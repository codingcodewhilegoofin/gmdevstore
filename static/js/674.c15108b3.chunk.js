"use strict";(self.webpackChunkgiomoscatoweb=self.webpackChunkgiomoscatoweb||[]).push([[674],{8621:function(e,t,r){r.d(t,{b:function(){return u}});var n=r(5987),i=r(2791),a=r(9324),o=r(3599),s=r(7760),l=["children","speed","rotationIntensity","floatIntensity","floatingRange"],u=i.forwardRef((function(e,t){var r=e.children,u=e.speed,c=void 0===u?1:u,h=e.rotationIntensity,d=void 0===h?1:h,f=e.floatIntensity,v=void 0===f?1:f,p=e.floatingRange,m=void 0===p?[-.1,.1]:p,g=(0,n.Z)(e,l),y=i.useRef(null),x=i.useRef(1e4*Math.random());return(0,a.x)((function(e){var t,r,n=x.current+e.clock.getElapsedTime();y.current.rotation.x=Math.cos(n/4*c)/8*d,y.current.rotation.y=Math.sin(n/4*c)/8*d,y.current.rotation.z=Math.sin(n/4*c)/20*d;var i=Math.sin(n/4*c)/10;i=s.MathUtils.mapLinear(i,-.1,.1,null!==(t=null==m?void 0:m[0])&&void 0!==t?t:-.1,null!==(r=null==m?void 0:m[1])&&void 0!==r?r:.1),y.current.position.y=i*v})),i.createElement("group",g,i.createElement("group",{ref:(0,o.Z)([y,t])},r))}))},580:function(e,t,r){r.d(t,{c:function(){return u}});var n=r(5987),i=r(7462),a=r(2791),o=r(9324),s=r(3599),l=["makeDefault"],u=a.forwardRef((function(e,t){var r=e.makeDefault,u=(0,n.Z)(e,l),c=(0,o.w)((function(e){return e.set})),h=(0,o.w)((function(e){return e.camera})),d=(0,o.w)((function(e){return e.size})),f=a.useRef();return a.useLayoutEffect((function(){var e=f.current;e&&!u.manual&&(e.aspect=d.width/d.height,e.updateProjectionMatrix())}),[d,u]),a.useLayoutEffect((function(){if(r&&f.current){var e=h;return c((function(){return{camera:f.current}})),function(){return c((function(){return{camera:e}}))}}}),[f,r,c]),a.createElement("perspectiveCamera",(0,i.Z)({ref:(0,s.Z)([f,t])},u))}))},3599:function(e,t){t.Z=function(e){return function(t){e.forEach((function(e){"function"===typeof e?e(t):null!=e&&(e.current=t)}))}}},1815:function(e,t,r){r.d(t,{Z:function(){return Vf}});var n=r(4165),i=r(5861),a=r(5647),o=r(1752),s=r(1120),l=r(2963),u=r(9439),c=r(3433),h=r(7326),d=r(136),f=r(9388),v=r(9611);function p(e){var t="function"===typeof Map?new Map:void 0;return p=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return(0,a.Z)(e,arguments,(0,s.Z)(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),(0,v.Z)(r,e)},p(e)}var m=r(4942),g=r(5671),y=r(3144),x=r(1413),b=r(7762),w=r(7760),S=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){return(0,g.Z)(this,r),t.call(this,e)}return(0,y.Z)(r,[{key:"load",value:function(e,t,r,n){var i=this,a=new w.FileLoader(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(e){var r;try{r=JSON.parse(e)}catch(oi){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(e.substring(65,e.length-2))}var n=i.parse(r);t&&t(n)}),r,n)}},{key:"parse",value:function(e){return new k(e)}}]),r}(w.Loader),k=function(){function e(t){(0,g.Z)(this,e),this.type="Font",this.data=t}return(0,y.Z)(e,[{key:"generateShapes",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=[],n=_(e,t,this.data),i=0,a=n.length;i<a;i++)Array.prototype.push.apply(r,n[i].toShapes());return r}}]),e}();function _(e,t,r){for(var n=Array.from(e),i=t/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*i,o=[],s=0,l=0,u=0;u<n.length;u++){var c=n[u];if("\n"===c)s=0,l-=a;else{var h=C(c,i,s,l,r);s+=h.offsetX,o.push(h.path)}}return o}function C(e,t,r,n,i){var a=i.glyphs[e]||i.glyphs["?"];if(a){var o,s,l,u,c,h,d,f,v=new w.ShapePath;if(a.o)for(var p=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),m=0,g=p.length;m<g;){switch(p[m++]){case"m":o=p[m++]*t+r,s=p[m++]*t+n,v.moveTo(o,s);break;case"l":o=p[m++]*t+r,s=p[m++]*t+n,v.lineTo(o,s);break;case"q":l=p[m++]*t+r,u=p[m++]*t+n,c=p[m++]*t+r,h=p[m++]*t+n,v.quadraticCurveTo(c,h,l,u);break;case"b":l=p[m++]*t+r,u=p[m++]*t+n,c=p[m++]*t+r,h=p[m++]*t+n,d=p[m++]*t+r,f=p[m++]*t+n,v.bezierCurveTo(c,h,d,f,l,u)}}return{offsetX:a.ha*t,path:v}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".")}k.prototype.isFont=!0;var O=new WeakMap,Z=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this,e)).decoderPath="",n.decoderConfig={},n.decoderBinary=null,n.decoderPending=null,n.workerLimit=4,n.workerPool=[],n.workerNextTaskID=1,n.workerSourceURL="",n.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},n.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"},n}return(0,y.Z)(r,[{key:"setDecoderPath",value:function(e){return this.decoderPath=e,this}},{key:"setDecoderConfig",value:function(e){return this.decoderConfig=e,this}},{key:"setWorkerLimit",value:function(e){return this.workerLimit=e,this}},{key:"load",value:function(e,t,r,n){var i=this,a=new w.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){var r={attributeIDs:i.defaultAttributeIDs,attributeTypes:i.defaultAttributeTypes,useUniqueIDs:!1};i.decodeGeometry(e,r).then(t).catch(n)}),r,n)}},{key:"decodeDracoFile",value:function(e,t,r,n){var i={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,i).then(t)}},{key:"decodeGeometry",value:function(e,t){var r=this;for(var n in t.attributeTypes){var i=t.attributeTypes[n];void 0!==i.BYTES_PER_ELEMENT&&(t.attributeTypes[n]=i.name)}var a,o=JSON.stringify(t);if(O.has(e)){var s=O.get(e);if(s.key===o)return s.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var l=this.workerNextTaskID++,u=e.byteLength,c=this._getWorker(l,u).then((function(r){return a=r,new Promise((function(r,n){a._callbacks[l]={resolve:r,reject:n},a.postMessage({type:"decode",id:l,taskConfig:t,buffer:e},[e])}))})).then((function(e){return r._createGeometry(e.geometry)}));return c.catch((function(){return!0})).then((function(){a&&l&&r._releaseTask(a,l)})),O.set(e,{key:o,promise:c}),c}},{key:"_createGeometry",value:function(e){var t=new w.BufferGeometry;e.index&&t.setIndex(new w.BufferAttribute(e.index.array,1));for(var r=0;r<e.attributes.length;r++){var n=e.attributes[r],i=n.name,a=n.array,o=n.itemSize;t.setAttribute(i,new w.BufferAttribute(a,o))}return t}},{key:"_loadLibrary",value:function(e,t){var r=new w.FileLoader(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((function(t,n){r.load(e,t,void 0,n)}))}},{key:"preload",value:function(){return this._initDecoder(),this}},{key:"_initDecoder",value:function(){var e=this;if(this.decoderPending)return this.decoderPending;var t="object"!==typeof WebAssembly||"js"===this.decoderConfig.type,r=[];return t?r.push(this._loadLibrary("draco_decoder.js","text")):(r.push(this._loadLibrary("draco_wasm_wrapper.js","text")),r.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(r).then((function(r){var n=r[0];t||(e.decoderConfig.wasmBinary=r[1]);var i=L.toString(),a=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([a]))})),this.decoderPending}},{key:"_getWorker",value:function(e,t){var r=this;return this._initDecoder().then((function(){if(r.workerPool.length<r.workerLimit){var n=new Worker(r.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:r.decoderConfig}),n.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},r.workerPool.push(n)}else r.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));var i=r.workerPool[r.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i}))}},{key:"_releaseTask",value:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}},{key:"debug",value:function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))}},{key:"dispose",value:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}]),r}(w.Loader);function L(){var e,t;function r(e,t,r,n,i,a){var o=a.num_components(),s=r.num_points()*o,l=s*i.BYTES_PER_ELEMENT,u=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),c=e._malloc(l);t.GetAttributeDataArrayForAllPoints(r,a,u,l,c);var h=new i(e.HEAPF32.buffer,c,s).slice();return e._free(c),{name:n,array:h,itemSize:o}}onmessage=function(n){var i=n.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var a=i.buffer,o=i.taskConfig;t.then((function(e){var t=e.draco,n=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(a),a.byteLength);try{var l=function(e,t,n,i){var a,o,s=i.attributeIDs,l=i.attributeTypes,u=t.GetEncodedGeometryType(n);if(u===e.TRIANGULAR_MESH)a=new e.Mesh,o=t.DecodeBufferToMesh(n,a);else{if(u!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,o=t.DecodeBufferToPointCloud(n,a)}if(!o.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+o.error_msg());var c={index:null,attributes:[]};for(var h in s){var d=self[l[h]],f=void 0,v=void 0;if(i.useUniqueIDs)v=s[h],f=t.GetAttributeByUniqueId(a,v);else{if(-1===(v=t.GetAttributeId(a,e[s[h]])))continue;f=t.GetAttribute(a,v)}c.attributes.push(r(e,t,a,h,d,f))}u===e.TRIANGULAR_MESH&&(c.index=function(e,t,r){var n=3*r.num_faces(),i=4*n,a=e._malloc(i);t.GetTrianglesUInt32Array(r,i,a);var o=new Uint32Array(e.HEAPF32.buffer,a,n).slice();return e._free(a),{array:o,itemSize:1}}(e,t,a));return e.destroy(a),c}(t,n,s,o),u=l.attributes.map((function(e){return e.array.buffer}));l.index&&u.push(l.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:l},u)}catch(c){console.error(c),self.postMessage({type:"error",id:i.id,error:c.message})}finally{t.destroy(s),t.destroy(n)}}))}}}function A(e){for(var t,r,n,i=0,a=0;a<e.length;++a){var o=e[a];if(o.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===r&&(r=o.itemSize),r!==o.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===n&&(n=o.normalized),n!==o.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;i+=o.array.length}for(var s=new t(i),l=0,u=0;u<e.length;++u)s.set(e[u].array,l),l+=e[u].array.length;return new w.BufferAttribute(s,r,n)}var M=Object.create,D=Object.defineProperty,T=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyNames,E=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty,N=function(e,t){for(var r in t)D(e,r,{get:t[r],enumerable:!0})},B=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}}((function(e,t){!function(r,n){"object"==typeof e&&typeof t<"u"?n(e):"function"==typeof define&&define.amd?define(["exports"],n):n((r=typeof globalThis<"u"?globalThis:r||self).SVDJS={})}(e,(function(e){e.SVD=function(e,t,r,n,i){if(t=void 0===t||t,r=void 0===r||r,i=1e-64/(n=n||Math.pow(2,-52)),!e)throw new TypeError("Matrix a is not defined");var a,o,s,l,u,c,h,d,f,v,p,m,g=e[0].length,y=e.length;if(y<g)throw new TypeError("Invalid matrix: m < n");for(var x=[],b=[],w=[],S="f"===t?y:g,k=v=h=0;k<y;k++)b[k]=new Array(S).fill(0);for(k=0;k<g;k++)w[k]=new Array(g).fill(0);var _,C=new Array(g).fill(0);for(k=0;k<y;k++)for(a=0;a<g;a++)b[k][a]=e[k][a];for(k=0;k<g;k++){for(x[k]=h,f=0,s=k+1,a=k;a<y;a++)f+=Math.pow(b[a][k],2);if(f<i)h=0;else for(d=(c=b[k][k])*(h=c<0?Math.sqrt(f):-Math.sqrt(f))-f,b[k][k]=c-h,a=s;a<g;a++){for(f=0,o=k;o<y;o++)f+=b[o][k]*b[o][a];for(c=f/d,o=k;o<y;o++)b[o][a]=b[o][a]+c*b[o][k]}for(C[k]=h,f=0,a=s;a<g;a++)f+=Math.pow(b[k][a],2);if(f<i)h=0;else{for(d=(c=b[k][k+1])*(h=c<0?Math.sqrt(f):-Math.sqrt(f))-f,b[k][k+1]=c-h,a=s;a<g;a++)x[a]=b[k][a]/d;for(a=s;a<y;a++){for(f=0,o=s;o<g;o++)f+=b[a][o]*b[k][o];for(o=s;o<g;o++)b[a][o]=b[a][o]+f*x[o]}}v<(p=Math.abs(C[k])+Math.abs(x[k]))&&(v=p)}if(r)for(k=g-1;0<=k;k--){if(0!==h){for(d=b[k][k+1]*h,a=s;a<g;a++)w[a][k]=b[k][a]/d;for(a=s;a<g;a++){for(f=0,o=s;o<g;o++)f+=b[k][o]*w[o][a];for(o=s;o<g;o++)w[o][a]=w[o][a]+f*w[o][k]}}for(a=s;a<g;a++)w[k][a]=0,w[a][k]=0;w[k][k]=1,h=x[k],s=k}if(t){if("f"===t)for(k=g;k<y;k++){for(a=g;a<y;a++)b[k][a]=0;b[k][k]=1}for(k=g-1;0<=k;k--){for(s=k+1,h=C[k],a=s;a<S;a++)b[k][a]=0;if(0!==h){for(d=b[k][k]*h,a=s;a<S;a++){for(f=0,o=s;o<y;o++)f+=b[o][k]*b[o][a];for(c=f/d,o=k;o<y;o++)b[o][a]=b[o][a]+c*b[o][k]}for(a=k;a<y;a++)b[a][k]=b[a][k]/h}else for(a=k;a<y;a++)b[a][k]=0;b[k][k]=b[k][k]+1}}for(n*=v,o=g-1;0<=o;o--)for(var O=0;O<50;O++){for(_=!1,s=o;0<=s;s--){if(Math.abs(x[s])<=n){_=!0;break}if(Math.abs(C[s-1])<=n)break}if(!_)for(u=0,l=s-(f=1),k=s;k<o+1&&(c=f*x[k],x[k]=u*x[k],!(Math.abs(c)<=n));k++)if(h=C[k],C[k]=Math.sqrt(c*c+h*h),u=h/(d=C[k]),f=-c/d,t)for(a=0;a<y;a++)p=b[a][l],m=b[a][k],b[a][l]=p*u+m*f,b[a][k]=-p*f+m*u;if(m=C[o],s===o){if(m<0&&(C[o]=-m,r))for(a=0;a<g;a++)w[a][o]=-w[a][o];break}for(v=C[s],c=(((p=C[o-1])-m)*(p+m)+((h=x[o-1])-(d=x[o]))*(h+d))/(2*d*p),h=Math.sqrt(c*c+1),c=((v-m)*(v+m)+d*(p/(c<0?c-h:c+h)-d))/v,k=s+(f=u=1);k<o+1;k++){if(h=x[k],p=C[k],d=f*h,h*=u,m=Math.sqrt(c*c+d*d),c=v*(u=c/(x[k-1]=m))+h*(f=d/m),h=-v*f+h*u,d=p*f,p*=u,r)for(a=0;a<g;a++)v=w[a][k-1],m=w[a][k],w[a][k-1]=v*u+m*f,w[a][k]=-v*f+m*u;if(m=Math.sqrt(c*c+d*d),c=(u=c/(C[k-1]=m))*h+(f=d/m)*p,v=-f*h+u*p,t)for(a=0;a<y;a++)p=b[a][k-1],m=b[a][k],b[a][k-1]=p*u+m*f,b[a][k]=-p*f+m*u}x[s]=0,x[o]=c,C[o]=v}for(k=0;k<g;k++)C[k]<n&&(C[k]=0);return{u:b,q:C,v:w}},e.VERSION="1.1.1",Object.defineProperty(e,"__esModule",{value:!0})}))}));var U="object"==typeof global&&global&&global.Object===Object&&global,I="object"==typeof self&&self&&self.Object===Object&&self,V=U||I||Function("return this")(),F=V.Symbol,j=Object.prototype,R=j.hasOwnProperty,G=j.toString,H=F?F.toStringTag:void 0;var W=function(e){var t=R.call(e,H),r=e[H];try{e[H]=void 0;var n=!0}catch(a){}var i=G.call(e);return n&&(t?e[H]=r:delete e[H]),i},q=Object.prototype.toString;var J=function(e){return q.call(e)},Y=F?F.toStringTag:void 0;var X=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Y&&Y in Object(e)?W(e):J(e)};var K=function(e){return null!=e&&"object"==typeof e};var Q=function(e){return"symbol"==typeof e||K(e)&&"[object Symbol]"==X(e)};var $=function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i},ee=Array.isArray,te=F?F.prototype:void 0,re=te?te.toString:void 0;var ne=function e(t){if("string"==typeof t)return t;if(ee(t))return $(t,e)+"";if(Q(t))return re?re.call(t):"";var r=t+"";return"0"==r&&1/t==-Infinity?"-0":r};var ie=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var ae=function(e){return e};var oe=function(e){if(!ie(e))return!1;var t=X(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},se=V["__core-js_shared__"],le=function(){var e=/[^.]+$/.exec(se&&se.keys&&se.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var ue=function(e){return!!le&&le in e},ce=Function.prototype.toString;var he=function(e){if(null!=e){try{return ce.call(e)}catch(t){}try{return e+""}catch(r){}}return""},de=/^\[object .+?Constructor\]$/,fe=Function.prototype,ve=Object.prototype,pe=fe.toString,me=ve.hasOwnProperty,ge=RegExp("^"+pe.call(me).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ye=function(e){return!(!ie(e)||ue(e))&&(oe(e)?ge:de).test(he(e))};var xe=function(e,t){return null===e||void 0===e?void 0:e[t]};var be=function(e,t){var r=xe(e,t);return ye(r)?r:void 0},we=be(V,"WeakMap"),Se=Object.create,ke=function(){function e(){}return function(t){if(!ie(t))return{};if(Se)return Se(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),_e=ke;var Ce=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)};var Oe=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t},Ze=Date.now;var Le=function(e){var t=0,r=0;return function(){var n=Ze(),i=16-(n-r);if(r=n,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}};var Ae=function(e){return function(){return e}},Me=function(){try{var e=be(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),De=Me,Te=De?function(e,t){return De(e,"toString",{configurable:!0,enumerable:!1,value:Ae(t),writable:!0})}:ae,ze=Le(Te);var Ee=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e},Pe=/^(?:0|[1-9]\d*)$/;var Ne=function(e,t){var r,n=typeof e;return!!(t=null!==(r=t)&&void 0!==r?r:9007199254740991)&&("number"==n||"symbol"!=n&&Pe.test(e))&&e>-1&&e%1==0&&e<t};var Be=function(e,t,r){"__proto__"==t&&De?De(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r};var Ue=function(e,t){return e===t||e!==e&&t!==t},Ie=Object.prototype.hasOwnProperty;var Ve=function(e,t,r){var n=e[t];(!Ie.call(e,t)||!Ue(n,r)||void 0===r&&!(t in e))&&Be(e,t,r)};var Fe=function(e,t,r,n){var i=!r;r||(r={});for(var a=-1,o=t.length;++a<o;){var s=t[a],l=n?n(r[s],e[s],s,r,e):void 0;void 0===l&&(l=e[s]),i?Be(r,s,l):Ve(r,s,l)}return r},je=Math.max;var Re=function(e,t,r){return t=je(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,a=je(n.length-t,0),o=Array(a);++i<a;)o[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(o),Ce(e,this,s)}};var Ge=function(e,t){return ze(Re(e,t,ae),e+"")};var He=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var We=function(e){return null!=e&&He(e.length)&&!oe(e)};var qe=function(e,t,r){if(!ie(r))return!1;var n=typeof t;return!!("number"==n?We(r)&&Ne(t,r.length):"string"==n&&t in r)&&Ue(r[t],e)};var Je=function(e){return Ge((function(t,r){var n=-1,i=r.length,a=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(a=e.length>3&&"function"==typeof a?(i--,a):void 0,o&&qe(r[0],r[1],o)&&(a=i<3?void 0:a,i=1),t=Object(t);++n<i;){var s=r[n];s&&e(t,s,n,a)}return t}))},Ye=Object.prototype;var Xe=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Ye)};var Ke=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var Qe=function(e){return K(e)&&"[object Arguments]"==X(e)},$e=Object.prototype,et=$e.hasOwnProperty,tt=$e.propertyIsEnumerable,rt=Qe(function(){return arguments}())?Qe:function(e){return K(e)&&et.call(e,"callee")&&!tt.call(e,"callee")},nt=rt;var it=function(){return!1},at="object"==typeof exports&&exports&&!exports.nodeType&&exports,ot=at&&"object"==typeof module&&module&&!module.nodeType&&module,st=ot&&ot.exports===at?V.Buffer:void 0,lt=(st?st.isBuffer:void 0)||it,ut={};ut["[object Float32Array]"]=ut["[object Float64Array]"]=ut["[object Int8Array]"]=ut["[object Int16Array]"]=ut["[object Int32Array]"]=ut["[object Uint8Array]"]=ut["[object Uint8ClampedArray]"]=ut["[object Uint16Array]"]=ut["[object Uint32Array]"]=!0,ut["[object Arguments]"]=ut["[object Array]"]=ut["[object ArrayBuffer]"]=ut["[object Boolean]"]=ut["[object DataView]"]=ut["[object Date]"]=ut["[object Error]"]=ut["[object Function]"]=ut["[object Map]"]=ut["[object Number]"]=ut["[object Object]"]=ut["[object RegExp]"]=ut["[object Set]"]=ut["[object String]"]=ut["[object WeakMap]"]=!1;var ct=function(e){return K(e)&&He(e.length)&&!!ut[X(e)]};var ht=function(e){return function(t){return e(t)}},dt="object"==typeof exports&&exports&&!exports.nodeType&&exports,ft=dt&&"object"==typeof module&&module&&!module.nodeType&&module,vt=ft&&ft.exports===dt&&U.process,pt=function(){try{return ft&&ft.require&&ft.require("util").types||vt&&vt.binding&&vt.binding("util")}catch(e){}}(),mt=pt&&pt.isTypedArray,gt=mt?ht(mt):ct,yt=Object.prototype.hasOwnProperty;var xt=function(e,t){var r=ee(e),n=!r&&nt(e),i=!r&&!n&&lt(e),a=!r&&!n&&!i&&gt(e),o=r||n||i||a,s=o?Ke(e.length,String):[],l=s.length;for(var u in e)(t||yt.call(e,u))&&(!o||!("length"==u||i&&("offset"==u||"parent"==u)||a&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Ne(u,l)))&&s.push(u);return s};var bt=function(e,t){return function(r){return e(t(r))}},wt=bt(Object.keys,Object),St=Object.prototype.hasOwnProperty;var kt=function(e){if(!Xe(e))return wt(e);var t=[];for(var r in Object(e))St.call(e,r)&&"constructor"!=r&&t.push(r);return t};var _t=function(e){return We(e)?xt(e):kt(e)};var Ct=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t},Ot=Object.prototype.hasOwnProperty;var Zt=function(e){if(!ie(e))return Ct(e);var t=Xe(e),r=[];for(var n in e)"constructor"==n&&(t||!Ot.call(e,n))||r.push(n);return r};var Lt=function(e){return We(e)?xt(e,!0):Zt(e)},At=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Mt=/^\w*$/;var Dt=function(e,t){if(ee(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!Q(e))||(Mt.test(e)||!At.test(e)||null!=t&&e in Object(t))},Tt=be(Object,"create");var zt=function(){this.__data__=Tt?Tt(null):{},this.size=0};var Et=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Pt=Object.prototype.hasOwnProperty;var Nt=function(e){var t=this.__data__;if(Tt){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Pt.call(t,e)?t[e]:void 0},Bt=Object.prototype.hasOwnProperty;var Ut=function(e){var t=this.__data__;return Tt?void 0!==t[e]:Bt.call(t,e)};var It=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Tt&&void 0===t?"__lodash_hash_undefined__":t,this};function Vt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Vt.prototype.clear=zt,Vt.prototype.delete=Et,Vt.prototype.get=Nt,Vt.prototype.has=Ut,Vt.prototype.set=It;var Ft=Vt;var jt=function(){this.__data__=[],this.size=0};var Rt=function(e,t){for(var r=e.length;r--;)if(Ue(e[r][0],t))return r;return-1},Gt=Array.prototype.splice;var Ht=function(e){var t=this.__data__,r=Rt(t,e);return!(r<0)&&(r==t.length-1?t.pop():Gt.call(t,r,1),--this.size,!0)};var Wt=function(e){var t=this.__data__,r=Rt(t,e);return r<0?void 0:t[r][1]};var qt=function(e){return Rt(this.__data__,e)>-1};var Jt=function(e,t){var r=this.__data__,n=Rt(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function Yt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Yt.prototype.clear=jt,Yt.prototype.delete=Ht,Yt.prototype.get=Wt,Yt.prototype.has=qt,Yt.prototype.set=Jt;var Xt=Yt,Kt=be(V,"Map");var Qt=function(){this.size=0,this.__data__={hash:new Ft,map:new(Kt||Xt),string:new Ft}};var $t=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var er=function(e,t){var r=e.__data__;return $t(t)?r["string"==typeof t?"string":"hash"]:r.map};var tr=function(e){var t=er(this,e).delete(e);return this.size-=t?1:0,t};var rr=function(e){return er(this,e).get(e)};var nr=function(e){return er(this,e).has(e)};var ir=function(e,t){var r=er(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function ar(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ar.prototype.clear=Qt,ar.prototype.delete=tr,ar.prototype.get=rr,ar.prototype.has=nr,ar.prototype.set=ir;var or=ar;function sr(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function r(){var n=arguments,i=t?t.apply(this,n):n[0],a=r.cache;if(a.has(i))return a.get(i);var o=e.apply(this,n);return r.cache=a.set(i,o)||a,o};return r.cache=new(sr.Cache||or),r}sr.Cache=or;var lr=sr;var ur=function(e){var t=lr(e,(function(e){return 500===r.size&&r.clear(),e})),r=t.cache;return t},cr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,hr=/\\(\\)?/g,dr=ur((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(cr,(function(e,r,n,i){t.push(n?i.replace(hr,"$1"):r||e)})),t})),fr=dr;var vr=function(e){return null==e?"":ne(e)};var pr=function(e,t){return ee(e)?e:Dt(e,t)?[e]:fr(vr(e))};var mr=function(e){if("string"==typeof e||Q(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t};var gr=function(e,t){for(var r=0,n=(t=pr(t,e)).length;null!=e&&r<n;)e=e[mr(t[r++])];return r&&r==n?e:void 0};var yr=function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e},xr=F?F.isConcatSpreadable:void 0;var br=function(e){return ee(e)||nt(e)||!!(xr&&e&&e[xr])};var wr=function e(t,r,n,i,a){var o=-1,s=t.length;for(n||(n=br),a||(a=[]);++o<s;){var l=t[o];r>0&&n(l)?r>1?e(l,r-1,n,i,a):yr(a,l):i||(a[a.length]=l)}return a};var Sr=function(e){return(null==e?0:e.length)?wr(e,1):[]};var kr=function(e){return ze(Re(e,void 0,Sr),e+"")},_r=bt(Object.getPrototypeOf,Object),Cr=Function.prototype,Or=Object.prototype,Zr=Cr.toString,Lr=Or.hasOwnProperty,Ar=Zr.call(Object);var Mr=function(e){if(!K(e)||"[object Object]"!=X(e))return!1;var t=_r(e);if(null===t)return!0;var r=Lr.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Zr.call(r)==Ar};var Dr=function(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var a=Array(i);++n<i;)a[n]=e[n+t];return a};var Tr=function(){this.__data__=new Xt,this.size=0};var zr=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var Er=function(e){return this.__data__.get(e)};var Pr=function(e){return this.__data__.has(e)};var Nr=function(e,t){var r=this.__data__;if(r instanceof Xt){var n=r.__data__;if(!Kt||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new or(n)}return r.set(e,t),this.size=r.size,this};function Br(e){var t=this.__data__=new Xt(e);this.size=t.size}Br.prototype.clear=Tr,Br.prototype.delete=zr,Br.prototype.get=Er,Br.prototype.has=Pr,Br.prototype.set=Nr;var Ur=Br;var Ir=function(e,t){return e&&Fe(t,_t(t),e)};var Vr=function(e,t){return e&&Fe(t,Lt(t),e)},Fr="object"==typeof exports&&exports&&!exports.nodeType&&exports,jr=Fr&&"object"==typeof module&&module&&!module.nodeType&&module,Rr=jr&&jr.exports===Fr?V.Buffer:void 0,Gr=Rr?Rr.allocUnsafe:void 0;var Hr=function(e,t){if(t)return e.slice();var r=e.length,n=Gr?Gr(r):new e.constructor(r);return e.copy(n),n};var Wr=function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,a=[];++r<n;){var o=e[r];t(o,r,e)&&(a[i++]=o)}return a};var qr=function(){return[]},Jr=Object.prototype.propertyIsEnumerable,Yr=Object.getOwnPropertySymbols,Xr=Yr?function(e){return null==e?[]:(e=Object(e),Wr(Yr(e),(function(t){return Jr.call(e,t)})))}:qr,Kr=Xr;var Qr=function(e,t){return Fe(e,Kr(e),t)},$r=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)yr(t,Kr(e)),e=_r(e);return t}:qr,en=$r;var tn=function(e,t){return Fe(e,en(e),t)};var rn=function(e,t,r){var n=t(e);return ee(e)?n:yr(n,r(e))};var nn=function(e){return rn(e,_t,Kr)};var an=function(e){return rn(e,Lt,en)},on=be(V,"DataView"),sn=be(V,"Promise"),ln=be(V,"Set"),un="[object Map]",cn="[object Promise]",hn="[object Set]",dn="[object WeakMap]",fn="[object DataView]",vn=he(on),pn=he(Kt),mn=he(sn),gn=he(ln),yn=he(we),xn=X;(on&&xn(new on(new ArrayBuffer(1)))!=fn||Kt&&xn(new Kt)!=un||sn&&xn(sn.resolve())!=cn||ln&&xn(new ln)!=hn||we&&xn(new we)!=dn)&&(xn=function(e){var t=X(e),r="[object Object]"==t?e.constructor:void 0,n=r?he(r):"";if(n)switch(n){case vn:return fn;case pn:return un;case mn:return cn;case gn:return hn;case yn:return dn}return t});var bn=xn,wn=Object.prototype.hasOwnProperty;var Sn=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&wn.call(e,"index")&&(r.index=e.index,r.input=e.input),r},kn=V.Uint8Array;var _n=function(e){var t=new e.constructor(e.byteLength);return new kn(t).set(new kn(e)),t};var Cn=function(e,t){var r=t?_n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)},On=/\w*$/;var Zn=function(e){var t=new e.constructor(e.source,On.exec(e));return t.lastIndex=e.lastIndex,t},Ln=F?F.prototype:void 0,An=Ln?Ln.valueOf:void 0;var Mn=function(e){return An?Object(An.call(e)):{}};var Dn=function(e,t){var r=t?_n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)};var Tn=function(e,t,r){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return _n(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return Cn(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Dn(e,r);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return Zn(e);case"[object Symbol]":return Mn(e)}};var zn=function(e){return"function"!=typeof e.constructor||Xe(e)?{}:_e(_r(e))};var En=function(e){return K(e)&&"[object Map]"==bn(e)},Pn=pt&&pt.isMap,Nn=Pn?ht(Pn):En;var Bn=function(e){return K(e)&&"[object Set]"==bn(e)},Un=pt&&pt.isSet,In=Un?ht(Un):Bn,Vn="[object Arguments]",Fn="[object Function]",jn="[object Object]",Rn={};Rn[Vn]=Rn["[object Array]"]=Rn["[object ArrayBuffer]"]=Rn["[object DataView]"]=Rn["[object Boolean]"]=Rn["[object Date]"]=Rn["[object Float32Array]"]=Rn["[object Float64Array]"]=Rn["[object Int8Array]"]=Rn["[object Int16Array]"]=Rn["[object Int32Array]"]=Rn["[object Map]"]=Rn["[object Number]"]=Rn[jn]=Rn["[object RegExp]"]=Rn["[object Set]"]=Rn["[object String]"]=Rn["[object Symbol]"]=Rn["[object Uint8Array]"]=Rn["[object Uint8ClampedArray]"]=Rn["[object Uint16Array]"]=Rn["[object Uint32Array]"]=!0,Rn["[object Error]"]=Rn[Fn]=Rn["[object WeakMap]"]=!1;var Gn=function e(t,r,n,i,a,o){var s,l=1&r,u=2&r,c=4&r;if(n&&(s=a?n(t,i,a,o):n(t)),void 0!==s)return s;if(!ie(t))return t;var h=ee(t);if(h){if(s=Sn(t),!l)return Oe(t,s)}else{var d=bn(t),f=d==Fn||"[object GeneratorFunction]"==d;if(lt(t))return Hr(t,l);if(d==jn||d==Vn||f&&!a){if(s=u||f?{}:zn(t),!l)return u?tn(t,Vr(s,t)):Qr(t,Ir(s,t))}else{if(!Rn[d])return a?t:{};s=Tn(t,d,l)}}o||(o=new Ur);var v=o.get(t);if(v)return v;o.set(t,s),In(t)?t.forEach((function(i){s.add(e(i,r,n,i,t,o))})):Nn(t)&&t.forEach((function(i,a){s.set(a,e(i,r,n,a,t,o))}));var p=h?void 0:(c?u?an:nn:u?Lt:_t)(t);return Ee(p||t,(function(i,a){p&&(i=t[a=i]),Ve(s,a,e(i,r,n,a,t,o))})),s};var Hn=function(e){return Gn(e,5)};var Wn=function(e){return function(t,r,n){for(var i=-1,a=Object(t),o=n(t),s=o.length;s--;){var l=o[e?s:++i];if(!1===r(a[l],l,a))break}return t}},qn=Wn();var Jn=function(e,t,r){(void 0!==r&&!Ue(e[t],r)||void 0===r&&!(t in e))&&Be(e,t,r)};var Yn=function(e){return K(e)&&We(e)};var Xn=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]};var Kn=function(e){return Fe(e,Lt(e))};var Qn=function(e,t,r,n,i,a,o){var s=Xn(e,r),l=Xn(t,r),u=o.get(l);if(u)Jn(e,r,u);else{var c=a?a(s,l,r+"",e,t,o):void 0,h=void 0===c;if(h){var d=ee(l),f=!d&&lt(l),v=!d&&!f&&gt(l);c=l,d||f||v?ee(s)?c=s:Yn(s)?c=Oe(s):f?(h=!1,c=Hr(l,!0)):v?(h=!1,c=Dn(l,!0)):c=[]:Mr(l)||nt(l)?(c=s,nt(s)?c=Kn(s):(!ie(s)||oe(s))&&(c=zn(l))):h=!1}h&&(o.set(l,c),i(c,l,n,a,o),o.delete(l)),Jn(e,r,c)}};var $n=function e(t,r,n,i,a){t!==r&&qn(r,(function(o,s){if(a||(a=new Ur),ie(o))Qn(t,r,s,n,e,i,a);else{var l=i?i(Xn(t,s),o,s+"",t,r,a):void 0;void 0===l&&(l=o),Jn(t,s,l)}}),Lt)};var ei=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0};var ti=function(e,t){return t.length<2?e:gr(e,Dr(t,0,-1))},ri=Je((function(e,t,r){$n(e,t,r)})),ni=ri;var ii=function(e,t){return t=pr(t,e),null==(e=ti(e,t))||delete e[mr(ei(t))]};var ai,oi,si,li,ui,ci,hi,di,fi,vi,pi,mi,gi,yi,xi,bi,wi=function(e){return Mr(e)?void 0:e},Si=kr((function(e,t){var r={};if(null==e)return r;var n=!1;t=$(t,(function(t){return t=pr(t,e),n||(n=t.length>1),t})),Fe(e,an(e),r),n&&(r=Gn(r,7,wi));for(var i=t.length;i--;)ii(r,t[i]);return r})),ki=Si;(oi=ai||(ai={})).all=["PerspectiveCamera","OrthographicCamera"],oi.is=function(e){return oi.all.includes(e)},(li=si||(si={})).DefaultUp=[0,1,0],li.DefaultTargetOffset=1e3,li.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:5,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:li.DefaultUp,isUpVectorFlipped:!1,targetOffset:li.DefaultTargetOffset},li.getZoom=function(e){return"PerspectiveCamera"===e.type?e.perspective.zoom:e.orthographic.zoom},function(e){e.isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]},e.lerp=function(e,t,r){return[e[0]+(t[0]-e[0])*r,e[1]+(t[1]-e[1])*r]}}(ui||(ui={})),function(e){e.isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.add=function(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]},e.sub=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},e.lerp=function(e,t,r){return[e[0]+(t[0]-e[0])*r,e[1]+(t[1]-e[1])*r,e[2]+(t[2]-e[2])*r]}}(ci||(ci={})),function(e){e.isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.lerp=function(e,t,r){return[e[0]+(t[0]-e[0])*r,e[1]+(t[1]-e[1])*r,e[2]+(t[2]-e[2])*r,e[3]+(t[3]-e[3])*r]}}(hi||(hi={})),function(e){e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e.isEqual=function(e,t){for(var r=0;r<16;r++)if(e[r]!==t[r])return!1;return!0},e.simplify=function(t){return null!==t&&void 0!==t?t:e.identity},e.applyMatrix4=function(e,t){for(var r=t.slice(0),n=0,i=t.length;n<i;n+=3){var a=e[3]*t[n]+e[7]*t[n+1]+e[11]*t[n+2]+e[15];r[n]=(e[0]*t[n]+e[4]*t[n+1]+e[8]*t[n+2]+e[12])/a,r[n+1]=(e[1]*t[n]+e[5]*t[n+1]+e[9]*t[n+2]+e[13])/a,r[n+2]=(e[2]*t[n]+e[6]*t[n+1]+e[10]*t[n+2]+e[14])/a}return r}}(di||(di={})),(vi=fi||(fi={})).white={r:1,g:1,b:1},vi.red={r:1,g:0,b:0},vi.black={r:0,g:0,b:0},vi.toRgb255a1=function(e){return{r:Math.round(255*e.r),g:Math.round(255*e.g),b:Math.round(255*e.b),a:1}},vi.clone=function(e){return{r:e.r,g:e.g,b:e.b}},vi.fromHex=function(e){return{r:((e=Math.floor(e))>>16&255)/255,g:(e>>8&255)/255,b:(255&e)/255}},vi.equals=function(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b},vi.lerp=function(e,t,r){return{r:e.r+(t.r-e.r)*r,g:e.g+(t.g-e.g)*r,b:e.b+(t.b-e.b)*r}},(mi=pi||(pi={})).white=(0,x.Z)((0,x.Z)({},fi.white),{},{a:1}),mi.from0to1=function(e){return{r:e[0],g:e[1],b:e[2],a:e[3]}},mi.fromHexAndA=function(e,t){return(0,x.Z)((0,x.Z)({},fi.fromHex(e)),{},{a:t})},mi.toRgb255a1=function(e){return{r:Math.round(255*e.r),g:Math.round(255*e.g),b:Math.round(255*e.b),a:e.a}},mi.equals=function(e,t){return fi.equals(e,t)&&e.a===t.a},mi.lerp=function(e,t,r){return{r:e.r+(t.r-e.r)*r,g:e.g+(t.g-e.g)*r,b:e.b+(t.b-e.b)*r,a:e.a+(t.a-e.a)*r}},(gi||(gi={})).identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]},function(e){e.defaultData={mass:1,stiffness:80,damping:10,velocity:0}}(yi||(yi={})),function(e){e.defaultData={control1:[.5,.05],control2:[.1,.3]}}(xi||(xi={})),function(e){e.defaultData=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return{type:"radial",hideBase:!1,count:3,radial:{radius:2*Math.max(e[0],e[1]),start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},linear:{scale:[1,1,1],rotation:[0,0,0],position:[e[0]+e[0]*t,0,0]},grid:{count:[2,2,2],size:e.map((function(e){return e*(1+t)})),useCenter:!0}}}}(bi||(bi={}));var _i=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,[{key:"modifyById",value:function(t,r){if(void 0===this[t])throw new Error("not expected");var n=(0,x.Z)((0,x.Z)({},this),{},(0,m.Z)({},t,r));return Object.setPrototypeOf(n,e.prototype),n}},{key:"add",value:function(e,t){var r,n;return null!==(r=null===(n=this.runOp({type:1,id:e,data:t}))||void 0===n?void 0:n.data)&&void 0!==r?r:this}},{key:"runOp",value:function(t){var r=this;if(1===t.type){var n,i=r[t.id];n=void 0===i?{type:2,id:t.id}:{type:1,id:t.id,data:i};var a=t.id,o=t.data,s=(0,x.Z)((0,x.Z)({},r),{},(0,m.Z)({},a,o));return Object.setPrototypeOf(s,e.prototype),{data:s,actual:t,reverse:n}}if(2===t.type){var l=t.id,u=r[l];if(void 0===u)return null;var c=(0,x.Z)({},r);return Object.setPrototypeOf(c,e.prototype),delete c[l],{data:c,actual:t,reverse:{type:1,id:l,data:u}}}throw new Error("illegal arg")}}]),e}();function Ci(e){if(void 0===e.deepFreeze){var t,r=Object.getOwnPropertyNames(e),n=(0,b.Z)(r);try{for(n.s();!(t=n.n()).done;){var i=e[t.value];i&&"object"==typeof i&&Ci(i)}}catch(a){n.e(a)}finally{n.f()}return Object.freeze(e)}e.deepFreeze(e)}var Oi=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){return(0,g.Z)(this,r),t.apply(this,arguments)}return(0,y.Z)(r)}(p(Error));function Zi(e,t,r){if(void 0===e?void 0===t?(e=0,t=10):e=t-10:void 0===t&&(t=e+10),e>t){var n=e;e=t,t=n}for(var i=[],a=1/(r+1),o=0;o<r;o++){var s=e+(t-e)*(o+.75+.5*Math.random())*a;i.push(s)}return i}function Li(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function Ai(e,t){var r,n=(0,b.Z)(e);try{for(n.s();!(r=n.n()).done;){var i=r.value;t(i.id,i.data),Ai(i.children,t)}}catch(a){n.e(a)}finally{n.f()}}function Mi(e,t){t(e.id,e.data);var r,n=(0,b.Z)(e.children);try{for(n.s();!(r=n.n()).done;){Mi(r.value,t)}}catch(i){n.e(i)}finally{n.f()}}var Di,Ti=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;(0,g.Z)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Object.setPrototypeOf((0,h.Z)(e),r.prototype),e}return(0,y.Z)(r,[{key:"deepFreeze",value:function(){for(var e=0;e<this.length;)Ci(this[e]),e++}},{key:"fillCaches0",value:function(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);var r,n=(0,b.Z)(e.children);try{for(n.s();!(r=n.n()).done;){var i=r.value;this.fillCaches0(i,e.id)}}catch(a){n.e(a)}finally{n.f()}}},{key:"fillCaches",value:function(){if(void 0===this.objCaches){this.objCaches=new Map,this.parentCaches=new Map;var e,t=(0,b.Z)(this);try{for(t.s();!(e=t.n()).done;){var r=e.value;this.fillCaches0(r,null)}}catch(n){t.e(n)}finally{t.f()}}}},{key:"randomId",value:function(){this.fillCaches();var e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}},{key:"isDescendantOf",value:function(e,t){for(;e;){var r=this.parent(e);if(r===t)return!0;e=r}return!1}},{key:"data",value:function(e){var t;return null===(t=this.get(e))||void 0===t?void 0:t.data}},{key:"has",value:function(e){return void 0!==this.childrenOf(e)}},{key:"get",value:function(e){return this.fillCaches(),this.objCaches.get(e)}},{key:"childrenOf",value:function(e){var t;return null===e?this:null===(t=this.get(e))||void 0===t?void 0:t.children}},{key:"traverseFrom",value:function(e,t){if(null===e)this.traverse(t);else{var r=this.get(e);r&&Mi(r,t)}}},{key:"traverse",value:function(e){Ai(this,e)}},{key:"totalSize",value:function(){return this.fillCaches(),this.objCaches.size}},{key:"parent",value:function(e){return this.fillCaches(),this.parentCaches.get(e)}},{key:"childrenArray",value:function(e){return null===e?this:this.get(e).children}},{key:"modifyById",value:function(e,t){if(void 0===this.get(e))throw new Error("not expected");var r=this.parent(e),n=this.childrenArray(r),i=n.findIndex((function(t){return t.id===e}));if(i<0)throw new Error("not expected");var a=n[i];return(n=(0,c.Z)(n))[i]=(0,x.Z)((0,x.Z)({},a),{},{data:t}),this.modifyArrayBy(r,n)}},{key:"modifyArrayBy",value:function(e,t){for(var n=this,i=e,a=t,o=function(){var e=a,t=i;if(void 0===(i=n.parent(i)))throw new Error;var r=(a=n.childrenArray(i)).findIndex((function(e){return e.id===t}));if(r<0)throw new Error;(a=(0,c.Z)(a))[r]=(0,x.Z)((0,x.Z)({},a[r]),{},{children:e})};null!==i;)o();Object.setPrototypeOf(a,r.prototype);var s=a;return s.fillCaches(),s}},{key:"runOp",value:function(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}}},{key:"checkDuplicatedIdRec",value:function(e){var t=e.id,r=e.children;if(void 0!==this.get(t))return!0;var n,i=(0,b.Z)(r);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(this.checkDuplicatedIdRec(a))return!0}}catch(o){i.e(o)}finally{i.f()}return!1}},{key:"addOp",value:function(e){var t=e.parent,r=e.fi,n=e.id,i=e.data,a=e.children;if(null!==t&&void 0===this.get(t))return null;if(this.checkDuplicatedIdRec(e))return null;var o=t,s=this.childrenArray(o),l={fi:r,id:n,data:i,children:a};return(s=[].concat((0,c.Z)(s),[l])).sort((function(e,t){return e.fi-t.fi})),e.localIndex=s.indexOf(l),{data:this.modifyArrayBy(o,s),actual:e,reverse:{type:8,id:n}}}},{key:"deleteOp",value:function(e){var t=e.id;if(null===this.get(t))return null;var r=this.parent(t);if(void 0===r)return null;var n=this.childrenArray(r),i=n.findIndex((function(e){return e.id===t}));e.localIndex=i;var a=(n=(0,c.Z)(n)).splice(i,1)[0];return{data:this.modifyArrayBy(r,n),actual:e,reverse:(0,x.Z)((0,x.Z)({type:7},a),{},{parent:r})}}},{key:"moveOp",value:function(e){var t=e.parent,r=e.fi,n=e.id;if(null!==t&&void 0===this.get(t))return this.deleteOp({type:8,id:n});if(null!==t)for(var i=t;null!==i;){if(void 0===i)throw new Error;if(i===n)throw new Oi("cyclic tree");i=this.parent(i)}var a=this.parent(n);if(void 0===a)return null;var o=a,s=this.childrenArray(a),l=s.findIndex((function(e){return e.id===n})),u=(s=(0,c.Z)(s)).splice(l,1)[0],h=this.modifyArrayBy(a,s);a=t,s=h.childrenArray(a);var d=u.fi;return u=(0,x.Z)((0,x.Z)({},u),{},{fi:r}),(s=[].concat((0,c.Z)(s),[u])).sort((function(e,t){return e.fi-t.fi})),e.localIndex=s.indexOf(u),{data:h=h.modifyArrayBy(a,s),actual:e,reverse:{type:9,parent:o,fi:d,id:n}}}},{key:"previous",value:function(e,t){if(null===t){var r=this.childrenArray(e);return 0===r.length?null:r[r.length-1].id}var n,i=null,a=(0,b.Z)(this.childrenArray(e));try{for(a.s();!(n=a.n()).done;){var o=n.value;if(o.id===t)return i;i=o.id}}catch(s){a.e(s)}finally{a.f()}return null}},{key:"traverseSortNext",value:function(e){var t=this.parent(e);if(void 0!==t){var r=this.childrenArray(t),n=r.findIndex((function(t){return t.id===e}))+1;if(n<r.length)return r[n].id;if(t)return this.traverseSortNext(t)}}},{key:"sortNext",value:function(e){var t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}},{key:"traverseSortPrevious",value:function(e){var t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}},{key:"sortPrevious",value:function(e){var t=this.parent(e);if(void 0!==t){var r=this.childrenArray(t),n=r.findIndex((function(t){return t.id===e}))-1;return n>=0?this.traverseSortPrevious(r[n].id):t}}},{key:"getAllSorted",value:function(e){var t,r=[],n=(0,b.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,a=this.getWithSortKey(i.id);void 0!==a&&r.push((0,x.Z)((0,x.Z)({},i),a))}}catch(l){n.e(l)}finally{n.f()}r.sort((function(e,t){return function(e,t){for(var r=0;r<e.length&&r<t.length;){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1;r+=1}return r!==t.length?-1:r!==e.length?1:0}(e.sortKey,t.sortKey)}));for(var o=0,s=r;o<s.length;o++){delete s[o].sortKey}return r}},{key:"getWithSortKey",value:function(e){var t=e,r=[],n=this.get(t),i=n;if(void 0!==n){for(;t;)r.splice(0,0,n.fi),null!==(t=this.parent(t))&&(n=this.get(t));return(0,x.Z)((0,x.Z)({},i),{},{sortKey:r})}}},{key:"insertBeforeHelper",value:function(e,t,r){return this.insertAfterHelper(e,this.previous(e,t),r)}},{key:"insertAfterHelper",value:function(e,t,r){var n=this.childrenArray(e);if(null===t){if(0===n.length)return Zi(0,r,r);var i=n[0].fi;return Zi(i-r,i,r)}var a=this.get(t);if(void 0===a||this.parent(t)!==e)throw new Error("illegal args");var o=n.find((function(e){return e.fi>a.fi}));if(void 0===o){var s=n[n.length-1].fi;return Zi(s,s+r,r)}return Zi(a.fi,o.fi,r)}}]),r}(p(Array));!function(e){e.runOp=function(e,t){if(Array.isArray(e)){var r=t.props,n={},i=(0,c.Z)(e),a=!1;if(r)for(var o=0,s=Object.keys(r);o<s.length;o++){var l=s[o],u=parseInt(l);if(isNaN(u))throw new Error("wrong index");n[l]=i[u],i[u]=r[l],a=!0}return a?{data:i,actual:t,reverse:{type:0,props:n}}:null}var h=t.props,d={},f=(0,x.Z)({},e),v=!1;if(h)for(var p=0,m=Object.keys(h);p<m.length;p++){var g=m[p];d[g]=f[g];var y=h[g];void 0===y?delete f[g]:f[g]=y,v=!0}return v?{data:f,actual:t,reverse:{type:0,props:d}}:null}}(Di||(Di={}));var zi=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;(0,g.Z)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),Object.setPrototypeOf((0,h.Z)(e),r.prototype),e}return(0,y.Z)(r,[{key:"deepFreeze",value:function(){for(var e=0;e<this.length;)Ci(this[e]),e++}},{key:"fillCaches0",value:function(e){this.objCaches.set(e.id,e)}},{key:"fillCaches",value:function(){if(void 0===this.objCaches){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;var e,t=(0,b.Z)(this);try{for(t.s();!(e=t.n()).done;){var r=e.value;this.fillCaches0(r)}}catch(n){t.e(n)}finally{t.f()}}}},{key:"randomId",value:function(){this.fillCaches();var e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}},{key:"data",value:function(e){var t;return null===(t=this.get(e))||void 0===t?void 0:t.data}},{key:"get",value:function(e){return this.fillCaches(),this.objCaches.get(e)}},{key:"modifyById",value:function(e,t){if(void 0===this.get(e))throw new Error("not expected");var r=this,n=r.findIndex((function(t){return t.id===e}));if(n<0)throw new Error("not expected");var i=r[n];return(r=(0,c.Z)(r))[n]=(0,x.Z)((0,x.Z)({},i),{},{data:t}),this.modifyArrayBy(r)}},{key:"modifyArrayBy",value:function(e){Object.setPrototypeOf(e,r.prototype);var t=e;return typeof process<"u"||t.fillCaches(),t}},{key:"runOp",value:function(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}}},{key:"addOp",value:function(e){var t=e.fi,r=e.id,n=this,i={fi:t,id:r,data:e.data};return(n=[].concat((0,c.Z)(n),[i])).sort((function(e,t){return e.fi-t.fi})),e.localIndex=n.indexOf(i),{data:this.modifyArrayBy(n),actual:e,reverse:{type:5,id:r}}}},{key:"deleteOp",value:function(e){var t=e.id,r=this,n=r.findIndex((function(e){return e.id===t}));if(-1===n)return null;e.localIndex=n;var i=(r=(0,c.Z)(r)).splice(n,1)[0];return{data:this.modifyArrayBy(r),actual:e,reverse:(0,x.Z)({type:4},i)}}},{key:"moveOp",value:function(e){var t=e.fi,r=e.id,n=this,i=(n=(0,c.Z)(n)).findIndex((function(e){return e.id===r}));if(-1===i)return null;var a=n[i].fi,o=(0,x.Z)((0,x.Z)({},n[i]),{},{fi:t});return n[i]=o,n.sort((function(e,t){return e.fi-t.fi})),e.localIndex=n.indexOf(o),{data:this.modifyArrayBy(n),actual:e,reverse:{type:6,fi:a,id:r}}}},{key:"previous",value:function(e){if(null===e)return 0===this.length?null:this[this.length-1].id;var t,r=null,n=(0,b.Z)(this);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.id===e)return r;r=i.id}}catch(a){n.e(a)}finally{n.f()}return null}},{key:"insertBeforeHelper",value:function(e,t){return this.insertAfterHelper(this.previous(e),t)}},{key:"insertAfterHelper",value:function(e,t){var r=this;if(null===e){if(0===r.length)return Zi(0,t,t);var n=r[0].fi;return Zi(n-t,n,t)}var i=this.get(e);if(void 0===i)throw new Error("illegal args");var a=r.find((function(e){return e.fi>i.fi}));if(void 0===a){var o=r[r.length-1].fi;return Zi(o,o+t,t)}return Zi(i.fi,a.fi,t)}}]),r}(p(Array)),Ei=Symbol(),Pi=Symbol(),Ni=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,[{key:"reportOp",value:function(e,t){var r=this;if(null!==t){r._current=t.data;for(var n=[];!(r instanceof Wi);){var i=r._path,a=r._current;if(""!==i&&n.splice(0,0,i),null===(r=r._parent))return;r.update(i,a)}r.push(n,e,t.actual,t.reverse)}}},{key:"deleteChildren",value:function(e){if(this._children){var t=this._children[e];if(t){var r=t[Pi];r&&r(),delete this._children[e]}}}}]),e}(),Bi=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i){var a;return(0,g.Z)(this,r),(a=t.call(this))._parent=e,a._path=n,a._current=i,a}return(0,y.Z)(r,[{key:"update",value:function(e,t){if(Array.isArray(this._current)){if("string"==typeof e&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=(0,c.Z)(this._current),this._current[e]=t}else this._current=(0,x.Z)((0,x.Z)({},this._current),{},(0,m.Z)({},e,t))}},{key:"runOp",value:function(e){this.reportOp(e,Di.runOp(this._current,e))}}]),r}(Ni),Ui=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i){var a;return(0,g.Z)(this,r),(a=t.call(this))._parent=e,a._path=n,a._current=i,a}return(0,y.Z)(r,[{key:"update",value:function(e,t){this._current=(0,x.Z)((0,x.Z)({},this._current),{},(0,m.Z)({},e,t)),Object.setPrototypeOf(this._current,_i.prototype)}},{key:"runOp",value:function(e){this.reportOp(e,this._current.runOp(e))}}]),r}(Ni),Ii={get:function(e,t){if(t===Pi)return function(){e._parent=null};if(t===Ei)return e._current;var r=e._current,n=e._children;if("push"===t&&Array.isArray(r))throw new Error("not supported to expand array");var i=void 0===n?void 0:n[t];if(void 0!==i)return i;var a=r[t],o=qi(e,t,a);return o!==a?(void 0===n&&(n={},e._children=n),n[t]=o,o):a},has:function(e,t){return t in e._current},ownKeys:function(e){return Reflect.ownKeys(e._current)},defineProperty:function(){throw Error("not supported")},getPrototypeOf:function(e){return Object.getPrototypeOf(e._current)},setPrototypeOf:function(){throw Error("not supported")},getOwnPropertyDescriptor:function(e,t){var r=e._current,n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:!0,enumerable:n.enumerable,value:r[t]}}},Vi=(0,x.Z)((0,x.Z)({},Ii),{},{set:function(e,t,r){var n,i={type:0,props:(0,m.Z)({},t,null!==(n=Xi(r))&&void 0!==n?n:r)};return e.deleteChildren(t),e.runOp(i),!0},deleteProperty:function(e,t){var r={type:0,props:(0,m.Z)({},t,void 0)};return e.deleteChildren(t),e.runOp(r),!0}}),Fi=(0,x.Z)((0,x.Z)({},Ii),{},{set:function(e,t,r){return void 0===r?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:r})),!0},deleteProperty:function(e,t){return e.runOp({type:2,id:t}),!0}}),ji=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i){var a;return(0,g.Z)(this,r),(a=t.call(this))._children={},a._parent=e,a._path=n,a._current=i,a[Pi]=function(){a._parent=null},a}return(0,y.Z)(r,[{key:"unproxy",value:function(){return this._current}},{key:"update",value:function(e,t){this._current=this._current.modifyById(e,t)}},{key:"runOp",value:function(e){this.reportOp(e,this._current.runOp(e))}},{key:"randomId",value:function(){return this._current.randomId()}},{key:"isDescendantOf",value:function(e,t){return this._current.isDescendantOf(e,t)}},{key:"childrenOf",value:function(e){return this._current.childrenOf(e)}},{key:"traverse",value:function(e){var t=this;this._current.traverse((function(r,n){e(r,t.data(r))}))}},{key:"get",value:function(e){return this._current.get(e)}},{key:"parent",value:function(e){return this._current.parent(e)}},{key:"data",value:function(e){var t,r=this._current,n=this._children,i=void 0===n?void 0:n[e];if(void 0!==i)return i;var a=null===(t=r.get(e))||void 0===t?void 0:t.data,o=qi(this,e,a);return o!==a?(void 0===n&&(n={},this._children=n),n[e]=o,o):a}},{key:"add",value:function(e,t,r,n,i){this.runOp({type:7,parent:e,fi:t,id:r,data:n,children:i})}},{key:"move",value:function(e,t,r){this.runOp({type:9,parent:e,fi:t,id:r})}},{key:"insertAfter",value:function(e,t,r){for(var n=this._current.insertAfterHelper(e,t,r.length),i=0;i<r.length;i++){var a=r[i];this.add(e,n[i],a.id,a.data,a.children)}}},{key:"insertBefore",value:function(e,t,r){for(var n=this._current.insertBeforeHelper(e,t,r.length),i=0;i<r.length;i++){var a=r[i];this.add(e,n[i],a.id,a.data,a.children)}}},{key:"moveAfter",value:function(e,t,r){for(var n=this._current.insertAfterHelper(e,t,r.length),i=0;i<r.length;i++){var a=r[i];this.move(e,n[i],a)}}},{key:"moveBefore",value:function(e,t,r){for(var n=this._current.insertBeforeHelper(e,t,r.length),i=0;i<r.length;i++){var a=r[i];this.move(e,n[i],a)}}},{key:"delete",value:function(e){this.deleteChildren(e),this.runOp({type:8,id:e})}},{key:"sortNext",value:function(e){return this._current.sortNext(e)}},{key:"sortPrevious",value:function(e){return this._current.sortPrevious(e)}},{key:"getAllSorted",value:function(e){return this._current.getAllSorted(e)}}]),r}(Ni),Ri=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i){var a;return(0,g.Z)(this,r),(a=t.call(this))._children={},a._parent=e,a._path=n,a._current=i,a[Pi]=function(){a._parent=null},a}return(0,y.Z)(r,[{key:"unproxy",value:function(){return this._current}},{key:"length",get:function(){return this._current.length}},{key:"forEach",value:function(e){for(var t=this.length,r=0;r<t;r++){var n=this._current[r].id;e(this.data(this._current[r].id),n)}}},{key:"update",value:function(e,t){this._current=this._current.modifyById(e,t)}},{key:"randomId",value:function(){return this._current.randomId()}},{key:"get",value:function(e){return(0,x.Z)((0,x.Z)({},this._current.get(e)),{},{data:this.data(e)})}},{key:"data",value:function(e){var t,r=this._current,n=this._children,i=void 0===n?void 0:n[e];if(void 0!==i)return i;var a=null===(t=r.get(e))||void 0===t?void 0:t.data,o=qi(this,e,a);return o!==a?(void 0===n&&(n={},this._children=n),n[e]=o,o):a}},{key:"runOp",value:function(e){this.reportOp(e,this._current.runOp(e))}},{key:"add",value:function(e,t,r){this.runOp({type:4,fi:e,id:t,data:r})}},{key:"move",value:function(e,t){this.runOp({type:6,fi:e,id:t})}},{key:"insertAfter",value:function(e,t){for(var r=this._current.insertAfterHelper(e,t.length),n=0;n<t.length;n++){var i=t[n];this.add(r[n],i.id,i.data)}}},{key:"insertBefore",value:function(e,t){for(var r=this._current.insertBeforeHelper(e,t.length),n=0;n<t.length;n++){var i=t[n];this.add(r[n],i.id,i.data)}}},{key:"moveAfter",value:function(e,t){for(var r=this._current.insertAfterHelper(e,t.length),n=0;n<t.length;n++){var i=t[n];this.move(r[n],i)}}},{key:"moveBefore",value:function(e,t){for(var r=this._current.insertBeforeHelper(e,t.length),n=0;n<t.length;n++){var i=t[n];this.move(r[n],i)}}},{key:"delete",value:function(e){this.deleteChildren(e),this.runOp({type:5,id:e})}}]),r}(Ni);function Gi(e,t,r){if(e.length>0){var n=e[e.length-1];if(0===n.type&&0===t.type&&Hi.equal(n.path,r))return void Object.assign(n.props,t.props)}e.push((0,x.Z)((0,x.Z)({},t),{},{path:r}))}var Hi,Wi=function(){function e(t){(0,g.Z)(this,e),this.ts=[],this.actual=[],this.reverse=[],this._current=t}return(0,y.Z)(e,[{key:"update",value:function(e,t){if(""!==e)throw new Error("");this._current=t}},{key:"push",value:function(e,t,r,n){Gi(this.ts,t,e),Gi(this.actual,r,e),Gi(this.reverse,n,e)}},{key:"result",value:function(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}}]),e}();function qi(e,t,r){return r instanceof Ti?new ji(e,t,r):r instanceof zi?new Ri(e,t,r):r instanceof _i?new Proxy(new Ui(e,t,r),Fi):null!==r&&"object"==typeof r?Li(r)?r:new Proxy(new Bi(e,t,r),Vi):r}function Ji(e){var t=new Wi(e);return[qi(t,"",e),t]}function Yi(e,t){var r=Ji(e),n=(0,u.Z)(r,2),i=n[0],a=n[1];return t(i),a.result()}function Xi(e){return e instanceof ji||e instanceof Ri?e._current:null!==e&&"object"==typeof e?e[Ei]:e}!function(e){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return r.length<=n?e:(e instanceof Ti||e instanceof ji)&&"string"==typeof r[n]||(e instanceof zi||e instanceof Ri)&&"string"==typeof r[n]?t(e.data(r[n]),r,n+1):"number"==typeof r[n]&&Array.isArray(e)||"string"==typeof r[n]&&"object"==typeof e?t(e[r[n]],r,n+1):void 0}e.equal=function(e,t){if(t.length!==e.length)return!1;for(var r=0;r<e.length;){if(e[r]!==t[r])return!1;r+=1}return!0},e.removeOverridden=function(e,r,n){var i=t(n,e);if(void 0!==i&&"object"==typeof i&&null!==i){var a=(0,x.Z)({},r);return Object.keys(i).forEach((function(e){delete a[e]})),a}return r},e.zoom=t}(Hi||(Hi={}));var Ki,Qi=(0,y.Z)((function e(){(0,g.Z)(this,e)})),$i=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this)).id=e,n}return(0,y.Z)(r)}(Qi),ea=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this)).data=e,n}return(0,y.Z)(r)}(Qi);try{Ki=new TextDecoder}catch(Ff){}var ta,ra,na,ia,aa,oa,sa,la=0,ua=[],ca=ua,ha=0,da={},fa=0,va=0,pa=[],ma={useRecords:!1,mapsAsObjects:!0},ga=(0,y.Z)((function e(){(0,g.Z)(this,e)})),ya=new ga;ya.name="MessagePack 0xC1";var xa=!1,ba=function(){function e(t){(0,g.Z)(this,e),t&&(!1===t.useRecords&&void 0===t.mapsAsObjects&&(t.mapsAsObjects=!0),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0)),Object.assign(this,t)}return(0,y.Z)(e,[{key:"unpack",value:function(t,r){var n=this;if(ta)return Ha((function(){return Wa(),n?n.unpack(t,r):e.prototype.unpack.call(ma,t,r)}));ra=r>-1?r:t.length,la=0,ha=0,va=0,ia=null,ca=ua,aa=null,ta=t;try{sa=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(Ao){throw ta=null,t instanceof Uint8Array?Ao:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&"object"==typeof t?t.constructor.name:typeof t))}if(this instanceof e){if(da=this,this.structures)return na=this.structures,wa();(!na||na.length>0)&&(na=[])}else da=ma,(!na||na.length>0)&&(na=[]);return wa()}},{key:"unpackMultiple",value:function(e,t){var r,n=0;try{xa=!0;var i=e.length,a=this?this.unpack(e,i):Xa.unpack(e,i);if(!t){for(r=[a];la<i;)n=la,r.push(wa());return r}for(t(a);la<i;)if(n=la,!1===t(wa()))return}catch(i){throw i.lastPosition=n,i.values=r,i}finally{xa=!1,Wa()}}},{key:"_mergeStructures",value:function(e,t){for(var r=0,n=(e=e||[]).length;r<n;r++){var i=e[r];i&&(i.isShared=!0,r>=32&&(i.highByte=r-32>>5))}for(var a in e.sharedLength=e.length,t||[])if(a>=0){var o=e[a],s=t[a];s&&(o&&((e.restoreStructures||(e.restoreStructures=[]))[a]=o),e[a]=s)}return this.structures=e}},{key:"decode",value:function(e,t){return this.unpack(e,t)}}]),e}();function wa(){try{if(!da.trusted&&!xa){var e=na.sharedLength||0;e<na.length&&(na.length=e)}var t=ka();if(la==ra)na.restoreStructures&&Sa(),na=null,ta=null,oa&&(oa=null);else{if(la>ra){var r=new Error("Unexpected end of MessagePack data");throw r.incomplete=!0,r}if(!xa)throw new Error("Data read, but end of buffer not reached")}return t}catch(t){throw na.restoreStructures&&Sa(),Wa(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer"))&&(t.incomplete=!0),t}}function Sa(){for(var e in na.restoreStructures)na[e]=na.restoreStructures[e];na.restoreStructures=null}function ka(){var e,t=ta[la++];if(t<160){if(t<128){if(t<64)return t;var r=na[63&t]||da.getStructures&&Za()[63&t];return r?(r.read||(r.read=Ca(r,63&t)),r.read()):t}if(t<144){if(t-=128,da.mapsAsObjects){for(var n={},i=0;i<t;i++)n[Fa()]=ka();return n}for(var a=new Map,o=0;o<t;o++)a.set(ka(),ka());return a}t-=144;for(var s=new Array(t),l=0;l<t;l++)s[l]=ka();return s}if(t<192){var u=t-160;if(va>=la)return ia.slice(la-fa,(la+=u)-fa);if(0==va&&ra<140){var c=u<16?Ba(u):Na(u);if(null!=c)return c}return La(u)}switch(t){case 192:return null;case 193:return aa?(e=ka())>0?aa[1].slice(aa.position1,aa.position1+=e):aa[0].slice(aa.position0,aa.position0-=e):ya;case 194:return!1;case 195:return!0;case 196:return Ua(ta[la++]);case 197:return e=sa.getUint16(la),la+=2,Ua(e);case 198:return e=sa.getUint32(la),la+=4,Ua(e);case 199:return Ia(ta[la++]);case 200:return e=sa.getUint16(la),la+=2,Ia(e);case 201:return e=sa.getUint32(la),la+=4,Ia(e);case 202:if(e=sa.getFloat32(la),da.useFloat32>2){var h=qa[(127&ta[la])<<1|ta[la+1]>>7];return la+=4,(h*e+(e>0?.5:-.5)>>0)/h}return la+=4,e;case 203:return e=sa.getFloat64(la),la+=8,e;case 204:return ta[la++];case 205:return e=sa.getUint16(la),la+=2,e;case 206:return e=sa.getUint32(la),la+=4,e;case 207:return da.int64AsNumber?(e=4294967296*sa.getUint32(la),e+=sa.getUint32(la+4)):e=sa.getBigUint64(la),la+=8,e;case 208:return sa.getInt8(la++);case 209:return e=sa.getInt16(la),la+=2,e;case 210:return e=sa.getInt32(la),la+=4,e;case 211:return da.int64AsNumber?(e=4294967296*sa.getInt32(la),e+=sa.getUint32(la+4)):e=sa.getBigInt64(la),la+=8,e;case 212:if(114==(e=ta[la++]))return ja(63&ta[la++]);var d=pa[e];if(d)return d.read?(la++,d.read(ka())):d.noBuffer?(la++,d()):d(ta.subarray(la,++la));throw new Error("Unknown extension "+e);case 213:return 114==(e=ta[la])?(la++,ja(63&ta[la++],ta[la++])):Ia(2);case 214:return Ia(4);case 215:return Ia(8);case 216:return Ia(16);case 217:return e=ta[la++],va>=la?ia.slice(la-fa,(la+=e)-fa):Aa(e);case 218:return e=sa.getUint16(la),va>=(la+=2)?ia.slice(la-fa,(la+=e)-fa):Ma(e);case 219:return e=sa.getUint32(la),va>=(la+=4)?ia.slice(la-fa,(la+=e)-fa):Da(e);case 220:return e=sa.getUint16(la),la+=2,za(e);case 221:return e=sa.getUint32(la),la+=4,za(e);case 222:return e=sa.getUint16(la),la+=2,Ea(e);case 223:return e=sa.getUint32(la),la+=4,Ea(e);default:if(t>=224)return t-256;if(void 0===t){var f=new Error("Unexpected end of MessagePack data");throw f.incomplete=!0,f}throw new Error("Unknown MessagePack token "+t)}}var _a=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Ca(e,t){function r(){if(r.count++>2){var n=e.read=new Function("r","return function(){return {"+e.map((function(e){return _a.test(e)?e+":r()":"["+JSON.stringify(e)+"]:r()"})).join(",")+"}}")(ka);return 0===e.highByte&&(e.read=Oa(t,e.read)),n()}for(var i={},a=0,o=e.length;a<o;a++){i[e[a]]=ka()}return i}return r.count=0,0===e.highByte?Oa(t,r):r}var Oa=function(e,t){return function(){var r=ta[la++];if(0===r)return t();var n=e<32?-(e+(r<<5)):e+(r<<5),i=na[n]||Za()[n];if(!i)throw new Error("Record id is not defined for "+n);return i.read||(i.read=Ca(i,e)),i.read()}};function Za(){var e=Ha((function(){return ta=null,da.getStructures()}));return na=da._mergeStructures(e,na)}var La=Ta,Aa=Ta,Ma=Ta,Da=Ta;function Ta(e){var t;if(e<16&&(t=Ba(e)))return t;if(e>64&&Ki)return Ki.decode(ta.subarray(la,la+=e));var r=la+e,n=[];for(t="";la<r;){var i=ta[la++];if(0===(128&i))n.push(i);else if(192===(224&i)){var a=63&ta[la++];n.push((31&i)<<6|a)}else if(224===(240&i)){var o=63&ta[la++],s=63&ta[la++];n.push((31&i)<<12|o<<6|s)}else if(240===(248&i)){var l=(7&i)<<18|(63&ta[la++])<<12|(63&ta[la++])<<6|63&ta[la++];l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l)}else n.push(i);n.length>=4096&&(t+=Pa.apply(String,n),n.length=0)}return n.length>0&&(t+=Pa.apply(String,n)),t}function za(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=ka();return t}function Ea(e){if(da.mapsAsObjects){for(var t={},r=0;r<e;r++)t[Fa()]=ka();return t}for(var n=new Map,i=0;i<e;i++)n.set(ka(),ka());return n}var Pa=String.fromCharCode;function Na(e){for(var t=la,r=new Array(e),n=0;n<e;n++){var i=ta[la++];if((128&i)>0)return void(la=t);r[n]=i}return Pa.apply(String,r)}function Ba(e){if(e<4){if(e<2){if(0===e)return"";var t=ta[la++];return(128&t)>1?void(la-=1):Pa(t)}var r=ta[la++],n=ta[la++];if((128&r)>0||(128&n)>0)return void(la-=2);if(e<3)return Pa(r,n);var i=ta[la++];return(128&i)>0?void(la-=3):Pa(r,n,i)}var a=ta[la++],o=ta[la++],s=ta[la++],l=ta[la++];if((128&a)>0||(128&o)>0||(128&s)>0||(128&l)>0)la-=4;else{if(e<6){if(4===e)return Pa(a,o,s,l);var u=ta[la++];return(128&u)>0?void(la-=5):Pa(a,o,s,l,u)}if(e<8){var c=ta[la++],h=ta[la++];if((128&c)>0||(128&h)>0)return void(la-=6);if(e<7)return Pa(a,o,s,l,c,h);var d=ta[la++];return(128&d)>0?void(la-=7):Pa(a,o,s,l,c,h,d)}var f=ta[la++],v=ta[la++],p=ta[la++],m=ta[la++];if((128&f)>0||(128&v)>0||(128&p)>0||(128&m)>0)la-=8;else{if(e<10){if(8===e)return Pa(a,o,s,l,f,v,p,m);var g=ta[la++];return(128&g)>0?void(la-=9):Pa(a,o,s,l,f,v,p,m,g)}if(e<12){var y=ta[la++],x=ta[la++];if((128&y)>0||(128&x)>0)return void(la-=10);if(e<11)return Pa(a,o,s,l,f,v,p,m,y,x);var b=ta[la++];return(128&b)>0?void(la-=11):Pa(a,o,s,l,f,v,p,m,y,x,b)}var w=ta[la++],S=ta[la++],k=ta[la++],_=ta[la++];if((128&w)>0||(128&S)>0||(128&k)>0||(128&_)>0)la-=12;else{if(e<14){if(12===e)return Pa(a,o,s,l,f,v,p,m,w,S,k,_);var C=ta[la++];return(128&C)>0?void(la-=13):Pa(a,o,s,l,f,v,p,m,w,S,k,_,C)}var O=ta[la++],Z=ta[la++];if(!((128&O)>0||(128&Z)>0)){if(e<15)return Pa(a,o,s,l,f,v,p,m,w,S,k,_,O,Z);var L=ta[la++];return(128&L)>0?void(la-=15):Pa(a,o,s,l,f,v,p,m,w,S,k,_,O,Z,L)}la-=14}}}}function Ua(e){return da.copyBuffers?Uint8Array.prototype.slice.call(ta,la,la+=e):ta.subarray(la,la+=e)}function Ia(e){var t=ta[la++];if(pa[t])return pa[t](ta.subarray(la,la+=e));throw new Error("Unknown extension type "+t)}var Va=new Array(4096);function Fa(){var e=ta[la++];if(!(e>=160&&e<192))return la--,ka();if(e-=160,va>=la)return ia.slice(la-fa,(la+=e)-fa);if(!(0==va&&ra<180))return La(e);var t,r=4095&(e<<5^(e>1?sa.getUint16(la):e>0?ta[la]:0)),n=Va[r],i=la,a=la+e-3,o=0;if(n&&n.bytes==e){for(;i<a;){if((t=sa.getUint32(i))!=n[o++]){i=1879048192;break}i+=4}for(a+=3;i<a;)if((t=ta[i++])!=n[o++]){i=1879048192;break}if(i===a)return la=i,n.string;a-=3,i=la}for(n=[],Va[r]=n,n.bytes=e;i<a;)t=sa.getUint32(i),n.push(t),i+=4;for(a+=3;i<a;)t=ta[i++],n.push(t);var s=e<16?Ba(e):Na(e);return n.string=null!=s?s:La(e)}var ja=function(e,t){var r=ka(),n=e;void 0!==t&&(e=e<32?-((t<<5)+e):(t<<5)+e,r.highByte=t);var i=na[e];return i&&i.isShared&&((na.restoreStructures||(na.restoreStructures=[]))[e]=i),na[e]=r,r.read=Ca(r,n),r.read()},Ra="object"==typeof self?self:global;pa[0]=function(){},pa[0].noBuffer=!0,pa[101]=function(){var e=ka();return(Ra[e[0]]||Error)(e[1])},pa[105]=function(e){var t=sa.getUint32(la-4);oa||(oa=new Map);var r,n=ta[la],i={target:r=n>=144&&n<160||220==n||221==n?[]:{}};oa.set(t,i);var a=ka();return i.used?Object.assign(r,a):(i.target=a,a)},pa[112]=function(e){var t=sa.getUint32(la-4),r=oa.get(t);return r.used=!0,r.target},pa[115]=function(){return new Set(ka())};var Ga=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map((function(e){return e+"Array"}));function Ha(e){var t,r=ra,n=la,i=ha,a=fa,o=va,s=ia,l=ca,u=oa,h=aa,d=new Uint8Array(ta.slice(0,ra)),f=na,v=na.slice(0,na.length),p=da,m=xa,g=e();return ra=r,la=n,ha=i,fa=a,va=o,ia=s,ca=l,oa=u,aa=h,ta=d,xa=m,(t=na=f).splice.apply(t,[0,na.length].concat((0,c.Z)(v))),da=p,sa=new DataView(ta.buffer,ta.byteOffset,ta.byteLength),g}function Wa(){ta=null,oa=null,na=null}pa[116]=function(e){var t=e[0],r=Ga[t];if(!r)throw new Error("Could not find typed array for code "+t);return new Ra[r](Uint8Array.prototype.slice.call(e,1).buffer)},pa[120]=function(){var e=ka();return new RegExp(e[0],e[1])},pa[98]=function(e){var t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],r=la;la+=t-4,(aa=[ka(),ka()]).position0=0,aa.position1=0;var n=la;la=r;try{return ka()}finally{la=n}},pa[255]=function(e){return 4==e.length?new Date(1e3*(16777216*e[0]+(e[1]<<16)+(e[2]<<8)+e[3])):8==e.length?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+1e3*(4294967296*(3&e[3])+16777216*e[4]+(e[5]<<16)+(e[6]<<8)+e[7])):12==e.length?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+1e3*((128&e[4]?-281474976710656:0)+1099511627776*e[6]+4294967296*e[7]+16777216*e[8]+(e[9]<<16)+(e[10]<<8)+e[11])):new Date("invalid")};for(var qa=new Array(147),Ja=0;Ja<256;Ja++)qa[Ja]=+("1e"+Math.floor(45.15-.30103*Ja));var Ya,Xa=new ba({useRecords:!1}),Ka=(Xa.unpack,Xa.unpackMultiple,Xa.unpack,new Float32Array(1));new Uint8Array(Ka.buffer,0,4);try{Ya=new TextEncoder}catch(jf){}var Qa,$a,eo,to,ro,no=typeof Buffer<"u",io=no?Buffer.allocUnsafeSlow:Uint8Array,ao=no?Buffer:Uint8Array,oo=no?4294967296:2144337920,so=0,lo=null,uo=/[\u0080-\uFFFF]/,co=Symbol("record-id"),ho=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;(0,g.Z)(this,r),(n=t.call(this,e)).offset=0;var i,a,o,s,l,c=0,d=ao.prototype.utf8Write?function(e,t,r){return eo.utf8Write(e,t,r)}:!(!Ya||!Ya.encodeInto)&&function(e,t){return Ya.encodeInto(e,eo.subarray(t)).written},f=(0,h.Z)(n);e||(e={});var v=e&&e.sequential,p=e.structures||e.saveStructures,m=e.maxSharedStructures;if(null==m&&(m=p?32:0),m>8160)throw new Error("Maximum maxSharedStructure is 8160");var y=e.maxOwnStructures;null==y&&(y=p?32:64),v&&!e.saveStructures&&(n.structures=[]);var x=m>32||y+m>64,w=m+64,S=m+y+64;if(S>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");var k=[],_=0,C=0;n.pack=n.encode=function(e,t){if(eo||(eo=new io(8192),to=new DataView(eo.buffer,0,8192),so=0),(ro=eo.length-10)-so<2048?(eo=new io(eo.length),to=new DataView(eo.buffer,0,eo.length),ro=eo.length-10,so=0):so=so+7&2147483640,i=so,l=f.structuredClone?new Map:null,f.bundleStrings?(lo=["",""],eo[so++]=214,eo[so++]=98,lo.position=so-i,so+=4):lo=null,a=f.structures){a.uninitialized&&(a=f._mergeStructures(f.getStructures()));var r=a.sharedLength||0;if(r>m)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+a.sharedLength);if(!a.transitions){a.transitions=Object.create(null);for(var n=0;n<r;n++){var u=a[n];if(u){for(var h=void 0,d=a.transitions,p=0,g=u.length;p<g;p++){var y=u[p];(h=d[y])||(h=d[y]=Object.create(null)),d=h}d[co]=n+64}}c=r}v||(a.nextId=r+64)}o&&(o=!1),s=a||[];try{if(O(e),lo){to.setUint32(lo.position+i,so-lo.position-i);var x=lo;lo=null,O(x[0]),O(x[1])}if(f.offset=so,l&&l.idsToInsert){(so+=6*l.idsToInsert.length)>ro&&L(so),f.offset=so;var b=function(e,t){var r,n=6*t.length,i=e.length-n;for(t.sort((function(e,t){return e.offset>t.offset?1:-1}));r=t.pop();){var a=r.offset,o=r.id;e.copyWithin(a+n,a,i);var s=a+(n-=6);e[s++]=214,e[s++]=105,e[s++]=o>>24,e[s++]=o>>16&255,e[s++]=o>>8&255,e[s++]=255&o,i=a}return e}(eo.subarray(i,so),l.idsToInsert);return l=null,b}return t&_o?(eo.start=i,eo.end=so,eo):eo.subarray(i,so)}finally{if(a){if(C<10&&C++,_>1e4)a.transitions=null,C=0,_=0,k.length>0&&(k=[]);else if(k.length>0&&!v){for(var w=0,S=k.length;w<S;w++)k[w][co]=0;k=[]}if(o&&f.saveStructures){var Z=a.sharedLength||m;a.length>Z&&(a=a.slice(0,Z));var A=eo.subarray(i,so);return!1===f.saveStructures(a,c)?(f._mergeStructures(f.getStructures()),f.pack(e)):(c=Z,A)}}t&Co&&(so=i)}};var O=function e(t){so>ro&&(eo=L(so));var r,a=typeof t;if("string"===a){var o,s=t.length;if(lo&&s>=8&&s<4096){var c=uo.test(t);return lo[c?0:1]+=t,eo[so++]=193,void e(c?-s:s)}o=s<32?1:s<256?2:s<65536?3:5;var f=3*s;if(so+f>ro&&(eo=L(so+f)),s<64||!d){var v,p,m,g=so+o;for(v=0;v<s;v++)(p=t.charCodeAt(v))<128?eo[g++]=p:p<2048?(eo[g++]=p>>6|192,eo[g++]=63&p|128):55296===(64512&p)&&56320===(64512&(m=t.charCodeAt(v+1)))?(p=65536+((1023&p)<<10)+(1023&m),v++,eo[g++]=p>>18|240,eo[g++]=p>>12&63|128,eo[g++]=p>>6&63|128,eo[g++]=63&p|128):(eo[g++]=p>>12|224,eo[g++]=p>>6&63|128,eo[g++]=63&p|128);r=g-so-o}else r=d(t,so+o,f);r<32?eo[so++]=160|r:r<256?(o<2&&eo.copyWithin(so+2,so+1,so+1+r),eo[so++]=217,eo[so++]=r):r<65536?(o<3&&eo.copyWithin(so+3,so+2,so+2+r),eo[so++]=218,eo[so++]=r>>8,eo[so++]=255&r):(o<5&&eo.copyWithin(so+5,so+3,so+3+r),eo[so++]=219,to.setUint32(so,r),so+=4),so+=r}else if("number"===a)if(t>>>0===t)t<64?eo[so++]=t:t<256?(eo[so++]=204,eo[so++]=t):t<65536?(eo[so++]=205,eo[so++]=t>>8,eo[so++]=255&t):(eo[so++]=206,to.setUint32(so,t),so+=4);else if(t>>0===t)t>=-32?eo[so++]=256+t:t>=-128?(eo[so++]=208,eo[so++]=t+256):t>=-32768?(eo[so++]=209,to.setInt16(so,t),so+=2):(eo[so++]=210,to.setInt32(so,t),so+=4);else{var y;if((y=n.useFloat32)>0&&t<4294967296&&t>=-2147483648){var x;if(eo[so++]=202,to.setFloat32(so,t),y<4||(x=t*qa[(127&eo[so])<<1|eo[so+1]>>7])>>0===x)return void(so+=4);so--}eo[so++]=203,to.setFloat64(so,t),so+=8}else if("object"===a)if(t){if(l){var w=l.get(t);if(w){if(!w.id){var S=l.idsToInsert||(l.idsToInsert=[]);w.id=S.push(w)}return eo[so++]=214,eo[so++]=112,to.setUint32(so,w.id),void(so+=4)}l.set(t,{offset:so-i})}var k=t.constructor;if(k===Object)Z(t,!0);else if(k===Array){(r=t.length)<16?eo[so++]=144|r:r<65536?(eo[so++]=220,eo[so++]=r>>8,eo[so++]=255&r):(eo[so++]=221,to.setUint32(so,r),so+=4);for(var _=0;_<r;_++)e(t[_])}else if(k===Map){(r=t.size)<16?eo[so++]=128|r:r<65536?(eo[so++]=222,eo[so++]=r>>8,eo[so++]=255&r):(eo[so++]=223,to.setUint32(so,r),so+=4);var C,O=(0,b.Z)(t);try{for(O.s();!(C=O.n()).done;){var A=(0,u.Z)(C.value,2),M=A[0],D=A[1];e(M),e(D)}}catch(N){O.e(N)}finally{O.f()}}else{for(var T=0,z=Qa.length;T<z;T++){var E=$a[T];if(t instanceof E){var P=function(){var r=Qa[T];if(r.write)return r.type&&(eo[so++]=212,eo[so++]=r.type,eo[so++]=0),e(r.write.call((0,h.Z)(n),t)),{v:void 0};var i=eo,a=to,o=so;eo=null;var s=void 0;try{s=r.pack.call((0,h.Z)(n),t,(function(e){return eo=i,i=null,(so+=e)>ro&&L(so),{target:eo,targetView:to,position:so-e}}),e)}finally{i&&(to=a,so=o,ro=(eo=i).length-10)}return s&&(s.length+so>ro&&L(s.length+so),so=po(s,eo,so,r.type)),{v:void 0}}();if("object"===typeof P)return P.v}}Z(t,!t.hasOwnProperty)}}else eo[so++]=192;else if("boolean"===a)eo[so++]=t?195:194;else if("bigint"===a){if(t<BigInt(1)<<BigInt(63)&&t>=-(BigInt(1)<<BigInt(63)))eo[so++]=211,to.setBigInt64(so,t);else if(t<BigInt(1)<<BigInt(64)&&t>0)eo[so++]=207,to.setBigUint64(so,t);else{if(!n.largeBigIntToFloat)throw new RangeError(t+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");eo[so++]=203,to.setFloat64(so,Number(t))}so+=8}else if("undefined"===a)n.encodeUndefinedAsNil?eo[so++]=192:(eo[so++]=212,eo[so++]=0,eo[so++]=0);else{if("function"!==a)throw new Error("Unknown type: "+a);e(n.writeFunction&&n.writeFunction())}},Z=!1===n.useRecords?n.variableMapSize?function(e){var t,r=Object.keys(e),n=r.length;n<16?eo[so++]=128|n:n<65536?(eo[so++]=222,eo[so++]=n>>8,eo[so++]=255&n):(eo[so++]=223,to.setUint32(so,n),so+=4);for(var i=0;i<n;i++)O(t=r[i]),O(e[t])}:function(e,t){eo[so++]=222;var r=so-i;so+=2;var n=0;for(var a in e)(t||e.hasOwnProperty(a))&&(O(a),O(e[a]),n++);eo[r+++i]=n>>8,eo[r+i]=255&n}:function(e){for(var t,r=Object.keys(e),i=s.transitions||(s.transitions=Object.create(null)),a=0,l=0,u=r.length;l<u;l++){var c=r[l];(t=i[c])||(t=i[c]=Object.create(null),a++),i=t}var h=i[co];if(h)h>=96&&x?(eo[so++]=96+(31&(h-=96)),eo[so++]=h>>5):eo[so++]=h;else{(h=s.nextId)||(h=64),h<w&&n.shouldShareStructure&&!n.shouldShareStructure(r)?((h=s.nextOwnId)<S||(h=w),s.nextOwnId=h+1):(h>=S&&(h=w),s.nextId=h+1);var d=r.highByte=h>=96&&x?h-96>>5:-1;i[co]=h,s[h-64]=r,h<w?(r.isShared=!0,s.sharedLength=h-63,o=!0,d>=0?(eo[so++]=96+(31&h),eo[so++]=d):eo[so++]=h):(d>=0?(eo[so++]=213,eo[so++]=114,eo[so++]=96+(31&h),eo[so++]=d):(eo[so++]=212,eo[so++]=114,eo[so++]=h),a&&(_+=C*a),k.length>=y&&(k.shift()[co]=0),k.push(i),O(r))}for(var f=0,v=r.length;f<v;f++)O(e[r[f]])},L=function(e){var t;if(e>16777216){if(e-i>oo)throw new Error("Packed buffer would be larger than maximum buffer size");t=Math.min(oo,4096*Math.round(Math.max((e-i)*(e>67108864?1.25:2),4194304)/4096))}else t=1+(Math.max(e-i<<2,eo.length-1)>>12)<<12;var r=new io(t);return to=new DataView(r.buffer,0,t),eo.copy?eo.copy(r,0,i,e):r.set(eo.slice(i,e)),so-=i,i=0,ro=r.length-10,eo=r};return n}return(0,y.Z)(r,[{key:"useBuffer",value:function(e){eo=e,to=new DataView(eo.buffer,eo.byteOffset,eo.byteLength),so=0}}]),r}(ba);function fo(e,t,r,n){var i=e.byteLength;if(i+1<256){var a=r(4+i),o=a.target,s=a.position;o[s++]=199,o[s++]=i+1}else if(i+1<65536){var l=r(5+i);o=l.target,s=l.position;o[s++]=200,o[s++]=i+1>>8,o[s++]=i+1&255}else{var u=r(7+i),c=(o=u.target,s=u.position,u.targetView);o[s++]=201,c.setUint32(s,i+1),s+=4}o[s++]=116,o[s++]=t,o.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),s)}function vo(e,t){var r=e.byteLength;if(r<256){var n=t(r+2),i=n.target,a=n.position;i[a++]=196,i[a++]=r}else if(r<65536){var o=t(r+3);i=o.target,a=o.position;i[a++]=197,i[a++]=r>>8,i[a++]=255&r}else{var s=t(r+5),l=(i=s.target,a=s.position,s.targetView);i[a++]=198,l.setUint32(a,r),a+=4}i.set(e,a)}function po(e,t,r,n){var i=e.length;switch(i){case 1:t[r++]=212;break;case 2:t[r++]=213;break;case 4:t[r++]=214;break;case 8:t[r++]=215;break;case 16:t[r++]=216;break;default:i<256?(t[r++]=199,t[r++]=i):i<65536?(t[r++]=200,t[r++]=i>>8,t[r++]=255&i):(t[r++]=201,t[r++]=i>>24,t[r++]=i>>16&255,t[r++]=i>>8&255,t[r++]=255&i)}return t[r++]=n,t.set(e,r),r+=i}function mo(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");$a.unshift(e.Class),Qa.unshift(e)}!function(e){e.unpack?pa[e.type]=e.unpack:pa[e.type]=e}(e)}$a=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,ga],Qa=[{pack:function(e,t,r){var n=e.getTime()/1e3;if((this.useTimestamp32||0===e.getMilliseconds())&&n>=0&&n<4294967296){var i=t(6),a=i.target,o=i.targetView,s=i.position;a[s++]=214,a[s++]=255,o.setUint32(s,n)}else if(n>0&&n<17179869184){var l=t(10),u=l.target,c=l.targetView,h=l.position;u[h++]=215,u[h++]=255,c.setUint32(h,4e6*e.getMilliseconds()+(n/1e3/4294967296>>0)),c.setUint32(h+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return t(0),r(this.onInvalidDate());var d=t(3),f=d.target,v=(d.targetView,d.position);f[v++]=212,f[v++]=255,f[v++]=255}else{var p=t(15),m=p.target,g=p.targetView,y=p.position;m[y++]=199,m[y++]=12,m[y++]=255,g.setUint32(y,1e6*e.getMilliseconds()),g.setBigInt64(y+4,BigInt(Math.floor(n)))}}},{pack:function(e,t,r){var n=Array.from(e),i=t(this.structuredClone?3:0),a=i.target,o=i.position;this.structuredClone&&(a[o++]=212,a[o++]=115,a[o++]=0),r(n)}},{pack:function(e,t,r){var n=t(this.structuredClone?3:0),i=n.target,a=n.position;this.structuredClone&&(i[a++]=212,i[a++]=101,i[a++]=0),r([e.name,e.message])}},{pack:function(e,t,r){var n=t(this.structuredClone?3:0),i=n.target,a=n.position;this.structuredClone&&(i[a++]=212,i[a++]=120,i[a++]=0),r([e.source,e.flags])}},{pack:function(e,t){this.structuredClone?fo(e,16,t):vo(no?Buffer.from(e):new Uint8Array(e),t)}},{pack:function(e,t){var r=e.constructor;r!==ao&&this.structuredClone?fo(e,Ga.indexOf(r.name),t):vo(e,t)}},{pack:function(e,t){var r=t(1);r.target[r.position]=193}}];var go,yo,xo,bo,wo,So,ko=new ho({useRecords:!1}),_o=(ko.pack,ko.pack,512),Co=1024,Oo=new ho({structuredClone:!0});function Zo(e){if(Li(e))return e;if(Array.isArray(e))return e.map(Zo);if("object"==typeof e&&null!==e){var t,r={},n=(0,b.Z)(Object.keys(e).sort());try{for(n.s();!(t=n.n()).done;){var i=t.value;r[i]=Zo(e[i])}}catch(a){n.e(a)}finally{n.f()}return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}return e}mo({Class:_i.prototype.constructor,type:1,write:function(e){return(0,x.Z)({},e)},read:function(e){return Object.setPrototypeOf(e,_i.prototype),e}}),mo({Class:zi.prototype.constructor,type:2,write:function(e){return(0,c.Z)(e)},read:function(e){return Object.setPrototypeOf(e,zi.prototype),e}}),mo({Class:Ti.prototype.constructor,type:3,write:function(e){return(0,c.Z)(e)},read:function(e){return Object.setPrototypeOf(e,Ti.prototype),e}}),mo({Class:$i.prototype.constructor,type:4,write:function(e){return e.id},read:function(e){return new $i(e)}}),mo({Class:ea.prototype.constructor,type:5,write:function(e){return e.data},read:function(e){return new ea(e)}}),function(e){function t(e){return Oo.pack(e)}e.serialize=t,e.deserialize=function(e){return Oo.unpack(e)},e.checksum=function(e){return function(e){var t=0;if(0===e.length)return t;for(var r=0;r<e.length;r++)t=(t<<5)-t+e[r],t&=t;return t}(t(Zo(e))).toString()}}(go||(go={})),function(e){e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"],e.is=function(t){return e.all.includes(t)}}(yo||(yo={})),function(e){e.defaultData=function(e){return function(e){if("PointLight"===e)return{type:e,color:pi.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,depth:1e5,helper:!0};if("SpotLight"===e)return{type:e,color:pi.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,helper:!0,shadowResolution:1024,shadowRadius:1};if("DirectionalLight"===e)return{type:e,color:pi.white,intensity:1,shadows:!0,size:1e3,depth:1e5,shadowResolution:1024,helper:!0,shadowRadius:1};throw new Error("not implemented")}(e)}}(xo||(xo={})),function(e){e.defaultData={castShadow:!0,receiveShadow:!0},e.equals=function(e,t){return e.castShadow===t.castShadow&&e.receiveShadow===t.receiveShadow}}(bo||(bo={})),function(e){e.defaultData={flatShading:!1,wireframe:!1,side:0},e.equals=function(e,t){return e.flatShading===t.flatShading&&e.side===t.side&&e.wireframe===t.wireframe}}(wo||(wo={})),function(e){e.defaultData=(0,x.Z)((0,x.Z)((0,x.Z)({},wo.defaultData),bo.defaultData),{},{cloner:null,booleanExclude:null})}(So||(So={}));var Lo,Ao,Mo,Do,To,zo,Eo,Po,No,Bo,Uo,Io,Vo,Fo,jo,Ro,Go=function(e){return e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Center=3]="Center",e[e.Justify=4]="Justify",e}(Go||{}),Ho=((Ao=Ho||{})[Ao.Top=1]="Top",Ao[Ao.Center=2]="Center",Ao[Ao.Bottom=3]="Bottom",Ao),Wo=function(e){return e[e.None=1]="None",e[e.Upper=2]="Upper",e[e.Lower=3]="Lower",e}(Wo||{});!function(e){e.defaultData={width:100,height:100,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.5,letterSpacing:1,text:"",textTransform:1,color:pi.fromHexAndA(6974058,1),alpha:1,font:"roboto_regular"}}(Lo||(Lo={})),function(e){e.defaultData=function(e,t){return"light"===e&&t?function(e){switch(e){case"basic":return{type:"light",category:"basic",alpha:1,visible:!0,mode:0};case"phong":return{category:"phong",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1,visible:!0,mode:0};case"toon":return{category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1,visible:!0,mode:0};case"lambert":return{category:"lambert",emissive:{r:0,g:0,b:0,a:1},type:"light",alpha:1,visible:!0,mode:0};case"physical":return{category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0}}}(t):function(e){switch(e){case"texture":return{alpha:1,visible:!0,size:[128,128],mode:0,axis:"x",side:2,type:"texture",projection:0,texture:{image:"image_0",wrapping:1001,repeat:[1,1],offset:[0,0]},crop:!0};case"color":return{type:"color",alpha:1,visible:!0,mode:0,color:fi.fromHex(4737101)};case"depth":return{type:"depth",alpha:1,visible:!0,mode:0,gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]],steps:[0,1,1,1,1,1,1,1,1,1,1],num:2,near:50,far:200};case"normal":return{type:"normal",alpha:1,visible:!0,mode:0,cnormal:[1,1,1]};case"gradient":return{type:"gradient",alpha:1,visible:!0,mode:0,gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{type:"noise",alpha:1,visible:!0,mode:0,size:[100,100,100],noiseType:0,scale:1,move:1,colorA:(0,x.Z)((0,x.Z)({},fi.fromHex(6710886)),{},{a:1}),colorB:(0,x.Z)((0,x.Z)({},fi.fromHex(6710886)),{},{a:1}),colorC:(0,x.Z)((0,x.Z)({},fi.fromHex(16777215)),{},{a:1}),colorD:(0,x.Z)((0,x.Z)({},fi.fromHex(16777215)),{},{a:1}),distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8]};case"fresnel":return{type:"fresnel",alpha:1,visible:!0,mode:0,color:pi.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{type:"rainbow",alpha:1,visible:!0,mode:0,filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"matcap":return{type:"matcap",alpha:1,visible:!0,mode:0,texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0]}};case"transmission":return{type:"transmission",alpha:1,visible:!0,mode:0,thickness:10,ior:1.5,roughness:1};case"displace":return{type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,visible:!0}}}(e)}}(Mo||(Mo={})),function(e){function t(e){var t,r=0,n=(0,b.Z)(e.layers);try{for(n.s();!(t=n.n()).done;){var i=t.value;"alpha"in i.data&&"light"!==i.data.type&&"fresnel"!==i.data.type&&(r+=(1-r)*i.data.alpha)}}catch(a){n.e(a)}finally{n.f()}return r<1}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"layer1",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer2",n=new zi;return n.push({fi:0,data:Mo.defaultData("light",e),id:t}),n.push({fi:1,data:Mo.defaultData("color"),id:r}),{layers:n}}e.isMergable=function(e){return!e.layers.some((function(e){if("texture"===e.data.type&&0!==e.data.projection||"depth"===e.data.type&&!e.data.isWorldSpace||"noise"===e.data.type||"displace"===e.data.type)return!0}))&&!t(e)},e.getHash=function(e){var t="";return e.layers.forEach((function(e){Object.entries(e.data).forEach((function(e){var r=(0,u.Z)(e,2),n=r[0],i=r[1];t+="".concat(n).concat(i),Array.isArray(i)?i.forEach((function(e){return t+="".concat(e)})):"object"==typeof i?Object.values(i).forEach((function(e){t+="".concat("number"==typeof e?e.toFixed(4):e)})):t+="".concat(i)}))})),t},e.isTransparent=t,e.defaultEmptyData=function(){return{layers:new zi}},e.defaultData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"layer1",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"layer2";return r("phong",e,t)},e.defaultTwoLayerData=r,e.defaultTwoLayerTextureData=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"basic",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer1",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"layer2",i=Mo.defaultData("texture");Object.assign(i.texture,{image:e});var a=new zi;return a.push({fi:0,data:i,id:r}),a.push({fi:1,data:Mo.defaultData("light",t),id:n}),{layers:a}}}(Do||(Do={})),function(e){e.defaultData=function(){return{points:new zi,roundness:0,shapeHoles:[],isClosed:!1}}}(To||(To={})),function(e){e.is2DParametricMesh=function(e){return"PolygonGeometry"===e||"RectangleGeometry"===e||"StarGeometry"===e||"TriangleGeometry"===e||"EllipseGeometry"===e}}(zo||(zo={})),function(e){e.defaultData=function(e){if("RectangleGeometry"===e)return{width:320,height:320,type:e,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("VectorGeometry"===e)return{width:1,height:1,type:e,subdivisions:12,shape:To.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("BooleanGeometry"===e)return{type:e,operation:2,width:0,height:0,depth:0,phongAngle:35};throw new Error("not implemented")}}(Eo||(Eo={})),function(e){e.identity=(0,x.Z)((0,x.Z)({},gi.identity),{},{hiddenMatrix:di.identity}),e.fromObject=function(e){return{position:e.position,rotation:e.rotation,scale:e.scale,hiddenMatrix:e.hiddenMatrix}},e.merge=function(e,t){return{position:(null===t||void 0===t?void 0:t.position)||e.position,rotation:(null===t||void 0===t?void 0:t.rotation)||e.rotation,scale:(null===t||void 0===t?void 0:t.scale)||e.scale,hiddenMatrix:(null===t||void 0===t?void 0:t.hiddenMatrix)||e.hiddenMatrix}},e.diff=function(e,t){return{position:ci.isEqual(e.position,t.position)?null:t.position,rotation:ci.isEqual(e.rotation,t.rotation)?null:t.rotation,scale:ci.isEqual(e.scale,t.scale)?null:t.scale,hiddenMatrix:di.isEqual(e.hiddenMatrix,t.hiddenMatrix)?null:t.hiddenMatrix}}}(Po||(Po={})),function(e){e.defaultData=(0,x.Z)({states:new zi,events:new zi,visible:!0,raycastLock:!1},Po.identity)}(No||(No={})),function(e){e.defaultData=(0,x.Z)({type:"Empty"},No.defaultData)}(Bo||(Bo={})),function(e){e.defaultData=(0,x.Z)((0,x.Z)({type:"Mesh"},No.defaultData),So.defaultData)}(Uo||(Uo={})),function(e){e.defaultData=(0,x.Z)((0,x.Z)({type:"TextFrame"},No.defaultData),Lo.defaultData)}(Io||(Io={})),function(e){e.defaultData=(0,x.Z)((0,x.Z)((0,x.Z)({},No.defaultData),Po.identity),si.defaultData)}(Vo||(Vo={})),function(e){e.defaultData=function(e){return(0,x.Z)((0,x.Z)({},No.defaultData),xo.defaultData(e))}}(Fo||(Fo={})),function(e){e.defaultCamera=(0,x.Z)({position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:di.identity,name:"Play Camera",visible:!0,raycastLock:!1,states:new zi,events:new zi},si.defaultData),e.defaultMeshObject=(0,x.Z)((0,x.Z)((0,x.Z)({name:"Rectangle"},No.defaultData),Uo.defaultData),{},{geometry:Eo.defaultData("RectangleGeometry"),material:Do.defaultTwoLayerData("basic","layer1","layer2")}),e.defaultBooleanObject=(0,x.Z)((0,x.Z)((0,x.Z)({name:"Boolean"},No.defaultData),Uo.defaultData),{},{geometry:Eo.defaultData("BooleanGeometry"),material:Do.defaultTwoLayerData("phong","layer1","layer2")})}(jo||(jo={})),function(e){function t(e,t){if(void 0===t)return e;var r=(0,x.Z)({},e);return"material"in r&&"material"in t&&t.material&&(r.material=Yi(r.material,(function(e){if("string"!=typeof e)for(var r=0,n=Object.entries(t.material.layers);r<n.length;r++){var i=(0,u.Z)(n[r],2),a=i[0],o=i[1],s=e.layers.data(a);s&&ni(s,o)}})).data),r.materials&&t.materials&&(r.materials=Yi(r.materials,(function(e){for(var n=0;n<r.materials.length;n++){var i=t.materials[n];if("string"!=typeof i)for(var a=0,o=Object.entries(i.layers);a<o.length;a++){var s,l,c=(0,u.Z)(o[a],2),h=c[0],d=c[1],f=null===(s=e[n])||void 0===s||null===(l=s.layers)||void 0===l?void 0:l.data(h);f&&ni(f,d)}}})).data),r}e.patchMaterialState=t,e.patch=function(e,r){if(void 0===r)return e;var n=(0,x.Z)({},e);if(Object.assign(n,Po.merge(n,r)),ai.is(e.type)){var i,a;n.orthographic=(0,x.Z)({},n.orthographic),n.perspective=(0,x.Z)({},n.perspective);var o=r;void 0!==(null===(i=o.orthographic)||void 0===i?void 0:i.zoom)&&(n.orthographic.zoom=o.orthographic.zoom),void 0!==(null===(a=o.perspective)||void 0===a?void 0:a.zoom)&&(n.perspective.zoom=o.perspective.zoom),void 0!==o.isUpVectorFlipped&&(n.isUpVectorFlipped=o.isUpVectorFlipped),void 0!==o.targetOffset&&(n.targetOffset=o.targetOffset)}else if("Mesh"===e.type)n.geometry=(0,x.Z)({},n.geometry),Object.assign(n.geometry,r.geometry),n=t(n,r);else if(yo.is(e.type)){var s=r;void 0!==n.intensity&&(n.intensity=s.intensity),void 0!==s.color&&("string"==typeof s.color?n.color=s.color:n.color=fi.clone(s.color))}return n}}(Ro||(Ro={}));var qo=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a,o,s=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:0,cornerSegments:8,hollow:0},e.parameters),l=s.width/2,u=null!==(n=s.radiusTop)&&void 0!==n?n:l,c=null!==(i=s.radiusBottom)&&void 0!==i?i:l;return u===c?(u=l,c=l):u>c?c=c*l/(u=l):(u=u*l/c,c=l),{parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(a=s.height)&&void 0!==a?a:s.width),depth:Math.abs(null!==(o=s.depth)&&void 0!==o?o:s.width),radiusTop:u,radiusBottom:c})}}},{key:"build",value:function(e){var t,r=e.parameters,n=r.width,i=r.depth,a=r.height,o=r.radialSegments,s=r.heightSegments,l=r.openEnded,u=r.thetaStart,c=r.thetaLength,h=r.radiusTop,d=r.radiusBottom,f=r.cornerRadius,v=r.cornerSegments,p=r.hollow;return(t=f||p?new Xo(h,d,a,o,s,l,u,c*Math.PI/180,f,f,v,p):new w.CylinderBufferGeometry(h,d,a,o,s,l,u,c*Math.PI/180)).scale(1,1,i/n),Object.assign(t,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"CylinderGeometry"})})}}]),e}();function Jo(e,t,r){r.x=e.x*t.x,r.y=e.y,r.z=e.x*t.y}function Yo(e){return new w.Vector2(e.y,-e.x)}var Xo=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i,a,o,s,l,u,h,d,f,v){var p,m=arguments.length>12&&void 0!==arguments[12]&&arguments[12];(0,g.Z)(this,r),(p=t.call(this)).type="RoundedCylinderBufferGeometry",e=void 0!==e?e:1,n=void 0!==n?n:1,i=i||1,a=Math.floor(a)||8,o=Math.floor(o)||1,s=void 0!==s&&s,l=void 0!==l?l:0,u=void 0!==u?u:2*Math.PI,s&&(h=0,d=0);var y=[],x=[],S=[],k=[],_=0,C=i/2,O=new w.Vector3,Z=new w.Vector3;m&&0==e&&(e=h),m&&0==n&&(n=d);var L=new w.Vector2(e,C),A=new w.Vector2(n,-C),M=null,D=null,T=null,z=null,E=L.clone().sub(A),P=0,N=0,B=0;v>0&&(P=Math.min(e,n)*(1-v),N=e-P,B=n-P);var U=L.clone();U.x-=P;var I=Math.PI-E.angle(),V=E.angle(),F=Math.tan(V/2),j=Math.tan(I/2),R=F+j,G=v?R:j,H=v?R:F;if(h=Math.min(h,(e-N)/G,E.length()/R),d=Math.min(d,(n-B)/H,E.length()/R),h>0){var W=h/F;M=L.clone().sub(new w.Vector2(W,h)),v&&((T=M.clone()).x-=P-R*h),L.sub(E.clone().setLength(W))}if(d>0){var q=d/j;D=A.clone().sub(new w.Vector2(q,-d)),A.add(E.clone().setLength(q)),v&&((z=D.clone()).x-=P-R*d,U.sub(E.clone().setLength(q)))}for(var J=(E=L.clone().sub(A)).length()<.5,Y=[],X=0;X<=a;X++){var K=[],Q=X/a,$=Q*u+l,ee=new w.Vector2(Math.sin($),Math.cos($));z&&D?(ge(K,Q,ee,I,d,z,-1,!0),ge(K,Q,ee,V,d,D,-1,!1)):D?(ye(K,ee,D.x,0,-1),ge(K,Q,ee,V,d,D,-1,!1)):s||ye(K,ee,n,B,-1);var te=Yo(E).normalize();if(Jo(te,ee,O),!J)for(var re=0;re<=o;re++){var ne=re/o,ie=E.clone().multiplyScalar(ne).add(A);Jo(ie,ee,Z),x.push(Z.x,Z.y,Z.z),S.push(O.x,O.y,O.z),k.push(Q,.5+Z.y/i),K.push(_++)}if(T&&M?(ge(K,Q,ee,I,h,M,1,!1),ge(K,Q,ee,V,h,T,1,!0)):M?(ge(K,Q,ee,I,h,M,1,!1),ye(K,ee,M.x,0,1)):s||ye(K,ee,e,N,1),v&&!J){var ae=Yo(E).multiplyScalar(-1).normalize();Jo(ae,ee,O);for(var oe=0;oe<=o;oe++){var se=oe/o,le=E.clone().multiplyScalar(-se).add(U);Jo(le,ee,Z),x.push(Z.x,Z.y,Z.z),S.push(O.x,O.y,O.z),k.push(Q,.5+Z.y/i),K.push(_++)}}v&&!s&&K.push(K[0]),Y.push(K)}for(var ue=0;ue<Y.length-1;ue++)for(var ce=0;ce<Y[0].length-1;ce++)if(!s||!v||ce!=o){var he=Y[ue][ce],de=Y[ue+1][ce],fe=Y[ue+1][ce+1],ve=Y[ue][ce+1],pe=x[3*fe+0],me=x[3*fe+2];y.push(he,de,ve),(0!=pe||0!=me)&&y.push(de,fe,ve)}function ge(e,t,r,n,a,o,s,l){for(var u=0;u<f+1;u++){var c=u/f,h=s<0?c:1-c;l&&(h-=1),h*=n;var d=new w.Vector2(Math.sin(h),Math.cos(h)*s);Jo(d.clone().multiplyScalar(a).add(o),r,Z),x.push(Z.x,Z.y,Z.z),Jo(d,r,O),S.push(O.x,O.y,O.z),k.push(t,.5+Z.y/i),e.push(_++)}}function ye(e,t,r,n,i){var a=new w.Vector3,o=new w.Vector2,s=[r,n];i<0&&s.reverse();for(var l=0,u=s;l<u.length;l++){var c=u[l];o.set(c,C*i),Jo(o,t,a),x.push(a.x,a.y,a.z),S.push(0,i,0),k.push(.5,.5),e.push(_++)}}function xe(t,r,i){var a=new w.Vector2(Math.sin(i),Math.cos(i)),o=new w.Vector2(-Math.cos(i),Math.sin(i)),s=new w.Vector3,l=t<0?function(e,t,r){return y.push(e,t,r)}:function(e,t,r){return y.push(e,r,t)};Jo(new w.Vector2((e+n+N+B)/4,0),a,s),x.push(s.x,s.y,s.z),S.push(o.x,0,o.y),k.push(.5,.5);var u,h=_++,d=(0,b.Z)(r);try{for(d.s();!(u=d.n()).done;){var f=u.value,v=x.slice(3*f,3*f+3);x.push.apply(x,(0,c.Z)(v)),S.push(o.x,0,o.y);var p=k.slice(2*f,2*f+2);k.push.apply(k,(0,c.Z)(p)),_++}}catch(g){d.e(g)}finally{d.f()}for(var m=h+1;m<_-1;m++)l(h,m,m+1);l(h,_-1,h+1)}return u<2*Math.PI&&(xe(-1,Y[0],l),xe(1,Y[Y.length-1],l+u)),p.setIndex(y),p.setAttribute("position",new w.Float32BufferAttribute(x,3)),p.setAttribute("normal",new w.Float32BufferAttribute(S,3)),p.setAttribute("uv",new w.Float32BufferAttribute(k,2)),p}return(0,y.Z)(r)}(w.BufferGeometry),Ko=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:0,cornerRadiusBottom:0,cornerSegments:8},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:a.width)})}}},{key:"build",value:function(e){var t,r=e.parameters,n=r.width,i=r.depth,a=r.height,o=r.radialSegments,s=r.heightSegments,l=r.openEnded,u=r.thetaStart,c=r.thetaLength,h=r.cornerRadiusTop,d=r.cornerRadiusBottom,f=r.cornerSegments;return(t=h>0||d>0||c<360?new Xo(0,n/2,a,o,s,l,u,c*Math.PI/180,h,d,f,0,!0):new w.ConeBufferGeometry(n/2,a,o,s,l)).scale(1,1,i/n),Object.assign(t,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"ConeGeometry"})})}}]),e}(),Qo=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:0,cornerSegments:8},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:a.width)})}}},{key:"build",value:function(e){var t,r=e.parameters,n=r.width,i=r.height,a=r.depth,o=r.widthSegments,s=r.heightSegments,l=r.depthSegments,u=r.cornerRadius,c=r.cornerSegments;return t=0==u?new w.BoxBufferGeometry(n,i,a,o,s,l):new es(n,i,a,o,s,l,u,c),Object.assign(t,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"CubeGeometry"})})}}]),e}(),$o=Math.PI/2,es=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:4;(0,g.Z)(this,r),(e=t.call(this)).type="BoxBufferGeometry";var d=(0,h.Z)(e);o=Math.floor(o),s=Math.floor(s),l=Math.floor(l),c=Math.floor(c),u=Math.min(u,n/2,i/2,a/2);var f=[],v=[],p=[],m=[],y=0,x=0;function b(e,t,r,n,i,a,o,s,l,c,h){for(var g=(a-2*u)/l,b=(o-2*u)/c,S=a/2-u,k=o/2-u,_=s/2,C=l+1,O=c+1,Z=0,L=0,A=new w.Vector3,M=0;M<O;M++)for(var D=M*b-k,T=0;T<C;T++){var z=T*g-S;A[e]=z*n,A[t]=D*i,A[r]=_,v.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[r]=s>0?1:-1,p.push(A.x,A.y,A.z),m.push(T/l),m.push(1-M/c),Z+=1}for(var E=0;E<c;E++)for(var P=0;P<l;P++){var N=y+P+C*E,B=y+P+C*(E+1),U=y+(P+1)+C*(E+1),I=y+(P+1)+C*E;f.push(N,B,I),f.push(B,U,I),L+=6}d.addGroup(x,L,h),x+=L,y+=Z}function S(e,t,r,n,i,a,o,s,l,h,g){for(var b=(o-2*u)/h,S=o/2-u,k=s/2-u,_=l/2,C=h+1,O=0,Z=0,L=new w.Vector3,A=new w.Vector3,M=0;M<c+1;M++){var D=M/c*$o,T=Math.sin(D)*u,z=(1-Math.cos(D))*u,E=Math.sin(D),P=Math.cos(D);L[t]=(k+T)*i,L[r]=(_-z)*a,A[e]=0,A[t]=E*Math.sign(L[t]),A[r]=P*Math.sign(L[r]);for(var N=0;N<C;N++){var B=N*b-S;L[e]=B*n,v.push(L.x,L.y,L.z),p.push(A.x,A.y,A.z),m.push(N/h),m.push(0),O+=1}}for(var U=0;U<c;U++)for(var I=0;I<h;I++){var V=y+I+C*U,F=y+I+C*(U+1),j=y+(I+1)+C*(U+1),R=y+(I+1)+C*U;f.push(V,F,R),f.push(F,j,R),Z+=6}d.addGroup(x,Z,g),x+=Z,y+=O}function k(e,t,r){var o=new w.Vector3,s=new w.Vector3(n/2,i/2,a/2);s.subScalar(u);for(var l=[],h=e*t*r>0?function(e,t,r){return f.push(e,t,r)}:function(e,t,r){return f.push(e,r,t)},d=0;d<=c;d++){for(var g=[],x=$o*(1-d/c),b=Math.cos(x),S=Math.sin(x),k=0,_=0;_<=d;_++){var C=Math.cos(k),O=Math.sin(k);o.x=b*C,o.y=S,o.z=b*O;var Z=s.clone().addScaledVector(o,u);v.push(e*Z.x,t*Z.y,r*Z.z),p.push(e*o.x,t*o.y,r*o.z),m.push(0,0),g.push(y++),k+=$o/d}l.push(g)}for(var L=l.length-1,A=0;A<L;A++){var M=l[A],D=l[A+1],T=M.length-1;h(M[0],D[1],D[0]);for(var z=1;z<=T;z++)h(M[z-1],M[z],D[z]),h(M[z],D[z+1],D[z])}}return b("z","y","x",-1,-1,a,i,n,l,s,0),b("z","y","x",1,-1,a,i,-n,l,s,1),b("x","z","y",1,1,n,a,i,o,l,2),b("x","z","y",1,-1,n,a,-i,o,l,3),b("x","y","z",1,-1,n,i,a,o,s,4),b("x","y","z",-1,-1,n,i,-a,o,s,5),u>0&&(S("z","y","x",-1,-1,1,a,i,n,l,0),S("z","y","x",1,-1,-1,a,i,n,l,1),S("z","y","x",-1,1,-1,a,i,n,l,1),S("z","y","x",1,1,1,a,i,n,l,0),S("x","y","z",-1,-1,-1,n,i,a,o,0),S("x","y","z",1,-1,1,n,i,a,o,1),S("x","y","z",-1,1,1,n,i,a,o,0),S("x","y","z",1,1,-1,n,i,a,o,1),S("y","x","z",-1,-1,1,i,n,a,s,0),S("y","x","z",1,-1,-1,i,n,a,s,1),S("y","x","z",1,1,1,i,n,a,s,1),S("y","x","z",-1,1,-1,i,n,a,s,0),k(1,1,1),k(-1,1,1),k(1,-1,1),k(-1,-1,1),k(1,1,-1),k(-1,1,-1),k(1,-1,-1),k(-1,-1,-1)),e.setIndex(f),e.setAttribute("position",new w.Float32BufferAttribute(v,3)),e.setAttribute("normal",new w.Float32BufferAttribute(p,3)),e.setAttribute("uv",new w.Float32BufferAttribute(m,2)),e}return(0,y.Z)(r)}(w.BufferGeometry),ts=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4;(0,g.Z)(this,r),(e=t.call(this)).type="PolyhedronGeometryRound";var d=[],f=[],v=[];return p(),m(),e.setAttribute("position",new w.Float32BufferAttribute(d,3)),e.setAttribute("normal",new w.Float32BufferAttribute(v,3)),e.setAttribute("uv",new w.Float32BufferAttribute(f,2)),(0,l.Z)(e);function p(){0==(s=Math.min(.99999,s))&&(h=0);for(var e={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[a],t=new w.Vector3,r=t.clone(),l=new w.Triangle,f=s*o,p=o-f,m=h+1,g=new w.Vector3,y=function(e,t){return g.subVectors(e,t).normalize()},x=function(e,t){return Array(e).fill(void 0).map(t)},b=x(n.length/3,(function(e,t){return(new w.Vector3).fromArray(n,3*t).setLength(o)})),S=[],k=1e6,_=function(e){for(var t=b[e],r=[],n=void 0,a=void 0,o=void 0,s=1e10,l=-1;-1!=(l=i.indexOf(e,l+1));){var c=l-l%3;n=i[c+(l+1)%3],a=i[c+(l+2)%3],o=t.distanceToSquared(b[n]),s=Math.min(s,o),r.push([n,a,o])}s+=1e-6;for(var h=[],d=0,f=r.length,v=0;v<f;v++){var p,m=(0,u.Z)(r[d],3);n=m[0],a=m[1],o=m[2];var g=1==(null===(p=S[n])||void 0===p?void 0:p.includes(e));o<=s&&h.push(n+ +g*k),d=r.findIndex((function(e){return e[0]==a}))}S.push(h)},C=0;C<b.length;C++)_(C);for(var O,Z,L=[],A=0,M=0,D=3==e,T=0;T<=h;T++){O=T*(T+1)/2,Z=(T+1)*(T+2)/2;for(var z=0;z<h-T;z++)A=O+z+T+2,M=Z+z+T+3,L.push.apply(L,[O,Z].concat((0,c.Z)(D?[M,O]:[A,Z]),[M,A])),O=A,Z=M;L.push(O,Z,O+h+2)}for(var E=t.clone(),P=t.clone(),N=t.clone(),B=t.clone(),U=t.clone(),I=[],V=x(b.length,(function(){return x(e,(function(){return t.clone()}))})),F=0;F<b.length;F++){t.copy(b[F]).normalize(),E.copy(t).multiplyScalar(p);for(var j=S[F],R=0;R<j.length;R++){var G=j[R],H=j[(R+1)%e];l.setFromPointsAndIndices(b,F,G%k,H%k),l.b.sub(l.a).setLength(1e10).add(l.a),l.c.sub(l.a).setLength(1e10).add(l.a),l.closestPointToPoint(E,V[F][R])}var W=[],q=[],J=[],Y=new w.Vector3;0==h&&(0,c.Z)(V[F]).reduce((function(e,t){return e.add(t)}),Y).multiplyScalar(1/e);for(var X=0;X<e;X++){var K=[],Q=(X-1+e)%e,$=V[F][Q],ee=V[F][X];t.copy($).sub(E),r.copy(ee).sub(E);var te=E.angleTo(t),re=t.angleTo(r),ne=Math.cos(te)*f;0==h?P.copy(Y):P.copy(E).setLength(p+ne),q.push(ne);for(var ie=[P,$,ee],ae=0;ae<2;ae++){var oe=ie[ae],se=ie[ae+1];B.subVectors(oe,E),U.subVectors(se,E),N.crossVectors(B,U).normalize();for(var le=0;le<m;le++){var ue=[te,re][ae]*le/m;t.copy(B).applyAxisAngle(N,ue).add(E),W.push(t.clone()),ae&&(y(t,E),K.push([0==le?oe:t.clone(),g.clone()]))}ae&&(y(se,E),K.push([se,g.clone()]))}J.push(K)}I.push(J);for(var ce=2*m,he=function(r){for(var n=ce*r,i=ce*((r+1)%e),a=[W[n]],o=1;o<m;o++){B=W[n+o],U=W[i+o],a.push(B);for(var s=1,l=o-2+1;s<=l;s++)t.lerpVectors(B,U,s/(l+1)),t.sub(E).setLength(q[r]).add(E),a.push(t.clone());a.push(U)}for(var u=0;u<m;u++)a.push(W[u+m+n]);a.push(W[i+m]);var h=L.map((function(e){return a[e]}));d.push.apply(d,(0,c.Z)(h.map((function(e){return[e.x,e.y,e.z]})).flat())),v.push.apply(v,(0,c.Z)(h.map((function(e){return y(e,E),[g.x,g.y,g.z]})).flat()))},de=0;de<e;de++)he(de)}for(var fe=[],ve=function(t){for(var r=0;r<e;r++){var n=S[t][r];if(n<k){for(var i=S[n].findIndex((function(e){return e%k==t})),a=I[t][r],o=I[n][i],s=0;s<m;s++){var l=a[s],u=o[m-s],c=a[s+1];[l,u,c,c,u,o[m-(s+1)]].forEach((function(e){d.push(e[0].x,e[0].y,e[0].z),v.push(e[1].x,e[1].y,e[1].z)}))}fe.push(a[0][0],o[m][0],a[m][0],o[0][0])}}},pe=0;pe<S.length;pe++)ve(pe);for(;fe.length;){var me,ge=void 0,ye=void 0,xe=void 0,be=fe.splice(0,2),we=(0,u.Z)(be,2);me=we[0],ge=we[1];for(var Se=[me];me!=ge;)Se.push(ge),xe=(ye=fe.indexOf(ge))%2,ge=fe.splice(ye-xe,2)[1-xe];g.subVectors(Se[0],Se[1]).cross(t.subVectors(Se[0],Se[2])).normalize();var ke=g.dot(Se[0])<0;ke&&g.negate();for(var _e=1;_e<=Se.length-2;_e++)[Se[_e+ +ke],Se[_e+1-+ke],Se[0]].forEach((function(e){d.push(e.x,e.y,e.z),v.push(g.x,g.y,g.z)}))}}function m(){for(var e=new w.Vector3,t=0;t<d.length;t+=3){e.x=d[t+0],e.y=d[t+1],e.z=d[t+2];var r=_(e)/2/Math.PI+.5,n=C(e)/Math.PI+.5;f.push(r,1-n)}for(var i=new w.Vector3,a=new w.Vector3,o=new w.Vector3,s=new w.Vector3,l=new w.Vector2,u=new w.Vector2,c=new w.Vector2,h=function(e,t,r,n){n<0&&1===e.x&&(f[t]=e.x-1),0===r.x&&0===r.z&&(f[t]=n/2/Math.PI+.5)},v=0,p=0;v<d.length;v+=9,p+=6){i.set(d[v+0],d[v+1],d[v+2]),a.set(d[v+3],d[v+4],d[v+5]),o.set(d[v+6],d[v+7],d[v+8]),l.set(f[p+0],f[p+1]),u.set(f[p+2],f[p+3]),c.set(f[p+4],f[p+5]),s.copy(i).add(a).add(o).divideScalar(3);var m=_(s);h(l,p+0,i,m),h(u,p+2,a,m),h(c,p+4,o,m)}for(var g=0;g<f.length;g+=6){var y=f[g+0],x=f[g+2],b=f[g+4],S=Math.max(y,x,b),k=Math.min(y,x,b);S>.9&&k<.1&&(y<.2&&(f[g+0]+=1),x<.2&&(f[g+2]+=1),b<.2&&(f[g+4]+=1))}function _(e){return Math.atan2(e.z,-e.x)}function C(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}}}return(0,y.Z)(r,null,[{key:"fromJSON",value:function(e){return new r(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}}]),r}(w.BufferGeometry),rs=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:a.width)})}}},{key:"build",value:function(e){var t=e.parameters,r=t.width,n=t.height,i=t.depth,a=t.detail,o=t.corner,s=t.cornerSides,l=0===a&&0!==o?new ns(.5*r,o,s):new w.DodecahedronBufferGeometry(.5*r,a);return l.scale(1,n/r,i/r),Object.assign(l,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"DodecahedronGeometry"})})}}]),e}(),ns=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;(0,g.Z)(this,r);var o=(1+Math.sqrt(5))/2,s=1/o,l=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-o,0,-s,o,0,s,-o,0,s,o,-s,-o,0,-s,o,0,s,-o,0,s,o,0,-o,0,-s,o,0,-s,-o,0,s,o,0,s],u=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],c="DodecahedronGeometry";return(e=t.call(this,l,u,c,n,i,a)).type=c,e}return(0,y.Z)(r,null,[{key:"fromJSON",value:function(e){return new r(e.radius,e.corner,e.cornerSides)}}]),r}(ts),is=1e-12,as=function(){function e(t){(0,g.Z)(this,e),this.position=new w.Vector2,this.startPosition=new w.Vector2,this.uuid=w.MathUtils.generateUUID(),this.position=t.clone()}return(0,y.Z)(e,[{key:"start",value:function(){this.reset()}},{key:"reset",value:function(){this.startPosition.copy(this.position)}},{key:"applyOffset",value:function(e){this.position.copy(this.startPosition).add(e)}},{key:"copy",value:function(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}},{key:"clone",value:function(){return new e(this.position).copy(this)}},{key:"toJSON",value:function(){return[this.position.x,this.position.y]}}]),e}(),os=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this,e.position)).parent=e,n}return(0,y.Z)(r,[{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this}},{key:"clone",value:function(){return new r(this.parent).copy(this)}}]),r}(as),ss=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n){var i;return(0,g.Z)(this,r),(i=t.call(this,n)).controls=[],i.roundness=0,i.areControlsDirectionsMirrored=!0,i.uuid=e,i.controls.push(new os((0,h.Z)(i)),new os((0,h.Z)(i))),i}return(0,y.Z)(r,[{key:"getOppositeControl",value:function(e){var t=this.controls.indexOf(e);return 0===t?this.controls[1]:1===t?this.controls[0]:null}},{key:"applyOffsetToControls",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=0,n=this.controls.length;r<n;r++){var i=this.controls[r];this.position.distanceTo(i.position)<=t?i.position.copy(this.position):i.applyOffset(e)}}},{key:"controlsMoved",value:function(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}},{key:"clone",value:function(){return new r(this.uuid,this.position).copy(this)}},{key:"toJSON",value:function(){return(0,o.Z)((0,s.Z)(r.prototype),"toJSON",this).call(this).concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}},{key:"computeTangents",value:function(){var e,t;return[null===(e=this.curveBefore)||void 0===e?void 0:e.getTangentAt(1),null===(t=this.curveAfter)||void 0===t?void 0:t.getTangentAt(0)]}},{key:"computeNormals",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w.Vector2,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w.Vector2,r=this.computeTangents(),n=(0,u.Z)(r,2),i=n[0],a=n[1];return i&&a&&(ls(i,e),ls(a,t)),[e,t]}},{key:"computeTangent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w.Vector2,t=this.computeTangents(),r=(0,u.Z)(t,2),n=r[0],i=r[1];return n&&i&&e.copy(n).add(i).normalize(),e}},{key:"computeNormal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w.Vector2,t=this.computeNormals(),r=(0,u.Z)(t,2),n=r[0],i=r[1];return e.copy(n).add(i).normalize(),e}}],[{key:"create",value:function(e,t){var n,i,o=new r(e,(0,a.Z)(w.Vector2,(0,c.Z)(t.position)));return(n=o.controls[0].position).set.apply(n,(0,c.Z)(t.controlPrevious.position)),(i=o.controls[1].position).set.apply(i,(0,c.Z)(t.controlNext.position)),o.roundness=t.roundness,o.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,o}}]),r}(as);function ls(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w.Vector2,r=e.length();return t.set(-e.y/r,e.x/r)}var us=new w.Vector2,cs=new w.Vector2,hs=new w.Vector2,ds=new w.Vector2,fs=new w.Vector2,vs=new w.Vector2,ps=new w.Vector3,ms=new w.Vector3;function gs(e){var t=new w.Vector2;t.addVectors(e.v0,us.subVectors(e.v1,e.v0).multiplyScalar(2/3));var r=new w.Vector2;return r.addVectors(e.v2,cs.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new w.CubicBezierCurve(e.v0,t,r,e.v2)}function ys(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return Math.abs(e-t)<r}function xs(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return e.distanceTo(t)<r}function bs(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return e.distanceTo(t)<r}function ws(e,t,r){var n=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),i=Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2)),a=Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2));return Math.acos((i*i+n*n-a*a)/(2*i*n))}function Ss(e,t,r){return Ls(e,t)&&Ls(t,r)&&ks(e.position,t.position,r.position)}function ks(e,t,r){return 0===us.copy(t).sub(e).cross(cs.copy(r).sub(e))}function _s(e,t,r,n,i){var a=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),o=(e.y+t.y)/2,s=(e.x+t.x)/2,l=Math.sqrt(Math.pow(r,2)-Math.pow(a/2,2))*(e.y-t.y)/a,u=Math.sqrt(Math.pow(r,2)-Math.pow(a/2,2))*(t.x-e.x)/a;return n.set(s+l,o+u),i.set(s-l,o-u),[n,i]}function Cs(e,t,r){return e.distanceTo(r)<t.distanceTo(r)?t:e}function Os(e,t,r,n,i,a){var o,s=t.x-e.x,l=t.y-e.y,u=r.x-e.x,c=r.y-e.y,h=Math.sqrt((s+u)*(s+u)+(l+c)*(l+c));return ws(t,e,r)>Math.PI&&(h*=-1),o=ys(c,l)?(l+c)*(n/h-.5)*8/3/(s-u):(s+u)*(n/h-.5)*8/3/(c-l),i.set(t.x-o*l,t.y+o*s),a.set(r.x+o*c,r.y-o*u),[i,a]}function Zs(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function Ls(e,t){return ks(e.position,e.controls[1].position,t.position)&&ks(e.position,t.controls[0].position,t.position)}function As(e,t){for(var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=ms.set(0,0,0),o=0,s=[],l=0;l<t.length;l++){var u=t[l],c=us,h=Ts(u,n);s.push(h);for(var d=0;d<=h;d++)if(u instanceof w.CubicBezierCurve||u instanceof w.QuadraticBezierCurve||u instanceof w.LineCurve){if(u.getPoint(d/h,c),a.set(c.x,c.y,0),void 0!==r&&bs(r,a))continue;void 0===r&&(r=ps),r.copy(a),e.setXYZ(o,a.x,a.y,a.z),o++}}return i&&o>1&&!(e.getX(o-1)===e.getX(0)&&e.getY(o-1)===e.getY(0)&&e.getZ(o-1)===e.getZ(0))&&(e.setXYZ(o,e.getX(0),e.getY(0),e.getZ(0)),o++),e}function Ms(e,t,r){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=ms.set(0,0,0),o=0,s=[],l=0;l<t.length;l++)if(!1!==r[l]){var u=void 0,c=t[l],h=us,d=Ts(c,n);s.push(d);for(var f=0;f<=d;f++)if(c instanceof w.CubicBezierCurve||c instanceof w.QuadraticBezierCurve||c instanceof w.LineCurve){var v;if(c.getPoint(f/d,h),a.set(h.x,h.y,0),null!==(v=u)&&void 0!==v&&v.equals(a))continue;void 0===u?u=ps:(e.setXYZ(o,u.x,u.y,u.z),o++,e.setXYZ(o,a.x,a.y,a.z),o++),u.copy(a)}}return i&&o>1&&!(e.getX(o-1)===e.getX(0)&&e.getY(o-1)===e.getY(0)&&e.getZ(o-1)===e.getZ(0))&&(e.setXYZ(o,e.getX(0),e.getY(0),e.getZ(0)),o++),s}function Ds(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[],i=0,a=e.length;i<a;i++){var o=e[i],s=0;if(r&&void 0!==o.roundedCurveCorner){var l=.5*Ts(o.roundedCurveCorner,t);i>0&&(n[i-1]+=l),s+=l}void 0!==o.curveAfter&&(s+=Ts(o.curveAfter,t)),n.push(s)}return e.length>0&&r&&void 0!==e[0].roundedCurveCorner&&(n[e.length-1]+=.5*Ts(e[0].roundedCurveCorner,t)),n}function Ts(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return e&&e instanceof w.EllipseCurve?2*t:e&&(e instanceof w.LineCurve||e instanceof w.LineCurve3)?1:e&&e instanceof w.SplineCurve?t*e.points.length:t}function zs(e,t){for(var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=0,o=0;o<t.length;o++)for(var s=t[o],l=Ts(s,n),u=us,c=0;c<=l;c++)if(s instanceof w.CubicBezierCurve||s instanceof w.QuadraticBezierCurve||s instanceof w.LineCurve){if(s.getPoint(c/l,u),void 0!==r&&xs(r,u,is))continue;void 0===r&&(r=cs),r.copy(u),e.push(u.x,u.y),a++}return ys(e[0],e[e.length-2],is)&&ys(e[1],e[e.length-1],is)&&(e.pop(),e.pop()),i&&a>1&&!(ys(e[a-1],e[1],is)&&ys(e[a-2],e[0],is))&&(e.push(e[0],e[1]),a++),e}var Es,Ps,Ns=new w.Vector2,Bs=new w.Vector2,Us=new w.Vector2,Is=new w.Vector2,Vs=new w.Vector2,Fs=new w.Vector2,js=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return(0,g.Z)(this,r),(e=t.call(this)).points=[],e.shapeHoles=[],e.eventDispatcher=new w.EventDispatcher,e.plane=new w.Plane(new w.Vector3(0,0,-1)),e.subdivision=0,e.controlSnapDistance=4,e.pointIDs=0,e.isMesh2D=!1,e._roundness=0,e.isClosed=!1,e.useCubicForRoundedCorners=!0,e.uuid=w.MathUtils.generateUUID(),e.needsUpdate=!1,e.roundedCurves=[],e._width=n,e._height=i,e}return(0,y.Z)(r,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"roundness",get:function(){return this._roundness},set:function(e){if(this._roundness!==e){this._roundness=e;for(var t=0,r=this.points.length;t<r;t++)this.points[t].roundness=e;this.needsUpdate=!0}}},{key:"getPointsIndexesByIds",value:function(e){var t=this;return e.map((function(e){return t.getPointIndexById(e)})).filter((function(e){return e>=0}))}},{key:"getPointIndexById",value:function(e){var t=this.points.length,r=this.points.findIndex((function(t){return t.uuid===e}));if(r<0)for(var n=t,i=0,a=this.shapeHoles.length;i<a;i++){var o=this.shapeHoles[i],s=o.points.length-1,l=o.getPointIndexById(e);if(!(l<0))return l+n;n+=s}return r}},{key:"getLineIndexById",value:function(e){return this.getPointIndexById(e)}},{key:"getBezierPoint",value:function(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0)for(var t=0,r=this.shapeHoles.length;t<r;t++){var n=this.shapeHoles[t],i=e-this.points.length;if(i<=n.points.length-1)return n.points[i]}throw new Error("This shape does not have a point for this index: "+e)}},{key:"getBezierPointIndex",value:function(e){var t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(var r=0,n=this.shapeHoles.length;r<n;r++){var i=this.shapeHoles[r],a=i.points.indexOf(e);if(a>=0)return t+a;t+=i.points.length}return-1}},{key:"getAllPoints",value:function(){var e,t=(e=[]).concat.apply(e,(0,c.Z)(this.shapeHoles.map((function(e){return e.points}))));return[].concat((0,c.Z)(this.points),(0,c.Z)(t))}},{key:"applySize",value:function(e,t){0===e&&(e=.001),0===t&&(t=.001),this._width=e,this._height=t}},{key:"applyScale",value:function(e,t){for(var r=Ns.set(e,t),n=0,i=this.points.length;n<i;n++){var a=this.points[n];a.position.multiply(r),a.controls[0].position.multiply(r),a.controls[1].position.multiply(r)}for(var o=0,s=this.shapeHoles.length;o<s;o++)this.shapeHoles[o].applyScale(e,t);this._update(!1)}},{key:"createPoint",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.MathUtils.generateUUID();t=e instanceof w.Vector2?e:new w.Vector2(e,r);var i=new ss(n,t);return i.roundness=this.roundness,i}},{key:"addPoint",value:function(e){this.points.push(e),this.needsUpdate=!0}},{key:"addPointAt",value:function(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}},{key:"getPointByUuid",value:function(e){for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];if(n.uuid===e)return n}for(var i=0,a=this.shapeHoles.length;i<a;i++){var o=this.shapeHoles[i].getPointByUuid(e);if(o)return o}}},{key:"getFirstPoint",value:function(){return this.points[0]}},{key:"getLastPoint",value:function(){return this.points[this.points.length-1]}},{key:"removePoint",value:function(e){var t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}},{key:"removePointById",value:function(e){var t=this.points.find((function(t){return t.uuid===e}));t&&this.removePoint(t)}},{key:"update",value:function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=0,r=this.shapeHoles.length;t<r;t++)this.shapeHoles[t].update(!1);this._update(e)}},{key:"extractShapePointsToBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t);var n=r?this.roundedCurveDivisions:this.curveDivisions;return As(e,r?this.roundedCurves:this.curves,t,this.autoClose),n.reduce((function(e,t){return e+t}),0)+1}},{key:"computeCurveDivisions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;return this.curveDivisions=Ds(this.points,e,!1),this.roundedCurveDivisions=Ds(this.points,e,!0),this.curveDivisions}},{key:"extractFilteredShapePointsToBuffer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12;return 2*Ms(e,this.curves,t,r,this.autoClose).reduce((function(e,t){return e+t}),0)}},{key:"extractShapePointsToFlatArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t),zs(e,this.roundedCurves,t,this.autoClose)}},{key:"getCurveIndexFromVertexId",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=0;void 0===this.curveDivisions&&this.computeCurveDivisions(this.subdivision);var n=t?this.roundedCurveDivisions:this.curveDivisions,i=0;t&&void 0!==this.points[0].roundedCurveCorner&&(i=.5*Ts(this.points[0].roundedCurveCorner,this.subdivision));var a=e-i;a<0&&(a+=n.reduce((function(e,t){return e+t}),0));for(var o=0,s=n.length;o<s;o++){var l=n[o];if(a<r+l)return[o,(a-r+1)/l];r+=l}return[0,1]}},{key:"getCurveT",value:function(e,t,r){var n=this.points[e],i=this.points[e>=this.points.length-1?0:e+1],a=this.curveDivisions,o=a[e];if(Zs(n,i)){var s=n.position.distanceTo(i.position);return n.position.distanceTo(Ns.set(r.x,r.y))/s}for(var l=0,u=0;u<e;u++)l+=a[u];return(t-l)/o}},{key:"dispose",value:function(){this.eventDispatcher=null}},{key:"_applyCurveForPoint",value:function(e,t){Zs(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);var r=this.curves[this.curves.length-1];e.curveBefore=r,t.curveAfter=r;var n=r.clone();e.roundedCurveBefore=n,t.roundedCurveAfter=n,e.roundedCurveCorner=void 0,this.roundedCurves.push(n)}},{key:"_update",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.curves=[],this.roundedCurves=[],this.points.length){for(var r=0,n=this.points.length;r<n;r++){var i=this.points[r];if(0===r)this.moveTo(i.position.x,i.position.y);else{var a=this.points[r-1];this._applyCurveForPoint(i,a)}}var o=this.getLastPoint();if(null!==o&&void 0!==o&&o.curveAfter&&(o.curveAfter=void 0),this.isClosed){var s=this.points[0],l=this.points[this.points.length-1];this._applyCurveForPoint(s,l)}if(this.points.length>2)for(var c=0,h=0,d=this.points.length;h<d;h++){var f,v,p=this.points[h],m=null!==(f=this.points[h-1])&&void 0!==f?f:this.points[this.points.length-1],g=null!==(v=this.points[h+1])&&void 0!==v?v:this.points[0],y=p.roundness,x=m&&g&&Ss(m,p,g);if(!p.controlsMoved()&&y>0&&!x){var b=p.curveBefore,S=p.curveAfter;if(void 0===b||void 0===S)continue;var k=p.roundedCurveBefore,_=p.roundedCurveAfter,C=b.getLength(),O=S.getLength(),Z=Math.min(y,.499*C),L=Math.min(y,.499*O),A=Math.min(Z,L),M=1-A/C,D=A/O,T=b.getPointAt(M,Ns),z=S.getPointAt(D,Bs);this._subSplitCurve(b,k,M,T,void 0),this._subSplitCurve(S,_,D,void 0,z);var E=void 0;if(this.useCubicForRoundedCorners){var P=ws(T,p.position,z)/2,N=Math.tan(P)*T.distanceTo(p.position),B=_s(T,z,N,Us,Is),U=(0,u.Z)(B,2),I=U[0],V=U[1],F=Cs(I,V,p.position),j=Os(F,T,z,N,Vs,Fs),R=(0,u.Z)(j,2),G=R[0],H=R[1];E=new w.CubicBezierCurve(T.clone(),G.clone(),H.clone(),z.clone())}else E=new w.QuadraticBezierCurve(T.clone(),p.position.clone(),z.clone());p.roundedCurveCorner=E,this.roundedCurves.splice(h+c,0,E),c++}}t&&(null===(e=this.eventDispatcher)||void 0===e||e.dispatchEvent({type:"update"}))}}},{key:"_subSplitCurve",value:function(e,t,r,n,i){if(!(e instanceof w.LineCurve)){var a=e,o=t,s=a.getUtoTmapping(r,0),l=function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,a=us.subVectors(t,e).multiplyScalar(i).add(e),o=cs.subVectors(r,t).multiplyScalar(i).add(t),s=hs.subVectors(n,r).multiplyScalar(i).add(r),l=a,u=ds.subVectors(o,a).multiplyScalar(i).add(a),c=fs.subVectors(s,o).multiplyScalar(i).add(o),h=s,d=vs.subVectors(c,u).multiplyScalar(i).add(u);return[e.x,e.y,l.x,l.y,u.x,u.y,d.x,d.y,c.x,c.y,h.x,h.y,n.x,n.y]}(a.v0,a.v1,a.v2,a.v3,s);return void 0!==n&&(o.v0.set(l[0],l[1]),o.v1.set(l[2],l[3]),o.v2.set(l[4],l[5]),o.v3.set(l[6],l[7])),void 0!==i&&(o.v0.set(l[6],l[7]),o.v1.set(l[8],l[9]),o.v2.set(l[10],l[11]),o.v3.set(l[12],l[13])),o}return void 0!==n&&t.v2.copy(n),void 0!==i&&t.v1.copy(i),t}},{key:"clone",value:function(){var e=new r(this._width,this._height);return e.points=this.points.map((function(e){return e.clone()})),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map((function(e){return e.clone()})),e}},{key:"toJSON",value:function(){return{points:this.points.reduce((function(e,t){return e.concat(t.toJSON())}),[]),shapeHoles:this.shapeHoles.map((function(e){return e.toJSON()})),isClosed:this.isClosed,roundness:this.roundness}}},{key:"fromJSON",value:function(e){var t;this.points=[],this.pointIDs=0;for(var n=e.points.length/7,i=0;i<n;i++){var a=7*i,o=e.points[a+0],s=e.points[a+1],l=e.points[a+2],u=e.points[a+3],c=e.points[a+4],h=e.points[a+5],d=e.points[a+6],f=new ss(w.MathUtils.generateUUID(),new w.Vector2(o,s));f.controls[0].position.set(l,u),f.controls[1].position.set(c,h),f.roundness=d,this.points.push(f)}return this.shapeHoles=null!==(t=e.shapeHoles)&&void 0!==t&&t.length?e.shapeHoles.map((function(e){var t=new r;return t.fromJSON(e),t})):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}},{key:"fromShape",value:function(e){var t=this,n=function(e,t){t instanceof w.CubicBezierCurve&&t.v3.equals(e.position)&&e.controls[0].position.copy(t.v2)};return this.points=function(e){var r,i,a=[];for(r=0,i=e.length;r<i;r++)e[r]instanceof w.QuadraticBezierCurve&&(e[r]=gs(e[r]));for(r=0,i=e.length;r<i;r++){var o=e[r],s=r>0?e[r-1]:null,l=void 0;o instanceof w.CubicBezierCurve?(l=t.createPoint(o.v0)).controls[1].position.copy(o.v1):o instanceof w.LineCurve&&(l=t.createPoint(o.v1)),void 0!==l&&(null!==s&&n(l,s),a.push(l))}var u=e[e.length-1],c=!1;return u instanceof w.CubicBezierCurve?u.v3.equals(a[0].position)&&(a[0].controls[0].position.copy(u.v2),c=!0):u instanceof w.LineCurve&&u.v2.equals(a[0].position)&&(c=!0),t.isClosed=c,a}(e.curves),e instanceof w.Shape&&(this.shapeHoles=e.holes.map((function(e){var t=new r;return t.fromShape(e),t}))),this.update(),this}}],[{key:"createFromState",value:function(e,t,n){var i=new r;return i.isClosed=e.isClosed,i.points=e.points.map((function(e){return ss.create(e.id,e.data)})),"number"==typeof e.roundness&&(i.roundness=e.roundness),i.shapeHoles=e.shapeHoles.map((function(e){return r.createFromState(e)})),void 0!==t&&void 0!==n&&i.applySize(t,n),i.update(),i}}]),r}(w.Shape),Rs=2*Math.PI;function Gs(e,t,r,n,i){return{x:e.x*t+n,y:e.y*r+i}}function Hs(e,t){var r=1.5707963267948966===t?.551915024494:-1.5707963267948966===t?-.551915024494:1.3333333333333333*Math.tan(t/4),n=Math.cos(e),i=Math.sin(e),a=Math.cos(e+t),o=Math.sin(e+t);return[{x:n-i*r,y:i+n*r},{x:a+o*r,y:o-a*r},{x:a,y:o}]}function Ws(e,t,r,n){var i=e*n-t*r<0?-1:1,a=Math.min(1,Math.max(-1,e*r+t*n));return i*Math.acos(a)}function qs(e){var t=e.px,r=e.py,n=e.cx,i=e.cy,a=e.rx,o=e.ry,s=e.largeArcFlag,l=e.sweepFlag,u=[];if(0===a||0===o)return[];var c=(t-n)/2,h=(r-i)/2;if(0===c&&0===h)return[];a=Math.abs(a),o=Math.abs(o);var d=Math.pow(c,2)/Math.pow(a,2)+Math.pow(h,2)/Math.pow(o,2);d>1&&(a*=Math.sqrt(d),o*=Math.sqrt(d));var f=function(e,t,r,n,i,a,o,s,l,u){var c=Math.pow(i,2),h=Math.pow(a,2),d=Math.pow(o,2),f=Math.pow(s,2),v=c*h-c*f-h*d;v<0&&(v=0),v/=c*f+h*d;var p=(v=Math.sqrt(v)*(l===u?-1:1))*i/a*s,m=v*-a/i*o,g=p+(e+r)/2,y=m+(t+n)/2,x=(o-p)/i,b=(s-m)/a,w=(-o-p)/i,S=(-s-m)/a,k=Ws(1,0,x,b),_=Ws(x,b,w,S);return!u&&_>0&&(_-=Rs),u&&_<0&&(_+=Rs),{centerx:g,centery:y,ang1:k,ang2:_}}(t,r,n,i,a,o,c,h,s,l),v=f.ang1,p=f.ang2,m=f.centerx,g=f.centery,y=Math.abs(p)/(Rs/4);Math.abs(1-y)<1e-7&&(y=1);var x=Math.max(Math.ceil(y),1);p/=x;for(var b=0;b<x;b++)u.push(Hs(v,p)),v+=p;return u.map((function(e){var t=Gs(e[0],a,o,m,g),r=t.x,n=t.y,i=Gs(e[1],a,o,m,g),s=i.x,l=i.y,u=Gs(e[2],a,o,m,g);return{x1:r,y1:n,x2:s,y2:l,x:u.x,y:u.y}}))}function Js(e,t){if(!e)throw t||"Assertion Failed!"}!function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"}(Es||(Es={})),function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"}(Ps||(Ps={}));var Ys=function(){function e(){}return e.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},e.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},e.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},e.edgeEval=function(t,r,n){Js(e.vertLeq(t,r)&&e.vertLeq(r,n));var i=r.s-t.s,a=n.s-r.s;return i+a>0?i<a?r.t-t.t+(t.t-n.t)*(i/(i+a)):r.t-n.t+(n.t-t.t)*(a/(i+a)):0},e.edgeSign=function(t,r,n){Js(e.vertLeq(t,r)&&e.vertLeq(r,n));var i=r.s-t.s,a=n.s-r.s;return i+a>0?(r.t-n.t)*i+(r.t-t.t)*a:0},e.transEval=function(t,r,n){Js(e.transLeq(t,r)&&e.transLeq(r,n));var i=r.t-t.t,a=n.t-r.t;return i+a>0?i<a?r.s-t.s+(t.s-n.s)*(i/(i+a)):r.s-n.s+(n.s-t.s)*(a/(i+a)):0},e.transSign=function(t,r,n){Js(e.transLeq(t,r)&&e.transLeq(r,n));var i=r.t-t.t,a=n.t-r.t;return i+a>0?(r.s-n.s)*i+(r.s-t.s)*a:0},e.vertCCW=function(e,t,r){return e.s*(t.t-r.t)+t.s*(r.t-e.t)+r.s*(e.t-t.t)>=0},e.interpolate=function(e,t,r,n){return(e=e<0?0:e)<=(r=r<0?0:r)?0===r?(t+n)/2:t+e/(e+r)*(n-t):n+r/(e+r)*(t-n)},e.intersect=function(t,r,n,i,a){var o,s,l;e.vertLeq(t,r)||(l=t,t=r,r=l),e.vertLeq(n,i)||(l=n,n=i,i=l),e.vertLeq(t,n)||(l=t,t=n,n=l,l=r,r=i,i=l),e.vertLeq(n,r)?e.vertLeq(r,i)?((o=e.edgeEval(t,n,r))+(s=e.edgeEval(n,r,i))<0&&(o=-o,s=-s),a.s=e.interpolate(o,n.s,s,r.s)):((o=e.edgeSign(t,n,r))+(s=-e.edgeSign(t,i,r))<0&&(o=-o,s=-s),a.s=e.interpolate(o,n.s,s,i.s)):a.s=(n.s+r.s)/2,e.transLeq(t,r)||(l=t,t=r,r=l),e.transLeq(n,i)||(l=n,n=i,i=l),e.transLeq(t,n)||(l=t,t=n,n=l,l=r,r=i,i=l),e.transLeq(n,r)?e.transLeq(r,i)?((o=e.transEval(t,n,r))+(s=e.transEval(n,r,i))<0&&(o=-o,s=-s),a.t=e.interpolate(o,n.t,s,r.t)):((o=e.transSign(t,n,r))+(s=-e.transSign(t,i,r))<0&&(o=-o,s=-s),a.t=e.interpolate(o,n.t,s,i.t)):a.t=(n.t+r.t)/2},e}(),Xs=function(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1},Ks=function(){function e(e){this.side=e,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(e){this.Sym.Lface=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(e){this.Sym.Org=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(e){this.Sym.Lnext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(e){this.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(e){this.Lnext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(e){this.Sym.Onext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(e){this.Sym.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(e){this.Sym.Lnext.Sym=e},enumerable:!0,configurable:!0}),e}(),Qs=function(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0},$s=function(){function e(){var e=new Qs,t=new Xs,r=new Ks(0),n=new Ks(1);e.next=e.prev=e,e.anEdge=null,t.next=t.prev=t,r.next=r,r.Sym=n,n.next=n,n.Sym=r,this.vHead=e,this.fHead=t,this.eHead=r,this.eHeadSym=n}return e.prototype.makeEdge_=function(e){var t=new Ks(0),r=new Ks(1);e.Sym.side<e.side&&(e=e.Sym);var n=e.Sym.next;return r.next=n,n.Sym.next=t,t.next=e,e.Sym.next=r,t.Sym=r,t.Onext=t,t.Lnext=r,t.Org=null,t.Lface=null,t.winding=0,t.activeRegion=null,r.Sym=t,r.Onext=r,r.Lnext=t,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,t},e.prototype.splice_=function(e,t){var r=e.Onext,n=t.Onext;r.Sym.Lnext=t,n.Sym.Lnext=e,e.Onext=n,t.Onext=r},e.prototype.makeVertex_=function(e,t,r){var n=e;Js(n,"Vertex can't be null!");var i=r.prev;n.prev=i,i.next=n,n.next=r,r.prev=n,n.anEdge=t;var a=t;do{a.Org=n,a=a.Onext}while(a!==t)},e.prototype.makeFace_=function(e,t,r){var n=e;Js(n,"Face can't be null");var i=r.prev;n.prev=i,i.next=n,n.next=r,r.prev=n,n.anEdge=t,n.trail=null,n.marked=!1,n.inside=r.inside;var a=t;do{a.Lface=n,a=a.Lnext}while(a!==t)},e.prototype.killEdge_=function(e){e.Sym.side<e.side&&(e=e.Sym);var t=e.next,r=e.Sym.next;t.Sym.next=r,r.Sym.next=t},e.prototype.killVertex_=function(e,t){var r=e.anEdge,n=r;do{n.Org=t,n=n.Onext}while(n!==r);var i=e.prev,a=e.next;a.prev=i,i.next=a},e.prototype.killFace_=function(e,t){var r=e.anEdge,n=r;do{n.Lface=t,n=n.Lnext}while(n!==r);var i=e.prev,a=e.next;a.prev=i,i.next=a},e.prototype.makeEdge=function(){var e=new Qs,t=new Qs,r=new Xs,n=this.makeEdge_(this.eHead);return this.makeVertex_(e,n,this.vHead),this.makeVertex_(t,n.Sym,this.vHead),this.makeFace_(r,n,this.fHead),n},e.prototype.splice=function(e,t){var r=!1,n=!1;if(e!==t){if(t.Org!==e.Org&&(n=!0,this.killVertex_(t.Org,e.Org)),t.Lface!==e.Lface&&(r=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(t,e),!n){var i=new Qs;this.makeVertex_(i,t,e.Org),e.Org.anEdge=e}if(!r){var a=new Xs;this.makeFace_(a,t,e.Lface),e.Lface.anEdge=e}}},e.prototype.delete=function(e){var t=e.Sym,r=!1;if(e.Lface!==e.Rface&&(r=!0,this.killFace_(e.Lface,e.Rface)),e.Onext===e)this.killVertex_(e.Org,null);else if(e.Rface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev),!r){var n=new Xs;this.makeFace_(n,e,e.Lface)}t.Onext===t?(this.killVertex_(t.Org,null),this.killFace_(t.Lface,null)):(e.Lface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),this.killEdge_(e)},e.prototype.addEdgeVertex=function(e){var t=this.makeEdge_(e),r=t.Sym;this.splice_(t,e.Lnext),t.Org=e.Dst;var n=new Qs;return this.makeVertex_(n,r,t.Org),t.Lface=r.Lface=e.Lface,t},e.prototype.splitEdge=function(e){var t=this.addEdgeVertex(e).Sym;return this.splice_(e.Sym,e.Sym.Oprev),this.splice_(e.Sym,t),e.Dst=t.Org,t.Dst.anEdge=t.Sym,t.Rface=e.Rface,t.winding=e.winding,t.Sym.winding=e.Sym.winding,t.idx=e.idx,t.Sym.idx=e.Sym.idx,t},e.prototype.connect=function(e,t){var r=!1,n=this.makeEdge_(e),i=n.Sym;if(t.Lface!==e.Lface&&(r=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(n,e.Lnext),this.splice_(i,t),n.Org=e.Dst,i.Org=t.Org,n.Lface=i.Lface=e.Lface,e.Lface.anEdge=i,!r){var a=new Xs;this.makeFace_(a,n,e.Lface)}return n},e.prototype.zapFace=function(e){var t,r,n,i,a,o=e.anEdge;r=o.Lnext;do{r=(t=r).Lnext,t.Lface=null,null===t.Rface&&(t.Onext===t?this.killVertex_(t.Org,null):(t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),(n=t.Sym).Onext===n?this.killVertex_(n.Org,null):(n.Org.anEdge=n.Onext,this.splice_(n,n.Oprev)),this.killEdge_(t))}while(t!=o);i=e.prev,(a=e.next).prev=i,i.next=a},e.prototype.countFaceVerts_=function(e){var t=e.anEdge,r=0;do{r++,t=t.Lnext}while(t!==e.anEdge);return r},e.prototype.mergeConvexFaces=function(e){var t,r,n,i,a;for(t=this.fHead.next;t!==this.fHead;t=t.next)if(t.inside)for(a=(r=t.anEdge).Org;n=r.Lnext,(i=r.Sym)&&i.Lface&&i.Lface.inside&&(this.countFaceVerts_(t)+this.countFaceVerts_(i.Lface)-2<=e&&Ys.vertCCW(r.Lprev.Org,r.Org,i.Lnext.Lnext.Org)&&Ys.vertCCW(i.Lprev.Org,i.Org,r.Lnext.Lnext.Org)&&(n=i.Lnext,this.delete(i),r=null,i=null)),!r||r.Lnext.Org!==a;)r=n;return!0},e.prototype.check=function(){var e,t,r,n,i,a,o=this.fHead,s=this.vHead,l=this.eHead;for(t=o,t=o;(e=t.next)!==o;t=e){Js(e.prev===t),i=e.anEdge;do{Js(i.Sym!==i),Js(i.Sym.Sym===i),Js(i.Lnext.Onext.Sym===i),Js(i.Onext.Sym.Lnext===i),Js(i.Lface===e),i=i.Lnext}while(i!==e.anEdge)}for(Js(e.prev===t&&null===e.anEdge),n=s,n=s;(r=n.next)!==s;n=r){Js(r.prev===n),i=r.anEdge;do{Js(i.Sym!==i),Js(i.Sym.Sym===i),Js(i.Lnext.Onext.Sym===i),Js(i.Onext.Sym.Lnext===i),Js(i.Org===r),i=i.Onext}while(i!==r.anEdge)}for(Js(r.prev===n&&null===r.anEdge),a=l,a=l;(i=a.next)!==l;a=i)Js(i.Sym.next===a.Sym),Js(i.Sym!==i),Js(i.Sym.Sym===i),Js(null!==i.Org),Js(null!==i.Dst),Js(i.Lnext.Onext.Sym===i),Js(i.Onext.Sym.Lnext===i);Js(i.Sym.next===a.Sym&&i.Sym===this.eHeadSym&&i.Sym.Sym===i&&null===i.Org&&null===i.Dst&&null===i.Lface&&null===i.Rface)},e}(),el=function(){this.handle=null},tl=function(){this.key=null,this.node=0},rl=function(){function e(e,t){this.leq=t,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=e,this.nodes=[],this.handles=[];for(var r=0;r<e+1;r++)this.nodes[r]=new el,this.handles[r]=new tl;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(e){var t,r,n,i=this.nodes,a=this.handles;for(t=i[e].handle;;){if((n=e<<1)<this.size&&this.leq(a[i[n+1].handle].key,a[i[n].handle].key)&&++n,Js(n<=this.max),r=i[n].handle,n>this.size||this.leq(a[t].key,a[r].key)){i[e].handle=t,a[t].node=e;break}i[e].handle=r,a[r].node=e,e=n}},e.prototype.floatUp_=function(e){var t,r,n,i=this.nodes,a=this.handles;for(t=i[e].handle;;){if(r=i[n=e>>1].handle,0===n||this.leq(a[r].key,a[t].key)){i[e].handle=t,a[t].node=e;break}i[e].handle=r,a[r].node=e,e=n}},e.prototype.init=function(){for(var e=this.size;e>=1;--e)this.floatDown_(e);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(e){var t,r;if(2*(t=++this.size)>this.max){var n,i;for(this.max*=2,i=this.nodes.length,this.nodes.length=this.max+1,n=i;n<this.nodes.length;n++)this.nodes[n]=new el;for(i=this.handles.length,this.handles.length=this.max+1,n=i;n<this.handles.length;n++)this.handles[n]=new tl}return 0===this.freeList?r=t:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[t].handle=r,this.handles[r].node=t,this.handles[r].key=e,this.initialized&&this.floatUp_(t),r},e.prototype.extractMin=function(){var e=this.nodes,t=this.handles,r=e[1].handle,n=t[r].key;return this.size>0&&(e[1].handle=e[this.size].handle,t[e[1].handle].node=1,t[r].key=null,t[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),n},e.prototype.delete=function(e){var t,r=this.nodes,n=this.handles;Js(e>=1&&e<=this.max&&null!==n[e].key),r[t=n[e].node].handle=r[this.size].handle,n[r[t].handle].node=t,--this.size,t<=this.size&&(t<=1||this.leq(n[r[t>>1].handle].key,n[r[t].handle].key)?this.floatDown_(t):this.floatUp_(t)),n[e].key=null,n[e].node=this.freeList,this.freeList=e},e}(),nl=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},il=function(){this.key=null,this.next=null,this.prev=null},al=function(){function e(e,t){this.frame=e,this.leq=t,this.head=new il,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(e){return this.insertBefore(this.head,e)},e.prototype.search=function(e){var t=this.head;do{t=t.next}while(null!==t.key&&!this.leq(this.frame,e,t.key));return t},e.prototype.insertBefore=function(e,t){do{e=e.prev}while(null!==e.key&&!this.leq(this.frame,e.key,t));var r=new il;return r.key=t,r.next=e.next,e.next.prev=r,r.prev=e,e.next=r,r},e.prototype.delete=function(e){e.next.prev=e.prev,e.prev.next=e.next},e}(),ol=function(){function e(){}return e.regionBelow=function(e){return e.nodeUp.prev.key},e.regionAbove=function(e){return e.nodeUp.next.key},e.debugEvent=function(e){},e.addWinding=function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},e.edgeLeq=function(e,t,r){var n=e.event,i=t.eUp,a=r.eUp;return i.Dst===n?a.Dst===n?Ys.vertLeq(i.Org,a.Org)?Ys.edgeSign(a.Dst,i.Org,a.Org)<=0:Ys.edgeSign(i.Dst,a.Org,i.Org)>=0:Ys.edgeSign(a.Dst,n,a.Org)<=0:a.Dst===n?Ys.edgeSign(i.Dst,n,i.Org)>=0:Ys.edgeEval(i.Dst,n,i.Org)>=Ys.edgeEval(a.Dst,n,a.Org)},e.deleteRegion=function(e,t){t.fixUpperEdge&&Js(0===t.eUp.winding),t.eUp.activeRegion=null,e.dict.delete(t.nodeUp)},e.fixUpperEdge=function(e,t,r){Js(t.fixUpperEdge),e.mesh.delete(t.eUp),t.fixUpperEdge=!1,t.eUp=r,r.activeRegion=t},e.topLeftRegion=function(t,r){var n,i=r.eUp.Org;do{r=e.regionAbove(r)}while(r.eUp.Org===i);if(r.fixUpperEdge){if(null===(n=t.mesh.connect(e.regionBelow(r).eUp.Sym,r.eUp.Lnext)))return null;e.fixUpperEdge(t,r,n),r=e.regionAbove(r)}return r},e.topRightRegion=function(t){var r=t.eUp.Dst;do{t=e.regionAbove(t)}while(t.eUp.Dst===r);return t},e.addRegionBelow=function(e,t,r){var n=new nl;return n.eUp=r,n.nodeUp=e.dict.insertBefore(t.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,r.activeRegion=n,n},e.isWindingInside=function(e,t){switch(e.windingRule){case Es.ODD:return 0!==(1&t);case Es.NONZERO:return 0!==t;case Es.POSITIVE:return t>0;case Es.NEGATIVE:return t<0;case Es.ABS_GEQ_TWO:return t>=2||t<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,r){r.windingNumber=e.regionAbove(r).windingNumber+r.eUp.winding,r.inside=e.isWindingInside(t,r.windingNumber)},e.finishRegion=function(t,r){var n=r.eUp,i=n.Lface;i.inside=r.inside,i.anEdge=n,e.deleteRegion(t,r)},e.finishLeftRegions=function(t,r,n){for(var i,a=null,o=r,s=r.eUp;o!==n;){if(o.fixUpperEdge=!1,(i=(a=e.regionBelow(o)).eUp).Org!=s.Org){if(!a.fixUpperEdge){e.finishRegion(t,o);break}i=t.mesh.connect(s.Lprev,i.Sym),e.fixUpperEdge(t,a,i)}s.Onext!==i&&(t.mesh.splice(i.Oprev,i),t.mesh.splice(s,i)),e.finishRegion(t,o),s=a.eUp,o=a}return s},e.addRightEdges=function(t,r,n,i,a,o){var s,l,u,c,h=!0;u=n;do{Js(Ys.vertLeq(u.Org,u.Dst)),e.addRegionBelow(t,r,u.Sym),u=u.Onext}while(u!==i);for(null===a&&(a=e.regionBelow(r).eUp.Rprev),l=r,c=a;(u=(s=e.regionBelow(l)).eUp.Sym).Org===c.Org;)u.Onext!==c&&(t.mesh.splice(u.Oprev,u),t.mesh.splice(c.Oprev,u)),s.windingNumber=l.windingNumber-u.winding,s.inside=e.isWindingInside(t,s.windingNumber),l.dirty=!0,!h&&e.checkForRightSplice(t,l)&&(e.addWinding(u,c),e.deleteRegion(t,l),t.mesh.delete(c)),h=!1,l=s,c=u;l.dirty=!0,Js(l.windingNumber-u.winding===s.windingNumber),o&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(e,t,r){e.mesh.splice(t,r)},e.vertexWeights=function(e,t,r){var n=Ys.vertL1dist(t,e),i=Ys.vertL1dist(r,e),a=.5*i/(n+i),o=.5*n/(n+i);e.coords[0]+=a*t.coords[0]+o*r.coords[0],e.coords[1]+=a*t.coords[1]+o*r.coords[1],e.coords[2]+=a*t.coords[2]+o*r.coords[2]},e.getIntersectData=function(t,r,n,i,a,o){r.coords[0]=r.coords[1]=r.coords[2]=0,r.idx=-1,e.vertexWeights(r,n,i),e.vertexWeights(r,a,o)},e.checkForRightSplice=function(t,r){var n=e.regionBelow(r),i=r.eUp,a=n.eUp;if(Ys.vertLeq(i.Org,a.Org)){if(Ys.edgeSign(a.Dst,i.Org,a.Org)>0)return!1;Ys.vertEq(i.Org,a.Org)?i.Org!==a.Org&&(t.pq.delete(i.Org.pqHandle),e.spliceMergeVertices(t,a.Oprev,i)):(t.mesh.splitEdge(a.Sym),t.mesh.splice(i,a.Oprev),r.dirty=n.dirty=!0)}else{if(Ys.edgeSign(i.Dst,a.Org,i.Org)<0)return!1;e.regionAbove(r).dirty=r.dirty=!0,t.mesh.splitEdge(i.Sym),t.mesh.splice(a.Oprev,i)}return!0},e.checkForLeftSplice=function(t,r){var n,i=e.regionBelow(r),a=r.eUp,o=i.eUp;if(Js(!Ys.vertEq(a.Dst,o.Dst)),Ys.vertLeq(a.Dst,o.Dst)){if(Ys.edgeSign(a.Dst,o.Dst,a.Org)<0)return!1;e.regionAbove(r).dirty=r.dirty=!0,n=t.mesh.splitEdge(a),t.mesh.splice(o.Sym,n),n.Lface.inside=r.inside}else{if(Ys.edgeSign(o.Dst,a.Dst,o.Org)>0)return!1;r.dirty=i.dirty=!0,n=t.mesh.splitEdge(o),t.mesh.splice(a.Lnext,o.Sym),n.Rface.inside=r.inside}return!0},e.checkForIntersect=function(t,r){var n,i,a=e.regionBelow(r),o=r.eUp,s=a.eUp,l=o.Org,u=s.Org,c=o.Dst,h=s.Dst,d=new Qs;if(Js(!Ys.vertEq(h,c)),Js(Ys.edgeSign(c,t.event,l)<=0),Js(Ys.edgeSign(h,t.event,u)>=0),Js(l!==t.event&&u!==t.event),Js(!r.fixUpperEdge&&!a.fixUpperEdge),l===u||Math.min(l.t,c.t)>Math.max(u.t,h.t))return!1;if(Ys.vertLeq(l,u)){if(Ys.edgeSign(h,l,u)>0)return!1}else if(Ys.edgeSign(c,u,l)<0)return!1;return e.debugEvent(t),Ys.intersect(c,l,h,u,d),Js(Math.min(l.t,c.t)<=d.t),Js(d.t<=Math.max(u.t,h.t)),Js(Math.min(h.s,c.s)<=d.s),Js(d.s<=Math.max(u.s,l.s)),Ys.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),n=Ys.vertLeq(l,u)?l:u,Ys.vertLeq(n,d)&&(d.s=n.s,d.t=n.t),Ys.vertEq(d,l)||Ys.vertEq(d,u)?(e.checkForRightSplice(t,r),!1):!Ys.vertEq(c,t.event)&&Ys.edgeSign(c,t.event,d)>=0||!Ys.vertEq(h,t.event)&&Ys.edgeSign(h,t.event,d)<=0?h===t.event?(t.mesh.splitEdge(o.Sym),t.mesh.splice(s.Sym,o),r=e.topLeftRegion(t,r),o=e.regionBelow(r).eUp,e.finishLeftRegions(t,e.regionBelow(r),a),e.addRightEdges(t,r,o.Oprev,o,o,!0),!0):c===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(o.Lnext,s.Oprev),a=r,r=e.topRightRegion(r),i=e.regionBelow(r).eUp.Rprev,a.eUp=s.Oprev,s=e.finishLeftRegions(t,a,null),e.addRightEdges(t,r,s.Onext,o.Rprev,i,!0),!0):(Ys.edgeSign(c,t.event,d)>=0&&(e.regionAbove(r).dirty=r.dirty=!0,t.mesh.splitEdge(o.Sym),o.Org.s=t.event.s,o.Org.t=t.event.t),Ys.edgeSign(h,t.event,d)<=0&&(r.dirty=a.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(o.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,o),o.Org.s=d.s,o.Org.t=d.t,o.Org.pqHandle=t.pq.insert(o.Org),e.getIntersectData(t,o.Org,l,c,u,h),e.regionAbove(r).dirty=r.dirty=a.dirty=!0,!1)},e.walkDirtyRegions=function(t,r){for(var n,i,a=e.regionBelow(r);;){for(;a.dirty;)r=a,a=e.regionBelow(a);if(!r.dirty&&(a=r,null===(r=e.regionAbove(r))||!r.dirty))return;if(r.dirty=!1,n=r.eUp,i=a.eUp,n.Dst!==i.Dst&&e.checkForLeftSplice(t,r)&&(a.fixUpperEdge?(e.deleteRegion(t,a),t.mesh.delete(i),i=(a=e.regionBelow(r)).eUp):r.fixUpperEdge&&(e.deleteRegion(t,r),t.mesh.delete(n),n=(r=e.regionAbove(a)).eUp)),n.Org!==i.Org)if(n.Dst===i.Dst||r.fixUpperEdge||a.fixUpperEdge||n.Dst!==t.event&&i.Dst!==t.event)e.checkForRightSplice(t,r);else if(e.checkForIntersect(t,r))return;n.Org===i.Org&&n.Dst===i.Dst&&(e.addWinding(i,n),e.deleteRegion(t,r),t.mesh.delete(n),r=e.regionAbove(a))}},e.connectRightVertex=function(t,r,n){var i,a=n.Onext,o=e.regionBelow(r),s=r.eUp,l=o.eUp,u=!1;s.Dst!==l.Dst&&e.checkForIntersect(t,r),Ys.vertEq(s.Org,t.event)&&(t.mesh.splice(a.Oprev,s),r=e.topLeftRegion(t,r),a=e.regionBelow(r).eUp,e.finishLeftRegions(t,e.regionBelow(r),o),u=!0),Ys.vertEq(l.Org,t.event)&&(t.mesh.splice(n,l.Oprev),n=e.finishLeftRegions(t,o,null),u=!0),u?e.addRightEdges(t,r,n.Onext,a,a,!0):(i=Ys.vertLeq(l.Org,s.Org)?l.Oprev:s,i=t.mesh.connect(n.Lprev,i),e.addRightEdges(t,r,i,i.Onext,i.Onext,!1),i.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,r))},e.connectLeftDegenerate=function(t,r,n){var i,a,o,s,l;return i=r.eUp,Ys.vertEq(i.Org,n)?(Js(!1),void e.spliceMergeVertices(t,i,n.anEdge)):Ys.vertEq(i.Dst,n)?(Js(!1),r=e.topRightRegion(r),a=s=(o=(l=e.regionBelow(r)).eUp.Sym).Onext,l.fixUpperEdge&&(Js(a!==o),e.deleteRegion(t,l),t.mesh.delete(o),o=a.Oprev),t.mesh.splice(n.anEdge,o),Ys.edgeGoesLeft(a)||(a=null),void e.addRightEdges(t,r,o.Onext,s,a,!0)):(t.mesh.splitEdge(i.Sym),r.fixUpperEdge&&(t.mesh.delete(i.Onext),r.fixUpperEdge=!1),t.mesh.splice(n.anEdge,i),void e.sweepEvent(t,n))},e.connectLeftVertex=function(t,r){var n,i,a,o,s,l,u=new nl;if(u.eUp=r.anEdge.Sym,n=t.dict.search(u).key,i=e.regionBelow(n)){if(o=n.eUp,s=i.eUp,0===Ys.edgeSign(o.Dst,r,o.Org))return void e.connectLeftDegenerate(t,n,r);if(a=Ys.vertLeq(s.Dst,o.Dst)?n:i,n.inside||a.fixUpperEdge){if(a===n)l=t.mesh.connect(r.anEdge.Sym,o.Lnext);else l=t.mesh.connect(s.Dnext,r.anEdge).Sym;a.fixUpperEdge?e.fixUpperEdge(t,a,l):e.computeWinding(t,e.addRegionBelow(t,n,l)),e.sweepEvent(t,r)}else e.addRightEdges(t,n,r.anEdge,r.anEdge,null,!0)}},e.sweepEvent=function(t,r){t.event=r,e.debugEvent(t);for(var n=r.anEdge;null===n.activeRegion;)if((n=n.Onext)===r.anEdge)return void e.connectLeftVertex(t,r);var i=e.topLeftRegion(t,n.activeRegion);Js(null!==i);var a=e.regionBelow(i),o=a.eUp,s=e.finishLeftRegions(t,a,null);s.Onext===o?e.connectRightVertex(t,i,s):e.addRightEdges(t,i,s.Onext,o,o,!0)},e.addSentinel=function(e,t,r,n){var i=new nl,a=e.mesh.makeEdge();a.Org.s=r,a.Org.t=n,a.Dst.s=t,a.Dst.t=n,e.event=a.Dst,i.eUp=a,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=e.dict.insert(i)},e.initEdgeDict=function(t){t.dict=new al(t,e.edgeLeq);var r=t.bmax[0]-t.bmin[0],n=t.bmax[1]-t.bmin[1],i=t.bmin[0]-r,a=t.bmax[0]+r,o=t.bmin[1]-n,s=t.bmax[1]+n;e.addSentinel(t,i,a,o),e.addSentinel(t,i,a,s)},e.doneEdgeDict=function(t){for(var r,n=0;null!==(r=t.dict.min().key);)r.sentinel||(Js(r.fixUpperEdge),Js(1===++n)),Js(0===r.windingNumber),e.deleteRegion(t,r)},e.removeDegenerateEdges=function(t){var r,n,i,a=t.mesh.eHead;for(r=a.next;r!==a;r=n)n=r.next,i=r.Lnext,Ys.vertEq(r.Org,r.Dst)&&r.Lnext.Lnext!==r&&(e.spliceMergeVertices(t,i,r),t.mesh.delete(r),i=(r=i).Lnext),i.Lnext===r&&(i!==r&&((i===n||i===n.Sym)&&(n=n.next),t.mesh.delete(i)),(r===n||r===n.Sym)&&(n=n.next),t.mesh.delete(r))},e.initPriorityQ=function(e){var t,r,n,i=0;for(r=(n=e.mesh.vHead).next;r!==n;r=r.next)i++;for(i+=8,t=e.pq=new rl(i,Ys.vertLeq),r=(n=e.mesh.vHead).next;r!==n;r=r.next)r.pqHandle=t.insert(r);return r===n&&(t.init(),!0)},e.donePriorityQ=function(e){e.pq=null},e.removeDegenerateFaces=function(t,r){var n,i,a;for(n=r.fHead.next;n!==r.fHead;n=i)i=n.next,Js((a=n.anEdge).Lnext!==a),a.Lnext.Lnext===a&&(e.addWinding(a.Onext,a),t.mesh.delete(a));return!0},e.computeInterior=function(t,r){var n,i;if(void 0===r&&(r=!0),e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);null!==(n=t.pq.extractMin());){for(;null!==(i=t.pq.min())&&Ys.vertEq(i,n);)i=t.pq.extractMin(),e.spliceMergeVertices(t,n.anEdge,i.anEdge);e.sweepEvent(t,n)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),!!e.removeDegenerateFaces(t,t.mesh)&&(r&&t.mesh.check(),!0)},e}(),sl=function(){function e(){this.mesh=new $s,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=Es.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.prototype.normalize_=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(!t)throw"Zero-size vector!";t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},e.prototype.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},e.prototype.computeNormal_=function(e){var t,r,n,i,a,o,s=[0,0,0],l=[0,0,0],u=[0,0,0],c=[0,0,0],h=[0,0,0],d=[null,null,null],f=[null,null,null],v=this.mesh.vHead;t=v.next;for(var p=0;p<3;++p)i=t.coords[p],l[p]=i,f[p]=t,s[p]=i,d[p]=t;for(t=v.next;t!==v;t=t.next)for(var m=0;m<3;++m)(i=t.coords[m])<l[m]&&(l[m]=i,f[m]=t),i>s[m]&&(s[m]=i,d[m]=t);var g=0;if(s[1]-l[1]>s[0]-l[0]&&(g=1),s[2]-l[2]>s[g]-l[g]&&(g=2),l[g]>=s[g])return e[0]=0,e[1]=0,void(e[2]=1);for(o=0,r=f[g],n=d[g],u[0]=r.coords[0]-n.coords[0],u[1]=r.coords[1]-n.coords[1],u[2]=r.coords[2]-n.coords[2],t=v.next;t!==v;t=t.next)c[0]=t.coords[0]-n.coords[0],c[1]=t.coords[1]-n.coords[1],c[2]=t.coords[2]-n.coords[2],h[0]=u[1]*c[2]-u[2]*c[1],h[1]=u[2]*c[0]-u[0]*c[2],h[2]=u[0]*c[1]-u[1]*c[0],(a=h[0]*h[0]+h[1]*h[1]+h[2]*h[2])>o&&(o=a,e[0]=h[0],e[1]=h[1],e[2]=h[2]);o<=0&&(e[0]=e[1]=e[2]=0,e[this.longAxis_(u)]=1)},e.prototype.checkOrientation_=function(){for(var e,t,r=this.mesh.fHead,n=this.mesh.vHead,i=0,a=r.next;a!==r;a=a.next)if(!((t=a.anEdge).winding<=0))do{i+=(t.Org.s-t.Dst.s)*(t.Org.t+t.Dst.t),t=t.Lnext}while(t!==a.anEdge);if(i<0){for(e=n.next;e!==n;e=e.next)e.t=-e.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var e,t,r=this.mesh.vHead,n=[0,0,0],i=!1;n[0]=this.normal[0],n[1]=this.normal[1],n[2]=this.normal[2],!n[0]&&!n[1]&&!n[2]&&(this.computeNormal_(n),i=!0),e=this.sUnit,t=this.tUnit;var a=this.longAxis_(n);e[a]=0,e[(a+1)%3]=1,e[(a+2)%3]=0,t[a]=0,t[(a+1)%3]=0,t[(a+2)%3]=n[a]>0?1:-1;for(var o=r.next;o!==r;o=o.next)o.s=this.dot_(o.coords,e),o.t=this.dot_(o.coords,t);i&&this.checkOrientation_();for(var s=!0,l=r.next;l!==r;l=l.next)s?(this.bmin[0]=this.bmax[0]=l.s,this.bmin[1]=this.bmax[1]=l.t,s=!1):(l.s<this.bmin[0]&&(this.bmin[0]=l.s),l.s>this.bmax[0]&&(this.bmax[0]=l.s),l.t<this.bmin[1]&&(this.bmin[1]=l.t),l.t>this.bmax[1]&&(this.bmax[1]=l.t))},e.prototype.addWinding_=function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},e.prototype.tessellateMonoRegion_=function(e,t){var r,n;if((r=t.anEdge).Lnext===r||r.Lnext.Lnext===r)throw"Mono region invalid";for(;Ys.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;Ys.vertLeq(r.Org,r.Dst);r=r.Lnext);n=r.Lprev;for(;r.Lnext!==n;)if(Ys.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(Ys.edgeGoesLeft(n.Lnext)||Ys.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)n=e.connect(n.Lnext,n).Sym;n=n.Lprev}else{for(;n.Lnext!==r&&(Ys.edgeGoesRight(r.Lprev)||Ys.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)r=e.connect(r,r.Lprev).Sym;r=r.Lnext}if(n.Lnext===r)throw"Mono region invalid";for(;n.Lnext.Lnext!==r;)n=e.connect(n.Lnext,n).Sym;return!0},e.prototype.tessellateInterior_=function(e){for(var t,r=e.fHead.next;r!==e.fHead;r=t)if(t=r.next,r.inside&&!this.tessellateMonoRegion_(e,r))return!1;return!0},e.prototype.discardExterior_=function(e){for(var t,r=e.fHead.next;r!==e.fHead;r=t)t=r.next,r.inside||e.zapFace(r)},e.prototype.setWindingNumber_=function(e,t,r){for(var n,i=e.eHead.next;i!==e.eHead;i=n)n=i.next,i.Rface.inside!==i.Lface.inside?i.winding=i.Lface.inside?t:-t:r?e.delete(i):i.winding=0},e.prototype.getNeighbourFace_=function(e){return e.Rface&&e.Rface.inside?e.Rface.n:-1},e.prototype.outputPolymesh_=function(e,t,r,n){var i,a,o=0,s=0;r>3&&e.mergeConvexFaces(r);for(var l=e.vHead.next;l!==e.vHead;l=l.next)l.n=-1;for(var u=e.fHead.next;u!==e.fHead;u=u.next)if(u.n=-1,u.inside){i=u.anEdge,a=0;do{-1===(l=i.Org).n&&(l.n=s,s++),a++,i=i.Lnext}while(i!==u.anEdge);if(a>r)throw"Face vertex greater that support polygon";u.n=o,++o}this.elementCount=o,t===Ps.CONNECTED_POLYGONS&&(o*=2),this.elements=[],this.elements.length=o*r,this.vertexCount=s,this.vertices=[],this.vertices.length=s*n,this.vertexIndices=[],this.vertexIndices.length=s;for(l=e.vHead.next;l!==e.vHead;l=l.next)if(-1!==l.n){var c=l.n*n;this.vertices[c+0]=l.coords[0],this.vertices[c+1]=l.coords[1],n>2&&(this.vertices[c+2]=l.coords[2]),this.vertexIndices[l.n]=l.idx}var h=0;for(u=e.fHead.next;u!==e.fHead;u=u.next)if(u.inside){i=u.anEdge,a=0;do{l=i.Org;this.elements[h++]=l.n,a++,i=i.Lnext}while(i!==u.anEdge);for(var d=a;d<r;++d)this.elements[h++]=-1;if(t===Ps.CONNECTED_POLYGONS){i=u.anEdge;do{this.elements[h++]=this.getNeighbourFace_(i),i=i.Lnext}while(i!==u.anEdge);for(var f=a;f<r;++f)this.elements[h++]=-1}}},e.prototype.outputContours_=function(e,t){var r,n,i=0,a=0;this.vertexCount=0,this.elementCount=0;for(var o=e.fHead.next;o!==e.fHead;o=o.next)if(o.inside){n=r=o.anEdge;do{this.vertexCount++,r=r.Lnext}while(r!==n);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*t,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var s=0,l=0,u=0;i=0;for(o=e.fHead.next;o!==e.fHead;o=o.next)if(o.inside){a=0,n=r=o.anEdge;do{this.vertices[s++]=r.Org.coords[0],this.vertices[s++]=r.Org.coords[1],t>2&&(this.vertices[s++]=r.Org.coords[2]),this.vertexIndices[l++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,a++,r=r.Lnext}while(r!==n);this.elements[u++]=i,this.elements[u++]=a,i+=a}},e.prototype.addContour=function(e,t){null===this.mesh&&(this.mesh=new $s),e<2&&(e=2),e>3&&(e=3);for(var r=null,n=0;n<t.length;n+=e)null===r?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=t[n+0],r.Org.coords[1]=t[n+1],r.Org.coords[2]=e>2?t[n+2]:0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},e.prototype.tesselate=function(e,t,r,n,i,a){if(void 0===e&&(e=Es.ODD),void 0===t&&(t=Ps.POLYGONS),void 0===a&&(a=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,i&&(this.normal[0]=i[0],this.normal[1]=i[1],this.normal[2]=i[2]),this.windingRule=e,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),ol.computeInterior(this,a);var o=this.mesh;return t===Ps.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),a&&o.check(),t===Ps.BOUNDARY_CONTOURS?this.outputContours_(o,n):this.outputPolymesh_(o,t,r,n),!0},e}();function ll(e){var t=e.windingRule,r=void 0===t?Es.ODD:t,n=e.elementType,i=void 0===n?Ps.POLYGONS:n,a=e.polySize,o=void 0===a?3:a,s=e.vertexSize,l=void 0===s?2:s,u=e.normal,c=void 0===u?[0,0,1]:u,h=e.contours,d=void 0===h?[]:h,f=e.strict,v=void 0===f||f,p=e.debug,m=void 0!==p&&p;if(!d&&v)throw new Error("Contours can't be empty");if(d){var g=new sl;e.edgeCreateCallback&&(g.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(g.vertexIdCallback=e.vertexIdCallback);for(var y=0;y<d.length;y++)g.addContour(l||2,d[y]);return g.tesselate(r,i,o,l,c,v),{vertices:g.vertices,vertexIndices:g.vertexIndices,vertexCount:g.vertexCount,elements:g.elements,elementCount:g.elementCount,mesh:m?g.mesh:void 0}}}Es.ODD,Es.NONZERO,Es.POSITIVE,Es.NEGATIVE,Es.ABS_GEQ_TWO,Ps.POLYGONS,Ps.CONNECTED_POLYGONS,Ps.BOUNDARY_CONTOURS;var ul=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n,i,a,o,s,l,u,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,g.Z)(this,r),(u=t.call(this)).type="ShapeGeometry",u.windingRule=Es.ODD,u.elementType=Ps.POLYGONS,u.polySize=3,u.vertexSize=2,u.strict=!0,u._shape=e,u._curveSegments=h,u._triangulationOptions=Object.assign({windingRule:Es.ODD,elementType:Ps.POLYGONS,polySize:3,vertexSize:2,strict:!0},d);for(var f,v,p,m=u._shape.extractShapePointsToFlatArray([],u._curveSegments),y=u._shape.shapeHoles.map((function(e){return e.extractShapePointsToFlatArray([],u._curveSegments)})),x=!0,b=!0,S=0,k=m.length/2;S<k;S++){var _=2*S,C=m[_+0],O=m[_+1];if(void 0!==v&&C!==v&&(x=!1),void 0!==p&&O!==p&&(b=!1),v=C,p=O,!x&&!b)break}!x&&!b&&(f=ll({contours:[m].concat((0,c.Z)(y)),windingRule:u._triangulationOptions.windingRule,elementType:u._triangulationOptions.elementType,polySize:u._triangulationOptions.polySize,vertexSize:u._triangulationOptions.vertexSize,strict:u._triangulationOptions.strict}));var Z=null!==(n=null===(i=f)||void 0===i?void 0:i.vertexCount)&&void 0!==n?n:1,L=null!==(a=null===(o=f)||void 0===o?void 0:o.elementCount)&&void 0!==a?a:1;if(u._positionAttribute=new w.BufferAttribute(new Float32Array(3*Z),3),u._normalAttribute=new w.BufferAttribute(new Float32Array(3*Z),3),u._uvAttribute=new w.BufferAttribute(new Float32Array(2*Z),2),u._indexAttribute=new w.BufferAttribute(new Uint32Array(3*L),1),f){for(var A=1/0,M=-1/0,D=1/0,T=-1/0,z=0,E=Z;z<E;z++){var P=2*z,N=f.vertices[P+0],B=f.vertices[P+1];N<A&&(A=N),N>M&&(M=N),B<D&&(D=B),B>T&&(T=B)}for(var U=M-A,I=T-D,V=0,F=Z;V<F;V++){var j=2*V,R=f.vertices[j+0],G=f.vertices[j+1],H=(R-A)/U,W=(G-D)/I;u._positionAttribute.setXYZ(V,R,G,0),u._normalAttribute.setXYZ(V,0,0,1),u._uvAttribute.setXY(V,H,W)}for(var q=0,J=L;q<J;q++){var Y=3*q,X=f.elements[Y+0],K=f.elements[Y+1],Q=f.elements[Y+2];u._indexAttribute.setX(Y+0,X),u._indexAttribute.setX(Y+1,K),u._indexAttribute.setX(Y+2,Q)}}return u.setAttribute("position",u._positionAttribute),u.setAttribute("normal",u._normalAttribute),u.setAttribute("uv",u._uvAttribute),u.setIndex(u._indexAttribute),u.setDrawRange(0,3*(null!==(s=null===(l=f)||void 0===l?void 0:l.elementCount)&&void 0!==s?s:1)),u}return(0,y.Z)(r,[{key:"clone",value:function(){var e=new r(this._shape,this._curveSegments);return e.userData=Hn(this.userData),e}}]),r}(w.BufferGeometry),cl=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,g.Z)(this,e),this.capacity=t,this.size=0,this.debug=r,this.debug&&console.log("allocating with cap ".concat(t));var n=t*e.eSize;this.buffer=new ArrayBuffer(n);var i=Float32Array.BYTES_PER_ELEMENT,a=0;this.positions=new Float32Array(this.buffer,a*i,3*t),a+=3*t,this.normals=new Float32Array(this.buffer,a*i,3*t),a+=3*t,this.uvs=new Float32Array(this.buffer,a*i,2*t)}return(0,y.Z)(e,[{key:"realloc",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t<this.size)throw Error("cannot shrink buffer");if(!(t<=this.capacity)||r){this.debug&&console.log("resizing from ".concat(this.capacity," \u2192 ").concat(t));var n=t*e.eSize,i=new ArrayBuffer(n),a=Float32Array.BYTES_PER_ELEMENT,o=0,s=new Float32Array(i,o*a,3*t);o+=3*t;var l=new Float32Array(i,o*a,3*t);o+=3*t;var u=new Float32Array(i,o*a,2*t);s.set(this.positions.slice(0,3*this.size)),l.set(this.normals.slice(0,3*this.size)),u.set(this.uvs.slice(0,2*this.size)),this.buffer=i,this.positions=s,this.normals=l,this.uvs=u,this.capacity=t}}},{key:"get",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.size+e;if(t>this.capacity){for(var r=this.capacity;t>r;)r*=2;this.realloc(r)}var n=this.size;return this.size=t,n}},{key:"reserve",value:function(e){var t=this.size+e;t>this.capacity&&this.realloc(t)}},{key:"shrink",value:function(){this.debug&&console.log("shrinking ".concat(this.capacity," \u2192 ").concat(this.size)),this.realloc(this.size,!0)}}]),e}(),hl=cl;hl.eSize=8*Float32Array.BYTES_PER_ELEMENT;var dl=function(e,t){return function(r){var n=(0,u.Z)(r,2),i=n[0],a=n[1];return a<i&&(a+=t),(e>=i?e:e+t)<=a}},fl=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3;(0,g.Z)(this,r),(i=t.call(this)).type="ShapeGeometry",i.vertexCache={},i._shape=e,i._depth=n,i._bevel=a,i._curveSegments=o,i._bevelSegmentsInput=s,a<=0?(i._bevelSize=0,i._bevelSegments=0):(i._bevelSize=Math.min(a,n/2-1e-12),i._bevelSegments=Math.floor(s));var l=i._shape.extractShapePointsToFlatArray([],o),d=i._shape.shapeHoles.map((function(e){for(var t=e.extractShapePointsToFlatArray([],o),r=[],n=t.length-1;n>=1;n-=2){var i=t[n-1],a=t[n-0];r.push(i,a)}return r})),f=ll({windingRule:Es.ODD,elementType:Ps.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[l]}),v=ll({windingRule:Es.ODD,elementType:Ps.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:(0,c.Z)(d)});if(!f)throw new Error("error generating geometry");var p=f.elementCount;if(v){f.elementCount+=v.elementCount;for(var m=0;m<v.elements.length;m++){var y=v.elements[m],x=m%2===0?f.vertexCount:0;f.elements.push(y+x)}for(var b=0;b<v.vertexIndices.length;b++){var S=v.vertexIndices[b],k=f.vertexCount;f.vertexIndices.push(S+k)}for(var _=0;_<v.vertices.length;_++){var C=v.vertices[_];f.vertices.push(C)}}for(var O=1/0,Z=-1/0,L=1/0,A=-1/0,M=0,D=f.vertexCount;M<D;M++){var T=2*M,z=f.vertices[T+0],E=f.vertices[T+1];z<O&&(O=z),z>Z&&(Z=z),E<L&&(L=E),E>A&&(A=E)}i._minX=O,i._minY=L,i._width=Z-O,i._height=A-L;var P=2*f.vertexCount*(2+i._bevelSegments);i._buffer=new hl(P);for(var N=[],B=[],U=f.elementCount-1;U>=0;U--){var I=U>=p,V=2*U,F=f.elements[V+0],j=f.elements[V+1],R=F+j,G={start:F,count:j,normals:[],continuous:[],concave:[]},H=F,W=R-1,q=F+1,J=i._shape.roundedCurves.length;do{var Y,X=H-F,K=f.vertices[2*W+0],Q=f.vertices[2*W+1],$=f.vertices[2*H+0],ee=f.vertices[2*H+1],te=f.vertices[2*q+0],re=f.vertices[2*q+1],ne=$-K,ie=ee-Q,ae=Math.sqrt(ne*ne+ie*ie);ne/=ae,ie/=ae;var oe=$-te,se=ee-re,le=Math.sqrt(oe*oe+se*se);oe/=le,se/=le,G.normals[2*X+0]=-se,G.normals[2*X+1]=oe,G.concave[X]=ne*se-ie*oe>0;var ue=f.vertexIndices[H];if(Array.isArray(ue))G.continuous[X]=!1;else{var ce=i._shape.getCurveIndexFromVertexId(ue-1,!0),he=(0,u.Z)(ce,2),de=he[0],fe=he[1];if(fe>0&&fe<1)G.continuous[X]=!0;else{var ve=1===fe?de+1:de-1;ve=(ve+J)%J;var pe=1===fe?0:1,me=i._shape.roundedCurves[de].getTangent(fe),ge=i._shape.roundedCurves[ve].getTangent(pe);G.continuous[X]=me.dot(ge)>.95}}I&&(G.normals[2*X+0]*=-1,G.normals[2*X+1]*=-1),W=(Y=[H,q,q+1])[0],H=Y[1],(q=Y[2])>=R&&(q-=j)}while(q!==F+1);var ye=[];ye.push({bevelI:0,angle:0,size:0,boundary:{vertices:f.vertices.slice(2*F,2*R),vertexCount:j,vertexIndices:new Array(j).fill(!0).map((function(e,t){return[t,t]})),elements:[0,j],elementCount:1,mesh:null},reverseMap:[],insetPoints:f.vertices.slice(2*F,2*R)});for(var xe=function(e){for(var t=e/i._bevelSegments*Math.PI/2,r=(1-Math.cos(t))*i._bevelSize,n=[],a=[],s=[],l=[],c=0,h=0;h<j;h++){var d=2*h,v=(h-1+j)%j*2,p=f.vertices[2*G.start+d+0],m=f.vertices[2*G.start+d+1],g=-G.normals[v+0]*r,y=-G.normals[v+1]*r,x=-G.normals[d+0]*r,b=-G.normals[d+1]*r;if(G.concave[h]||!G.concave[h]&&I){var w=Math.atan2(y,g),S=Math.atan2(b,x);S>w&&(S-=2*Math.PI);var k=S-w;if(G.continuous[h]||I){var _=w+k/2,C=Math.cos(_)*r,O=Math.sin(_)*r;n[2*c+0]=p+C*(I?-1:1),n[2*c+1]=m+O*(I?-1:1),l[c]=h,c++}else for(var Z=Math.max(1,Math.floor(o/4*Math.abs(k)/Math.PI)),L=0;L<=Z;L++){var A=w+k*(L/Z),M=Math.cos(A)*r,D=Math.sin(A)*r;n[2*c+0]=p+M,n[2*c+1]=m+D,l[c]=h,c++}}else n[2*c+0]=p+g,n[2*c+1]=m+y,l[c]=h,a[h]=c,n[2*++c+0]=p,n[2*c+1]=m,l[c]=h,n[2*++c+0]=p+x,n[2*c+1]=m+b,l[c]=h,s[h]=c,c++}var T=ll({windingRule:Es.POSITIVE,elementType:Ps.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[n],edgeCreateCallback:function(e){var t=e.Org.idx,r=l[t],n=l[(t+1)%l.length];e.idx=[r,n],e.Sym.idx=[n,r]},vertexIdCallback:function(e){var t=e.Lprev.idx;return[t?t[1]:0,e.idx[0]]}});if(!T)throw console.log("Error"),new Error("error generating bevel geometry for ".concat(e,"'th loop"));if(!T.vertexCount)return"break";for(var z=0;z<T.vertexIndices.length;z++){var E=(0,u.Z)(T.vertexIndices[z],2),P=E[0],N=E[1];if(P!==N){var B=N;N<P&&(B+=j);for(var U=P;U<B;U++){var V=U%j,F=(U+1)%j;if(!G.continuous[V]||!G.continuous[F]){T.vertexIndices[z]=[P,V],T.vertexIndices.splice(z+1,0,[F,N]),T.vertices.splice(2*(z+1),0,T.vertices[2*z],T.vertices[2*z+1]);break}}}}ye.push({bevelI:e,angle:t,size:r,boundary:T,reverseMap:l,insetPoints:n})},be=1;be<=i._bevelSegments;be++){var we=xe(be);if("break"===we)break}for(var Se=function(e,t,r){for(var n=0,i=e.boundary.vertexIndices.length;n<i&&r(e.boundary.vertexIndices[t]);)t=(t+1)%i,n++;return n},ke=N.length,_e=1;_e<ye.length;_e++){var Ce=ye[_e-1],Oe=ye[_e],Ze=Ce.boundary.vertexIndices.length,Le=Oe.boundary.vertexIndices.length;if(!Ze||!Le)break;for(var Ae=G.concave.length,Me=0,De=dl(Me,j);!Ce.boundary.vertexIndices.filter(De).length||!Oe.boundary.vertexIndices.filter(De).length;)Me++,De=dl(Me,j);var Te=Ce.boundary.vertexIndices.findIndex(De),ze=Oe.boundary.vertexIndices.findIndex(De);do{Te=(Te+1)%Ze}while(De(Ce.boundary.vertexIndices[Te]));do{ze=(ze+1)%Le}while(De(Oe.boundary.vertexIndices[ze]));var Ee=Me=(Me+1)%j,Pe=i.buildBevelVert(G,Ce,(Te-1+Ze)%Ze),Ne=i.buildBevelVert(G,Oe,(ze-1+Le)%Le),Be=Pe,Ue=Ne,Ie=void 0,Ve=void 0,Fe=!1;do{var je=Se(Ce,Te,De=dl(Me,j)),Re=Se(Oe,ze,De),Ge=Fe;if(Fe=!1,je&&!Re){for(var He=0;He<je;He++)Ie=i.buildBevelVert(G,Ce,(Te+He)%Ze,He/(je-1)),N.push(Be.topN,Ie.topP,Ue.topN),N.push(Ie.bottomP,Be.bottomN,Ue.bottomN),Be=Ie;Fe=!0}else if(!je&&Re)for(var We=0;We<Re;We++)Ve=i.buildBevelVert(G,Oe,(ze+We)%Le,We/(Re-1)),N.push(Ue.topN,Be.topP,Ve.topP),N.push(Be.bottomP,Ue.bottomN,Ve.bottomP),Ue=Ve;else if(je&&Re)if(Ie=i.buildBevelVert(G,Ce,Te,0),Ve=i.buildBevelVert(G,Oe,ze,0),Ge?(N.push(Be.topN,Ve.topP,Ue.topN),N.push(Be.topN,Ie.topP,Ve.topP),N.push(Ve.bottomP,Be.bottomN,Ue.bottomN),N.push(Ve.bottomP,Ie.bottomP,Be.bottomN)):(N.push(Ue.topN,Be.topN,Ie.topP),N.push(Ue.topN,Ie.topP,Ve.topP),N.push(Ie.bottomP,Be.bottomN,Ue.bottomN),N.push(Ie.bottomP,Ue.bottomN,Ve.bottomP)),Be=Ie,Ue=Ve,je===Re)for(var qe=1;qe<je;qe++)Ie=i.buildBevelVert(G,Ce,(Te+qe)%Ze,qe/(je-1)),Ve=i.buildBevelVert(G,Oe,(ze+qe)%Le,qe/(Re-1)),N.push(Be.topN,Ie.topP,Ue.topN),N.push(Ue.topN,Ie.topP,Ve.topP),N.push(Ie.bottomP,Be.bottomN,Ue.bottomN),N.push(Ie.bottomP,Ue.bottomN,Ve.bottomP),Be=Ie,Ue=Ve;else if(je>Re)for(var Je=je/Re,Ye=0,Xe=1;Xe<je;Xe++)Ie=i.buildBevelVert(G,Ce,(Te+Xe)%Ze,Xe/(je-1)),N.push(Be.topN,Ie.topP,Ue.topN),N.push(Ie.bottomP,Be.bottomN,Ue.bottomN),Be=Ie,Xe>(Ye+1)*Je&&(Ye++,Ve=i.buildBevelVert(G,Oe,(ze+Ye)%Le,Ye/(Re-1)),N.push(Ue.topN,Ie.topP,Ve.topP),N.push(Ie.bottomP,Ue.bottomN,Ve.bottomP),Ue=Ve);else for(var Ke=Re/je,Qe=0,$e=1;$e<Re;$e++)Ve=i.buildBevelVert(G,Oe,(ze+$e)%Le,$e/(Re-1)),N.push(Ue.topN,Ie.topP,Ve.topP),N.push(Ie.bottomP,Ue.bottomN,Ve.bottomP),Ue=Ve,$e>(Qe+1)*Ke&&(Qe++,Ie=i.buildBevelVert(G,Ce,(Te+Qe)%Ze,Qe/(je-1)),N.push(Be.topN,Ie.topP,Ue.topN),N.push(Ie.bottomP,Be.bottomN,Ue.bottomN),Be=Ie);Te=(Te+je)%Ze,ze=(ze+Re)%Le,Me=(Me+1)%Ae}while(Me!==Ee)}for(var et=ye[0],tt=0,rt=et.boundary.vertexCount;tt<rt;tt++){var nt=i.buildBevelVert(G,et,tt),it=i.buildBevelVert(G,et,(tt+1)%rt);N.push(it.topP,nt.topN,nt.bottomN),N.push(it.topP,nt.bottomN,it.bottomP)}if(I){for(var at=[],ot=N.length-1;ot>=ke+2;ot-=3){var st=N[ot-2],lt=N[ot-1],ut=N[ot-0];at.push(ut,lt,st)}N.splice.apply(N,[ke,N.length-ke].concat(at))}if(I){for(var ct=[],ht=ye[ye.length-1].boundary.vertices.length-1;ht>=1;ht-=2){var dt=ye[ye.length-1].boundary.vertices[ht-1],ft=ye[ye.length-1].boundary.vertices[ht-0];ct.push(dt,ft)}B.push(ct)}if(!I){var vt=ye[ye.length-1],pt=ll({windingRule:ye.length>1?Es.POSITIVE:Es.ODD,elementType:Ps.POLYGONS,vertexSize:2,strict:!0,contours:[vt.insetPoints].concat(B)});if(!pt)throw new Error("Error generating geometry for surface");Object.assign((0,h.Z)(i),{capStartIndex:N.length});for(var mt=0;mt<3*pt.elementCount;mt+=3){var gt=i.buildSurfaceVert(pt,pt.elements[mt+0]),yt=i.buildSurfaceVert(pt,pt.elements[mt+1]),xt=i.buildSurfaceVert(pt,pt.elements[mt+2]);N.push(gt.top,yt.top,xt.top),N.push(xt.bottom,yt.bottom,gt.bottom)}}i.vertexCache={}}i._buffer.shrink();var bt=new w.BufferAttribute(Uint32Array.from(N),1),wt=new w.BufferAttribute(i._buffer.positions,3),St=new w.BufferAttribute(i._buffer.normals,3),kt=new w.BufferAttribute(i._buffer.uvs,2);return wt.needsUpdate=!0,St.needsUpdate=!0,kt.needsUpdate=!0,bt.needsUpdate=!0,i.setAttribute("position",wt),i.setAttribute("normal",St),i.setAttribute("uv",kt),i.setIndex(bt),i}return(0,y.Z)(r,[{key:"buildSurfaceVert",value:function(e,t){var r=t.toString();if(r in this.vertexCache)return this.vertexCache[r];var n=e.vertices[2*t+0],i=e.vertices[2*t+1],a=(n-this._minX)/this._width,o=(i-this._minY)/this._height,s=this._buffer.get(2),l=3*s,u=2*s,c={top:s+0,bottom:s+1};return this._buffer.positions[l+0]=n,this._buffer.positions[l+1]=i,this._buffer.positions[l+2]=this._depth,this._buffer.normals[l+0]=0,this._buffer.normals[l+1]=0,this._buffer.normals[l+2]=1,this._buffer.uvs[u+0]=a,this._buffer.uvs[u+1]=o,this._buffer.positions[l+3]=n,this._buffer.positions[l+4]=i,this._buffer.positions[l+5]=0,this._buffer.normals[l+3]=0,this._buffer.normals[l+4]=0,this._buffer.normals[l+5]=-1,this._buffer.uvs[u+2]=a,this._buffer.uvs[u+3]=o,this.vertexCache[r]=c,c}},{key:"buildBevelVert",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i="".concat(t.bevelI,":").concat(r);if(i in this.vertexCache)return this.vertexCache[i];var a,o,s,l,c=(0,u.Z)(t.boundary.vertexIndices[r],2),h=c[0],d=c[1];h!==d?(o=h,a=d,l=!1,s=e.continuous[o]&&e.continuous[a]):(o=((a=h)-1+e.count)%e.count,l=e.concave[a]&&t.bevelI>0,s=e.continuous[a]||l);var f=Math.cos(t.angle),v=Math.sin(t.angle),p=2*r,m=2*a,g=2*o,y=t.boundary.vertices[p+0],x=t.boundary.vertices[p+1],b=(1-v)*this._bevelSize,w=(y-this._minX)/this._width,S=(x-this._minY)/this._height,k=e.normals[m+0],_=e.normals[m+1],C=e.normals[g+0],O=e.normals[g+1];if(l){var Z=C-k,L=O-_;k+=Z*(1-n),_+=L*(1-n);var A=Math.sqrt(k*k+_*_);k/=A,_/=A}var M=this._buffer.get(s?2:4),D=3*M,T=2*M,z={i:r,fi:a,topP:M+0,topN:M+0,bottomP:M+1,bottomN:M+1};return this._buffer.positions[D+0]=y,this._buffer.positions[D+1]=x,this._buffer.positions[D+2]=this._depth-b,this._buffer.normals[D+0]=k*f,this._buffer.normals[D+1]=_*f,this._buffer.normals[D+2]=v,this._buffer.uvs[T+0]=w,this._buffer.uvs[T+1]=S,this._buffer.positions[D+3]=y,this._buffer.positions[D+4]=x,this._buffer.positions[D+5]=b,this._buffer.normals[D+3]=k*f,this._buffer.normals[D+4]=_*f,this._buffer.normals[D+5]=-v,this._buffer.uvs[T+2]=S,this._buffer.uvs[T+3]=w,s||(M+=2,D+=6,T+=4,z.topP=M+0,z.bottomP=M+1,this._buffer.positions[D+0]=y,this._buffer.positions[D+1]=x,this._buffer.positions[D+2]=this._depth-b,this._buffer.normals[D+0]=C*f,this._buffer.normals[D+1]=O*f,this._buffer.normals[D+2]=v,this._buffer.uvs[T+0]=w,this._buffer.uvs[T+1]=S,this._buffer.positions[D+3]=y,this._buffer.positions[D+4]=x,this._buffer.positions[D+5]=b,this._buffer.normals[D+3]=C*f,this._buffer.normals[D+4]=O*f,this._buffer.normals[D+5]=-v,this._buffer.uvs[T+2]=S,this._buffer.uvs[T+3]=w),this.vertexCache[i]=z,z}},{key:"clone",value:function(){var e=new r(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=Hn(this.userData),e}}]),r}(w.BufferGeometry),vl=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a,o,s,l,u,c,h=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),d=Math.abs(h.width),f=Math.abs(null!==(n=h.height)&&void 0!==n?n:h.width),v=Math.abs(null!==(i=h.depth)&&void 0!==i?i:0),p=null!==(a=e.shape)&&void 0!==a?a:null===t||void 0===t?void 0:t.shape,m=null!==(o=null===(s=p)||void 0===s?void 0:s.roundness)&&void 0!==o?o:h.roundness;void 0!==p&&(p instanceof js?(p.width!==d||p.height!==f)&&p.applySize(d,f):p=new js(d,f).fromJSON(p),void 0!==(null===(l=e.parameters)||void 0===l?void 0:l.roundness)&&(null===(u=e.parameters)||void 0===u?void 0:u.roundness)>0&&p.update(!1));var g=null!==(c=p)&&void 0!==c?c:new js(d,f);return{parameters:Object.assign(h,{width:d,height:f,depth:v,roundness:m}),shape:g}}},{key:"build",value:function(e){var t,r=e.parameters,n=r.depth,i=r.extrudeBevelSize,a=r.extrudeBevelSegments,o=r.subdivisions,s=r.roundness;return e.shape.roundness=s,t=n<=0?new ul(e.shape,o):new fl(e.shape,n,i,o,a),Object.assign(t,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"VectorGeometry"})})}}]),e}(),pl=2*Math.PI,ml=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof js?e.shape:new js,parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:0)})}}},{key:"build",value:function(e){var t=e.parameters,r=t.width,n=t.height,i=t.spikes,a=t.angle,o=t.innerRadius,s=t.depth,l=t.extrudeBevelSize,u=t.extrudeBevelSegments,c=e.shape,h=function(e,t,r,n,i,a){if(n>=pl)return i>30||i%4===0?(function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=.5522847498,s=t*o,l=r*o;e.addPoint(xl(i-t,a,i-t,a-l,i-t,a+l)),e.addPoint(xl(i,a+r,i-s,a+r,i+s,a+r)),e.addPoint(xl(i+t,a,i+t,a+l,i+t,a-l)),e.addPoint(xl(i,a-r,i+s,a-r,i-s,a-r)),n>0&&wl(e,t,r,n)}(e,t,r,a),Math.round(i/4)):gl(e,n,i,t,r,a);var o={x:0,y:r},s=n+.5*Math.PI,l={x:Math.cos(s)*t,y:Math.sin(s)*r},u=qs({px:o.x,py:o.y,cx:l.x,cy:l.y,rx:t,ry:r,largeArcFlag:n>Math.PI,sweepFlag:!0});return i>30||i%u.length===0?function(e,t,r,n,i,a,o,s){var l=Math.round(i/n.length);e.addPoint(yl(t,r));for(var u=0,c=n.length;u<c;u++){var h=n[u],d=e.points[u],f=yl(h.x,h.y);d.controls[1].position.set(h.x1,h.y1),f.controls[0].position.set(h.x2,h.y2),e.addPoint(f)}return s>0?bl(e,a,o,s):e.addPoint(yl(0,0)),l}(e,o.x,o.y,u,i,t,r,a):gl(e,n,i,t,r,a)}(c,.5*r,.5*n,a*Math.PI/180,i,o);c.isClosed=!0,c.update();var d=vl.create({shape:c,parameters:{subdivisions:h,depth:s,extrudeBevelSize:l,extrudeBevelSegments:u}});return Object.assign(d,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"EllipseGeometry"})})}}]),e}();function gl(e,t,r,n,i,a){for(var o=-t/r,s=0;s<=r;s++){var l=o*s,u=Math.sin(l)*n,c=Math.cos(l)*i;e.addPoint(yl(u,c))}return t<pl?a>0?bl(e,n,i,a):e.addPoint(yl(0,0)):(e.removePoint(e.points[e.points.length-1]),a>0&&wl(e,n,i,a)),1}function yl(e,t){return new ss(w.MathUtils.generateUUID(),new w.Vector2(e,t))}function xl(e,t,r,n,i,a){var o=yl(e,t);return o.controls[0].position.set(r,n),o.controls[1].position.set(i,a),o}function bl(e,t,r,n){Sl(e,t,r,n).forEach((function(t){return e.addPoint(t)}))}function wl(e,t,r,n){var i=Sl(e,t,r,n),a=new js;i.forEach((function(e){return a.addPoint(e)})),a.isClosed=!0,e.shapeHoles.push(a)}function Sl(e,t,r,n){var i=n*t/100,a=i*(Math.abs(r)/Math.abs(t)),o=new w.Vector2(i/t,a/r),s=e.points.map((function(e){var t=e.clone();return t.uuid=w.MathUtils.generateUUID(),t})).reverse();return s.forEach((function(e){e.position.multiply(o);var t=e.controls[0].position.clone().multiply(o),r=e.controls[1].position.clone().multiply(o);e.controls[0].position.copy(r),e.controls[1].position.copy(t)})),s}var kl=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),o=Math.abs(a.width),s=Math.abs(null!==(n=a.height)&&void 0!==n?n:o),l=Math.abs(null!==(i=a.depth)&&void 0!==i?i:o),u=Math.abs(Math.min(o,l))/2;return{parameters:Object.assign(a,{width:o,height:s,depth:l,radius:u,segments:Math.round(a.segments),pathSegments:Math.round(a.pathSegments),cornerSegments:Math.round(a.cornerSegments)})}}},{key:"build",value:function(e){var t=e.parameters,r=t.width,n=t.height,i=t.depth,a=t.radius,o=t.revolutions,s=t.segments,l=t.pathRadius,u=t.pathType,c=t.pathSegments,h=t.cornerRadius,d=t.cornerSegments,f=new _l(!1,r,n,i,a,o,s,l,u,c,h,d);return Object.assign(f,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"HelixGeometry"})})}}]),e}(),_l=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:1;(0,g.Z)(this,r),e=t.call(this);var f=n&&1===o;f&&(d=0),h>100&&(h=100);var v,p,m,y,x,b,S,k,_=function(){return new w.Vector3},C=new w.Vector3,O=_(),Z=_(),L=_(),A=_(),M=_(),D=_(),T=_(),z=_(),E=_(),P=_(),N=_(),B=i-2*l+.001,U=B/o,I=Math.ceil(s*o),V=I+1,F=B/I,j=-B/2,R=c+1,G=2*Math.PI/c,H=Math.PI/2/d,W=.01,q=Math.min((1-h/100)*l,l-W),J=l-q,Y=0,X=2,K=d*X+X,Q=R*K/X,$=Q+R*V,ee=R*(V+K),te=[3,3,2].map((function(e){return Array(ee*e).fill(0)})),re=(0,u.Z)(te,3),ne=re[0],ie=re[1],ae=re[2],oe=[],se=a-l;function le(e,t){var r=Math.PI/2;b=t*F,k=2*Math.PI*(b%U)/U+r,b+=j,S=Math.sin(k)*se,x=Math.cos(k)*se,n?e.set(x,S,b):e.set(x,b,S)}le(C,-1e-10),le(O,0),A.copy(C),le(C,1);for(var ue=C.distanceTo(O),ce=J+q,he=ue*I+2*ce,de=q,fe=he-ce,ve=function(e){le(Z,e),N.subVectors(Z,A).normalize(),A.copy(Z),E.copy(Z).setComponent(+n+1,0).normalize(),P.crossVectors(N,E).normalize();for(var t=0===e,r=e===I,i=t?3*Math.PI/2:H,a=t?de:fe,o=t?R:$,s=t?0:ee-R,u=N.clone().multiplyScalar(t?-J:J).add(Z),h=N.clone().multiplyScalar(t?-1:1).normalize(),v=0;v<R;v++){var p=v*G;if(M.addVectors(C.copy(E).multiplyScalar(l*Math.cos(p)),O.copy(P).multiplyScalar(l*Math.sin(p))),D.copy(M).normalize(),t||r){f||(Y=s+v,[0,1,2].forEach((function(e){ne[3*Y+e]=u.getComponent(e),ie[3*Y+e]=h.getComponent(e)})),ae[2*Y]=+r,ae[2*Y+1]=v/c),O.copy(D).multiplyScalar(q),L.addVectors(Z,O);for(var m=0;m<d;m++){var g=m*H+i;T.addVectors(C.copy(N).multiplyScalar(J*Math.sin(g)),O.copy(D).multiplyScalar(J*Math.cos(g))),z.copy(T).normalize(),O.addVectors(L,T),T.normalize(),Y=o+m*R+v,[0,1,2].forEach((function(e){ne[3*Y+e]=O.getComponent(e),ie[3*Y+e]=z.getComponent(e)}));var y=+t+Math.sin(g);ae[2*Y]=(a+J*y)/he,ae[2*Y+1]=v/c}}O.addVectors(Z,M),Y=Q+e*R+v,[0,1,2].forEach((function(e){ne[3*Y+e]=O.getComponent(e),ie[3*Y+e]=D.getComponent(e)})),ae[2*Y]=(ce+e*ue)/he,ae[2*Y+1]=v/c}},pe=0;pe<=I;pe++)ve(pe);var me=V+2*d+X,ge=1,ye=f?[ge,ge+V-1]:[0,me-1],xe=(0,u.Z)(ye,2),be=xe[0],we=xe[1];for(pe=be;pe<=we-1;pe++)for(var Se=f&&pe===we-1,ke=0;ke<R-1;ke++)p=(v=pe*R+ke)+1,m=(Se?ke:v)+R,y=(Se?ke+1:p)+R,0===pe?oe.push(p,y,m):pe===me-2?oe.push(v,p,m):oe.push(v,p,m,p,y,m);return e.setIndex(oe),e.setAttribute("position",new w.Float32BufferAttribute(ne,3)),e.setAttribute("normal",new w.Float32BufferAttribute(ie,3)),e.setAttribute("uv",new w.Float32BufferAttribute(ae,2)),e}return(0,y.Z)(r)}(w.BufferGeometry),Cl=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:a.width)})}}},{key:"build",value:function(e){var t=e.parameters,r=t.width,n=t.height,i=t.depth,a=t.detail,o=t.corner,s=t.cornerSides,l=0===a&&0!==o?new Ol(.5*r,o,s):new w.IcosahedronBufferGeometry(.5*r,a);return l.scale(1,n/r,i/r),Object.assign(l,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"IcosahedronGeometry"})})}}]),e}(),Ol=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;(0,g.Z)(this,r);var o=(1+Math.sqrt(5))/2,s=[-1,o,0,1,o,0,-1,-o,0,1,-o,0,0,-1,o,0,1,o,0,-1,-o,0,1,-o,o,0,-1,o,0,1,-o,0,-1,-o,0,1],l=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],u="IcosahedronGeometry";return(e=t.call(this,s,l,u,n,i,a)).type=u,e}return(0,y.Z)(r,null,[{key:"fromJSON",value:function(e){return new r(e.radius,e.corner,e.cornerSides)}}]),r}(ts),Zl=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a,o;(null!==(r=null===(n=e.parameters)||void 0===n?void 0:n.points)&&void 0!==r?r:[]).forEach((function(e){Array.isArray(e)&&(e.x=e[0],e.y=e[1])}));var s=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(a=s.height)&&void 0!==a?a:s.width),depth:Math.abs(null!==(o=s.depth)&&void 0!==o?o:s.width)})}}},{key:"build",value:function(e){var t=e.parameters,r=t.points,n=t.segments,i=t.verticalSegments,a=new w.Shape;a.moveTo(r[0].x,r[0].y),a.bezierCurveTo(r[1].x,r[1].y,r[2].x,r[2].y,r[3].x,r[3].y);var o=new w.LatheBufferGeometry(a.extractPoints(i).shape,n);return o.rotateZ(Math.PI),Object.assign(o,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"LatheGeometry"})})}}]),e}(),Ll=new w.Matrix4,Al=new w.Object3D,Ml=new w.Vector3,Dl=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;return(0,g.Z)(this,r),(e=t.call(this)).uuid=w.MathUtils.generateUUID(),e.name="",e.type="Geometry",e.vertices=[],e.colors=[],e.faces=[],e.faceVertexUvs=[[]],e.morphTargets=[],e.morphNormals=[],e.skinWeights=[],e.skinIndices=[],e.lineDistances=[],e.boundingBox=null,e.boundingSphere=null,e.elementsNeedUpdate=!1,e.verticesNeedUpdate=!1,e.uvsNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.lineDistancesNeedUpdate=!1,e.groupsNeedUpdate=!1,e}return(0,y.Z)(r,[{key:"applyMatrix4",value:function(e){for(var t=(new w.Matrix3).getNormalMatrix(e),r=0,n=this.vertices.length;r<n;r++)this.vertices[r].applyMatrix4(e);for(var i=0,a=this.faces.length;i<a;i++){var o=this.faces[i];o.normal.applyMatrix3(t).normalize();for(var s=0,l=o.vertexNormals.length;s<l;s++)o.vertexNormals[s].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}},{key:"rotateX",value:function(e){return Ll.makeRotationX(e),this.applyMatrix4(Ll),this}},{key:"rotateY",value:function(e){return Ll.makeRotationY(e),this.applyMatrix4(Ll),this}},{key:"rotateZ",value:function(e){return Ll.makeRotationZ(e),this.applyMatrix4(Ll),this}},{key:"translate",value:function(e,t,r){return Ll.makeTranslation(e,t,r),this.applyMatrix4(Ll),this}},{key:"scale",value:function(e,t,r){return Ll.makeScale(e,t,r),this.applyMatrix4(Ll),this}},{key:"lookAt",value:function(e){return Al.lookAt(e),Al.updateMatrix(),this.applyMatrix4(Al.matrix),this}},{key:"fromBufferGeometry",value:function(e){var t=this,r=null!==e.index?e.index:void 0,n=e.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var i=n.position,a=n.normal,o=n.color,s=n.uv,l=n.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var u=0;u<i.count;u++)t.vertices.push((new w.Vector3).fromBufferAttribute(i,u)),void 0!==o&&t.colors.push((new w.Color).fromBufferAttribute(o,u));function c(e,r,n,i){var u=void 0===o?[]:[t.colors[e].clone(),t.colors[r].clone(),t.colors[n].clone()],c=void 0===a?[]:[(new w.Vector3).fromBufferAttribute(a,e),(new w.Vector3).fromBufferAttribute(a,r),(new w.Vector3).fromBufferAttribute(a,n)],h=new zl(e,r,n,c,u,i);t.faces.push(h),void 0!==s&&t.faceVertexUvs[0].push([(new w.Vector2).fromBufferAttribute(s,e),(new w.Vector2).fromBufferAttribute(s,r),(new w.Vector2).fromBufferAttribute(s,n)]),void 0!==l&&t.faceVertexUvs[1].push([(new w.Vector2).fromBufferAttribute(l,e),(new w.Vector2).fromBufferAttribute(l,r),(new w.Vector2).fromBufferAttribute(l,n)])}var h=e.groups;if(h.length>0)for(var d=0;d<h.length;d++)for(var f=h[d],v=f.start,p=v,m=v+f.count;p<m;p+=3)void 0!==r?c(r.getX(p),r.getX(p+1),r.getX(p+2),f.materialIndex):c(p,p+1,p+2,f.materialIndex);else if(void 0!==r)for(var g=0;g<r.count;g+=3)c(r.getX(g),r.getX(g+1),r.getX(g+2));else for(var y=0;y<i.count;y+=3)c(y,y+1,y+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ml).negate(),this.translate(Ml.x,Ml.y,Ml.z),this}},{key:"normalize",value:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,n=new w.Matrix4;return n.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix4(n),this}},{key:"computeFaceNormals",value:function(){for(var e=new w.Vector3,t=new w.Vector3,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],a=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),i.normal.copy(e)}}},{key:"computeVertexNormals",value:function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=new Array(this.vertices.length),r=0,n=this.vertices.length;r<n;r++)t[r]=new w.Vector3;if(e)for(var i=new w.Vector3,a=new w.Vector3,o=0,s=this.faces.length;o<s;o++){var l=this.faces[o],u=this.vertices[l.a],c=this.vertices[l.b],h=this.vertices[l.c];i.subVectors(h,c),a.subVectors(u,c),i.cross(a),t[l.a].add(i),t[l.b].add(i),t[l.c].add(i)}else{this.computeFaceNormals();for(var d=0,f=this.faces.length;d<f;d++){var v=this.faces[d];t[v.a].add(v.normal),t[v.b].add(v.normal),t[v.c].add(v.normal)}}for(var p=0,m=this.vertices.length;p<m;p++)t[p].normalize();for(var g=0,y=this.faces.length;g<y;g++){var x=this.faces[g],b=x.vertexNormals;3===b.length?(b[0].copy(t[x.a]),b[1].copy(t[x.b]),b[2].copy(t[x.c])):(b[0]=t[x.a].clone(),b[1]=t[x.b].clone(),b[2]=t[x.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}},{key:"computeFlatVertexNormals",value:function(){this.computeFaceNormals();for(var e=0,t=this.faces.length;e<t;e++){var r=this.faces[e],n=r.vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}},{key:"computeMorphNormals",value:function(){for(var e=0,t=this.faces.length;e<t;e++){var n=this.faces[e];n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]);for(var i=0,a=n.vertexNormals.length;i<a;i++)n.__originalVertexNormals[i]?n.__originalVertexNormals[i].copy(n.vertexNormals[i]):n.__originalVertexNormals[i]=n.vertexNormals[i].clone()}var o=new r;o.faces=this.faces;for(var s=0,l=this.morphTargets.length;s<l;s++){if(!this.morphNormals[s]){this.morphNormals[s]={},this.morphNormals[s].faceNormals=[],this.morphNormals[s].vertexNormals=[];for(var u=this.morphNormals[s].faceNormals,c=this.morphNormals[s].vertexNormals,h=0,d=this.faces.length;h<d;h++){var f=new w.Vector3,v={a:new w.Vector3,b:new w.Vector3,c:new w.Vector3};u.push(f),c.push(v)}}var p=this.morphNormals[s];o.vertices=this.morphTargets[s].vertices,o.computeFaceNormals(),o.computeVertexNormals();for(var m=0,g=this.faces.length;m<g;m++){var y=this.faces[m],x=p.faceNormals[m],b=p.vertexNormals[m];x.copy(y.normal),b.a.copy(y.vertexNormals[0]),b.b.copy(y.vertexNormals[1]),b.c.copy(y.vertexNormals[2])}}for(var S=0,k=this.faces.length;S<k;S++){var _=this.faces[S];_.normal=_.__originalFaceNormal,_.vertexNormals=_.__originalVertexNormals}}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new w.Box3),this.boundingBox.setFromPoints(this.vertices)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new w.Sphere),this.boundingSphere.setFromPoints(this.vertices)}},{key:"merge",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e&&e.isGeometry){var n,i=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,l=e.faces,u=this.colors,c=e.colors;void 0!==t&&(n=(new w.Matrix3).getNormalMatrix(t));for(var h=0,d=o.length;h<d;h++){var f=o[h].clone();void 0!==t&&f.applyMatrix4(t),a.push(f)}for(var v=0,p=c.length;v<p;v++)u.push(c[v].clone());for(var m=0,g=l.length;m<g;m++){var y=l[m],x=void 0,b=void 0,S=y.vertexNormals,k=y.vertexColors,_=new zl(y.a+i,y.b+i,y.c+i);_.normal.copy(y.normal),void 0!==n&&_.normal.applyMatrix3(n).normalize();for(var C=0,O=S.length;C<O;C++)x=S[C].clone(),void 0!==n&&x.applyMatrix3(n).normalize(),_.vertexNormals.push(x);_.color.copy(y.color);for(var Z=0,L=k.length;Z<L;Z++)b=k[Z],_.vertexColors.push(b.clone());_.materialIndex=y.materialIndex+r,s.push(_)}for(var A=0,M=e.faceVertexUvs.length;A<M;A++){var D=e.faceVertexUvs[A];void 0===this.faceVertexUvs[A]&&(this.faceVertexUvs[A]=[]);for(var T=0,z=D.length;T<z;T++){for(var E=D[T],P=[],N=0,B=E.length;N<B;N++)P.push(E[N].clone());this.faceVertexUvs[A].push(P)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)}},{key:"mergeMesh",value:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)}},{key:"mergeVertices",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t={},r=[],n=[],i=Math.pow(10,e),a=0,o=this.vertices.length;a<o;a++){var s=this.vertices[a],l=Math.round(s.x*i)+"_"+Math.round(s.y*i)+"_"+Math.round(s.z*i);void 0===t[l]?(t[l]=a,r.push(this.vertices[a]),n[a]=r.length-1):n[a]=n[t[l]]}for(var u=[],c=0,h=this.faces.length;c<h;c++){var d=this.faces[c];d.a=n[d.a],d.b=n[d.b],d.c=n[d.c];for(var f=[d.a,d.b,d.c],v=0;v<3;v++)if(f[v]===f[(v+1)%3]){u.push(c);break}}for(var p=u.length-1;p>=0;p--){var m=u[p];this.faces.splice(m,1);for(var g=0,y=this.faceVertexUvs.length;g<y;g++)this.faceVertexUvs[g].splice(m,1)}var x=this.vertices.length-r.length;return this.vertices=r,x}},{key:"setFromPoints",value:function(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var n=e[t];this.vertices.push(new w.Vector3(n.x,n.y,n.z||0))}return this}},{key:"sortFacesByMaterialIndex",value:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var n,i,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===t&&(n=[]),o&&o.length===t&&(i=[]);for(var s=0;s<t;s++){var l=e[s]._id;n&&n.push(a[l]),i&&i.push(o[l])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}for(var n=[],i=0;i<this.vertices.length;i++){var a=this.vertices[i];n.push(a.x,a.y,a.z)}for(var o=[],s=[],l={},u=[],c={},h=[],d={},f=0;f<this.faces.length;f++){var v=this.faces[f],p=void 0!==this.faceVertexUvs[0][f],m=v.normal.length()>0,g=v.vertexNormals.length>0,y=1!==v.color.r||1!==v.color.g||1!==v.color.b,x=v.vertexColors.length>0,b=0;if(b=_(b,0,0),b=_(b,1,!0),b=_(b,2,!1),b=_(b,3,p),b=_(b,4,m),b=_(b,5,g),b=_(b,6,y),b=_(b,7,x),o.push(b),o.push(v.a,v.b,v.c),o.push(v.materialIndex),p){var w=this.faceVertexUvs[0][f];o.push(Z(w[0]),Z(w[1]),Z(w[2]))}if(m&&o.push(C(v.normal)),g){var S=v.vertexNormals;o.push(C(S[0]),C(S[1]),C(S[2]))}if(y&&o.push(O(v.color)),x){var k=v.vertexColors;o.push(O(k[0]),O(k[1]),O(k[2]))}}function _(e,t,r){return r?e|1<<t:e&~(1<<t)}function C(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=s.length/3,s.push(e.x,e.y,e.z)),l[t]}function O(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==c[t]||(c[t]=u.length,u.push(e.getHex())),c[t]}function Z(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]||(d[t]=h.length/2,h.push(e.x,e.y)),d[t]}return e.data={},e.data.vertices=n,e.data.normals=s,u.length>0&&(e.data.colors=u),h.length>0&&(e.data.uvs=[h]),e.data.faces=o,e}},{key:"clone",value:function(){return(new r).copy(this)}},{key:"copy",value:function(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;for(var t=e.vertices,r=0,n=t.length;r<n;r++)this.vertices.push(t[r].clone());for(var i=e.colors,a=0,o=i.length;a<o;a++)this.colors.push(i[a].clone());for(var s=e.faces,l=0,u=s.length;l<u;l++)this.faces.push(s[l].clone());for(var c=0,h=e.faceVertexUvs.length;c<h;c++){var d=e.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var f=0,v=d.length;f<v;f++){for(var p=d[f],m=[],g=0,y=p.length;g<y;g++){var x=p[g];m.push(x.clone())}this.faceVertexUvs[c].push(m)}}for(var b=e.morphTargets,w=0,S=b.length;w<S;w++){var k={};if(k.name=b[w].name,void 0!==b[w].vertices){k.vertices=[];for(var _=0,C=b[w].vertices.length;_<C;_++)k.vertices.push(b[w].vertices[_].clone())}if(void 0!==b[w].normals){k.normals=[];for(var O=0,Z=b[w].normals.length;O<Z;O++)k.normals.push(b[w].normals[O].clone())}this.morphTargets.push(k)}for(var L=e.morphNormals,A=0,M=L.length;A<M;A++){var D={};if(void 0!==L[A].vertexNormals){D.vertexNormals=[];for(var T=0,z=L[A].vertexNormals.length;T<z;T++){var E=L[A].vertexNormals[T],P={};P.a=E.a.clone(),P.b=E.b.clone(),P.c=E.c.clone(),D.vertexNormals.push(P)}}if(void 0!==L[A].faceNormals){D.faceNormals=[];for(var N=0,B=L[A].faceNormals.length;N<B;N++)D.faceNormals.push(L[A].faceNormals[N].clone())}this.morphNormals.push(D)}for(var U=e.skinWeights,I=0,V=U.length;I<V;I++)this.skinWeights.push(U[I].clone());for(var F=e.skinIndices,j=0,R=F.length;j<R;j++)this.skinIndices.push(F[j].clone());for(var G=e.lineDistances,H=0,W=G.length;H<W;H++)this.lineDistances.push(G[H]);var q=e.boundingBox;null!==q&&(this.boundingBox=q.clone());var J=e.boundingSphere;return null!==J&&(this.boundingSphere=J.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}},{key:"toBufferGeometry",value:function(){var e=(new Tl).fromGeometry(this),t=new w.BufferGeometry,r=new Float32Array(3*e.vertices.length);if(t.setAttribute("position",new w.BufferAttribute(r,3).copyVector3sArray(e.vertices)),e.normals.length>0){var n=new Float32Array(3*e.normals.length);t.setAttribute("normal",new w.BufferAttribute(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var i=new Float32Array(3*e.colors.length);t.setAttribute("color",new w.BufferAttribute(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var a=new Float32Array(2*e.uvs.length);t.setAttribute("uv",new w.BufferAttribute(a,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);t.setAttribute("uv2",new w.BufferAttribute(o,2).copyVector2sArray(e.uvs2))}for(var s in t.groups=e.groups,e.morphTargets){for(var l=[],u=e.morphTargets[s],c=0,h=u.length;c<h;c++){var d=u[c],f=new w.Float32BufferAttribute(3*d.data.length,3);f.name=d.name,l.push(f.copyVector3sArray(d.data))}t.morphAttributes[s]=l}if(e.skinIndices.length>0){var v=new w.Float32BufferAttribute(4*e.skinIndices.length,4);t.setAttribute("skinIndex",v.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var p=new w.Float32BufferAttribute(4*e.skinWeights.length,4);t.setAttribute("skinWeight",p.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(t.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(t.boundingBox=e.boundingBox.clone()),t}},{key:"computeTangents",value:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")}},{key:"computeLineDistances",value:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}},{key:"applyMatrix",value:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}],[{key:"createBufferGeometryFromObject",value:function(e){var t=new w.BufferGeometry,r=e.geometry;if(e.isPoints||e.isLine){var n=new w.Float32BufferAttribute(3*r.vertices.length,3),i=new w.Float32BufferAttribute(3*r.colors.length,3);if(t.setAttribute("position",n.copyVector3sArray(r.vertices)),t.setAttribute("color",i.copyColorsArray(r.colors)),r.lineDistances&&r.lineDistances.length===r.vertices.length){var a=new w.Float32BufferAttribute(r.lineDistances.length,1);t.setAttribute("lineDistance",a.copyArray(r.lineDistances))}null!==r.boundingSphere&&(t.boundingSphere=r.boundingSphere.clone()),null!==r.boundingBox&&(t.boundingBox=r.boundingBox.clone())}else e.isMesh&&(t=r.toBufferGeometry());return t}}]),r}(w.EventDispatcher);Dl.prototype.isGeometry=!0;var Tl=function(){function e(){(0,g.Z)(this,e),this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}return(0,y.Z)(e,[{key:"computeGroups",value:function(e){var t,r,n,i=[],a=e.faces;for(r=0;r<a.length;r++){var o=a[r];o.materialIndex!==n&&(n=o.materialIndex,void 0!==t&&(t.count=3*r-t.start,i.push(t)),t={start:3*r,materialIndex:n})}void 0!==t&&(t.count=3*r-t.start,i.push(t)),this.groups=i}},{key:"fromGeometry",value:function(e){var t,r=e.faces,n=e.vertices,i=e.faceVertexUvs,a=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var u=0;u<l;u++)t[u]={name:s[u].name,data:[]};this.morphTargets.position=t}var c,h=e.morphNormals,d=h.length;if(d>0){c=[];for(var f=0;f<d;f++)c[f]={name:h[f].name,data:[]};this.morphTargets.normal=c}var v=e.skinIndices,p=e.skinWeights,m=v.length===n.length,g=p.length===n.length;n.length>0&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var y=0;y<r.length;y++){var x=r[y];this.vertices.push(n[x.a],n[x.b],n[x.c]);var b=x.vertexNormals;if(3===b.length)this.normals.push(b[0],b[1],b[2]);else{var S=x.normal;this.normals.push(S,S,S)}var k=x.vertexColors;if(3===k.length)this.colors.push(k[0],k[1],k[2]);else{var _=x.color;this.colors.push(_,_,_)}if(!0===a){var C=i[0][y];void 0!==C?this.uvs.push(C[0],C[1],C[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",y),this.uvs.push(new w.Vector2,new w.Vector2,new w.Vector2))}if(!0===o){var O=i[1][y];void 0!==O?this.uvs2.push(O[0],O[1],O[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",y),this.uvs2.push(new w.Vector2,new w.Vector2,new w.Vector2))}for(var Z=0;Z<l;Z++){var L=s[Z].vertices;t[Z].data.push(L[x.a],L[x.b],L[x.c])}for(var A=0;A<d;A++){var M=h[A].vertexNormals[y];c[A].data.push(M.a,M.b,M.c)}m&&this.skinIndices.push(v[x.a],v[x.b],v[x.c]),g&&this.skinWeights.push(p[x.a],p[x.b],p[x.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}]),e}(),zl=function(){function e(t,r,n,i,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;(0,g.Z)(this,e),this.a=t,this.b=r,this.c=n,this.normal=i&&i.isVector3?i:new w.Vector3,this.vertexNormals=Array.isArray(i)?i:[],this.color=a&&a.isColor?a:new w.Color,this.vertexColors=Array.isArray(a)?a:[],this.materialIndex=o}return(0,y.Z)(e,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var n=0,i=e.vertexColors.length;n<i;n++)this.vertexColors[n]=e.vertexColors[n].clone();return this}}]),e}(),El=["a","b","c"];function Pl(e,t){switch(t){case"c":return e.c;case"b":return e.b;default:return e.a}}function Nl(e,t,r){var n=Math.min(e,t)+"_"+Math.max(e,t);return r.get(n)}function Bl(e,t,r,n,i,a){var o,s=Math.min(e,t),l=Math.max(e,t),u=s+"_"+l;n.has(u)?o=n.get(u):(o={a:r[s],b:r[l],newEdge:null,faces:[]},n.set(u,o));o.faces.push(i),a[e].edges.push(o),a[t].edges.push(o)}function Ul(e,t,r,n,i){e.push(new zl(t,r,n,void 0,void 0,i))}function Il(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function Vl(e,t,r,n){e.push([t.clone(),r.clone(),n.clone()])}var Fl=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;(0,g.Z)(this,e),this.subdivisions=t}return(0,y.Z)(e,[{key:"modify",value:function(e){(e=e instanceof w.BufferGeometry?(new Dl).fromBufferGeometry(e):e.clone()).mergeVertices();for(var t=this.subdivisions;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}},{key:"_smooth",value:function(e){var t,r,n,i,a,o=new w.Vector3,s=e.vertices,l=e.faces,u=e.faceVertexUvs[0],c=void 0!==u&&u.length>0,h=[],d=new Map;!function(e,t,r,n){var i,a,o;for(i=0,a=e.length;i<a;i++)r[i]={edges:[]};for(i=0,a=t.length;i<a;i++)Bl((o=t[i]).a,o.b,e,n,o,r),Bl(o.b,o.c,e,n,o,r),Bl(o.c,o.a,e,n,o,r)}(s,l,h,d);for(var f,v,p,m,g,y,x,b=[],S=0,k=Array.from(d.keys());S<k.length;S++){var _=k[S];for(v=d.get(_),p=new w.Vector3,g=3/8,y=1/8,2!=(x=v.faces.length)&&(g=.5,y=0),p.addVectors(v.a,v.b).multiplyScalar(g),o.set(0,0,0),i=0;i<x;i++){for(m=v.faces[i],a=0;a<3&&((f=s[Pl(m,El[a])])===v.a||f===v.b);a++);f&&o.add(f)}o.multiplyScalar(y),p.add(o),v.newEdge=b.length,b.push(p)}var C,O,Z,L,A,M,D,T=[];for(r=0,n=s.length;r<n;r++){for(M=s[r],3==(t=(A=h[r].edges).length)?C=3/16:t>3&&(C=3/(8*t)),O=1-t*Number(C),Z=C,t<=2&&(2==t&&(O=3/4,Z=1/8)),D=M.clone().multiplyScalar(O),o.set(0,0,0),i=0;i<t;i++)f=(L=A[i]).a!==M?L.a:L.b,o.add(f);o.multiplyScalar(Number(Z)),D.add(o),T.push(D)}var z,E,P,N,B,U,I,V=T.concat(b),F=T.length,j=[],R=[],G=new w.Vector2,H=new w.Vector2,W=new w.Vector2;for(r=0,n=l.length;r<n;r++)m=l[r],Ul(j,z=Number(Nl(m.a,m.b,d).newEdge)+F,E=Number(Nl(m.b,m.c,d).newEdge)+F,P=Number(Nl(m.c,m.a,d).newEdge)+F,m.materialIndex),Ul(j,m.a,z,P,m.materialIndex),Ul(j,m.b,E,z,m.materialIndex),Ul(j,m.c,P,E,m.materialIndex),c&&(B=(N=u[r])[0],U=N[1],I=N[2],G.set(Il(B.x,U.x),Il(B.y,U.y)),H.set(Il(U.x,I.x),Il(U.y,I.y)),W.set(Il(B.x,I.x),Il(B.y,I.y)),Vl(R,G,H,W),Vl(R,B,G,W),Vl(R,U,H,G),Vl(R,I,W,H));e.vertices=V,e.faces=j,c&&(e.faceVertexUvs[0]=R)}}]),e}(),jl=new w.Vector3,Rl=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a=null!==(r=null!==(n=e.geometry)&&void 0!==n?n:null===t||void 0===t?void 0:t.geometry)&&void 0!==r?r:(new w.BufferGeometry).copy(new w.BoxBufferGeometry(100,100,100));void 0===t?(a.computeBoundingBox(),a.boundingBox.getSize(jl),i={width:jl.x,height:jl.y,depth:jl.z,subdivisions:0}):i=t.parameters;var o=(0,x.Z)((0,x.Z)({},i),e.parameters);return{parameters:{width:Math.abs(o.width),height:Math.abs(o.height),depth:Math.abs(o.depth),subdivisions:Math.abs(o.subdivisions)},geometry:a}}},{key:"build",value:function(e){var t,r=e.parameters,n=r.width,i=r.height,a=r.depth,o=r.subdivisions,s=null!==(t=e.geometry)&&void 0!==t?t:(new w.BufferGeometry).copy(new w.BoxBufferGeometry(100,100,100)),l=s.userData.parameters;void 0===l?(s.computeBoundingBox(),s.boundingBox.getSize(jl)):jl.set(l.width,l.height,l.depth),(n!==jl.x||i!==jl.y||a!==jl.z)&&s.scale(0===jl.x?1:n/jl.x,0===jl.y?1:i/jl.y,0===jl.z?1:a/jl.z);var u=s.originalGeometry;return o>0?(void 0===u||(null===l||void 0===l?void 0:l.subdivisions)!==o)&&(void 0===u&&(u=s),s=new Fl(o).modify(u).toBufferGeometry()):(void 0!==u&&(s=u),u=void 0,void 0===s.getAttribute("normal")&&s.computeVertexNormals()),void 0!==u&&Object.assign(s,{originalGeometry:u}),delete e.geometry,Object.assign(s,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"NonParametricGeometry"})})}},{key:"loadFromUrl",value:function(e,t,r){var n=this;new w.BufferGeometryLoader(r).load(e,(function(e){var r=n.normalizeInputs({geometry:e});e.boundingBox.getSize(jl);var i=100/jl.x;Object.assign(r.parameters,{width:100,height:jl.y*i,depth:jl.z*i}),t(n.build(r))}))}}]),e}(),Gl=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof js?e.shape:new js,parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:0)})}}},{key:"build",value:function(e){for(var t=e.parameters,r=t.width,n=t.height,i=t.spikes,a=t.cornerRadius,o=t.depth,s=t.extrudeBevelSize,l=t.extrudeBevelSegments,u=e.shape,c=.5*r,h=.5*n,d=2*Math.PI/i,f=0;f<i;f++){var v=d*f,p=0+Math.sin(v)*c,m=0+Math.cos(v)*h;u.addPoint(u.createPoint(p,m))}u.isClosed=!0;for(var g=0,y=u.points.length;g<y;g++)u.points[g].roundness=a;u.roundness=a,u.update();var b=vl.create({shape:u,parameters:{roundness:a,depth:o,extrudeBevelSize:s,extrudeBevelSegments:l}});return Object.assign(b,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"PolygonGeometry"})})}}]),e}(),Hl=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:a.width)})}}},{key:"build",value:function(e){var t=e.parameters,r=t.width,n=t.height,i=t.depth,a=t.radialSegments,o=t.heightSegments,s=t.openEnded,l=t.cornerRadius,u=t.cornerSegments,c=new Yl(.5*r,n,a,o,s,l,u);return c.scale(1,1,i/r),Object.assign(c,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"PyramidGeometry"})})}}]),e}();function Wl(e,t,r){r.x=e.x*t.x,r.y=e.y,r.z=e.x*t.y}function ql(e,t,r,n,i,a){var o=t.clone().sub(e),s=r.clone().sub(e),l=o.angleTo(s);if(o.normalize(),s.normalize(),n===i){var u=o.add(s).normalize();a.copy(e).addScaledVector(u,n/Math.sin(l/2))}else{var c=o.angleTo(s);a.copy(e),a.addScaledVector(o,i/Math.sin(c)),a.addScaledVector(s,n/Math.sin(c))}}function Jl(e,t,r){var n=e.clone().sub(t),i=r.clone().sub(t);return n.projectOnVector(i),n.add(t)}var Yl=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:4;(0,g.Z)(this,r),e=t.call(this),a=Math.floor(Math.max(3,a)),o=Math.floor(o),c=Math.floor(c);var h,d=[],f=[],v=[],p=[],m=0,y=i/2,x=Math.PI/a,b=n*Math.cos(Math.PI/a),S=2*Math.PI/a,k=(a-2)*Math.PI/a,_=Math.PI-k,C=new w.Vector3(0,-y,0),O=new w.Vector3(0,y,0),Z=new w.Vector2(n,-y),L=new w.Vector2(b,-y),A=new w.Vector2(0,O.y).sub(L),M=new w.Vector2(0,O.y).sub(Z),D=new w.Vector2(A.y,-A.x).normalize(),T=new w.Vector2(M.y,-M.x).normalize(),z=n*Math.cos(Math.PI/a)*Math.tan((Math.PI-A.angle())/2)-1e-8;l=Math.min(l,z);var E=new w.Vector3(D.x,D.y,0),P=new w.Vector3(Math.cos(S)*E.x,E.y,Math.sin(S)*E.x);h=E.angleTo(P);var N=l/Math.tan((Math.PI-A.angle())/2),B=l/Math.tan((Math.PI-h)/2),U=new w.Vector3;if(!s){f.push(C.x,C.y,C.z),v.push(0,-1,0),p.push(0,0);var I=m++,V=[],F=Z.clone(),j=N/Math.cos(Math.PI/a);F.x-=j;for(var R=0;R<a;R++){var G=R/a*Math.PI*2+x,H=new w.Vector2(Math.sin(G),Math.cos(G));Wl(F,H,U),f.push(U.x,U.y,U.z),v.push(0,-1,0),p.push(0,0),V.push(m++)}for(var W=0;W<V.length;W++)d.push(V[W],I,V[(W+1)%V.length])}for(var q=[],J=new w.Vector3,Y=new w.Vector3,X=new w.Vector3,K=new w.Vector3,Q=new w.Vector3,$=new w.Vector3,ee=0;ee<a;ee++){var te=ee/a*Math.PI*2+x,re=(ee+.5)/a*Math.PI*2+x,ne=(ee+1)/a*Math.PI*2+x,ie=new w.Vector2(Math.sin(te),Math.cos(te)),ae=new w.Vector2(Math.sin(re),Math.cos(re)),oe=new w.Vector2(Math.sin(ne),Math.cos(ne));Wl(Z,ie,Y),Wl(Z,oe,X),Wl(D,ae,J),ql(O,Y,X,B,B,K),f.push(K.x,K.y,K.z),ql(Y,O,X,B,N,Q),f.push(Q.x,Q.y,Q.z),ql(X,Y,O,N,B,$),f.push($.x,$.y,$.z),v.push(J.x,J.y,J.z),v.push(J.x,J.y,J.z),v.push(J.x,J.y,J.z),p.push(0,0),p.push(0,0),p.push(0,0);var se=m++,le=m++,ue=m++;if(d.push(se,le,ue),l>0){var ce=Y.clone().add(X).multiplyScalar(.5),he=O.clone().sub(ce).normalize(),de=C.clone().sub(ce).normalize().add(he).normalize().multiplyScalar(-1),fe=$.clone().sub(Q);He(ce,fe,de,A.angle());var ve=void 0,pe=void 0,me=new w.Vector3;Wl(T,oe,me);var ge=$.clone().add(K).multiplyScalar(.5);ge=Jl(ge,X,O);var ye=$.clone().sub(K),xe=He(ge,ye,me,h,K.y),be=(0,u.Z)(xe,2);ve=be[0],pe=be[1];var we=ve,Se=we.clone().setY(0).normalize(),ke=new w.Vector3(0,-1,0),_e=Se.clone().cross(ke);We(we,Se,ke,_e),q.concat(pe);var Ce=A.angle(),Oe=Math.PI-Ce,Ze=O.clone();Ze.y-=l/Math.sin(Ce-Math.PI/2);for(var Le=new w.Vector3,Ae=[],Me=0;Me<c;Me++){for(var De=[],Te=Math.PI/2-Oe*Me/c,ze=Math.cos(Te),Ee=Math.sin(Te),Pe=re,Ne=0;Ne<=Me;Ne++){var Be=Math.cos(Pe),Ue=Math.sin(Pe);J.x=ze*Ue,J.y=Ee,J.z=ze*Be,Le.copy(Ze).addScaledVector(J,l),f.push(Le.x,Le.y,Le.z),v.push(J.x,J.y,J.z),p.push(0,0),De.push(m++),Pe+=2*Math.PI/Me/a}Ae.push(De)}pe.reverse(),Ae.push(pe);for(var Ie=Ae.length-1,Ve=0;Ve<Ie;Ve++){var Fe=Ae[Ve],je=Ae[Ve+1],Re=Fe.length-1;d.push(je[1],Fe[0],je[0]);for(var Ge=1;Ge<=Re;Ge++)d.push(Fe[Ge],Fe[Ge-1],je[Ge]),d.push(je[Ge+1],Fe[Ge],je[Ge])}}}function He(e,t,r,n,i){var a=-n/2,o=(Math.PI-n)/2,s=t.clone().normalize().cross(r);e.addScaledVector(r,-l/Math.sin(o));for(var u=new w.Vector3,h=new w.Vector3,g=m,y=[],x=0;x<=c;x++){var b=a+x/c*n;h.set(0,0,0),h.addScaledVector(s,Math.sin(b)),h.addScaledVector(r,Math.cos(b));for(var S=0;S<=1;S++){var k=S/1-.5;if(u.copy(e),u.addScaledVector(t,k),u.addScaledVector(h,l),null!=i){var _=Math.max(0,u.y-i);u.addScaledVector(t,-_/t.y)}f.push(u.x,u.y,u.z),v.push(h.x,h.y,h.z),p.push(0,0),0===S&&y.push(m),m++}}for(var C=0;C<c;C++)for(var O=0;O<1;O++){var Z=g+O+2*C,L=Z+2,A=L+1,M=Z+1;d.push(Z,L,M),d.push(L,A,M)}return[e.clone().addScaledVector(t,.5),y]}function We(e,t,r,n){for(var i=Math.PI/2,a=M.angle()-i,o=[],s=new w.Vector3,u=new w.Vector3,h=0;h<=c;h++){for(var g=[],y=h/c,x=0;x<=h;x++){var b=((h?x/h:0)-.5)*_,S=Math.cos(b),k=Math.sin(b),C=(i+Math.atan(Math.tan(a)*S))*y,O=Math.cos(C),Z=Math.sin(C);s.set(0,0,0),s.addScaledVector(t,Z*S),s.addScaledVector(r,O),s.addScaledVector(n,Z*k),u.copy(e).addScaledVector(s,l),f.push(u.x,u.y,u.z),v.push(s.x,s.y,s.z),p.push(0,0),g.push(m++)}o.push(g)}for(var L=o.length-1,A=0;A<L;A++){var D=o[A],T=o[A+1],z=D.length-1;d.push(D[0],T[1],T[0]);for(var E=1;E<=z;E++)d.push(D[E-1],D[E],T[E]),d.push(D[E],T[E+1],T[E])}}return e.setIndex(d),e.setAttribute("position",new w.Float32BufferAttribute(f,3)),e.setAttribute("normal",new w.Float32BufferAttribute(v,3)),e.setAttribute("uv",new w.Float32BufferAttribute(p,2)),e}return(0,y.Z)(r)}(w.BufferGeometry),Xl=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a,o=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),s=Object.assign(null!==(n=null===t||void 0===t?void 0:t.ui)&&void 0!==n?n:{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof js?e.shape:new js,parameters:Object.assign(o,{width:Math.abs(o.width),height:Math.abs(null!==(i=o.height)&&void 0!==i?i:o.width),depth:Math.abs(null!==(a=o.depth)&&void 0!==a?a:0)}),ui:s}}},{key:"build",value:function(e){var t=e.shape,r=e.parameters,n=r.width,i=r.height,a=r.cornerRadius,o=r.cornerType,s=r.depth,l=r.extrudeBevelSize,u=r.extrudeBevelSegments,c={x:.5*n,y:.5*i},h={x:-c.x,y:-c.y},d={x:c.x,y:c.y};function f(e,t,r){return t>n&&r>i?Math.min(e*n/t,e*i/r):t>n?e*n/t:r>i?e*i/r:e}var v=[];v[0]=0===a[0]?0:f(a[0],a[0]+a[3],a[0]+a[1]),v[1]=0===a[1]?0:f(a[1],a[1]+a[2],a[1]+a[0]),v[2]=0===a[2]?0:f(a[2],a[2]+a[1],a[2]+a[3]),v[3]=0===a[3]?0:f(a[3],a[3]+a[0],a[3]+a[2]);var p=h.x,m=d.x,g=d.y,y=h.y;t.addPoint(t.createPoint(p,g)),t.addPoint(t.createPoint(m,g)),t.addPoint(t.createPoint(m,y)),t.addPoint(t.createPoint(p,y)),t.isClosed=!0;for(var b=!0,w=0,S=t.points.length;w<S;w++)t.points[w].roundness=v[w],w>0&&v[w]!==v[w-1]&&(b=!1);b&&(t.roundness=v[0]),t.useCubicForRoundedCorners=1!==o,t.update();var k=vl.create({shape:t,parameters:{depth:s,extrudeBevelSize:l,extrudeBevelSegments:u}});return Object.assign(k,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"RectangleGeometry"})})}}]),e}(),Kl=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:a.width)})}}},{key:"build",value:function(e){var t=e.parameters,r=t.width,n=void 0===r?100:r,i=t.height,a=void 0===i?n:i,o=t.depth,s=void 0===o?n:o,l=t.widthSegments,u=void 0===l?64:l,c=t.heightSegments,h=void 0===c?64:c,d=t.phiStart,f=t.phiLength,v=t.thetaStart,p=t.thetaLength,m=new w.SphereBufferGeometry(.5*n,u,h,d,f,v,p);return m.scale(1,a/n,s/n),Object.assign(m,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"SphereGeometry"})})}}]),e}(),Ql=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(null!==(n=i.height)&&void 0!==n?n:i.width),depth:0})}}},{key:"build",value:function(e){var t=e.parameters,r=t.width,n=void 0===r?100:r,i=t.height,a=void 0===i?n:i,o=t.widthSegments,s=void 0===o?8:o,l=t.heightSegments,u=void 0===l?8:l,c=new w.PlaneBufferGeometry(n,a,s,u);return c.scale(1,1,1),Object.assign(c,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"PlaneGeometry"})})}}]),e}(),$l=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:a.width)})}}},{key:"build",value:function(e){var t=e.parameters,r=t.width,n=t.height,i=t.depth,a=t.angle,o=t.cornerRadius,s=t.cornerSegments,l=new eu(r,n,i,a,o,s);return Object.assign(l,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"BackdropGeometry"})})}}]),e}(),eu=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:90,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:24;(0,g.Z)(this,r),(e=t.call(this)).type="BackdropGeometry";var c=[],h=[],d=[],f=.001;0==s&&(l=1),l=Math.max(1,Math.floor(l)),s=Math.min(s,100),o=Math.min(180-f,o),o*=Math.PI/180;var v=[],p=Math.PI/2,m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new w.Vector3(e,t,r)},y=m(),x=m(),b=i/2,S=n/2,k=a/2,_=-S,C=+S,O=[m(_,-b,+k),m(_,-b,-k),m(_,+b,-k)],Z=O[0],L=O[1],A=O[2],M=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Math.sin(e-Math.PI/(+t+1))},D=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Math.cos(e-Math.PI/(+t+1))};A.y=Math.sin(o)*i-b;var T=Math.cos(o)*i-k,z=Z.z-f;o<=p?(A.z=Math.min(T,z),A.z==z&&(A.y-=(T-z)/Math.tan(p-o))):L.z=Math.min(L.z-T-k,Z.z-f),y.subVectors(Z,L),x.subVectors(A,L);var E=Math.min(y.length(),x.length())*s/100,P=E*Math.tan(o/2),N=E/Math.cos(o/2),B=y.clone().normalize().add(x.normalize()).setLength(N).add(L);y.set(0,M(o,!0),D(o,!0)),v.push([A,y.clone()]);for(var U=(Math.PI-o)/l,I=0;I<=l;I++){var V=p+o+I*U;y.set(0,Math.sin(V)*P,Math.cos(V)*P),y.add(B),x.set(0,M(V),D(V)),v.push([y.clone(),x.clone()])}v.push([Z,m(0,1,0)]);var F=Math.sin(U/2)*P*2,j=v.length-1,R=v[0][0].distanceTo(v[1][0]),G=v[j-1][0].distanceTo(v[j][0]),H=R+F*l+G;v[0].push(1);for(var W=0;W<=l;W++)v[W+1].push(1-(R+W*F)/H);v[j].push(0);var q,J,Y,X=(0,u.Z)(v[0],3),K=X[0],Q=X[1],$=X[2];for(I=1;I<v.length;I++){var ee;q=(ee=(0,u.Z)(v[I],3))[0],J=ee[1],Y=ee[2],c.push(_,K.y,K.z,_,q.y,q.z,C,K.y,K.z,C,K.y,K.z,_,q.y,q.z,C,q.y,q.z),h.push(0,Q.y,Q.z,0,J.y,J.z,0,Q.y,Q.z,0,Q.y,Q.z,0,J.y,J.z,0,J.y,J.z),d.push(0,$,0,Y,1,$,1,$,0,Y,1,Y),K=q,Q=J,$=Y}return e.setAttribute("position",new w.Float32BufferAttribute(c,3)),e.setAttribute("normal",new w.Float32BufferAttribute(h,3)),e.setAttribute("uv",new w.Float32BufferAttribute(d,2)),e}return(0,y.Z)(r)}(w.BufferGeometry),tu=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof js?e.shape:new js,parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:0)})}}},{key:"build",value:function(e){var t=e.parameters,r=t.width,n=t.height,i=t.innerRadiusPercent,a=t.spikes,o=t.cornerRadius,s=t.angle,l=t.depth,u=t.extrudeBevelSize,c=t.extrudeBevelSegments,h=e.shape,d=.5*r,f=.5*n,v=s*Math.PI/360/a,p=Math.PI/2*3*-1,m=d*i/100,g=f*i/100;if(3===a&&50===i){v=2*Math.PI/a;for(var y=0;y<a;y++){var b=v*y,w=0+Math.sin(b)*d,S=0+Math.cos(b)*f;h.addPoint(h.createPoint(w,S))}}else for(var k=0;k<a;k++){var _=0+Math.cos(p)*d,C=0+Math.sin(p)*f;h.addPoint(h.createPoint(_,C)),p+=v,_=0+Math.cos(p)*m,C=0+Math.sin(p)*g,h.addPoint(h.createPoint(_,C)),p+=v}h.isClosed=!0;for(var O=0,Z=h.points.length;O<Z;O++)h.points[O].roundness=o;h.roundness=o,h.update();var L=vl.create({shape:h,parameters:{roundness:o,depth:l,extrudeBevelSize:u,extrudeBevelSegments:c}});return Object.assign(L,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"StarGeometry"})})}}]),e}(),ru=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,depth:0},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:0)})}}},{key:"build",value:function(e){var t=e.parameters,r=t.width,n=t.height,i=new w.PlaneBufferGeometry(r,n);return Object.assign(i,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"TextFrameGeometry"})})}}]),e}(),nu=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,radialSegments:32,tubularSegments:64,arc:2*Math.PI,cornerRadius:30,cornerSegments:8},e.parameters),o=Math.abs(a.width),s=Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),l=Math.abs(null!==(i=a.depth)&&void 0!==i?i:.25*a.width);return{parameters:Object.assign(a,{width:o,height:s,depth:l})}}},{key:"build",value:function(e){var t=e.parameters,r=t.width,n=t.height,i=t.depth,a=t.radialSegments,o=t.tubularSegments,s=function(e,t,r,n,i,a,o,s,l,u,c){var h;return t=(h=[r,t])[0],r=h[1],o=t/2,1==(i/=2*Math.PI)&&(u=0),new _l(!0,e,t,r,n,i,a,o,s,l,u,c)}(r,n,i,.5*r,t.arc,o,0,0,a,t.cornerRadius,t.cornerSegments);return s.scale(1,n/r,1),Object.assign(s,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"TorusGeometry"})})}}]),e}();var iu=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a,o=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(o,{width:Math.abs(o.width),height:Math.abs(null!==(n=o.height)&&void 0!==n?n:o.width),depth:Math.abs(null!==(i=o.depth)&&void 0!==i?i:o.width),tube:null!==(a=o.tube)&&void 0!==a?a:.125*o.width})}}},{key:"build",value:function(e){var t=e.parameters,r=t.width,n=t.tube,i=t.tubularSegments,a=t.radialSegments,o=t.p,s=t.q,l=.5*r;l!==n&&(l-=n);var u=new w.TorusKnotBufferGeometry(l,n,i,a,o,s);return Object.assign(u,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"TorusKnotGeometry"})})}}]),e}(),au=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"create",value:function(e){return this.build(this.normalizeInputs(e))}},{key:"normalizeInputs",value:function(e,t){var r,n,i,a=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof js?e.shape:new js,parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width*(a.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(null!==(i=a.depth)&&void 0!==i?i:0)})}}},{key:"build",value:function(e){var t=e.parameters,r=t.width,n=void 0===r?100:r,i=t.height,a=t.cornerRadius,o=t.depth,s=t.extrudeBevelSize,l=t.extrudeBevelSegments,u=t.isRect,c=e.shape,h=.5*n,d=.5*i;u?(c.addPoint(c.createPoint(-h,d)),c.addPoint(c.createPoint(h,-d)),c.addPoint(c.createPoint(-h,-d))):(c.addPoint(c.createPoint(0,d)),c.addPoint(c.createPoint(h,-d)),c.addPoint(c.createPoint(-h,-d))),c.isClosed=!0;for(var f=0,v=c.points.length;f<v;f++)c.points[f].roundness=a;c.roundness=a,c.update();var p=vl.create({shape:c,parameters:{roundness:a,depth:o,extrudeBevelSize:s,extrudeBevelSegments:l}});return Object.assign(p,{userData:(0,x.Z)((0,x.Z)({},e),{},{type:"TriangleGeometry"})})}}]),e}(),ou={};N(ou,{addBarycentricAttribute:function(){return cu},fixUvs:function(){return du},loadFromUrl:function(){return hu},resizeGeometry:function(){return uu},roundShapePolygon:function(){return lu}});var su=function(e,t){var r=t.x-e.x,n=t.y-e.y,i=Math.sqrt(r*r+n*n),a=r/i,o=n/i;return{x:r,y:n,len:i,nx:a,ny:o,ang:Math.atan2(o,a)}},lu=function(e,t,r){var n,i,a,o,s,l,u,c,h,d,f,v,p,m,g=t.length;for(o=t[g-2],e.curves=[],n=1;n<g-1;n++){s=t[n%g],l=t[(n+1)%g];var y=su(s,o),x=su(s,l);u=y.nx*x.ny-y.ny*x.nx,c=y.nx*x.nx-y.ny*-x.ny,f=Math.asin(u),h=1,d=!1,c<0?f<0?f=Math.PI+f:(f=Math.PI-f,h=-1,d=!0):f>0&&(h=-1,d=!0),v=f/2,(m=Math.abs(Math.cos(v)*r/Math.sin(v)))>Math.min(y.len/2,x.len/2)?(m=Math.min(y.len/2,x.len/2),p=Math.abs(m*Math.sin(v)/Math.cos(v))):p=r,i=s.x+x.nx*m,a=s.y+x.ny*m,i+=-x.ny*p*h,a+=x.nx*p*h,e.absarc(i,a,p,y.ang+Math.PI/2*h,x.ang-Math.PI/2*h,d),o=s,s=l}e.closePath()},uu=function(e,t){var r=t.width,n=t.height,i=t.depth;r=Math.abs(r),n=Math.abs(n),i=Math.abs(i);var a,o,s,l=e.userData.parameters;0===r?(r=l.width,a=1):a=r/l.width,0===n?(n=l.height,o=1):o=n/l.height,0===i?(i=l.depth,s=1):s=i/l.depth,e.scale(a,o,s),l.width=r,l.height=n,l.depth=i},cu=function(e,t){for(var r=[new w.Vector3(1,0,0),new w.Vector3(0,1,0),new w.Vector3(0,0,1)],n=e.attributes.position,i=new Float32Array(3*n.count),a=0,o=n.count;a<o;a++)r[a%3].toArray(i,3*a);e.setAttribute(t,new w.Float32BufferAttribute(i,3))},hu=function(e){return new Promise((function(t){(new w.BufferGeometryLoader).load(e,(function(e){return t(e)}))}))},du=function(e,t,r){var n=e.getAttribute("uv");if(n)for(var i=0;i<n.count;i++){var a=n.getX(i),o=n.getY(i);n.setXY(i,(a+t/2)/t,1-(o-r/2)/r*-1)}},fu=new Promise((function(e){e})),vu=function(){function e(t){var r;(0,g.Z)(this,e),t=null!==(r=t)&&void 0!==r?r:{},this.name=t.name,this.type=t.type,this.node=t.node,this.size=t.size,this.needsUpdate=t.needsUpdate}return(0,y.Z)(e,[{key:"value",get:function(){return this.node.value},set:function(e){this.node.value=e}}]),e}(),pu=function(){function e(t){(0,g.Z)(this,e),this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},this.uuid=w.MathUtils.generateUUID(),this.type=t,this.name="",this.userData={}}return(0,y.Z)(e,[{key:"analyze",value:function(e,t){var r;t=null!==(r=t)&&void 0!==r?r:{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}},{key:"analyzeAndFlow",value:function(e,t,r){var n;return r=null!==(n=r)&&void 0!==n?n:{},this.analyze(e,r),this.flow(e,t,r)}},{key:"flow",value:function(e,t,r){var n;r=null!==(n=r)&&void 0!==n?n:{},e.addFlow(r.slot,r.cache,r.context);var i={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),i}},{key:"build",value:function(e,t,r){var n;t=null!==(n=t)&&void 0!==n?n:this.getType(e,t);var i=e.getNodeData(null!==r&&void 0!==r?r:this);return e.analyzing&&this.appendDepsNode(e,i,t),-1===e.nodes.indexOf(this)&&e.nodes.push(this),void 0!==this.updateFrame&&-1===e.updaters.indexOf(this)&&e.updaters.push(this),this.generate(e,t,r)}},{key:"updateFrame",value:function(e){}},{key:"generateReadonly",value:function(e,t,r,n,i,a){return""}},{key:"generate",value:function(e,t,r,n,i){return""}},{key:"parse",value:function(e,t,r,n){}},{key:"appendDepsNode",value:function(e,t,r){t.deps=(t.deps||0)+1;var n=e.getTypeLength(r);(n>(t.outputMax||0)||this.getType(e,r))&&(t.outputMax=n,t.output=r)}},{key:"setName",value:function(e){this.name=e}},{key:"getName",value:function(){return this.name}},{key:"getType",value:function(e,t){return"sampler2D"===t||"samplerCube"===t?t:this.type}},{key:"getJSONNode",value:function(e){if(null!==e&&void 0!==e&&e.materials&&void 0!==(null===e||void 0===e?void 0:e.materials[this.uuid]))return e.materials[this.uuid]}},{key:"getHash",value:function(){var t,r,n="{";for(t in this)(r=this[t])instanceof e&&(n+='"'+t+'":'+r.getHash()+",");if(this.hashProperties)for(var i=0;i<this.hashProperties.length;i++)r=this[t=this.hashProperties[i]],n+='"'+t+'":"'+String(r)+'",';return n+='"id":"'+this.uuid+'"}'}},{key:"copy",value:function(e){return this.name=e.name,e.type&&(this.type=e.type),e.frameId&&(this.frameId=e.frameId),e.hashProperties&&(this.hashProperties=e.hashProperties.map((function(e){return e}))),this.userData=JSON.parse(JSON.stringify(e.userData)),this.shortcuts=JSON.parse(JSON.stringify(e.shortcuts)),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"createJSONNode",value:function(e){var t=void 0===e||"string"==typeof e;if("string"!=typeof this.type)throw new Error("Node does not allow serialization.");var r={};return r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),!t&&e&&(e.nodes[this.uuid]=r),r}},{key:"toJSON",value:function(e){var t;return null!==(t=this.getJSONNode(e))&&void 0!==t?t:this.createJSONNode(e)}},{key:"fromJSON",value:function(e,t){return this.uuid=e.uuid,this.type=e.type,e.name&&(this.name=e.name),e.userData&&(this.userData=e.userData),this}}]),e}(),mu=function(){function e(){(0,g.Z)(this,e),this.nodes={},this.keywords={}}return(0,y.Z)(e,[{key:"add",value:function(e){this.nodes[e.name]=e}},{key:"addKeyword",value:function(e,t,r){r=void 0===r||r,this.keywords[e]={callback:t,cache:r}}},{key:"remove",value:function(e){delete this.nodes[e.name]}},{key:"removeKeyword",value:function(e){delete this.keywords[e]}},{key:"get",value:function(e){return this.nodes[e]}},{key:"getKeyword",value:function(e,t){return this.keywords[e].callback(t)}},{key:"getKeywordData",value:function(e){return this.keywords[e]}},{key:"contains",value:function(e){return void 0!==this.nodes[e]}},{key:"containsKeyword",value:function(e){return void 0!==this.keywords[e]}}]),e}(),gu=new mu,yu=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n){var i,a;return(0,g.Z)(this,r),(a=t.call(this,e)).scope="",n=null!==(i=n)&&void 0!==i?i:{},a.shared=void 0===n.shared||n.shared,a.unique=void 0!==n.unique&&n.unique,a}return(0,y.Z)(r,[{key:"build",value:function(e,t,n,i){var a;if(t=null!==(a=t)&&void 0!==a?a:this.getType(e),this.getShared(e,t)){var l,u=this.getUnique(e,t);u&&void 0===this.uuid&&(this.uuid=w.MathUtils.generateUUID()),n=e.getUUID(null!==(l=n)&&void 0!==l?l:this.getUUID(),!u);var c=e.getNodeData(n),h=c.output||this.getType(e);if(e.analyzing)return(c.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,c,t),this.generate(e,t,n)):(0,o.Z)((0,s.Z)(r.prototype),"build",this).call(this,e,t,n);if(u)return c.name=c.name||(0,o.Z)((0,s.Z)(r.prototype),"build",this).call(this,e,t,n),c.name;if(!this.getLabel()&&(!this.getShared(e,h)||e.context.ignoreCache||1===c.deps))return(0,o.Z)((0,s.Z)(r.prototype),"build",this).call(this,e,t,n);n=this.getUUID(!1);var d=this.getTemp(e,n);if(d)return e.format(d,h,t);d=(0,o.Z)((0,s.Z)(r.prototype),"generate",this).call(this,e,t,n,c.output,i);var f=this.generate(e,h,n);return e.addNodeCode(d+" = "+f+";"),e.format(d,h,t)}return(0,o.Z)((0,s.Z)(r.prototype),"build",this).call(this,e,t,n)}},{key:"getShared",value:function(e,t){return"sampler2D"!==t&&"samplerCube"!==t&&this.shared}},{key:"getUnique",value:function(e,t){return this.unique}},{key:"setLabel",value:function(e){return this.label=e,this}},{key:"getLabel",value:function(){return this.label}},{key:"getUUID",value:function(e){var t=this.uuid;return"string"==typeof this.scope&&(t=this.scope+"-"+t),t}},{key:"getTemp",value:function(e,t){t=t||this.uuid;var r=e.getVars()[t];return r?r.name:void 0}},{key:"generate",value:function(e,t,r,n,i){var a;return this.getShared(e,t)||console.error("TempNode is not shared"),r=null!==(a=r)&&void 0!==a?a:this.uuid,e.getTempVar(r,null!==n&&void 0!==n?n:this.getType(e),i,this.getLabel()).name}}]),r}(pu),xu=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n){var i,a;return(0,g.Z)(this,r),(n=null!==(i=n)&&void 0!==i?i:{}).shared=void 0!==n.shared&&n.shared,(a=t.call(this,e,n)).readonly=!1,a}return(0,y.Z)(r,[{key:"setReadonly",value:function(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}},{key:"getReadonly",value:function(){return this.readonly}},{key:"createJSONNode",value:function(e){var t=(0,o.Z)((0,s.Z)(r.prototype),"createJSONNode",this).call(this,e);return!0===this.readonly&&(t.readonly=this.readonly),t}},{key:"fromJSON",value:function(e,t){return(0,o.Z)((0,s.Z)(r.prototype),"fromJSON",this).call(this,e,t),void 0!==e.readonly&&this.setReadonly(e.readonly),this}},{key:"generate",value:function(e,t,r,n,i,a){var o,s;r=e.getUUID(null!==(o=r)&&void 0!==o?o:this.getUUID()),n=null!==(s=n)&&void 0!==s?s:this.getType(e);var l=e.getNodeData(r);return this.getReadonly()&&void 0!==this.generateReadonly?this.generateReadonly(e,t,r,n,i,a):e.isShader("vertex")?(l.vertex||(l.vertex=e.createVertexUniform(n,this,i,a,this.getLabel())),e.format(l.vertex.name,n,t)):(l.fragment||(l.fragment=e.createFragmentUniform(n,this,i,a,this.getLabel())),e.format(l.fragment.name,n,t))}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.readonly=e.readonly,this}}]),r}(yu),bu=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;return(0,g.Z)(this,r),(e=t.call(this,"v2")).nodeType="Vector2",e.value=n instanceof w.Vector2?n:new w.Vector2(n,i),e}return(0,y.Z)(r,[{key:"x",get:function(){return this.value.x},set:function(e){this.value.x=e}},{key:"y",get:function(){return this.value.y},set:function(e){this.value.y=e}},{key:"generateReadonly",value:function(e,t,r,n,i,a){return e.format("vec2("+this.value.x+", "+this.value.y+")",n,t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.value.copy(e.value),this}}]),r}(xu),wu=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return(0,g.Z)(this,r),(e=t.call(this,"v3")).nodeType="Vector3",e.value=n instanceof w.Vector3?n:new w.Vector3(n,i,a),e}return(0,y.Z)(r,[{key:"x",get:function(){return this.value.x},set:function(e){this.value.x=e}},{key:"y",get:function(){return this.value.y},set:function(e){this.value.y=e}},{key:"z",get:function(){return this.value.z},set:function(e){this.value.z=e}},{key:"generateReadonly",value:function(e,t,r,n,i,a){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",n,t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.value.copy(e.value),this}}]),r}(xu),Su=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i,a){var o;return(0,g.Z)(this,r),(o=t.call(this,e,n,i)).isColorA=!0,o.a=a,o}return(0,y.Z)(r,[{key:"setRGBA",value:function(e,t,n,i){(0,o.Z)((0,s.Z)(r.prototype),"setRGB",this).call(this,e,t,n),this.a=i}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.a="a"in e?e.a:1,this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b,this.a)}},{key:"x",get:function(){return this.r},set:function(e){this.r=e}},{key:"y",get:function(){return this.g},set:function(e){this.g=e}},{key:"z",get:function(){return this.b},set:function(e){this.b=e}},{key:"w",get:function(){return this.a},set:function(e){this.a=e}}]),r}(w.Color),ku=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this,"v4")).nodeType="Vector4",n.value=e instanceof Su?e:new Su(e.r,e.g,e.b,e.a),n}return(0,y.Z)(r,[{key:"generateReadonly",value:function(e,t,r,n,i,a){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",n,t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.value.copy(e.value),this}}]),r}(xu),_u=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,Cu=/[a-z_0-9]+/gi,Ou=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i,a,o){var s;return(0,g.Z)(this,r),(s=t.call(this,o)).src="",s.nodeType="Function",s.useKeywords=!0,s.includes=[],s.extensions={},s.keywords={},s.isMethod=void 0===o,s.isInterface=!1,s.parse(e,n,i,a),s}return(0,y.Z)(r,[{key:"getShared",value:function(e,t){return!this.isMethod}},{key:"getType",value:function(e){return e.getTypeByFormat(this.type)}},{key:"getInputByName",value:function(e){if(this.inputs)for(var t=this.inputs.length;t--;)if(this.inputs[t].name===e)return this.inputs[t]}},{key:"getIncludeByName",value:function(e){if(this.includes)for(var t=this.includes.length;t--;)if(this.includes[t].name===e)return this.includes[t]}},{key:"generate",value:function(e,t,r,n,i){var a,o=0,s=this.src;if(this.includes)for(var l=0;l<this.includes.length;l++)e.include(this.includes[l],this);for(var u in this.extensions)e.extensions[u]=!0;for(var c=[];a=Cu.exec(this.src);)c.push(a);for(var h=0;h<c.length;h++){var d=c[h],f=d[0],v=!this.isMethod||!this.getInputByName(f),p=f;if(this.keywords[f]||this.useKeywords&&v&&gu.containsKeyword(f)){var m=this.keywords[f];if(!m){var g=gu.getKeywordData(f);g.cache&&(m=e.keywords[f]),m=m||gu.getKeyword(f,e),g.cache&&(e.keywords[f]=m)}p=m.build(e)}f!==p&&(s=s.substring(0,d.index+o)+p+s.substring(d.index+f.length+o),o+=p.length-f.length),void 0===this.getIncludeByName(p)&&gu.contains(p)&&e.include(gu.get(p))}return"source"===t?s:this.isMethod?(this.isInterface||e.include(this,void 0,s),this.name):e.format("( "+s+" )",this.getType(e),t)}},{key:"parse",value:function(e,t,r,n){if(this.src=e||"",this.includes=null!==t&&void 0!==t?t:[],this.extensions=null!==r&&void 0!==r?r:{},this.keywords=null!==n&&void 0!==n?n:{},this.isMethod){var i=_u.exec(this.src);if(this.inputs=[],i&&4==i.length){this.type=i[1],this.name=i[2];var a=i[3].match(Cu);if(a)for(var o=0;o<a.length;){var s=a[o++],l=void 0;"in"===s||"out"===s||"inout"===s?l=a[o++]:(l=s,s="");var u=a[o++];this.inputs.push({name:u,type:l,qualifier:s})}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.isMethod=e.isMethod,this.useKeywords=e.useKeywords,void 0!==e.type&&(this.type=e.type),this.parse(e.src,e.includes,e.extensions,e.keywords),this}},{key:"toJSON",value:function(e){var t=this.getJSONNode(e);if(!t){var r;(t=this.createJSONNode(e)).src=this.src,t.isMethod=this.isMethod,t.useKeywords=this.useKeywords,this.isMethod||(t.type=this.type),t.extensions=JSON.parse(JSON.stringify(this.extensions));var n={};for(var i in this.keywords)n[i]=this.keywords[i].toJSON(e).uuid;if(t.keywords=n,null!==(r=this.includes)&&void 0!==r&&r.length){for(var a=[],o=0;o<this.includes.length;o++)a.push(this.includes[o].toJSON(e).uuid);t.includes=a}t.isMethod=this.isMethod,t.inputs=this.inputs}return t.nodeType=this.nodeType,t}},{key:"fromJSON",value:function(e,t){if((0,o.Z)((0,s.Z)(r.prototype),"fromJSON",this).call(this,e,t),void 0!==e.inputs&&(this.inputs=e.inputs),void 0!==e.isMethod&&(this.isMethod=e.isMethod),e.src&&(this.src=e.src),e.isMethod&&(this.isMethod=e.isMethod),e.useKeywords&&(this.useKeywords=e.useKeywords),e.type&&(this.type=e.type),e.extensions&&(this.extensions=e.extensions),e.keywords&&t)for(var n in this.keywords={},e.keywords)this.keywords[n]=t.getNode(e.keywords[n]);return e.includes&&t&&(this.includes=e.includes.map((function(e){return t.getNode(e)}))),this}}]),r}(yu),Zu=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,Lu=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0;return(0,g.Z)(this,r),(e=t.call(this)).src="",e.useDefine=!1,e.nodeType="Const",e.parse(n||r.PI,void 0,void 0,void 0,i),e}return(0,y.Z)(r,[{key:"getType",value:function(e){return e.getTypeByFormat(this.type)}},{key:"parse",value:function(e,t,r,n,i){this.src=e||"";var a,o,s="",l=Zu.exec(e);this.useDefine=null!==i&&void 0!==i?i:"#"===this.src.charAt(0),l&&l.length>1?(o=l[1],a=l[2],s=l[3]):(a=this.src,o="f"),this.name=a,this.type=o,this.value=s}},{key:"build",value:function(e,t){if("source"===t){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}},{key:"generate",value:function(e,t,r,n,i){return e.format(this.name,this.getType(e),t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.parse(e.src,void 0,void 0,void 0,e.useDefine),this}}]),r}(yu),Au=Lu;Au.PI="PI",Au.PI2="PI2",Au.RECIPROCAL_PI="RECIPROCAL_PI",Au.RECIPROCAL_PI2="RECIPROCAL_PI2",Au.LOG2="LOG2",Au.EPSILON="EPSILON";var Mu=new RegExp("^structs*([a-z_0-9]+)s*{s*((.|\n)*?)}","gim"),Du=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),Tu=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,g.Z)(this,r),(e=t.call(this)).inputs=[],e.src="",e.nodeType="Struct",e.parse(n),e}return(0,y.Z)(r,[{key:"getType",value:function(e){return e.getTypeByFormat(this.name)}},{key:"getInputByName",value:function(e){for(var t=this.inputs.length;t--;)if(this.inputs[t].name===e)return this.inputs[t]}},{key:"generate",value:function(e,t,r,n,i){return"source"===t?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}},{key:"parse",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.src=e,this.inputs=[];var t=Mu.exec(e);if(t){for(var r,n=t[2];r=Du.exec(n);)this.inputs.push({type:r[1],name:r[2]});this.name=t[1]}else this.name="";this.type=this.name}}]),r}(yu),zu=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this,"v2",{shared:!1})).nodeType="UV",n.index=null!==e&&void 0!==e?e:0,n}return(0,y.Z)(r,[{key:"generate",value:function(e,t){e.requires.uv[this.index]=!0;var r=this.index>0?this.index+1:"",n=e.isShader("vertex")?"uv"+r:"vUv"+r;return e.format(n,this.getType(e),t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.index=e.index,this}},{key:"toJSON",value:function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).index=this.index),t.nodeType=this.nodeType,t}},{key:"fromJSON",value:function(e,t){return(0,o.Z)((0,s.Z)(r.prototype),"fromJSON",this).call(this,e,t),e.index&&(this.index=e.index),this}}]),r}(yu);gu.addKeyword("uv",(function(){return new zu})),gu.addKeyword("uv2",(function(){return new zu(1)}));var Eu=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu,i=arguments.length>1?arguments[1]:void 0;return(0,g.Z)(this,r),(e=t.call(this,"v4")).nodeType="ColorSpace",e.factor=new pu,e.input=n,e.method=null!==i&&void 0!==i?i:r.LINEAR_TO_LINEAR,e.hashProperties=["method"],e}return(0,y.Z)(r,[{key:"generate",value:function(e,t){var n,i=this.input.build(e,"v4"),a=this.getType(e),o=r.Nodes[this.method],s=e.include(o);if(s===r.LINEAR_TO_LINEAR)return e.format(i,a,t);if(2===(null===(n=o.inputs)||void 0===n?void 0:n.length)){var l=this.factor.build(e,"f");return e.format(s+"( "+i+", "+l+" )",a,t)}return e.format(s+"( "+i+" )",a,t)}},{key:"fromEncoding",value:function(e){var t=r.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}},{key:"fromDecoding",value:function(e){var t=r.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.input.copy(e.input),this.method=e.method,this.factor.copy(e.factor),this}}],[{key:"getEncodingComponents",value:function(e){switch(e){case w.LinearEncoding:return["Linear"];case w.sRGBEncoding:return["sRGB"];default:return[]}}}]),r}(yu),Pu=Eu;Pu.Nodes={LinearToLinear:new Ou(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),sRGBToLinear:new Ou(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),LinearTosRGB:new Ou(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n"))},Pu.LINEAR_TO_LINEAR="LinearToLinear",Pu.SRGB_TO_LINEAR="sRGBToLinear",Pu.LINEAR_TO_SRGB="LinearTosRGB";var Nu,Bu=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;return(0,g.Z)(this,r),(e=t.call(this,n,s,o,a,i)).nodeType="Expression",e}return(0,y.Z)(r)}(Ou),Uu=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){return(0,g.Z)(this,r),t.apply(this,arguments)}return(0,y.Z)(r,[{key:"toJSON",value:function(e){var t=(0,o.Z)((0,s.Z)(r.prototype),"toJSON",this).call(this,e),n=void 0===e||"string"==typeof e;if(void 0!==this.image&&!n){var i=this.image;if(Array.isArray(i)){e.images[i.uuid].url=[];for(var a=0;a<i.length;a++)e.images[i.uuid].url[a]=Iu(i[a])}else e.images[i.uuid].url=Iu(i)}return t}}]),r}(w.Texture);function Iu(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?function(e){if(/^data:/i.test(e.src))return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Nu&&(Nu=document.createElement("canvas")),Nu.width=e.width,Nu.height=e.height;var r=Nu.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=Nu}var n=e.src.startsWith("blob:")?e.fileName:e.src;return/\.jpe?g$/i.test(n)?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}(e):(console.warn("THREE.Texture: Unable to serialize Texture."),"")}var Vu=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uu,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;return(0,g.Z)(this,r),(e=t.call(this,"v4",{shared:!0})).nodeType="Texture",e.value=n,e.uv=null!==i&&void 0!==i?i:new zu,e.bias=a,e.project=void 0!==o&&o,e}return(0,y.Z)(r,[{key:"getTexture",value:function(e,t){return(0,o.Z)((0,s.Z)(r.prototype),"generate",this).call(this,e,t,this.value.uuid,"t")}},{key:"generate",value:function(e,t){var r;if("sampler2D"===t)return this.getTexture(e,t);var n,i,a=this.getTexture(e,t),o=this.uv.build(e,this.project?"v4":"v2"),s=this.bias?this.bias.build(e,"f"):void 0;void 0===s&&e.context.bias&&(s=e.context.bias.setTexture(this).build(e,"f")),n=this.project?"texture2DProj":s?"tex2DBias":"tex2D",i=s?n+"( "+a+", "+o+", "+s+" )":n+"( "+a+", "+o+" )";var l={include:e.isShader("vertex"),ignoreCache:!0},u=this.getType(e);return e.addContext(l),this.colorSpace=null!==(r=this.colorSpace)&&void 0!==r?r:new Pu(new Bu("",u)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(i),i=this.colorSpace.build(e,u),e.removeContext(),e.format(i,u,t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),e.value.isRenderTargetTexture?this.value=e.value:this.value.copy(e.value),this.uv.copy(e.uv),e.bias?this.bias?this.bias.copy(e.bias):this.bias=e.bias.clone():this.bias=void 0,e.colorSpace?this.colorSpace?this.colorSpace.copy(e.colorSpace):this.colorSpace=e.colorSpace.clone():this.colorSpace=void 0,this.project=e.project,e.value.isRenderTargetTexture||(this.value.updateMatrix(),this.value.needsUpdate=!0),this}}]),r}(xu),Fu=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this,"f")).nodeType="Float",n.value=null!==e&&void 0!==e?e:0,n}return(0,y.Z)(r,[{key:"generateReadonly",value:function(e,t,r,n,i,a){return e.format(this.value+(this.value%1?"":".0"),n,t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.value=e.value,this}}]),r}(xu),ju=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n){var i;return(0,g.Z)(this,r),(i=t.call(this)).inputs=[],i.nodeType="FunctionCall",i.value=e,i.inputs=null!==n&&void 0!==n?n:[],i}return(0,y.Z)(r,[{key:"getFunction",value:function(){return this.value}},{key:"getType",value:function(e){return this.value.getType(e)}},{key:"generate",value:function(e,t,r,n,i){n=this.getType(e);var a=this.value,o=a.build(e,t)+"( ",s=[];if(a.inputs){for(var l=0;l<a.inputs.length;l++){var u=a.inputs[l],c=this.inputs[l]||this.inputs[u.name];s.push(c.build(e,e.getTypeByFormat(u.type)))}o+=s.join(", ")+" )"}return e.format(o,n,t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.value.copy(e.value),this.inputs=e.inputs.map((function(e){return e.clone()})),this}},{key:"toJSON",value:function(e){var t=this.getJSONNode(e);if(!t){var r,n=this.value;if((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,null!==(r=n.inputs)&&void 0!==r&&r.length){t.inputs={};for(var i=0;i<n.inputs.length;i++){var a=n.inputs[i],o=this.inputs[i];t.inputs[a.name]=o.toJSON(e).uuid}}}return t}}]),r}(yu),Ru=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.ADD;return(0,g.Z)(this,r),(e=t.call(this)).nodeType="Operator",e.type=n.type,e.a=n,e.b=i,e.op=a,e}return(0,y.Z)(r,[{key:"getType",value:function(e){var t=this.a.getType(e),r=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(r)>e.getTypeLength(t)?r:t}},{key:"generate",value:function(e,t){var r=this.getType(e);this.type=r;var n=this.a.build(e,r),i=this.b.build(e,r);return e.format("( "+n+" "+this.op+" "+i+" )",r,t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.a.copy(e.a),this.b.copy(e.b),this.op=e.op,this}}]),r}(yu),Gu=Ru;Gu.ADD="+",Gu.SUB="-",Gu.MUL="*",Gu.DIV="/";var Hu=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.ABS,a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;return(0,g.Z)(this,r),(e=t.call(this)).nodeType="Math",e.a=n,"string"!=typeof i?e.b=i:o=i,"string"!=typeof a?e.c=a:o=a,e.method=o,e.hashProperties=["method"],e}return(0,y.Z)(r,[{key:"getNumInputs",value:function(e){switch(this.method){case r.MIX:case r.CLAMP:case r.REFRACT:case r.SMOOTHSTEP:case r.FACEFORWARD:return 3;case r.MIN:case r.MAX:case r.MOD:case r.STEP:case r.REFLECT:case r.DISTANCE:case r.DOT:case r.CROSS:case r.POW:return 2;default:return 1}}},{key:"getInputType",value:function(e){var t=e.getTypeLength(this.a.getType(e)),r=this.b?e.getTypeLength(this.b.getType(e)):0,n=this.c?e.getTypeLength(this.c.getType(e)):0;return t>r&&t>n?this.a.getType(e):r>n?this.b.getType(e):this.c.getType(e)}},{key:"getType",value:function(e){switch(this.method){case r.LENGTH:case r.DISTANCE:case r.DOT:return"f";case r.CROSS:return"v3"}return this.getInputType(e)}},{key:"generate",value:function(e,t){var n,i,a,o=this.a?e.getTypeLength(this.a.getType(e)):0,s=this.b?e.getTypeLength(this.b.getType(e)):0,l=this.c?e.getTypeLength(this.c.getType(e)):0,u=this.getInputType(e),c=this.getType(e);switch(this.type=c,this.method){case r.NEGATE:return e.format("( -"+this.a.build(e,u)+" )",u,t);case r.INVERT:return e.format("( 1.0 - "+this.a.build(e,u)+" )",u,t);case r.CROSS:n=this.a.build(e,"v3"),i=this.b.build(e,"v3");break;case r.STEP:n=this.a.build(e,1===o?"f":u),i=this.b.build(e,u);break;case r.MIN:case r.MAX:case r.MOD:n=this.a.build(e,u),i=this.b.build(e,1===s?"f":u);break;case r.REFRACT:n=this.a.build(e,u),i=this.b.build(e,u),a=this.c.build(e,"f");break;case r.MIX:n=this.a.build(e,u),i=this.b.build(e,u),a=this.c.build(e,1===l?"f":u);break;default:n=this.a.build(e,u),this.b&&(i=this.b.build(e,u)),this.c&&(a=this.c.build(e,u))}var h=[];h.push(n),i&&h.push(i),a&&h.push(a);var d=this.getNumInputs(e);if(h.length!==d)throw Error('Arguments not match used in "'.concat(this.method,'". Require ').concat(d,", currently ").concat(h.length,"."));return e.format(this.method+"( "+h.join(", ")+" )",c,t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.a.copy(e.a),this.b=e.b instanceof pu?e.b.clone():e.b,this.c=e.c instanceof pu?e.c.clone():e.c,this.method=e.method,this}}]),r}(yu),Wu=Hu;Wu.RAD="radians",Wu.DEG="degrees",Wu.EXP="exp",Wu.EXP2="exp2",Wu.LOG="log",Wu.LOG2="log2",Wu.SQRT="sqrt",Wu.INV_SQRT="inversesqrt",Wu.FLOOR="floor",Wu.CEIL="ceil",Wu.NORMALIZE="normalize",Wu.FRACT="fract",Wu.SATURATE="saturate",Wu.SIN="sin",Wu.COS="cos",Wu.TAN="tan",Wu.ASIN="asin",Wu.ACOS="acos",Wu.ARCTAN="atan",Wu.ABS="abs",Wu.SIGN="sign",Wu.LENGTH="length",Wu.NEGATE="negate",Wu.INVERT="invert",Wu.MIN="min",Wu.MAX="max",Wu.MOD="mod",Wu.STEP="step",Wu.REFLECT="reflect",Wu.DISTANCE="distance",Wu.DOT="dot",Wu.CROSS="cross",Wu.POW="pow",Wu.MIX="mix",Wu.CLAMP="clamp",Wu.REFRACT="refract",Wu.SMOOTHSTEP="smoothstep",Wu.FACEFORWARD="faceforward";var qu=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new pu;return(0,g.Z)(this,r),(e=t.call(this,"v4")).nodeType="TextureCubeUV",e.value=n,e.uv=i,e.bias=a,e}return(0,y.Z)(r,[{key:"bilinearCubeUV",value:function(e,t,n,i){var a,o,s,l,u=new ju(r.Nodes.bilinearCubeUV,[t,n,i]);this.colorSpaceTL=null!==(a=this.colorSpaceTL)&&void 0!==a?a:new Pu(new Bu("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(u.build(e)+".tl"),this.colorSpaceTR=null!==(o=this.colorSpaceTR)&&void 0!==o?o:new Pu(new Bu("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(u.build(e)+".tr"),this.colorSpaceBL=null!==(s=this.colorSpaceBL)&&void 0!==s?s:new Pu(new Bu("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(u.build(e)+".bl"),this.colorSpaceBR=null!==(l=this.colorSpaceBR)&&void 0!==l?l:new Pu(new Bu("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(u.build(e)+".br");var c={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(c),this.colorSpaceTLExp=new Bu(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new Bu(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new Bu(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new Bu(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();var h=new Bu("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return h.keywords.cubeUV_TL=this.colorSpaceTLExp,h.keywords.cubeUV_TR=this.colorSpaceTRExp,h.keywords.cubeUV_BL=this.colorSpaceBLExp,h.keywords.cubeUV_BR=this.colorSpaceBRExp,h.keywords.cubeUV=u,h}},{key:"generate",value:function(e,t){if(e.isShader("fragment")){var n=this.uv,i=this.bias||e.context.roughness,a=new ju(r.Nodes.roughnessToMip,[i]),o=new Wu(a,r.Nodes.m0,r.Nodes.cubeUV_maxMipLevel,Wu.CLAMP),s=new Wu(o,Wu.FLOOR),l=new Wu(o,Wu.FRACT),u=this.bilinearCubeUV(e,this.value,n,s),c=this.bilinearCubeUV(e,this.value,n,new Gu(s,new Fu(1).setReadonly(!0),Gu.ADD)),h=new Wu(u,c,l,Wu.MIX);return e.format(h.build(e),"v4",t)}return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.uv.copy(e.uv),this.bias.copy(e.bias),this.value.copy(e.value),e.colorSpaceTL?this.colorSpaceTL?this.colorSpaceTL.copy(e.colorSpaceTL):this.colorSpaceTL=e.colorSpaceTL.clone():this.colorSpaceTL=void 0,e.colorSpaceTR?this.colorSpaceTR?this.colorSpaceTR.copy(e.colorSpaceTR):this.colorSpaceTR=e.colorSpaceTR.clone():this.colorSpaceTR=void 0,e.colorSpaceBL?this.colorSpaceBL?this.colorSpaceBL.copy(e.colorSpaceBL):this.colorSpaceBL=e.colorSpaceBL.clone():this.colorSpaceBL=void 0,e.colorSpaceBR?this.colorSpaceBR?this.colorSpaceBR.copy(e.colorSpaceBR):this.colorSpaceBR=e.colorSpaceBR.clone():this.colorSpaceBR=void 0,e.colorSpaceTLExp?this.colorSpaceTLExp?this.colorSpaceTLExp.copy(e.colorSpaceTLExp):this.colorSpaceTLExp=e.colorSpaceTLExp.clone():this.colorSpaceTLExp=void 0,e.colorSpaceTRExp?this.colorSpaceTRExp?this.colorSpaceTRExp.copy(e.colorSpaceTRExp):this.colorSpaceTRExp=e.colorSpaceTRExp.clone():this.colorSpaceTRExp=void 0,e.colorSpaceBLExp?this.colorSpaceBLExp?this.colorSpaceBLExp.copy(e.colorSpaceBLExp):this.colorSpaceBLExp=e.colorSpaceBLExp.clone():this.colorSpaceBLExp=void 0,e.colorSpaceBRExp?this.colorSpaceBRExp?this.colorSpaceBRExp.copy(e.colorSpaceBRExp):this.colorSpaceBRExp=e.colorSpaceBRExp.clone():this.colorSpaceBRExp=void 0,this}}]),r}(yu),Ju=qu;Ju.Nodes=function(){var e=new Tu("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),t=new Au("float cubeUV_maxMipLevel 8.0",!0),r=new Au("float cubeUV_minMipLevel 4.0",!0),n=new Au("float cubeUV_maxTileSize 256.0",!0),i=new Au("float cubeUV_minTileSize 16.0",!0),a=new Ou("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");a.useKeywords=!1;var o=new Ou("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");o.useKeywords=!1;var s=new Ou("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[e,a,o,t,r,n,i]);s.useKeywords=!1;var l=new Au("float r0 1.0",!0),u=new Au("float v0 0.339",!0),c=new Au("float m0 -2.0",!0),h=new Au("float r1 0.8",!0),d=new Au("float v1 0.276",!0),f=new Au("float m1 -1.0",!0),v=new Au("float r4 0.4",!0),p=new Au("float v4 0.046",!0),m=new Au("float m4 2.0",!0),g=new Au("float r5 0.305",!0),y=new Au("float v5 0.016",!0),x=new Au("float m5 3.0",!0),b=new Au("float r6 0.21",!0),w=new Au("float v6 0.0038",!0),S=new Au("float m6 4.0",!0);return{bilinearCubeUV:s,roughnessToMip:new Ou("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[l,u,c,h,d,f,v,p,m,g,y,x,b,w,S]),m0:c,cubeUV_maxMipLevel:t}}();var Yu=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this,"v3")).nodeType="Normal",n.scope=null!==e&&void 0!==e?e:r.VIEW,n}return(0,y.Z)(r,[{key:"getShared",value:function(){return this.scope===r.WORLD}},{key:"build",value:function(e,t,n,i){var a=e.context[this.scope+"Normal"];return a?a.build(e,t,n,i):(0,o.Z)((0,s.Z)(r.prototype),"build",this).call(this,e,t,n)}},{key:"generate",value:function(e,t,n,i,a){var o;switch(this.scope){case r.VIEW:o=e.isShader("vertex")?"transformedNormal":"geometryNormal";break;case r.LOCAL:e.isShader("vertex")?o="objectNormal":(e.requires.normal=!0,o="vObjectNormal");break;case r.WORLD:e.isShader("vertex")?o="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,o="vWNormal")}return e.format(o,this.getType(e),t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.scope=e.scope,this}},{key:"toJSON",value:function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t.nodeType=this.nodeType,t}},{key:"fromJSON",value:function(e,t){return(0,o.Z)((0,s.Z)(r.prototype),"fromJSON",this).call(this,e,t),e.scope&&(this.scope=e.scope),this}}]),r}(yu),Xu=Yu;Xu.LOCAL="local",Xu.WORLD="world",Xu.VIEW="view",Xu.NORMAL="normal",gu.addKeyword("viewNormal",(function(){return new Xu(Xu.VIEW)})),gu.addKeyword("localNormal",(function(){return new Xu(Xu.NORMAL)})),gu.addKeyword("worldNormal",(function(){return new Xu(Xu.WORLD)}));var Ku=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this,"v3")).nodeType="Position",n.scope=null!==e&&void 0!==e?e:r.LOCAL,n}return(0,y.Z)(r,[{key:"getType",value:function(){return this.scope===r.PROJECTION?"v4":this.type}},{key:"getShader",value:function(){switch(this.scope){case r.LOCAL:case r.WORLD:return!1}return!0}},{key:"generate",value:function(e,t,n,i,a){var o;switch(this.scope){case r.LOCAL:e.isShader("vertex")?o="transformed":(e.requires.position=!0,o="vPosition");break;case r.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,o="vWPosition";break;case r.VIEW:o=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case r.PROJECTION:o=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return e.format(o,this.getType(),t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.scope=e.scope,this}},{key:"toJSON",value:function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t.nodeType=this.nodeType,t}},{key:"fromJSON",value:function(e,t){return(0,o.Z)((0,s.Z)(r.prototype),"fromJSON",this).call(this,e,t),e.scope&&(this.scope=e.scope),this}}]),r}(yu),Qu=Ku;Qu.LOCAL="local",Qu.WORLD="world",Qu.VIEW="view",Qu.PROJECTION="projection",gu.addKeyword("position",(function(){return new Qu})),gu.addKeyword("worldPosition",(function(){return new Qu(Qu.WORLD)})),gu.addKeyword("viewPosition",(function(){return new Qu(Qu.VIEW)}));var $u=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this,"v3")).nodeType="Reflect",n.scope=null!==e&&void 0!==e?e:r.CUBE,n}return(0,y.Z)(r,[{key:"getUnique",value:function(e){return!e.context.viewNormal}},{key:"getType",value:function(){return this.scope===r.SPHERE?"v2":this.type}},{key:"generate",value:function(e,t){var n=this.getUnique(e);if(e.isShader("fragment")){var i;switch(this.scope){case r.VECTOR:var a=new Xu(Xu.VIEW),o=e.context.roughness,s=a.build(e,"v3"),l=new Qu(Qu.VIEW).build(e,"v3"),u=o?o.build(e,"f"):void 0,c="reflect( -normalize( ".concat(l," ), ").concat(s," )");u&&(c="normalize( mix( ".concat(c,", ").concat(s,", ").concat(u," * ").concat(u," ) )"));var h="inverseTransformDirection( ".concat(c,", viewMatrix )");n?(e.addNodeCode("vec3 reflectVec = ".concat(h,";")),i="reflectVec"):i=h;break;case r.CUBE:var d=new r(r.VECTOR).build(e,"v3"),f="vec3( -"+d+".x, "+d+".yz )";n?(e.addNodeCode("vec3 reflectCubeVec = ".concat(f,";")),i="reflectCubeVec"):i=f;break;case r.SPHERE:var v="normalize( ( viewMatrix * vec4( "+new r(r.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";n?(e.addNodeCode("vec2 reflectSphereVec = ".concat(v,";")),i="reflectSphereVec"):i=v}return e.format(i,this.getType(),t)}return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.scope=e.scope,this}},{key:"toJSON",value:function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t.nodeType=this.nodeType,t}},{key:"fromJSON",value:function(e,t){return(0,o.Z)((0,s.Z)(r.prototype),"fromJSON",this).call(this,e,t),e.scope&&(this.scope=e.scope),this}}]),r}(yu),ec=$u;ec.CUBE="cube",ec.SPHERE="sphere",ec.VECTOR="vector";var tc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vu,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return(0,g.Z)(this,r),(e=t.call(this,"v4")).nodeType="TextureCube",e.value=n,e.radianceNode=new Ju(e.value,null!==i&&void 0!==i?i:new ec(ec.VECTOR),a),e.irradianceNode=new Ju(e.value,new Xu(Xu.WORLD),new Fu(1).setReadonly(!0)),e}return(0,y.Z)(r,[{key:"generate",value:function(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),("irradiance"===e.slot?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.value.copy(e.value),this.radianceNode.copy(e.radianceNode),this.irradianceNode.copy(e.irradianceNode),this}}]),r}(yu),rc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w.CubeTexture,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return(0,g.Z)(this,r),(e=t.call(this,"v4",{shared:!0})).nodeType="CubeTexture",e.value=n,e.uv=null!==i&&void 0!==i?i:new ec,e.bias=a,e}return(0,y.Z)(r,[{key:"getTexture",value:function(e,t){return(0,o.Z)((0,s.Z)(r.prototype),"generate",this).call(this,e,t,this.value.uuid,"tc")}},{key:"generate",value:function(e,t){var r,n;if("samplerCube"===t)return this.getTexture(e,t);var i,a=this.getTexture(e,t),o=null===(r=this.uv)||void 0===r?void 0:r.build(e,"v3"),s=this.bias?this.bias.build(e,"f"):void 0;void 0===s&&e.context.bias&&(s=e.context.bias.setTexture(this).build(e,"f")),i=s?"texCubeBias( "+a+", "+o+", "+s+" )":"texCube( "+a+", "+o+" )";var l={include:e.isShader("vertex"),ignoreCache:!0},u=this.getType(e);return e.addContext(l),this.colorSpace=null!==(n=this.colorSpace)&&void 0!==n?n:new Pu(new Bu("",u)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(i),i=this.colorSpace.build(e,u),e.removeContext(),e.format(i,u,t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.value.copy(e.value),e.uv?this.uv?this.uv.copy(e.uv):this.uv=e.uv.clone():this.uv=void 0,e.bias?this.bias?this.bias.copy(e.bias):this.bias=e.bias.clone():this.bias=void 0,this}}]),r}(xu),nc=["x","y","z","w"],ic=["float","vec2","vec3","vec4"],ac={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},oc={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},sc=function(){function e(){(0,g.Z)(this,e),this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.getIncludesCode=function(){function e(e,t){return e.deps.length-t.deps.length}return function(t,r){var n=this.getIncludes(t,r);if(!n)return"";var i="";n=n.sort(e);for(var a=0;a<n.length;a++)n[a].src&&(i+=n[a].src+"\n");return i}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.requires={uv:[],color:[],lights:!1,fog:!1,transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","\n\t\t\t// NOTE: Include Spline's blending modes. This could be part of BlendNode\n\t\t\t#define SPE_BLENDING_NORMAL 0\n\t\t\t#define SPE_BLENDING_MULTIPLY 1\n\t\t\t#define SPE_BLENDING_SCREEN 2\n\t\t\t#define SPE_BLENDING_OVERLAY 3\n\n\t\t\tvec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, a * b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );\n\t\t\t\treturn mix( a, tmp, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );\n\t\t\t\treturn clamp( mix( a, tmp, alpha ), 0.0, 1.0 );\n\t\t\t}\n\n\t\t\tvec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {\n\t\t\t\tif ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );\n\t\t\t\treturn vec3( 1.0 );\n\t\t\t}\n\t\t\t","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join("\n"),fragment:["float accumAlpha = 0.0;","void accumulateAlpha(float alpha) {\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * alpha;\n\t\t\t\t}",""].join("\n")},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}return(0,y.Z)(e,[{key:"build",value:function(e,t){this.buildShader("vertex",e),this.buildShader("fragment",t);for(var r=0;r<this.requires.uv.length;r++)if(this.requires.uv[r]){var n=r>0?r+1:"";this.addVaryCode("varying vec2 vUv"+n+";"),r>0&&this.addVertexParsCode("attribute vec2 uv"+n+";"),this.addVertexFinalCode("vUv"+n+" = uv"+n+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this}},{key:"buildShader",value:function(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}},{key:"setMaterial",value:function(e,t){return this.material=e,this.renderer=t,this.requires.lights=e.lights,this.requires.fog=e.fog,this.mergeDefines(e.defines),this}},{key:"addFlow",value:function(e,t,r){return this.addSlot(e).addCache(t).addContext(r)}},{key:"removeFlow",value:function(){return this.removeSlot().removeCache().removeContext()}},{key:"addCache",value:function(e){return this.cache=null!==e&&void 0!==e?e:"",this.caches.push(this.cache),this}},{key:"removeCache",value:function(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}},{key:"addContext",value:function(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}},{key:"removeContext",value:function(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}},{key:"addSlot",value:function(e){return this.slot=e||"",this.slots.push(this.slot),this}},{key:"removeSlot",value:function(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}},{key:"addFragmentVariable",value:function(e,t){void 0===this.fragmentVariables[e]&&(this.addFragmentCode("".concat(t," ").concat(e,";")),this.fragmentVariables[e]="")}},{key:"addVertexCode",value:function(e){this.addCode(e,"vertex")}},{key:"addFragmentCode",value:function(e){this.addCode(e,"fragment")}},{key:"addCode",value:function(e,t){this.code[null!==t&&void 0!==t?t:this.shader]+=e+"\n"}},{key:"addVertexNodeCode",value:function(e){this.addNodeCode(e,"vertex")}},{key:"addFragmentNodeCode",value:function(e){this.addNodeCode(e,"fragment")}},{key:"addNodeCode",value:function(e,t){this.nodeCode[null!==t&&void 0!==t?t:this.shader]+=e+"\n"}},{key:"clearNodeCode",value:function(e){var t;e=null!==(t=e)&&void 0!==t?t:this.shader;var r=this.nodeCode[e];return this.nodeCode[e]="",r}},{key:"clearVertexNodeCode",value:function(){return this.clearNodeCode("vertex")}},{key:"clearFragmentNodeCode",value:function(){return this.clearNodeCode("fragment")}},{key:"addVertexFinalCode",value:function(e){this.addFinalCode(e,"vertex")}},{key:"addFragmentFinalCode",value:function(e){this.addFinalCode(e,"fragment")}},{key:"addFinalCode",value:function(e,t){this.finalCode[null!==t&&void 0!==t?t:this.shader]+=e+"\n"}},{key:"addVertexParsCode",value:function(e){this.addParsCode(e,"vertex")}},{key:"addFragmentParsCode",value:function(e){this.addParsCode(e,"fragment")}},{key:"addParsCode",value:function(e,t){this.parsCode[null!==t&&void 0!==t?t:this.shader]+=e+"\n"}},{key:"addVaryCode",value:function(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}},{key:"isCache",value:function(e){return-1!==this.caches.indexOf(e)}},{key:"isSlot",value:function(e){return-1!==this.slots.indexOf(e)}},{key:"define",value:function(e,t){this.defines[e]=void 0===t?1:t}},{key:"require",value:function(e){this.requires[e]=!0}},{key:"isDefined",value:function(e){return void 0!==this.defines[e]}},{key:"getVar",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"varying",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"V",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",o=this.getVars(n),s=o[e];if(!s){var l=o.length;s={name:r||"node"+i+l+(a?"_"+a:""),type:t},o.push(s),o[e]=s}return s}},{key:"getTempVar",value:function(e,t,r,n){return this.getVar(e,t,r,this.shader,"T",n)}},{key:"getAttribute",value:function(e,t){if(!this.attributes[e]){var r=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(r.name+" = "+e+";"),this.attributes[e]={varying:r,name:e,type:t}}return this.attributes[e]}},{key:"getCode",value:function(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join("\n")}},{key:"getVarListCode",value:function(e,t){var r;t=null!==(r=t)&&void 0!==r?r:"";for(var n="",i=0,a=e.length;i<a;++i){var o=e[i],s=o.type,l=o.name,u=o.size,c=this.getFormatByType(s);if(void 0===c)throw new Error("Node pars "+c+" not found.");c.includes("[]")?n+=t+" "+c.substring(0,c.length-2)+" "+l+"[".concat(u,"];\n"):n+=t+" "+c+" "+l+";\n"}return n}},{key:"getVars",value:function(e){return this.inputs.vars[null!==e&&void 0!==e?e:this.shader]}},{key:"getNodeData",value:function(e){var t=e instanceof pu?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}},{key:"createUniform",value:function(e,t,r,n,i,a){if(t.includes("[]")){var o=this.inputs.arrayUniforms,s=o.list.length,l=new vu({type:t,size:r.size,name:n||"nodeUA"+s+(a?"_"+a:""),node:r,needsUpdate:i});return o.list.push(l),o[e].push(l),o[e][l.name]=l,this.uniforms[l.name]=l,l}var u=this.inputs.uniforms,c=u.list.length,h=new vu({type:t,name:n||"nodeU"+c+(a?"_"+a:""),node:r,needsUpdate:i});return u.list.push(h),u[e].push(h),u[e][h.name]=h,this.uniforms[h.name]=h,h}},{key:"createVertexUniform",value:function(e,t,r,n,i){return this.createUniform("vertex",e,t,r,n,i)}},{key:"createFragmentUniform",value:function(e,t,r,n,i){return this.createUniform("fragment",e,t,r,n,i)}},{key:"include",value:function(e,t,r){var n;if(e="string"==typeof e?gu.get(e):e,!1===this.context.include)return e.name;e instanceof Ou?n=this.includes.functions:e instanceof Au?n=this.includes.consts:e instanceof Tu&&(n=this.includes.structs);var i=n[this.shader]=n[this.shader]||[];if(e){var a,o=i[e.name];if(o||(o=i[e.name]={node:e,deps:[]},i.push(o),o.src=e.build(this,"source")),e instanceof Ou&&t&&i[t.name]&&-1===i[t.name].deps.indexOf(e)&&(i[t.name].deps.push(e),null!==(a=e.includes)&&void 0!==a&&a.length)){var s=0;do{this.include(e.includes[s++],t)}while(s<e.includes.length)}return r&&(o.src=r),e.name}throw new Error("Include not found.")}},{key:"colorToVectorProperties",value:function(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}},{key:"colorToVector",value:function(e){return e.replace(/c/g,"v3")}},{key:"getIncludes",value:function(e,t){return this.includes[e][t||this.shader]}},{key:"getConstructorFromLength",value:function(e){return ic[e-1]}},{key:"isTypeMatrix",value:function(e){return/^m/.test(e)}},{key:"getTypeLength",value:function(e){return"f"===e?1:parseInt(this.colorToVector(e).substr(1))}},{key:"getTypeFromLength",value:function(e){return 1===e?"f":"v"+e}},{key:"findNode",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0;n<arguments.length;n++){var i=t[n];if(null!==i&&void 0!==i&&i.isNode)return i}}},{key:"resolve",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0;n<arguments.length;n++){var i=t[n];if(void 0!==i){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case w.CubeReflectionMapping:case w.CubeRefractionMapping:return new rc(i);case w.CubeUVReflectionMapping:return new tc(new Vu(i));default:return new Vu(i)}else{if(i.isVector2)return new bu(i);if(i.isVector3)return new wu(i);if(i.isVector4)return new ku(i)}}}}},{key:"format",value:function(e,t,r){switch(this.colorToVector(r+" <- "+t)){case"f <- v2":case"f <- v3":case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}},{key:"getTypeByFormat",value:function(e){return ac[e]||e}},{key:"getFormatByType",value:function(e){return oc[e]||e}},{key:"getUUID",value:function(e,t){return(t=void 0===t||t)&&this.cache&&(e=this.cache+"-"+e),e}},{key:"getElementByIndex",value:function(e){return nc[e]}},{key:"getIndexByElement",value:function(e){return nc.indexOf(e)}},{key:"isShader",value:function(e){return this.shader===e}},{key:"setShader",value:function(e){return this.shader=e,this}},{key:"mergeDefines",value:function(e){for(var t in e)this.defines[t]=e[t];return this.defines}},{key:"mergeUniform",value:function(e){for(var t in e)this.uniforms[t]=e[t];return this.uniforms}},{key:"getTextureEncodingFromMap",value:function(e){var t;return e?e.isTexture&&(t=e.encoding):t=w.LinearEncoding,t===w.LinearEncoding&&this.context.gamma&&(t=w.sRGBEncoding),t}}]),e}(),lc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu;return(0,g.Z)(this,r),(e=t.call(this,"v4")).nodeType="Raw",e.value=n,e}return(0,y.Z)(r,[{key:"generate",value:function(e){var t=this.value.analyzeAndFlow(e,this.type),r=t.code+"\n";return e.isShader("vertex")?r+="gl_Position = "+t.result+";":r+="gl_FragColor = "+t.result+";",r}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.value.copy(e.value),this}}]),r}(pu),uc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;return(0,g.Z)(this,r),(e=t.call(this,"c")).nodeType="Color",e.value=n instanceof Su?n:new Su(n||0,i,a,o),e}return(0,y.Z)(r,[{key:"setRGBA",value:function(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}},{key:"generate",value:function(e,t,r,n,i,a){var o,s;r=e.getUUID(null!==(o=r)&&void 0!==o?o:this.getUUID()),n=null!==(s=n)&&void 0!==s?s:this.getType(e);var l=e.getNodeData(r),u=this.getReadonly()&&void 0!==this.generateReadonly;if(this.alpha){var c=this.alpha.build(e,"f");e.addFragmentNodeCode("accumAlpha += ( 1.0 - accumAlpha ) * ".concat(c,";"))}return u?this.generateReadonly(e,t,r,n,i,a):e.isShader("vertex")?(l.vertex||(l.vertex=e.createVertexUniform(n,this,i,a,this.getLabel())),e.format(l.vertex.name,n,t)):(l.fragment||(l.fragment=e.createFragmentUniform(n,this,i,a,this.getLabel())),e.format(l.fragment.name,n,t))}},{key:"generateReadonly",value:function(e,t,r,n,i,a){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",n,t)}}]),r}(xu),cc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this,"i")).nodeType="Int",n.value=Math.floor(null!==e&&void 0!==e?e:0),n}return(0,y.Z)(r,[{key:"generateReadonly",value:function(e,t,r,n,i,a){return e.format(this.value.toString(),n,t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.value=e.value,this}}]),r}(xu),hc=function(){function e(t,r,n,i){if((0,g.Z)(this,e),this.next=void 0,this.uniforms={},this.textures={},this.defines={},this.id=t,this.uuid=r,n){for(var a in this.type=n.type,n)"type"!==a&&"calpha"!==a&&(this.uniforms["f".concat(this.id,"_").concat(a)]=n[a]);for(var o in i)this.defines[o]=i[o]}}return(0,y.Z)(e,[{key:"copy",value:function(e){for(var t in this.id=e.id,this.type=e.type,this.defines=(0,x.Z)({},e.defines),e.uniforms)"transmissionSamplerMap"===this.getName(t)||"transmissionDepthMap"===this.getName(t)||(this.uniforms[t]?this.uniforms[t].copy(e.uniforms[t]):this.uniforms[t]=e.uniforms[t].clone());return this}},{key:"clone",value:function(){return new e(this.id).copy(this)}},{key:"fromJSON",value:function(e,t){for(var r in this.id=e.id,this.defines=(0,x.Z)({},e.defines),e.uniforms)this.uniforms[r]=t.getNode(e.uniforms[r]);if("texture"===e.type){if(!("f".concat(this.id,"_textureSize")in this.uniforms)){var n=this.uniforms["f".concat(this.id,"_texture")].value.image;this.uniforms["f".concat(e.id,"_textureSize")]=new wu(n.width,n.height)}"f".concat(this.id,"_size")in this.uniforms||(this.uniforms["f".concat(e.id,"_size")]=new bu(200,200)),"f".concat(e.id,"_axis")in this.uniforms||(this.uniforms["f".concat(e.id,"_axis")]=new cc(0)),"f".concat(e.id,"_side")in this.uniforms||(this.uniforms["f".concat(e.id,"_side")]=new cc(0)),"f".concat(e.id,"_projection")in this.uniforms||(this.uniforms["f".concat(e.id,"_projection")]=new cc(0))}else"noise"===e.type?("f".concat(e.id,"_noiseType")in this.uniforms||(this.uniforms["f".concat(e.id,"_noiseType")]=new cc(0)),"f".concat(e.id,"_size")in this.uniforms||(this.uniforms["f".concat(e.id,"_size")]=new wu(-1,-1,-1))):"depth"===e.type&&("f".concat(e.id,"_isWorldSpace")in this.uniforms||(this.uniforms["f".concat(e.id,"_isWorldSpace")]=new Fu(1)));return this}},{key:"toJSON",value:function(e){var t={};for(var r in this.uniforms)t[r]=this.uniforms[r].toJSON(e).uuid;return{id:this.id,type:this.type,defines:JSON.parse(JSON.stringify(this.defines)),uniforms:t,next:null==this.next?void 0:this.next.toJSON(e)}}},{key:"copyUniforms",value:function(e){for(var t in this.uniforms){var r=this.getName(t);void 0!==r&&e.uniforms["f".concat(e.id,"_").concat(r)]&&"transmissionDepthMap"!==r&&"transmissionSamplerMap"!==r&&this.uniforms[t].copy(e.uniforms["f".concat(e.id,"_").concat(r)])}return this}},{key:"hasValueByKey",value:function(e){return void 0!==this.uniforms[e]}},{key:"hasValue",value:function(e){return this.hasValueByKey("f".concat(this.id,"_").concat(e))}},{key:"setValue",value:function(e,t){var r="f".concat(this.id,"_").concat(e);this.hasValueByKey(r)&&void 0!==t&&(this.uniforms[r].value=t)}},{key:"getValue",value:function(e){var t="f".concat(this.id,"_").concat(e);if(this.hasValueByKey(t))return this.uniforms[t].value}},{key:"getValues",value:function(){var e={type:this.type};for(var t in this.uniforms){var r=this.getName(t);if(void 0!==r){var n=this.uniforms["f".concat(this.id,"_").concat(r)].value;void 0!==n&&(Array.isArray(n)?e[r]=n.map((function(e){return e.clone?e.clone():e})):e[r]=n.clone?n.clone():n)}}return e}},{key:"getName",value:function(e){var t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log("Layer.getName: error ".concat(e))}},{key:"getNames",value:function(){var e=[];for(var t in this.uniforms){var r=this.getName(t);r&&e.push(r)}return e}},{key:"isEqual",value:function(e){for(var t in e.uniforms){var r=e.getName(t);if(!r)return!1;var n=this.getValue(r),i=e.uniforms[t].value;if(i.value instanceof w.Texture){if(n.image!==i.image)return!1}else if(Array.isArray(i)){for(var a=n,o=0,s=a.length;o<s;++o)if(a[o]!==i[o])return!1}else{var l=n;if(l.equals){if(!l.equals(i))return!1}else if(n!==i)return!1}}return!0}},{key:"dispose",value:function(){}}]),e}();function dc(e){var t=e instanceof hc?e.type:e;return"texture"===t||"displace_map"===t||"matcap"===t}var fc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this,"b")).nodeType="Bool",n.value=null!==e&&void 0!==e&&e,n}return(0,y.Z)(r,[{key:"generateReadonly",value:function(e,t,r,n){return e.format(this.value?"true":"false",n,t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.value=e.value,this}}]),r}(xu),vc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1?arguments[1]:void 0;return(0,g.Z)(this,r),(e=t.call(this,"v4[]")).nodeType="Vector4Array",e.size=n,e.value=Array.isArray(i)?i:i instanceof w.Vector4?new Array(n).fill(i):new Array(n).fill(new w.Vector4(0)),e}return(0,y.Z)(r,[{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.value=e.value.map((function(e){return e.clone()})),this}}]),r}(xu),pc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1?arguments[1]:void 0;return(0,g.Z)(this,r),(e=t.call(this,"f[]")).nodeType="FloatArray",e.size=n,e.value=Array.isArray(i)?i:"number"==typeof i?new Array(n).fill(i):new Array(n).fill(0),e}return(0,y.Z)(r,[{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.size=e.size,this.value=(0,c.Z)(e.value),this}}]),r}(xu),mc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this,"m3")).nodeType="Matrix3",n.value=null!==e&&void 0!==e?e:new w.Matrix3,n}return(0,y.Z)(r,[{key:"generateReadonly",value:function(e,t,r,n,i,a){return e.format("mat3("+this.value.elements.join(", ")+")",n,t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.elements=e.elements,this}},{key:"elements",get:function(){return this.value.elements},set:function(e){this.value.fromArray(e)}}]),r}(xu),gc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vu,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,h=arguments.length>8?arguments[8]:void 0;return(0,g.Z)(this,r),(e=t.call(this,"v3")).nodeType="CustomTexture",e.firstTime=!0,e.texture=n,e.textureSize=i,e.crop=a,e.projection=o,e.axis=s,e.side=l,e.size=u,e.mat=new mc(e.texture.value.matrix),e.alpha=c,e.mode=h,e.calpha="g".concat(e.uuid.toString().replace(/-/g,""),"_calpha"),e}return(0,y.Z)(r,[{key:"generate",value:function(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;var n,i="g".concat(this.uuid.toString().replace(/-/g,""));switch(this.projection.value){case 3:n=e.include(r.Nodes.cylindrical);break;case 2:n=e.include(r.Nodes.spherical);break;case 1:var a=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],o=new Ou("\n\t\tvec3 ".concat(i,"_planarTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {\n\n\t\t\t\tvec2 uvs = ( mat * vec3( (").concat(i,"_vCustomUv * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\t").concat(0===this.side.value?"":"lalpha *= step(0.0, ".concat(2===this.side.value?"-1.0 * ":"","dot(vObjectNormal, mat * ").concat(a,"));"),"\n\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\treturn col;\n\t\t\t}"));n=e.include(o);break;default:n=e.include(r.Nodes.uv)}if(1===this.projection.value&&this.firstTime){e.addVertexParsCode("varying vec2 ".concat(i,"_vCustomUv;")),e.addFragmentParsCode("varying vec2 ".concat(i,"_vCustomUv;"));var s=["zy","xz","xy"][this.axis.value];e.addVertexFinalCode("".concat(i,"_vCustomUv = (1. + (transformed.").concat(s,")) / 2.;"))}e.addFragmentVariable(this.calpha,"float");var l=[];return l.push(this.texture.getTexture(e,"t")),l.push(this.textureSize.build(e,"v2")),l.push(this.crop.build(e,"f")),l.push(this.mat.build(e,"mat3")),l.push(this.size.build(e,"v2")),l.push(this.alpha.build(e,"f")),l.push(this.mode.build(e,"i")),l.push(this.calpha),this.firstTime=!this.firstTime,e.format(n+"("+l.join(",")+")",this.getType(e),t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.texture.copy(e.texture),this.textureSize=e.textureSize.clone(),this.crop=e.crop.clone(),this.projection=e.projection.clone(),this.axis=e.axis.clone(),this.size=e.size.clone(),this.alpha=e.alpha.clone(),this.mode=e.mode.clone(),this}}]),r}(yu),yc=gc;yc.Nodes={cylindrical:new Ou("\nvec3 cylindricalTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {\n                vec3 posN = normalize(position);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float scaledHeight = position.y / (size.y * 0.5);\n                float v =  (scaledHeight / 2.) + .5;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\treturn col;\n\t\t\t}\n"),spherical:new Ou("\nvec3 sphericalTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {\n                vec3 posN = normalize(vPosition);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float v = 0.5 + asin(posN.y) / 3.1415;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\treturn col;\n\t\t\t}\n"),uv:new Ou("vec3 uvTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {\n\n\t\t\t\tvec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\treturn col;\n\t\t\t}")};var xc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i,a,o,s,l){var u;return(0,g.Z)(this,r),(u=t.call(this,"v3")).nodeType="Fresnel",u.color=e,u.bias=n,u.scale=i,u.intensity=a,u.factor=o,u.alpha=s,u.mode=l,u.calpha="g".concat(u.uuid.toString().replace(/-/g,""),"_calpha"),u}return(0,y.Z)(r,[{key:"generate",value:function(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");var n=e.include(r.Nodes.fresnel),i=[];return i.push(this.color.build(e,"c")),i.push(this.bias.build(e,"f")),i.push(this.scale.build(e,"f")),i.push(this.intensity.build(e,"f")),i.push(this.factor.build(e,"f")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),i.push(this.calpha),e.format(n+"("+i.join(",")+")",this.getType(e),t)}return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.color=e.color.clone(),this.bias=e.bias.clone(),this.scale=e.scale.clone(),this.intensity=e.intensity.clone(),this.factor=e.factor.clone(),this.alpha=e.alpha.clone(),this.mode=e.mode.clone(),this.calpha=e.calpha,this}}]),r}(yu),bc=xc;bc.Nodes={fresnel:new Ou("vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, float alpha, int mode, out float calpha) {\n\t\t\t\tfloat fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );\n\n\t\t\t\tfloat lalpha = clamp( fresnel, 0.0, 1.0 ) * alpha;\n\t\t\t\tcalpha = lalpha / clamp(lalpha + accumAlpha, 0.001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\t\t\t\treturn color;\n\t\t\t}")};var wc,Sc=((wc=Sc||{}).SIMPLEX="simplex3d",wc.SIMPLEX_FRACTAL="simplex3dFractal",wc.ASHIMA="simplexAshima",wc.FBM="fbm",wc.PERLIN="perlin",wc),kc=function(){var e=new Ou("vec3 random3(vec3 c) {\n\t\t\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n\t\t\tvec3 r;\n\t\t\tr.z = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.x = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.y = fract(512.0*j);\n\t\t\treturn r-0.5;\n\t\t}"),t=new Ou("float simplex3d(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t \n\t\t\t vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t vec3 x1 = x - i1 + G3;\n\t\t\t vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(s), x);\n\t\t\t d.y = dot(random3(s + i1), x1);\n\t\t\t d.z = dot(random3(s + i2), x2);\n\t\t\t d.w = dot(random3(s + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}",[e]);t.keywords.F3=new Au("float F3 0.3333333"),t.keywords.G3=new Au("float G3 0.1666667");var r=new Ou("float simplex3dFractal(vec3 m) {\n\t\t\tmat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);\n\t\t\tmat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);\n\t\t\tmat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);\n\t\t\treturn 0.5333333 * simplex3d(m * rot1)\n\t\t\t\t + 0.2666667 * simplex3d(2.0 * m * rot2)\n\t\t\t\t + 0.1333333 * simplex3d(4.0 * m * rot3)\n\t\t\t\t + 0.0666667 * simplex3d(8.0 * m);\n\t\t}",[t]),n=new Ou("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),i=new Ou("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new Ou("float simplexAshima(vec3 v) {\n\t\t  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\t\t  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\t  vec3 i  = floor(v + dot(v, C.yyy) );\n\t\t  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\t\t  vec3 g = step(x0.yzx, x0.xyz);\n\t\t  vec3 l = 1.0 - g;\n\t\t  vec3 i1 = min( g.xyz, l.zxy );\n\t\t  vec3 i2 = max( g.xyz, l.zxy );\n\t\t  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\t\t  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\t\t  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\t\t  i = mod(i, 289.0 ); \n\t\t  vec4 p = permute( permute( permute( \n\t\t\t\t\t i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n\t\t\t\t   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t  float n_ = 1.0/7.0; // N=7\n\t\t  vec3  ns = n_ * D.wyz - D.xzx;\n\t\t  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n\t\t  vec4 x_ = floor(j * ns.z);\n\t\t  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\t\t  vec4 x = x_ *ns.x + ns.yyyy;\n\t\t  vec4 y = y_ *ns.x + ns.yyyy;\n\t\t  vec4 h = 1.0 - abs(x) - abs(y);\n\t\t  vec4 b0 = vec4( x.xy, y.xy );\n\t\t  vec4 b1 = vec4( x.zw, y.zw );\n\t\t  vec4 s0 = floor(b0)*2.0 + 1.0;\n\t\t  vec4 s1 = floor(b1)*2.0 + 1.0;\n\t\t  vec4 sh = -step(h, vec4(0.0));\n\t\t  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t\t  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\t  vec3 p0 = vec3(a0.xy,h.x);\n\t\t  vec3 p1 = vec3(a0.zw,h.y);\n\t\t  vec3 p2 = vec3(a1.xy,h.z);\n\t\t  vec3 p3 = vec3(a1.zw,h.w);\n\t\t  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t\t  p0 *= norm.x;\n\t\t  p1 *= norm.y;\n\t\t  p2 *= norm.z;\n\t\t  p3 *= norm.w;\n\t\t  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t\t  m = m * m;\n\t\t  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n\t\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t\t}",[n,i]),o=new Ou("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),s=new Ou("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),l=new Ou("float noise(vec3 p){\n\t\t\tvec3 a = floor(p);\n\t\t\tvec3 d = p - a;\n\t\t\td = d * d * (3.0 - 2.0 * d);\n\t\t\tvec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n\t\t\tvec4 k1 = perm(b.xyxy);\n\t\t\tvec4 k2 = perm(k1.xyxy + b.zzww);\n\t\t\tvec4 c = k2 + a.zzzz;\n\t\t\tvec4 k3 = perm(c);\n\t\t\tvec4 k4 = perm(c + 1.0);\n\t\t\tvec4 o1 = fract(k3 * (1.0 / 41.0));\n\t\t\tvec4 o2 = fract(k4 * (1.0 / 41.0));\n\t\t\tvec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n\t\t\tvec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\t\t\treturn o4.y * d.y + o4.x * (1.0 - d.y);\n\t\t}",[s]),u=new Ou("float fbm(vec3 x) {\n\t\t\tfloat v = 0.0;\n\t\t\tfloat a = 0.5;\n\t\t\tvec3 shift = vec3(100);\n\t\t\tfor (int i = 0; i < NUM_OCTAVES; ++i) {\n\t\t\t\tv += a * noise(x);\n\t\t\t\tx = x * 2.0 + shift;\n\t\t\t\ta *= 0.5;\n\t\t\t}\n\t\t\treturn v;\n\t\t}",[l]);u.keywords.NUM_OCTAVES=new Au("int NUM_OCTAVES ".concat(5));var c=new Ou("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}");return{simplex:t,simplexFractal:r,simplexAshima:a,fbm:u,perlin:new Ou("float perlin(vec3 P){\n\t\t  vec3 Pi0 = floor(P);\n\t\t  vec3 Pi1 = Pi0 + vec3(1.0);\n\t\t  Pi0 = mod(Pi0, 289.0);\n\t\t  Pi1 = mod(Pi1, 289.0);\n\t\t  vec3 Pf0 = fract(P);\n\t\t  vec3 Pf1 = Pf0 - vec3(1.0);\n\t\t  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\t\t  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n\t\t  vec4 iz0 = Pi0.zzzz;\n\t\t  vec4 iz1 = Pi1.zzzz;\n\t\t  vec4 ixy = permute(permute(ix) + iy);\n\t\t  vec4 ixy0 = permute(ixy + iz0);\n\t\t  vec4 ixy1 = permute(ixy + iz1);\n\t\t  vec4 gx0 = ixy0 / 7.0;\n\t\t  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n\t\t  gx0 = fract(gx0);\n\t\t  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\t\t  vec4 sz0 = step(gz0, vec4(0.0));\n\t\t  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\t\t  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\t\t  vec4 gx1 = ixy1 / 7.0;\n\t\t  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n\t\t  gx1 = fract(gx1);\n\t\t  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\t\t  vec4 sz1 = step(gz1, vec4(0.0));\n\t\t  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\t\t  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\t\t  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\t\t  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\t\t  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\t\t  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\t\t  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\t\t  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\t\t  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\t\t  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\t\t  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\t\t  g000 *= norm0.x;\n\t\t  g010 *= norm0.y;\n\t\t  g100 *= norm0.z;\n\t\t  g110 *= norm0.w;\n\t\t  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\t\t  g001 *= norm1.x;\n\t\t  g011 *= norm1.y;\n\t\t  g101 *= norm1.z;\n\t\t  g111 *= norm1.w;\n\t\t  float n000 = dot(g000, Pf0);\n\t\t  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\t\t  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\t\t  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\t\t  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\t\t  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\t\t  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\t\t  float n111 = dot(g111, Pf1);\n\t\t  vec3 fade_xyz = fade(Pf0);\n\t\t  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\t\t  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\t\t  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n\t\t  return 2.2 * n_xyz;\n\t\t}",[n,i,c])}}(),_c=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i,a,o,s,l){var u;return(0,g.Z)(this,r),(u=t.call(this,"v3")).nodeType="Rainbow",u.filmThickness=e,u.movement=n,u.wavelengths=i,u.noiseStrength=a,u.noiseScale=o,u.offset=s,u.alpha=l,u.calpha="g".concat(u.uuid.toString().replace(/-/g,""),"_calpha"),u}return(0,y.Z)(r,[{key:"generate",value:function(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");var n=e.include(r.Nodes.rainbow),i=[];return i.push(this.filmThickness.build(e,"f")),i.push(this.movement.build(e,"f")),i.push(this.wavelengths.build(e,"v3")),i.push(this.noiseStrength.build(e,"f")),i.push(this.noiseScale.build(e,"f")),i.push(this.offset.build(e,"v3")),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(n+"("+i.join(",")+")",this.getType(e),t)}return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.filmThickness=e.filmThickness.clone(),this.movement=e.movement.clone(),this.wavelengths=e.wavelengths.clone(),this.noiseStrength=e.noiseStrength.clone(),this.noiseScale=e.noiseScale.clone(),this.offset=e.offset.clone(),this.alpha=e.alpha.clone(),this.calpha=e.calpha,this}}]),r}(yu),Cc=_c;Cc.Nodes=function(){var e=new Ou("vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {\n                 vec3 st = position / noiseScale;\n\t\t\t\t vec3 q = vec3(simplex3d(st),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(1.0)),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(1.0)));\n\n\t\t\t\t vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),\n\t\t\t\t\t\t\t  simplex3d(st * q));\n\n                 float noise = simplex3d(st + r);\n\n                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);\n             }",[kc.simplex]);return{rainbow:new Ou("vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, float alpha, out float calpha) {\n                 vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);\n\n                 float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);\n                 float lalpha = alpha * rainbowContribution;\n                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\n                 return res;\n             }",[e])}}();var Oc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i,a,o,s,l,u){var c;return(0,g.Z)(this,r),(c=t.call(this,"v3")).nodeType="Transmission",c.thickness=e,c.ior=n,c.roughness=i,c.transmissionSamplerSize=a,c.transmissionSamplerMap=o,c.transmissionDepthMap=s,c.aspectRatio=l,c.alpha=u,c.calpha="g".concat(c.uuid.toString().replace(/-/g,""),"_calpha"),c}return(0,y.Z)(r,[{key:"generate",value:function(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",30),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");var n=e.include(r.Nodes.transmission),i=[];return i.push(this.thickness.build(e,"f")),i.push(this.ior.build(e,"f")),i.push(this.roughness.build(e,"f")),i.push(this.transmissionSamplerSize.build(e,"v2")),i.push(this.transmissionSamplerMap.getTexture(e,"t")),i.push(this.transmissionDepthMap.getTexture(e,"t")),i.push(this.aspectRatio.build(e,"v2")),i.push("normal"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(n+"("+i.join(",")+")",this.getType(e),t)}return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,this),this.thickness=e.thickness.clone(),this.ior=e.ior.clone(),this.roughness=e.roughness.clone(),this.transmissionSamplerSize=e.transmissionSamplerSize.clone(),this.transmissionSamplerMap=e.transmissionSamplerMap,this.transmissionDepthMap=e.transmissionDepthMap,this.alpha=e.alpha.clone(),this.calpha=e.calpha,this}}]),r}(yu),Zc=Oc;Zc.Nodes=function(){var e=new Ou("\n            float gaussian(vec2 i) {\n                const float sigma = float(NUM_SAMPLES) * .25;\n                return exp( -.5* dot(i/=sigma,i) ) / ( 6.28 * sigma*sigma );\n            }"),t=new Ou("\n            vec4 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {\n                // Slightly modified version of this:\n                // https://www.shadertoy.com/view/ltScRG\n\n                const int LOD = 2;\n                const int sLOD = 4; // tile size = 2^LOD\n\n                vec4 O = vec4(0);\n                const int s = NUM_SAMPLES/sLOD;\n                for ( int i = 0; i < s*s; i++ ) {\n                    int modulo = (i)-((i)/(s))*(s);\n                    vec2 d = vec2(float(modulo), float(i/s))*float(sLOD) - float(NUM_SAMPLES)/2.;\n                    vec2 uv = U + (scale * aspectRatio) * d;\n                    // What is the depth of the opaque object we're trying to sample\n                    float opaqueDepth = texture2D(dm, uv).r;\n                    if (opaqueDepth < gl_FragCoord.z) {\n                        uv = unrefractedU + ((scale * min(lod / 2., 1.)) * aspectRatio) * d;\n                        lod = lod > 4.0 ? lod : lod / 2.0;\n                    }\n\t\t            #ifdef TEXTURE_LOD_EXT\n                    O += gaussian(d) * texture2DLodEXT( sp, uv, lod);\n                    #else\n                    O += gaussian(d) * textureLod( sp, uv, lod);\n                    #endif\n                }\n                return O / O.a;\n            }",[e]),r=new Ou("\n            vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\t        // Direction of refracted light.\n\t\t        vec3 refractionVector = refract( -v,  n, 1.0 / ior );\n\t\t        // Compute rotation-independant scaling of the model matrix.\n\t\t        vec3 modelScale;\n\t\t        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\t        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\t        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\t        // The thickness is specified in local space.\n\t\t        return normalize( refractionVector ) * thickness * modelScale;\n\t        }"),n=new Ou("\nfloat applyIorToRoughness( float roughness, float ior ) {\n\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t} "),i=new Ou("\nvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n        float lod = applyIorToRoughness(roughness, ior);\n\n        return blur(transmissionSamplerMap, fragCoord, vec2(lod / (transmissionSamplerSize.x / 2.)), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);\n\t}",[n,t]),a=new Ou("\nvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {\n        vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n        vec3 refractedRayExit = position + transmissionRay;\n\n        // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n        vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );\n        vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n        refractionCoords += 1.0;\n        refractionCoords /= 2.0;\n\n        vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );\n        vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;\n        unrefractedCoords += 1.0;\n        unrefractedCoords /= 2.0;\n\n        // Sample framebuffer to get pixel the refracted ray hits.\n        vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );\n        // Get the specular component.\n        return vec4( ( 1.0 ) * transmittedLight.rgb, transmittedLight.a );\n    }",[i,r]);return{transmission:new Ou("\n            vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float alpha, out float calpha) {\n                vec3 v = vec3(0.);\n                if (isOrthographic) {\n                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n                } else {\n                    v = normalize(vWPosition - cameraPosition);\n                }\n                vec4 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );\n                float lalpha = alpha;\n\n                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n                 return transmission.rgb;\n            }",[a])}}();var Lc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n){var i;return(0,g.Z)(this,r),(i=t.call(this,"v3")).nodeType="CustomNormal",i.cnormal=e,i.alpha=n,i}return(0,y.Z)(r,[{key:"generate",value:function(e,t){if(e.isShader("fragment")){var n=e.include(r.Nodes.customNormal),i=[];return i.push(this.cnormal.build(e,"v3")),i.push("normal"),i.push(this.alpha.build(e,"f")),e.format(n+"("+i.join(",")+")",this.getType(e),t)}return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.cnormal.copy(e.cnormal),this.alpha.copy(e.alpha),this}}]),r}(yu),Ac=Lc;Ac.Nodes={customNormal:new Ou("vec3 customNormal(vec3 cnormal, vec3 norm, float alpha) {\n\t\t\t\tvec3 normal = packNormalToRGB( norm ).rgb;\n\t\t\t\tnormal *= step( vec3(0.5), cnormal );\n\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * alpha;\n\n\t\t\t\treturn normal;\n\t\t\t}")};var Mc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i,a,o,s,l,u){var c;return(0,g.Z)(this,r),(c=t.call(this,"v3")).nodeType="Gradient",c.gradientType=e,c.smooth=n,c.colors=i,c.steps=a,c.offset=o,c.morph=s,c.angle=l,c.alpha=u,c.calpha="g".concat(c.uuid.toString().replace(/-/g,""),"_calpha"),c}return(0,y.Z)(r,[{key:"generate",value:function(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");var n=e.include(r.Nodes.gradient),i=[];return i.push(this.gradientType.build(e,"i")),i.push(this.smooth.build(e,"b")),i.push(this.colors.build(e,"v4[]")),i.push(this.steps.build(e,"f[]")),i.push(this.offset.build(e,"v2")),i.push(this.morph.build(e,"v2")),i.push(this.angle.build(e,"f")),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(n+"("+i.join(",")+")",this.getType(e),t)}return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.gradientType=e.gradientType.clone(),this.smooth=e.smooth.clone(),this.colors=e.colors.clone(),this.steps=e.steps.clone(),this.offset=e.offset.clone(),this.morph=e.morph.clone(),this.angle=e.angle.clone(),this.alpha=e.alpha.clone(),this.calpha=e.calpha,this}}]),r}(yu),Dc=Mc;Dc.Nodes={gradient:new Ou("vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, float alpha, out float calpha) {\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tvec2 m = morph / vUv.xy;\n\t\t\t\tvec2 rot = vec2( 0.5 + m.x, m.y );\n\t\t\t\tvec2 dt = vec2(\n\t\t\t\t\tcos( angle ) * rot.x - sin( angle ) * rot.y,\n\t\t\t\t\tsin( angle ) * rot.x + cos( angle ) * rot.y\n\t\t\t\t);\n\t\t\t\tvec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;\n\t\t\t\tfloat t = dot( pt, dt ) / dot( dt, dt );\n\t\t\t\tif ( gradientType == 1 ) {\n\t\t\t\t\tt = distance (\n\t\t\t\t\t\t( vUv + morph ) * 3.0,\n\t\t\t\t\t\t( vUv + offset ) + 1.0\n\t\t\t\t\t) + angle;\n\t\t\t\t} else if ( gradientType == 2 ) {\n\t\t\t\t\tfloat polar = atan(\n\t\t\t\t\t\tvUv.x + morph.x - 0.5 + offset.x,\n\t\t\t\t\t\tvUv.y + morph.y - 0.5 + offset.y\n\t\t\t\t\t) * -1.0;\n\t\t\t\t\tt = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );\n\t\t\t\t}\n\n\t\t\t\tfloat p;\n\t\t\t\tif (smoothed) {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfloat lalpha = alpha * color.a;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\n\t\t\t\treturn color.xyz;\n\t\t\t}")};var Tc=function(e){return e.NOISE="noise",e.MAP="map",e}(Tc||{}),zc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new cc(0),i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0;return(0,g.Z)(this,r),(e=t.call(this,"v3")).nodeType="VertexDisplacement",e.displacementTypeIndex=n,e.intensity=i,e.movementOrTexture=a,"map"===Object.values(Tc)[e.displacementTypeIndex.value]&&(e.mat=new mc(e.movementOrTexture.value.matrix)),e.cropOrOffset=o,e.scale=s,e.noiseFunctionIndex=l,e}return(0,y.Z)(r,[{key:"generate",value:function(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");var n,i=[];switch(i.push("displaced_position"),i.push("displaced_normal"),Object.values(Tc)[this.displacementTypeIndex.value]){case"map":n=e.include(r.Nodes.map),i.push(this.movementOrTexture.getTexture(e,"t")),i.push("uv"),i.push(this.cropOrOffset.build(e,"f")),this.mat&&i.push(this.mat.build(e,"mat3"));break;case"noise":var a=Object.values(Sc)[this.noiseFunctionIndex.value],o=new Ou("vec3 orthogonal(vec3 v) {\n\t\t\t\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t\t\t\t}"),s=new Ou("vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement) {\n\t\t\t\t\t\t\treturn p + n * ".concat(a,"((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;\n\t\t\t\t\t\t}"),[kc.simplex,kc.simplexFractal,kc.simplexAshima,kc.fbm,kc.perlin]),l=new Ou("vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, float intensity, out vec3 displaced_normal) {\n\t\t\t\t\t\t\tvec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement);\n\t\t\t\t\t\t\tvec3 tangent1 = orthogonal(normal);\n\t\t\t\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\n                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.\n                            // This caused some small oval/circular visual artifacts in the lighting.\n                            // For now, simply using neighbors further away betters the problem,\n                            // but we should figure out the underlying cause when we have some time.\n                            // Maybe its related to how we calculate the tangent and bitangent?\n\t\t\t\t\t\t\tvec3 nearby1 = position + tangent1;\n\t\t\t\t\t\t\tvec3 nearby2 = position + tangent2;\n\t\t\t\t\t\t\tvec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement);\n\t\t\t\t\t\t\tvec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement);\n\t\t\t\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\t\t\t\treturn displaced_position;\n\t\t\t\t\t\t}",[s,o]);n=e.include(l),i.push(this.scale.build(e,"f")),i.push(this.cropOrOffset.build(e,"v3")),i.push(this.movementOrTexture.build(e,"f"))}return i.push(this.intensity.build(e,"f")),i.push("displaced_normal"),e.format(n+"("+i.join(",")+")",this.getType(e),t)}return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},{key:"copy",value:function(e){var t,n;return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.noiseFunctionIndex=null===(t=e.noiseFunctionIndex)||void 0===t?void 0:t.clone(),this.scale=null===(n=e.scale)||void 0===n?void 0:n.clone(),this.cropOrOffset=e.cropOrOffset.clone(),this.intensity=e.intensity.clone(),this.movementOrTexture=e.movementOrTexture.clone(),this}}]),r}(yu),Ec=zc;Ec.Nodes=function(){var e=new Ou("vec3 orthogonal(vec3 v) {\n\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t}"),t=new Ou("float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {\n\t\t\t\tvec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;\n\t\t\t\tvec4 tmp = texture2D(tex, uvs);\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tif (crop > 0.5) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\treturn 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn col.r;\n\t\t\t}");return{map:new Ou("vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {\n\t\t\t\tvec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;\n\t\t\t\tvec3 tangent1 = normalize(orthogonal(normal));\n\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\t\t\t\tvec3 nearby1 = position + tangent1 * 0.1;\n\t\t\t\tvec3 nearby2 = position + tangent2 * 0.1;\n\t\t\t\tvec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tvec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\treturn displaced_position;\n\t\t\t}",[e,t])}}();var Pc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new pu,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new pu,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new pu,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new pu,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new pu,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:new pu,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:new pu,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:new pu,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:new pu,v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:new pu;return(0,g.Z)(this,r),(e=t.call(this,"v3")).nodeType="Noise",e.scale=n,e.size=i,e.move=a,e.fA=o,e.fB=s,e.distortion=l,e.colorA=u,e.colorB=c,e.colorC=h,e.colorD=d,e.alpha=f,e.noiseType=v,e.calpha="g".concat(e.uuid.toString().replace(/-/g,""),"_calpha"),e}return(0,y.Z)(r,[{key:"generate",value:function(e,t,r,n,i){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");var a=Object.values(Sc)[this.noiseType.value],o=new Ou("vec3 ".concat(a,"customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, float alpha, out float calpha) {\n                vec3 st = position / size;\n\t\t\t\tst /= scale;\n\t\t\t\tvec3 q = vec3(").concat(a,"(st),\n\t\t\t\t\t\t\t  ").concat(a,"(st + vec3(1.0)),\n\t\t\t\t\t\t\t  ").concat(a,"(st + vec3(1.0)));\n\t\t\t\tvec3 r = vec3(").concat(a,"(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),\n\t\t\t\t\t\t\t  ").concat(a,"(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), \n\t\t\t\t\t\t\t  ").concat(a,"(st * q));\n\t\t\t\tfloat f = ").concat(a,"(st + r);\n\t\t\t\tvec4 color;\n\t\t\t\tcolor = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));\n\t\t\t\tcolor = mix(color, colorC, clamp(length(q), 0.0, 1.0));\n\t\t\t\tcolor = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));\n\n                float lalpha = alpha * color.a;\n                calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\n\t\t\t    accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t}"),[kc.simplex,kc.simplexFractal,kc.simplexAshima,kc.fbm,kc.perlin]),s=e.include(o),l=[];return l.push(this.scale.build(e,"f")),l.push(this.size.build(e,"v3")),l.push(this.move.build(e,"f")),l.push(this.fA.build(e,"v2")),l.push(this.fB.build(e,"v2")),l.push(this.distortion.build(e,"v2")),l.push(this.colorA.build(e,"v4")),l.push(this.colorB.build(e,"v4")),l.push(this.colorC.build(e,"v4")),l.push(this.colorD.build(e,"v4")),l.push(this.alpha.build(e,"f")),l.push(this.calpha),e.format(s+"("+l.join(",")+")",this.getType(e),t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.scale.copy(e.scale),this.size.copy(e.size),this.move.copy(e.move),this.fA.copy(e.fA),this.fB.copy(e.fB),this.distortion.copy(e.distortion),this.colorA.copy(e.colorA),this.colorB.copy(e.colorB),this.colorC.copy(e.colorC),this.colorD.copy(e.colorD),this.alpha.copy(e.alpha),this.calpha=e.calpha,this.noiseType.copy(e.noiseType),this}}]),r}(yu);Pc.numOctaves=5;var Nc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pu,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new pu,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new pu;return(0,g.Z)(this,r),(e=t.call(this,"v3")).nodeType="Blend",e.a=n,e.b=i,e.alpha=a,e.mode=o,e}return(0,y.Z)(r,[{key:"generate",value:function(e,t){if(e.isShader("fragment")){var r=[];return r.push(this.a.build(e,"c")),r.push(this.b.build(e,"c")),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),e.format("spe_blend("+r.join(",")+")",this.getType(e),t)}return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.a.copy(e.a),this.b.copy(e.b),this.alpha.copy(e.alpha),this.mode.copy(e.mode),this}}]),r}(yu),Bc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i,a,o,s,l,u,c,h,d,f){var v;return(0,g.Z)(this,r),(v=t.call(this,"v3")).nodeType="Depth",v.gradientType=e,v.smooth=n,v.near=i,v.far=a,v.isVector=o,v.isWorldSpace=s,v.origin=l,v.direction=u,v.colors=c,v.steps=h,v.num=d,v.alpha=f,v.calpha="g".concat(v.uuid.toString().replace(/-/g,""),"_calpha"),v}return(0,y.Z)(r,[{key:"generate",value:function(e,t){var n="g".concat(this.uuid.toString().replace(/-/g,"")),i=new Ou("vec3 ".concat(n,"_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[").concat(n,"_MAX_COLORS], float steps[").concat(n,"_MAX_COLORS], float alpha, out float calpha) {\n               vec4 color = colors[0];\n               #ifdef ").concat(n,"_IS_VECTOR\n                   #ifdef ").concat(n,"_LINEAR\n                       #ifdef ").concat(n,"_WORLDSPACE\n                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);\n                       #else\n                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);\n                       #endif\n                   #else\n                       #ifdef ").concat(n,"_WORLDSPACE\n                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);\n                       #else\n                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);\n                       #endif\n                   #endif\n               #else\n                   float dist = length(vWPosition - cameraPosition);\n\t\t\t       float depth = ( dist - near ) / ( far - near );\n               #endif\n\n\n              float p;\n              #ifdef ").concat(n,"_SMOOTH\n\t\t\t\tfor ( int i = 1; i < ").concat(n,"_MAX_COLORS; i++ ) {\n\t\t\t\t\t\tp = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n              #else\n                for ( int i = 1; i < ").concat(n,"_MAX_COLORS; i++ ) {\n                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);\n                   color = mix(color, colors[i], p);\n                 }\n              #endif\n\n               float lalpha = alpha * color.a;\n               calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\n\t\t\t   accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n               return color.rgb;\n\t\t\t}"),[r.Nodes.vectorLinearWorldSpaceDepth,r.Nodes.vectorLinearObjectSpaceDepth,r.Nodes.vectorSphericalObjectSpaceDepth,r.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define("".concat(n,"_MAX_COLORS"),this.num.value+1),this.smooth.value&&e.define("".concat(n,"_SMOOTH")),this.isVector.value>.5&&e.define("".concat(n,"_IS_VECTOR")),0===this.gradientType.value&&e.define("".concat(n,"_LINEAR")),this.isWorldSpace.value>.5&&e.define("".concat(n,"_WORLDSPACE")),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");var a=e.include(i),o=[];return o.push(this.near.build(e,"f")),o.push(this.far.build(e,"f")),o.push(this.origin.build(e,"v3")),o.push(this.direction.build(e,"v3")),o.push(this.colors.build(e,"v4[]")),o.push(this.steps.build(e,"f[]")),o.push(this.alpha.build(e,"f")),o.push(this.calpha),e.format(a+"("+o.join(",")+")",this.getType(e),t)}return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.gradientType=e.gradientType.clone(),this.smooth=e.smooth.clone(),this.near=e.near.clone(),this.far=e.far.clone(),this.isVector=e.isVector.clone(),this.isWorldSpace=e.isWorldSpace.clone(),this.origin=e.origin.clone(),this.direction=e.direction.clone(),this.colors=e.colors.clone(),this.steps=e.steps.clone(),this.alpha=e.alpha.clone(),this.calpha=e.calpha,this}}]),r}(yu),Uc=Bc;Uc.Nodes={vectorLinearWorldSpaceDepth:new Ou("float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorLinearObjectSpaceDepth:new Ou("float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalWorldSpaceDepth:new Ou("float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(vWPosition - origin);\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalObjectSpaceDepth:new Ou("float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(position - origin);\n               return ( dist - near ) / ( far - near );\n            }")};var Ic=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i){var a;return(0,g.Z)(this,r),(a=t.call(this,"v3")).nodeType="Matcap",a.texture=e,a.alpha=n,a.mode=i,a.calpha="g".concat(a.uuid.toString().replace(/-/g,""),"_calpha"),a}return(0,y.Z)(r,[{key:"generate",value:function(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");var n=e.include(r.Nodes.matcap);e.require("normal"),e.requires.normal=!0;var i=[];return i.push(this.texture.getTexture(e,"t")),i.push("normal"),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),i.push(this.calpha),e.format(n+"("+i.join(",")+")",this.getType(e),t)}return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.texture=e.texture.clone(),this.alpha=e.alpha.clone(),this.mode=e.mode.clone(),this.calpha=e.calpha,this}}]),r}(yu),Vc=Ic;Vc.Nodes={matcap:new Ou("vec3 matcap(sampler2D matcapTex, vec3 normal, float alpha, int mode, out float calpha) {\n                vec3 viewDir = normalize( vViewPosition );\n                vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n                vec3 y = cross( viewDir, x );\n                vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n                vec4 matcapColor = texture2D( matcapTex, uv );\n\n                calpha =  alpha / clamp( alpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * alpha;\n                \n                return matcapColor.rgb;\n            }\n            ")};var Fc=function(){function e(t){(0,g.Z)(this,e),this.id=2,this.layerCount=2,this.uuid=w.MathUtils.generateUUID(),this.needsUpdate=!1,this._material=t,this._layerNodes=[];var r=this._createLayer({id:0,type:"color"});this._material.color=r.color,void 0===this._material.alpha&&(this._material.alpha=new Fu(1));var n=new Fu(1),i=new cc(0);"shadingAlpha"in this._material&&"shadingBlend"in this._material&&(this._material.shadingAlpha=n,this._material.shadingBlend=i),this._layerNodes.push({id:0,type:"color",color:r.color,alpha:r.alpha,mode:r.mode}),this._layerNodes.push({id:1,type:"light",alpha:n,mode:i}),this.head=r.layer,this.head.next=new hc(1,void 0,{type:"light",alpha:n,mode:i}),this.attachLightNodes(this.getLightLayer())}return(0,y.Z)(e,[{key:"material",get:function(){return this._material},set:function(e){var t;this._material=e;for(var r,n,i=this.head;void 0!==i;){if("light"===i.type){r=i.uniforms["f".concat(i.id,"_alpha")],n=i.uniforms["f".concat(i.id,"_mode")];break}i=i.next}"shadingAlpha"in this._material&&"shadingBlend"in this._material&&(this._material.shadingAlpha=r,this._material.shadingBlend=n),this.attachLightNodes(null===(t=e.userData.layers)||void 0===t?void 0:t.getLightLayer()),this.blendColors(),this.blendAfterColors(),this.blendPositions()}},{key:"getLayersOfType",value:function(e){for(var t=[],r=this.head;r;)r.type===e&&t.push(r),r=r.next;return t}},{key:"addLayer",value:function(e){var t;if(e.id=null!==(t=e.id)&&void 0!==t?t:++this.id,this.layerCount++,"light"===e.type){var r=this.createLightLayer(e);return this.uuid=w.MathUtils.generateUUID(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),r}var n=this._createLayer(e),i=n.layer;if(void 0===this.head)this.head=i;else{for(var a=this.head;null!=a.next;)a=a.next;a.next=i}return n.color&&this._layerNodes.push({id:i.id,type:"color",color:n.color,alpha:n.alpha,mode:n.mode}),n.position&&this._layerNodes.push({id:i.id,type:"position",position:n.position}),this.uuid=w.MathUtils.generateUUID(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),i}},{key:"addLayerBeforeAt",value:function(e,t){var r,n=this.head;e.id=null!==(r=e.id)&&void 0!==r?r:++this.id,this.layerCount++;var i=this._createLayer(e),a=i.layer;a.next=t;var o=0;if(n===t)this.head=a,i.color&&this._layerNodes.splice(0,0,{id:a.id,type:"color",color:i.color,alpha:i.alpha,mode:i.mode}),i.position&&this._layerNodes.splice(0,0,{id:a.id,type:"position",position:i.position});else{for(o=1;(null===(s=n)||void 0===s?void 0:s.next)!==t;){var s,l;n=null===(l=n)||void 0===l?void 0:l.next,o++}n.next=a,i.color&&this._layerNodes.splice(o,0,{id:a.id,type:"color",color:i.color,alpha:i.alpha,mode:i.mode}),i.position&&this._layerNodes.splice(o,0,{id:a.id,type:"position",position:i.position})}return this.uuid=w.MathUtils.generateUUID(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),a}},{key:"addLayerAt",value:function(e,t){var r;t.id=null!==(r=t.id)&&void 0!==r?r:++this.id,this.layerCount++;var n=this._createLayer(t),i=n.layer;if(n.color&&this._layerNodes.splice(e,0,{id:i.id,type:"color",color:n.color,alpha:n.alpha,mode:n.mode}),n.position&&this._layerNodes.splice(e,0,{id:i.id,type:"position",position:n.position}),0==e)i.next=this.head,this.head=i;else{for(var a=this.head,o=this.head.next,s=0;s<e-1;s++)a=o,o=o.next;i.next=o,a.next=i}return this.uuid=w.MathUtils.generateUUID(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),i}},{key:"removeLayer",value:function(e){var t,r,n=this.head,i=0;if((null===(t=n)||void 0===t?void 0:t.id)==e)this.head=n.next;else for(i=1,r=n,n=null===(a=n)||void 0===a?void 0:a.next;null!=n;){var a;if(n.id==e){r.next=n.next;break}i++,r=n,n=n.next}return this.cleanupChangedLayer(n),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.uuid=w.MathUtils.generateUUID(),this.layerCount--,i}},{key:"changeLayer",value:function(e,t){var r,n,i,a=this.head;if((null===(r=a)||void 0===r?void 0:r.id)==e){var o=this._createLayer((0,x.Z)({id:e,uuid:a.uuid},t));(i=o.layer).next=a.next,this.head=i,o.color&&(this._layerNodes[0]={id:i.id,type:"color",color:o.color,alpha:o.alpha,mode:o.mode}),o.position&&(this._layerNodes[0]={id:i.id,type:"position",position:o.position}),i.uniforms["f".concat(e,"_mode")].value=a.uniforms["f".concat(e,"_mode")].value,i.uniforms["f".concat(e,"_alpha")].value=a.uniforms["f".concat(e,"_alpha")].value}else{n=a,a=a.next;for(var s=1;null!=a;){if(a.id==e){var l=this._createLayer((0,x.Z)({id:e,uuid:a.uuid},t));i=l.layer,n.next=i,i.next=a.next,l.color&&(this._layerNodes[s]={id:e,type:"color",color:l.color,alpha:l.alpha,mode:l.mode}),l.position&&(this._layerNodes[s]={id:e,type:"position",position:l.position}),i.uniforms["f".concat(e,"_mode")].value=a.uniforms["f".concat(e,"_mode")].value,i.uniforms["f".concat(e,"_alpha")].value=a.uniforms["f".concat(e,"_alpha")].value;break}n=a,a=a.next,s++}}return this.uuid=w.MathUtils.generateUUID(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),i}},{key:"getLayer",value:function(e){for(var t=this.head;null!=t&&t.id!=e;)t=t.next;return t}},{key:"getLayerByUuid",value:function(e){for(var t=this.head;void 0!==t;){if(t.uuid===e)return t;t=t.next}}},{key:"getLayers",value:function(){for(var e=[],t=this.head;null!=t;)e.push(t),t=t.next;return e}},{key:"getLayerPosition",value:function(e){for(var t=this.head,r=0;void 0!==t&&t.id!=e;)r++,t=t.next;return r}},{key:"getDefines",value:function(){}},{key:"getBeforeProgram",value:function(){}},{key:"getLightingProgram",value:function(){}},{key:"getAfterProgram",value:function(){}},{key:"getVarPrograms",value:function(){}},{key:"getUniforms",value:function(){}},{key:"moveLayer",value:function(e,t){var r,n,i=this.head;if(0==e)r=this.head,this.head=r.next;else{for(var a=0;a<e;a++)n=i,i=i.next;n.next=i.next,r=i}if(i=this.head,n=void 0,0==t)r.next=this.head,this.head=r;else{for(var o,s=0;s<t-1;s++)i=i.next;r.next=null===(o=i)||void 0===o?void 0:o.next,i.next=r}var l=this._layerNodes.splice(e,1)[0];this._layerNodes.splice(t,0,l),this.uuid=w.MathUtils.generateUUID(),this.blendColors(),this.blendAfterColors()}},{key:"updateLayerUniform",value:function(){this.uuid=w.MathUtils.generateUUID(),this.blendColors(),this.blendAfterColors()}},{key:"copy",value:function(e){this.needsUpdate=!1,this.layerCount=e.layerCount,this._layerNodes=[],this.layerCount=0,this.head=void 0,this.rebuildLayerNodes(this.head,e.head);for(var t=e.head,r=this.head;null!=t.next;)this.rebuildLayerNodes(r,t.next),r=r.next,t=t.next;return this.id=e.id,this.uuid=e.uuid,this.blendColors(),this.blendAfterColors(),this.blendPositions(),this}},{key:"createLightLayer",value:function(e){var t=new Fu(e.alpha),r=new cc(e.mode);this._material.shadingAlpha=t,this._material.shadingBlend=r,this._layerNodes.push({id:e.id,type:"light",alpha:t,mode:r});var n=new hc(e.id,void 0,{type:"light",alpha:t,mode:r});if(void 0===this.head)this.head=n;else{for(var i=this.head;null!=i.next;)i=i.next;i.next=n}return this.attachLightNodes(this.getLightLayer()),n}},{key:"rebuildLayerNodes",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("light"===t.type){var n=r?t.uniforms["f".concat(t.id,"_alpha")]:new Fu(t.uniforms["f".concat(t.id,"_alpha")].value),i=r?t.uniforms["f".concat(t.id,"_mode")]:new cc(t.uniforms["f".concat(t.id,"_mode")].value);this._material.shadingAlpha=n,this._material.shadingBlend=i,this._layerNodes.push({id:t.id,type:"light",alpha:n,mode:i}),void 0===this.head?this.head=new hc(t.id,t.uuid,{type:"light",alpha:n,mode:i}):e&&(e.next=new hc(t.id,t.uuid,{type:"light",alpha:n,mode:i})),this.attachLightNodes(t)}else{var a={type:t.type,id:t.id};for(var o in t.uniforms){var s=t.getName(o);if(s){var l="f".concat(t.id,"_").concat(s);if(Array.isArray(t.uniforms[l].value))a[s]=t.uniforms[l].value.map((function(e){return e.clone&&!r?e.clone():e}));else{var u=t.uniforms[l].value;if("transmissionDepthMap"===s){a[s]=u;continue}null!=u&&(a[s]=!u.clone||r||u.isRenderTargetTexture?u:u.clone())}}}this.addLayer(a)}}},{key:"attachLightNodes",value:function(e){var t,r,n,i,a,o,s,l,u,c,h,d=this,f={},v=this.getLightLayer();switch(this._material.userData.category){case"Lambert":f.emissive=new uc(null!==(t=null===e||void 0===e||null===(r=e.getValue("emissive"))||void 0===r?void 0:r.clone())&&void 0!==t?t:0);break;case"Phong":f.shininess=new Fu(null!==(n=null===e||void 0===e?void 0:e.getValue("shininess"))&&void 0!==n?n:30),f.specular=new uc(null!==(i=null===e||void 0===e||null===(a=e.getValue("specular"))||void 0===a?void 0:a.clone())&&void 0!==i?i:1118481);break;case"Toon":f.shininess=new Fu(null!==(o=null===e||void 0===e?void 0:e.getValue("shininess"))&&void 0!==o?o:30),f.specular=new uc(null!==(s=null===e||void 0===e||null===(l=e.getValue("specular"))||void 0===l?void 0:l.clone())&&void 0!==s?s:1118481);break;case"Physical":f.roughness=new Fu(null!==(u=null===e||void 0===e?void 0:e.getValue("roughness"))&&void 0!==u?u:.3),f.metalness=new Fu(null!==(c=null===e||void 0===e?void 0:e.getValue("metalness"))&&void 0!==c?c:0),f.reflectivity=new Fu(null!==(h=null===e||void 0===e?void 0:e.getValue("reflectivity"))&&void 0!==h?h:.5)}Object.keys(f).forEach((function(e){d._material[e]=f[e],v.uniforms["f".concat(v.id,"_").concat(e)]=f[e]}))}},{key:"clone",value:function(t){return new e(t).copy(this)}},{key:"toJSON",value:function(e){return{id:this.id,uuid:this.uuid,head:this.head.toJSON(e)}}},{key:"fromJSON",value:function(e,t,r){for(var n=new hc(e.head.id,void 0,{type:e.head.type}).fromJSON(e.head,t),i=e.head.next,a=n;null!=i;)a.next=new hc(i.id,void 0,{type:i.type}).fromJSON(i,t),i=i.next,a=a.next;this._layerNodes=[],this.head=void 0,this.rebuildLayerNodes(this.head,n,!0);var o=n;for(a=this.head;null!=o.next;)this.rebuildLayerNodes(a,o.next,!0),a=a.next,o=o.next;return this._material=r,this.id=e.id,this.uuid=e.uuid,this.blendColors(),this.blendAfterColors(),this.blendPositions(),this}},{key:"getLightLayer",value:function(){for(var e=this.head;void 0!==e&&"light"!==e.type;){var t;e=null!==(t=e.next)&&void 0!==t?t:e}return e}},{key:"dispose",value:function(){var e=this.head;for(this._layerNodes=[],this.layerCount=0;void 0!==e;)!0===e.hasOwnProperty("dispose")&&e.dispose(),e=e.next;this.head=void 0}},{key:"_createLayer",value:function(e){var t=e.type;switch(t){case"color":var r,n,i,a=new uc(null!==(r=e.color)&&void 0!==r?r:5855577),o=new Fu(null!==(n=e.alpha)&&void 0!==n?n:1),s=new Bu("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");s.keywords.alpha=o;var l=new cc(null!==(i=e.mode)&&void 0!==i?i:0);return a.alpha=o,{layer:new hc(e.id,e.uuid,{type:t,color:a,alpha:o,calpha:s,mode:l}),color:a,alpha:s,mode:l};case"texture":var u,c,h,d,f,v,p,m,g=null!==(u=e.texture)&&void 0!==u?u:new Uu,y=g.matrix;e.mat&&y.copy(e.mat),g.needsUpdate=!0;var x=new Fu(null!==(c=e.crop)&&void 0!==c?c:0),b=new cc(null!==(h=e.projection)&&void 0!==h?h:0),S=new cc(null!==(d=e.axis)&&void 0!==d?d:0),k=new cc(null!==(f=e.side)&&void 0!==f?f:0),_=new bu(e.size?new w.Vector2(e.size[0],e.size[1]):new w.Vector2(100,100)),C=new Fu(null!==(v=e.alpha)&&void 0!==v?v:1),O=new cc(null!==(p=e.mode)&&void 0!==p?p:0),Z=new Vu(g),L=new wu(null!==(m=e.textureSize)&&void 0!==m?m:new w.Vector3(g.image?g.image.width:0,g.image?g.image.height:0)),A=new yc(Z,L,x,b,S,k,_,C,O),M=new Bu(A.calpha,"f");return{layer:new hc(e.id,e.uuid,{type:t,texture:Z,textureSize:L,crop:x,projection:b,axis:S,side:k,size:_,mat:A.mat,alpha:C,calpha:M,mode:O}),color:A,alpha:M,mode:O};case"matcap":var D,T,z,E=null!==(D=e.texture)&&void 0!==D?D:new Uu;E.needsUpdate=!0;var P=new Fu(null!==(T=e.alpha)&&void 0!==T?T:1),N=new Vu(E),B=new cc(null!==(z=e.mode)&&void 0!==z?z:0),U=new Vc(N,P,B),I=new Bu(U.calpha,"f");return{layer:new hc(e.id,e.uuid,{type:t,texture:N,alpha:P,calpha:I,mode:B}),color:U,alpha:I,mode:B};case"fresnel":var V,F,j,R,G,H,W,q=new uc(null!==(V=e.color)&&void 0!==V?V:16777215),J=new Fu(null!==(F=e.bias)&&void 0!==F?F:.1),Y=new Fu(null!==(j=e.scale)&&void 0!==j?j:1),X=new Fu(null!==(R=e.intensity)&&void 0!==R?R:2),K=new Fu(null!==(G=e.factor)&&void 0!==G?G:1),Q=new Fu(null!==(H=e.alpha)&&void 0!==H?H:1),$=new cc(null!==(W=e.mode)&&void 0!==W?W:0),ee=new bc(q,J,Y,X,K,Q,$),te=new Bu(ee.calpha,"f");return{layer:new hc(e.id,e.uuid,{type:t,color:q,bias:J,scale:Y,intensity:X,factor:K,alpha:Q,calpha:te,mode:$}),color:ee,alpha:te,mode:$};case"rainbow":var re,ne,ie,ae,oe,se,le,ue,ce=new Fu(null!==(re=e.filmThickness)&&void 0!==re?re:30),he=new Fu(null!==(ne=e.movement)&&void 0!==ne?ne:0),de=new wu(null!==(ie=e.wavelengths)&&void 0!==ie?ie:new w.Vector3(0,0,0)),fe=new Fu(null!==(ae=e.noiseStrength)&&void 0!==ae?ae:0),ve=new Fu(null!==(oe=e.noiseScale)&&void 0!==oe?oe:1),pe=new wu(null!==(se=e.offset)&&void 0!==se?se:new w.Vector3(0,0,0)),me=new Fu(null!==(le=e.alpha)&&void 0!==le?le:1),ge=new Cc(ce,he,de,fe,ve,pe,me),ye=new Bu(ge.calpha,"f"),xe=new cc(null!==(ue=e.mode)&&void 0!==ue?ue:0);return{layer:new hc(e.id,e.uuid,{type:t,filmThickness:ce,movement:he,wavelengths:de,noiseStrength:fe,noiseScale:ve,offset:pe,alpha:me,calpha:ye,mode:xe}),color:ge,alpha:ye,mode:xe};case"transmission":var be,we,Se,ke,_e,Ce,Oe,Ze,Le=new Fu(null!==(be=e.thickness)&&void 0!==be?be:10),Ae=new Fu(null!==(we=e.ior)&&void 0!==we?we:1.5),Me=new Fu(null!==(Se=e.roughness)&&void 0!==Se?Se:.5),De=new bu(null!==(ke=e.transmissionSamplerSize)&&void 0!==ke?ke:new w.Vector2(2048,2048)),Te=null!==(_e=e.transmissionSamplerMap)&&void 0!==_e?_e:new Uu,ze=null!==(Ce=e.transmissionDepthMap)&&void 0!==Ce?Ce:new Uu,Ee=new Vu(Te),Pe=new Vu(ze),Ne=window.innerWidth,Be=window.innerHeight,Ue=Ne>=Be?new bu(Be/Ne,1):new bu(1,Ne/Be),Ie=new Fu(null!==(Oe=e.alpha)&&void 0!==Oe?Oe:1),Ve=new Zc(Le,Ae,Me,De,Ee,Pe,Ue,Ie),Fe=new Bu(Ve.calpha,"f"),je=new cc(null!==(Ze=e.mode)&&void 0!==Ze?Ze:0);return{layer:new hc(e.id,e.uuid,{type:t,thickness:Le,ior:Ae,roughness:Me,transmissionSamplerSize:De,transmissionSamplerMap:Ee,transmissionDepthMap:Pe,aspectRatio:Ue,alpha:Ie,calpha:Fe,mode:je}),color:Ve,alpha:Fe,mode:je};case"depth":var Re,Ge,He,We,qe,Je,Ye,Xe,Ke,Qe,$e,et,tt,rt=new cc(null!==(Re=e.gradientType)&&void 0!==Re?Re:0),nt=new fc(null!==(Ge=e.smooth)&&void 0!==Ge&&Ge),it=new Fu(null!==(He=e.near)&&void 0!==He?He:50),at=new Fu(null!==(We=e.far)&&void 0!==We?We:200),ot=new Fu(null!==(qe=e.isVector)&&void 0!==qe?qe:1),st=new Fu(null!==(Je=e.isWorldSpace)&&void 0!==Je?Je:0),lt=new wu(null!==(Ye=e.origin)&&void 0!==Ye?Ye:new w.Vector3),ut=new wu(null!==(Xe=e.direction)&&void 0!==Xe?Xe:new w.Vector3),ct=new cc(null!==(Ke=e.num)&&void 0!==Ke?Ke:0);e.colors?et=new vc(ct.value+1,e.colors):(et=new vc(ct.value+1,new w.Vector4(0,0,0,1))).value[1]=new w.Vector4(1,1,1,1),e.steps?tt=new pc(ct.value+1,e.steps):(tt=new pc(ct.value+1,1)).value[0]=0;var ht=new Fu(null!==(Qe=e.alpha)&&void 0!==Qe?Qe:1),dt=new cc(null!==($e=e.mode)&&void 0!==$e?$e:0),ft=new Uc(rt,nt,it,at,ot,st,lt,ut,et,tt,ct,ht),vt=new Bu(ft.calpha,"f");return{layer:new hc(e.id,e.uuid,{type:t,gradientType:rt,smooth:nt,near:it,far:at,isVector:ot,isWorldSpace:st,origin:lt,direction:ut,colors:et,steps:tt,num:ct,alpha:ht,calpha:vt,mode:dt}),color:ft,alpha:vt,mode:dt};case"noise":var pt,mt,gt,yt,xt,bt,wt,St,kt,_t=new Fu(null!==(pt=e.scale)&&void 0!==pt?pt:1),Ct=new wu(null!==(mt=e.size)&&void 0!==mt?mt:new w.Vector3(100,100,100)),Ot=new Fu(null!==(gt=e.move)&&void 0!==gt?gt:1),Zt=new bu(null!==(yt=e.fA)&&void 0!==yt?yt:new w.Vector2(1.7,9.2)),Lt=new bu(null!==(xt=e.fB)&&void 0!==xt?xt:new w.Vector2(8.3,2.8)),At=new bu(null!==(bt=e.distortion)&&void 0!==bt?bt:new w.Vector2(1,1)),Mt=new ku(e.colorA),Dt=new ku(e.colorB),Tt=new ku(e.colorC),zt=new ku(e.colorD),Et=new Fu(null!==(wt=e.alpha)&&void 0!==wt?wt:1),Pt=new cc(null!==(St=e.mode)&&void 0!==St?St:0),Nt=new cc(null!==(kt=e.noiseType)&&void 0!==kt?kt:0),Bt=new Pc(_t,Ct,Ot,Zt,Lt,At,Mt,Dt,Tt,zt,Et,Nt),Ut=new Bu(Bt.calpha,"f");return{layer:new hc(e.id,e.uuid,{type:t,scale:_t,size:Ct,move:Ot,fA:Zt,fB:Lt,distortion:At,colorA:Mt,colorB:Dt,colorC:Tt,colorD:zt,alpha:Et,calpha:Ut,mode:Pt,noiseType:Nt}),color:Bt,alpha:Ut,mode:Pt};case"normal":var It,Vt,Ft,jt=new wu(null!==(It=e.cnormal)&&void 0!==It?It:new w.Vector3(1,1,1)),Rt=new Fu(null!==(Vt=e.alpha)&&void 0!==Vt?Vt:1),Gt=new cc(null!==(Ft=e.mode)&&void 0!==Ft?Ft:0),Ht=new Ac(jt,Rt),Wt=new Bu("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");return Wt.keywords.alpha=Rt,{layer:new hc(e.id,e.uuid,{type:t,cnormal:jt,alpha:Rt,calpha:Wt,mode:Gt}),color:Ht,alpha:Wt,mode:Gt};case"gradient":var qt,Jt,Yt,Xt,Kt,Qt,$t,er,tr,rr=new cc(null!==(qt=e.gradientType)&&void 0!==qt?qt:0),nr=new fc(null!==(Jt=e.smooth)&&void 0!==Jt&&Jt);e.colors?er=new vc(e.colors.length,e.colors):(er=new vc(10,new w.Vector4(0,0,0,1))).value[1]=new w.Vector4(1,1,1,1),e.steps?tr=new pc(e.steps.length,e.steps):(tr=new pc(10,1)).value[0]=0;var ir=new bu(null!==(Yt=e.offset)&&void 0!==Yt?Yt:new w.Vector2(0,0)),ar=new bu(null!==(Xt=e.morph)&&void 0!==Xt?Xt:new w.Vector2(0,0)),or=new Fu(null!==(Kt=e.angle)&&void 0!==Kt?Kt:0),sr=new Fu(null!==(Qt=e.alpha)&&void 0!==Qt?Qt:1),lr=new cc(null!==($t=e.mode)&&void 0!==$t?$t:0),ur=new Dc(rr,nr,er,tr,ir,ar,or,sr),cr=new Bu(ur.calpha,"f");return{layer:new hc(e.id,e.uuid,{type:t,gradientType:rr,smooth:nr,colors:er,steps:tr,offset:ir,morph:ar,angle:or,alpha:sr,calpha:cr,mode:lr}),color:ur,alpha:cr,mode:lr};case"displace":var hr,dr=new cc(null!==(hr=e.displacementType)&&void 0!==hr?hr:0);if(0===dr.value){var fr,vr,pr,mr,gr,yr,xr,br=new wu(null!==(fr=e.offset)&&void 0!==fr?fr:new w.Vector3(0,0,0)),wr=new Fu(null!==(vr=e.scale)&&void 0!==vr?vr:10),Sr=new Fu(null!==(pr=e.intensity)&&void 0!==pr?pr:8),kr=new Fu(null!==(mr=e.movement)&&void 0!==mr?mr:1),_r=new Fu(null!==(gr=e.alpha)&&void 0!==gr?gr:1),Cr=new cc(null!==(yr=e.mode)&&void 0!==yr?yr:0),Or=new cc(null!==(xr=e.noiseType)&&void 0!==xr?xr:0),Zr=new Ec(dr,Sr,kr,br,wr,Or);return{layer:new hc(e.id,e.uuid,{displacementType:dr,type:t,offset:br,scale:wr,intensity:Sr,movement:kr,alpha:_r,mode:Cr,noiseType:Or}),position:Zr}}if(1===dr.value){var Lr,Ar,Mr,Dr,Tr,zr=null!==(Lr=e.texture)&&void 0!==Lr?Lr:new Uu,Er=zr.matrix;e.mat&&Er.copy(e.mat),zr.needsUpdate=!0;var Pr=new Fu(null!==(Ar=e.intensity)&&void 0!==Ar?Ar:8),Nr=new Vu(zr),Br=new Fu(null!==(Mr=e.crop)&&void 0!==Mr?Mr:0),Ur=new Fu(null!==(Dr=e.alpha)&&void 0!==Dr?Dr:1),Ir=new cc(null!==(Tr=e.mode)&&void 0!==Tr?Tr:0),Vr=new Ec(dr,Pr,Nr,Br);return{layer:new hc(e.id,e.uuid,{displacementType:dr,type:t,intensity:Pr,texture:Nr,crop:Br,mat:Vr.mat,alpha:Ur,mode:Ir}),position:Vr}}return{}}return{}}},{key:"blendColors",value:function(){var e=this._layerNodes.findIndex((function(e){return"color"===e.type})),t=this._layerNodes.findIndex((function(e){return"light"===e.type}));if(-1!==e&&e<t){for(var r=this._layerNodes[e].color,n=e+1;n<t;++n){var i=this._layerNodes[n];"color"===i.type&&(r=new Nc(r,i.color,i.alpha,i.mode))}this._material.color=r}else this._material.color=void 0}},{key:"blendAfterColors",value:function(){var e=new Bu("outgoingLight","f"),t=this._layerNodes.findIndex((function(e){return"light"===e.type}));if(this._layerNodes.length>t+1){for(var r=t+1;r<this._layerNodes.length;++r){var n=this._layerNodes[r];"color"===n.type&&(e=new Nc(e,n.color,n.alpha,n.mode))}"afterColor"in this._material&&(this._material.afterColor=e)}else"afterColor"in this._material&&(this._material.afterColor=void 0)}},{key:"blendPositions",value:function(){var e=this._layerNodes.filter((function(e){return"position"===e.type}));if(e.length>0){for(var t=e[0].position,r=1;r<e.length;++r)e[r]&&(t=new Gu(t,e[r].position,Gu.ADD),t=new Gu(t,new Fu(.5).setReadonly(!0),Gu.MUL));this._material.position=t}else this._material.position=void 0}},{key:"cleanupChangedLayer",value:function(e){if("displace"===(this._layerNodes=this._layerNodes.filter((function(t){return t.id!==e.id})),e.type))this.blendPositions();else this.blendColors(),this.blendAfterColors()}}]),e}(),jc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i){var a;return(0,g.Z)(this,r),(a=t.call(this,i)).isNodeMaterial=!0,a.type="NodeMaterial",a.wireframeLinecap="",a.wireframeLinejoin="",a.uniformsBackup={},a.userData={type:"",category:"",nodeType:""},a.fog=!0,a.vertex=null!==e&&void 0!==e?e:new lc(new Qu(Qu.PROJECTION)),a.fragment=null!==n&&void 0!==n?n:new lc(new uc(5855577)),a.updaters=[],a.isDetached=!0,a.dithering=!0,a.onBeforeCompile=a._onBeforeCompile,a}return(0,y.Z)(r,[{key:"getDefines",value:function(){return this.defines}},{key:"getUniforms",value:function(){return this.uniforms}},{key:"getVertexShader",value:function(){return this.vertexShader}},{key:"getFragmentShader",value:function(){return this.fragmentShader}},{key:"_onBeforeCompile",value:function(e,t){this.build({renderer:t}),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=!0===this.extensions.derivatives,e.extensionFragDepth=!0===this.extensions.fragDepth,e.extensionDrawBuffers=!0===this.extensions.drawBuffers,e.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD}},{key:"_getLayerStack",value:function(e){var t=this,r=new Fc(this);return e&&(0,i.Z)((0,n.Z)().mark((function i(){return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==e.image){n.next=5;break}return n.next=3,new Promise((function(e){return requestAnimationFrame(e)}));case 3:n.next=0;break;case 5:r.addLayerAt(1,{type:"texture",texture:e}),t.dispose();case 6:case"end":return n.stop()}}),i)})))(),r}},{key:"clampUniformsForPreview",value:function(e,t){var r=function(e,t,r){return Math.min(Math.max(e,t),r)};if(this.userData.layers){var n,i=(0,b.Z)(this.userData.layers.getLayers());try{for(i.s();!(n=i.n()).done;){var a=n.value;if("displace"==a.type){this.uniformsBackup["f".concat(a.id,"_intensity")]=a.uniforms["f".concat(a.id,"_intensity")].value;var o=r(a.uniforms["f".concat(a.id,"_intensity")].value,e,t);a.uniforms["f".concat(a.id,"_intensity")].value=o}}}catch(s){i.e(s)}finally{i.f()}}}},{key:"restoreClampedUniforms",value:function(){if(this.userData.layers){var e,t=(0,b.Z)(this.userData.layers.getLayers());try{for(t.s();!(e=t.n()).done;){var r=e.value;"displace"==r.type&&(r.uniforms["f".concat(r.id,"_intensity")].value=this.uniformsBackup["f".concat(r.id,"_intensity")])}}catch(n){t.e(n)}finally{t.f()}}}},{key:"customProgramCacheKey",value:function(){return this.getHash()}},{key:"updateFrame",value:function(e){for(var t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}},{key:"build",value:function(e){var t,r,n=null!==(r=(e=null!==(t=e)&&void 0!==t?t:{}).builder)&&void 0!==r?r:new sc;return n.setMaterial(this,e.renderer),n.build(this.vertex,this.fragment),this.vertexShader=n.getCode("vertex"),this.fragmentShader=n.getCode("fragment"),this.defines=n.defines,this.uniforms=n.uniforms,this.extensions=n.extensions,this.updaters=n.updaters,this.fog=n.requires.fog,this.lights=n.requires.lights,this.transparent=n.requires.transparent||this.blending>w.NormalBlending,this}},{key:"getHash",value:function(){var e="{";return e+='"vertex":'+this.vertex.getHash()+",",e+='"fragment":'+this.fragment.getHash(),e+="}"}},{key:"copy",value:function(e){var t=this.uuid;for(var r in e)this[r]=e[r];return this.uuid=t,void 0!==e.userData&&(this.userData=JSON.parse(JSON.stringify(e.userData))),this}},{key:"toJSON",value:function(e){var t=this.userData.layers;this.userData.layers=void 0;var n=(0,o.Z)((0,s.Z)(r.prototype),"toJSON",this).call(this,e);return n.type="ShaderMaterial",n.userData={type:this.userData.type,category:this.userData.category,nodeType:this.type,layers:t.toJSON(e)},n.vertex=this.vertex.toJSON(e).uuid,n.fragment=this.fragment.toJSON(e).uuid,delete n.vertexShader,delete n.fragmentShader,delete n.color,delete n.shininess,delete n.specular,delete n.roughness,delete n.metalness,delete n.uniforms,e&&!e.materials[this.uuid]&&(e.materials[this.uuid]=n),this.userData.layers=t,n}},{key:"fromJSON",value:function(e,t){var r;this.defines=null!==(r=e.defines)&&void 0!==r?r:{},this.depthFunc=e.depthFunc,this.depthWrite=e.depthWrite,this.side=void 0!==e.side?e.side:w.FrontSide,this.transparent=e.transparent,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.wireframe=e.wireframe,this.userData.layers.fromJSON(e.userData.layers,t,this)}},{key:"penumbraSizeNode",get:function(){return this.fragment.penumbraSize},set:function(e){this.fragment.penumbraSize=e}}]),r}(w.ShaderMaterial);Object.defineProperties(jc.prototype,{properties:{get:function(){return this.fragment.properties}},needsUpdate:{set:function(e){!0===e&&this.version++,this.needsCompile=e},get:function(){return this.needsCompile}}});var Rc,Gc,Hc,Wc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;return(0,g.Z)(this,r),(e=t.call(this,"basic")).nodeType="Basic",e.color=new uc(5855577),e}return(0,y.Z)(r,[{key:"generate",value:function(e){var t;if(e.isShader("vertex")){var r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(w.UniformsUtils.merge([w.UniformsLib.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join("\n"));var n=["#include <beginnormal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];r&&n.push(r.code,r.result?"displaced_position = "+r.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","\tvNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{void 0===this.color&&(this.color=new uc(5855577)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});var i=this.color.flow(e,"c",{slot:"color"}),a=this.alpha?this.alpha.flow(e,"f"):void 0,o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=void 0!==a,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join("\n"));var s=["#include <normal_fragment_begin>",i.code];a&&s.push(a.code,"#ifdef ALPHATEST"," if ( "+a.result+" <= ALPHATEST ) discard;","#endif"),o?s.push(o.code,"vec3 outgoingLight = ".concat(i.result,";"),"vec3 finalColor = spe_blend(outgoingLight, ".concat(o.result,", 1.0, SPE_BLENDING_NORMAL);")):s.push("vec3 finalColor = ".concat(i.result,";")),a?s.push("gl_FragColor = vec4( finalColor, accumAlpha * ".concat(a.result," );")):s.push("gl_FragColor = vec4("+i.result+", 1.0 );"),s.push("#include <fog_fragment>","#include <dithering_fragment>"),t=s.join("\n")}return t}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),e.color&&(this.color=e.color.clone()),e.position&&(this.position=e.position.clone()),e.alpha&&(this.alpha=e.alpha.clone()),e.afterColor&&(this.afterColor=e.afterColor.clone()),e.shadingAlpha&&(this.shadingAlpha=e.shadingAlpha.clone()),e.shadingBlend&&(this.shadingBlend=e.shadingBlend.clone()),this}}]),r}(pu),qc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wc,i=arguments.length>1?arguments[1]:void 0;return(0,g.Z)(this,r),(e=t.call(this,n,n,i)).type="BasicNodeMaterial",e.fragment=n,e}return(0,y.Z)(r,[{key:"color",get:function(){return this.fragment.color},set:function(e){this.fragment.color=e}},{key:"afterColor",get:function(){return this.fragment.afterColor},set:function(e){this.fragment.afterColor=e}},{key:"alpha",get:function(){return this.fragment.alpha},set:function(e){this.fragment.alpha=e}},{key:"shadingAlpha",get:function(){return this.fragment.shadingAlpha},set:function(e){this.fragment.shadingAlpha=e}},{key:"shadingBlend",get:function(){return this.fragment.shadingBlend},set:function(e){this.fragment.shadingBlend=e}},{key:"position",get:function(){return this.fragment.position},set:function(e){this.fragment.position=e}}]),r}(jc),Jc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i){var a;return(0,g.Z)(this,r),(a=t.call(this,n,e)).userData.type="BasicMaterial",a.userData.category="Basic",a.userData.layers=null!==i&&void 0!==i?i:a._getLayerStack(null===e||void 0===e?void 0:e.map),a}return(0,y.Z)(r,[{key:"layersList",get:function(){return this.userData.layers},set:function(e){this.userData.layers=e}},{key:"equals",value:function(e){return this.userData.type===e.userData.type&&this.userData.layers.uuid==e.userData.layers.uuid}},{key:"copy",value:function(e){if(void 0!==e.userData.layers&&e.userData.layers instanceof Fc){var t=e.userData.layers,n=e.fragment;(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e);var i=n.clone();this.fragment=i,this.vertex=i;var a=t.clone(this);this.userData.layers=a}else(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e);return this}},{key:"dispose",value:function(){(0,o.Z)((0,s.Z)(r.prototype),"dispose",this).call(this)}}],[{key:"fromJSON",value:function(e,t,n){var i=new r(void 0,n.getNode(t.vertex));return i.fromJSON(t,n),i}},{key:"fromMaterial",value:function(e){var t=new r(e.map?{map:e.map}:{}),n=t.fragment;return n.color.value.copy(e.color),n.alpha.value=e.opacity,t}}]),r}(qc),Yc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;return(0,g.Z)(this,r),(e=t.call(this,"phong")).nodeType="Phong",e.color=new uc(5855577),e.specular=new uc(1118481),e.shininess=new Fu(30),e.penumbraSize=new pc(5,.5),e.shadingAlpha=new Fu(1),e.shadingBlend=new cc(0),e}return(0,y.Z)(r,[{key:"build",value:function(e){var t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){var r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(w.UniformsUtils.merge([w.UniformsLib.fog,w.UniformsLib.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var n=["#include <beginnormal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];r&&n.push(r.code,r.result?"displaced_position = "+r.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:this.penumbraSize}),void 0===this.color&&(this.color=new uc(5855577)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);var i=this.color.flow(e,"c",{slot:"color"}),a=this.specular.flow(e,"c"),o=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),u=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=void 0!==c,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[".concat(5,"];"),"#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));var h=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tBlinnPhongMaterial material;"];h.push(i.code,"\tvec3 diffuseColor = "+i.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","\tvec3 totalEmissiveRadiance = emissive;",a.code,"\tvec3 specular = "+a.result+";",o.code,"\tfloat shininess = max( 0.0001, "+o.result+" );","\tfloat specularStrength = 1.0;"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;"),h.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(s.result," * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(s.result,", ").concat(l.result," );\n\t\t\t\t}\n\t\t\t\t")),u&&h.push(u.code,"outgoingLight = spe_blend(outgoingLight, ".concat(u.result,", 1.0, SPE_BLENDING_NORMAL);")),c?h.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(c.result," );")):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join("\n")}return t}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),e.color&&(this.color=e.color.clone()),this.specular=e.specular.clone(),this.shininess=e.shininess.clone(),e.position&&(this.position=e.position.clone()),e.afterColor&&(this.afterColor=e.afterColor.clone()),e.alpha&&(this.alpha=e.alpha.clone()),e.shadingAlpha&&(this.shadingAlpha=e.shadingAlpha.clone()),e.shadingBlend&&(this.shadingBlend=e.shadingBlend.clone()),this}}]),r}(pu),Xc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yc,i=arguments.length>1?arguments[1]:void 0;return(0,g.Z)(this,r),(e=t.call(this,n,n,i)).type="PhongNodeMaterial",e.fragment=n,e}return(0,y.Z)(r,[{key:"color",get:function(){return this.fragment.color},set:function(e){this.fragment.color=e}},{key:"afterColor",get:function(){return this.fragment.afterColor},set:function(e){this.fragment.afterColor=e}},{key:"alpha",get:function(){return this.fragment.alpha},set:function(e){this.fragment.alpha=e}},{key:"shadingAlpha",get:function(){return this.fragment.shadingAlpha},set:function(e){this.fragment.shadingAlpha=e}},{key:"shadingBlend",get:function(){return this.fragment.shadingBlend},set:function(e){this.fragment.shadingBlend=e}},{key:"position",get:function(){return this.fragment.position},set:function(e){this.fragment.position=e}},{key:"specular",get:function(){return this.fragment.specular},set:function(e){this.fragment.specular=e}},{key:"shininess",get:function(){return this.fragment.shininess},set:function(e){this.fragment.shininess=e}}]),r}(jc),Kc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i){var a;return(0,g.Z)(this,r),(a=t.call(this,n,e)).userData.type="PhongMaterial",a.userData.category="Phong",a.userData.layers=null!==i&&void 0!==i?i:a._getLayerStack(null===e||void 0===e?void 0:e.map),a}return(0,y.Z)(r,[{key:"layersList",get:function(){return this.userData.layers},set:function(e){this.userData.layers=e}},{key:"equals",value:function(e){return this.userData.type===e.userData.type&&this.userData.layers.uuid==e.userData.layers.uuid}},{key:"copy",value:function(e){if(void 0!==e.userData.layers&&e.userData.layers instanceof Fc){var t=e.userData.layers,n=e.fragment;(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e);var i=n.clone();this.fragment=i,this.vertex=i;var a=t.clone(this);this.userData.layers=a,i.shadingAlpha.value=n.shadingAlpha.value,i.shadingBlend.value=n.shadingBlend.value}else(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e);return this}},{key:"dispose",value:function(){(0,o.Z)((0,s.Z)(r.prototype),"dispose",this).call(this)}}],[{key:"fromJSON",value:function(e,t,n){var i=new r(void 0,n.getNode(t.vertex));return i.fromJSON(t,n),i}},{key:"fromMaterial",value:function(e){var t=new r(e.map?{map:e.map}:{}),n=t.fragment;return n.color.value.copy(e.color),n.alpha.value=e.opacity,t}}]),r}(Xc),Qc=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;return(0,g.Z)(this,r),(e=t.call(this,"lambert")).nodeType="Lambert",e.color=new uc(5855577),e.emissive=new uc(0),e.emissiveIntensity=new Fu(1),e.penumbraSize=new pc(5,.5),e.shadingAlpha=new Fu(1),e.shadingBlend=new cc(0),e}return(0,y.Z)(r,[{key:"build",value:function(e){var t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){var r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(w.UniformsUtils.merge([w.UniformsLib.fog,w.UniformsLib.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var n=["#include <beginnormal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];r&&n.push(r.code,r.result?"displaced_position = "+r.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\n\t\t\t\t\tvec3 diffuse = vec3( 1.0 );\n\t\t\t\t\tGeometricContext geometry;\n\t\t\t\t\tgeometry.position = mvPosition.xyz;\n\t\t\t\t\tgeometry.normal = normalize( transformedNormal );\n\t\t\t\t\tgeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\t\t\t\t\tGeometricContext backGeometry;\n\t\t\t\t\tbackGeometry.position = geometry.position;\n\t\t\t\t\tbackGeometry.normal = -geometry.normal;\n\t\t\t\t\tbackGeometry.viewDir = geometry.viewDir;\n\t\t\t\t\tvLightFront = vec3( 0.0 );\n\t\t\t\t\tvIndirectFront = vec3( 0.0 );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvLightBack = vec3( 0.0 );\n\t\t\t\t\t\tvIndirectBack = vec3( 0.0 );\n\t\t\t\t\t#endif\n\t\t\t\t\tIncidentLight directLight;\n\t\t\t\t\tfloat dotNL;\n\t\t\t\t\tvec3 directLightColor_Diffuse;\n\t\t\t\t\tvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\tvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\t\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_POINT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_DIR_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_HEMI_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:this.penumbraSize}),void 0===this.color&&(this.color=new uc(5855577)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);var i=this.color.flow(e,"c",{slot:"color"}),a=this.emissive.flow(e,"c",{slot:"emissive"}),o=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),u=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=void 0!==c,e.addParsCode(["uniform float penumbraSize[".concat(5,"];"),"varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));var h=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx, viewdy));\n\t\t\t\tbool isFrontFacing = (dot(normal, faceNormal) >= 0.0);\n\t\t\t\t","#include <clipping_planes_fragment>"];h.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("#ifdef DOUBLE_SIDED","\treflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","\treflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","\treflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","\treflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),a&&h.push(a.code,"reflectedLight.directDiffuse += "+a.result+" * "+o.result+";"),h.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;"),h.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(s.result," * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(s.result,", ").concat(l.result," );\n\t\t\t\t}\n\t\t\t\t")),u&&h.push(u.code,"outgoingLight = spe_blend(outgoingLight, ".concat(u.result,", 1.0, SPE_BLENDING_NORMAL);")),c?h.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(c.result," );")):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join("\n")}return t}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.emissiveIntensity=e.emissiveIntensity.clone(),e.color&&(this.color=e.color.clone()),e.position&&(this.position=e.position.clone()),e.afterColor&&(this.afterColor=e.afterColor.clone()),e.alpha&&(this.alpha=e.alpha.clone()),e.shadingAlpha&&(this.shadingAlpha=e.shadingAlpha.clone()),e.shadingBlend&&(this.shadingBlend=e.shadingBlend.clone()),e.emissive&&(this.emissive=e.emissive.clone()),this}}]),r}(pu),$c=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qc,i=arguments.length>1?arguments[1]:void 0;return(0,g.Z)(this,r),(e=t.call(this,n,n,i)).type="LambertNodeMaterial",e.fragment=n,e}return(0,y.Z)(r,[{key:"color",get:function(){return this.fragment.color},set:function(e){this.fragment.color=e}},{key:"afterColor",get:function(){return this.fragment.afterColor},set:function(e){this.fragment.afterColor=e}},{key:"alpha",get:function(){return this.fragment.alpha},set:function(e){this.fragment.alpha=e}},{key:"shadingAlpha",get:function(){return this.fragment.shadingAlpha},set:function(e){this.fragment.shadingAlpha=e}},{key:"shadingBlend",get:function(){return this.fragment.shadingBlend},set:function(e){this.fragment.shadingBlend=e}},{key:"position",get:function(){return this.fragment.position},set:function(e){this.fragment.position=e}},{key:"emissive",get:function(){return this.fragment.emissive},set:function(e){this.fragment.emissive=e}},{key:"emissiveIntensity",get:function(){return this.fragment.emissiveIntensity},set:function(e){this.fragment.emissiveIntensity=e}}]),r}(jc),eh=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i){var a;return(0,g.Z)(this,r),(a=t.call(this,n,e)).userData.type="LambertMaterial",a.userData.category="Lambert",a.userData.layers=null!==i&&void 0!==i?i:a._getLayerStack(null===e||void 0===e?void 0:e.map),a}return(0,y.Z)(r,[{key:"layersList",get:function(){return this.userData.layers},set:function(e){this.userData.layers=e}},{key:"equals",value:function(e){return this.userData.type===e.userData.type&&this.userData.layers.uuid==e.userData.layers.uuid}},{key:"copy",value:function(e){if(void 0!==e.userData.layers&&e.userData.layers instanceof Fc){var t=e.userData.layers,n=e.fragment;(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e);var i=n.clone();this.fragment=i,this.vertex=i;var a=t.clone(this);this.userData.layers=a,i.shadingAlpha.value=n.shadingAlpha.value,i.shadingBlend.value=n.shadingBlend.value}else(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e);return this}},{key:"dispose",value:function(){(0,o.Z)((0,s.Z)(r.prototype),"dispose",this).call(this)}}],[{key:"fromJSON",value:function(e,t,n){var i=new r(void 0,n.getNode(t.vertex));return i.fromJSON(t,n),i}}]),r}($c),th=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;return(0,g.Z)(this,r),(e=t.call(this,"toon")).nodeType="Toon",e.color=new uc(5855577),e.specular=new uc(1118481),e.shininess=new Fu(30),e.penumbraSize=new pc(5,.5),e.shadingAlpha=new Fu(1),e.shadingBlend=new cc(0),e}return(0,y.Z)(r,[{key:"build",value:function(e){var t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){var r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(w.UniformsUtils.merge([w.UniformsLib.fog,w.UniformsLib.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var n=["#include <beginnormal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];r&&n.push(r.code,r.result?"displaced_position = "+r.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:this.penumbraSize}),void 0===this.color&&(this.color=new uc(5855577)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);var i=this.color.flow(e,"c",{slot:"color"}),a=this.specular.flow(e,"c"),o=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),u=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=void 0!==c,e.addParsCode(["uniform float penumbraSize[".concat(5,"];"),"varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>","\n\t\t\t\t\tvarying vec3 vViewPosition;\n\t\t\t\t\tstruct ToonMaterial {\n\t\t\t\t\t\tvec3\tdiffuseColor;\n\t\t\t\t\t\tvec3\tspecularColor;\n\t\t\t\t\t\tfloat\tspecularShininess;\n\t\t\t\t\t\tfloat\tspecularStrength;\n\t\t\t\t\t};\n\t\t\t\t\tvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t\t\t\n\t\t\t\t\t\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n\t\t\t\t\t}\n\t\t\t\t\tvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t}\n\t\t\t\t\t#define RE_Direct\t\t\t\tRE_Direct_Toon\n\t\t\t\t\t#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\t\t\t\t\t#define Material_LightProbeLOD( material )\t(0)\n\t\t\t\t\t","#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join("\n"));var h=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tToonMaterial material;"];h.push(i.code,"\tvec3 diffuseColor = "+i.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"\tvec3 specular = "+a.result+";",o.code,"\tfloat shininess = max( 0.0001, "+o.result+" );","\tfloat specularStrength = 1.0;"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),h.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(s.result," * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(s.result,", ").concat(l.result," );\n\t\t\t\t}\n\t\t\t\t")),u&&h.push(u.code,"outgoingLight = spe_blend(outgoingLight, ".concat(u.result,", 1.0, SPE_BLENDING_NORMAL);")),c?h.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(c.result," );")):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join("\n")}return t}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),e.color&&(this.color=e.color.clone()),this.specular=e.specular.clone(),this.shininess=e.shininess.clone(),e.position&&(this.position=e.position.clone()),e.afterColor&&(this.afterColor=e.afterColor.clone()),e.alpha&&(this.alpha=e.alpha.clone()),e.shadingAlpha&&(this.shadingAlpha=e.shadingAlpha.clone()),e.shadingBlend&&(this.shadingBlend=e.shadingBlend.clone()),this}}]),r}(pu),rh=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new th,i=arguments.length>1?arguments[1]:void 0;return(0,g.Z)(this,r),(e=t.call(this,n,n,i)).type="ToonNodeMaterial",e.fragment=n,e}return(0,y.Z)(r,[{key:"color",get:function(){return this.fragment.color},set:function(e){this.fragment.color=e}},{key:"afterColor",get:function(){return this.fragment.afterColor},set:function(e){this.fragment.afterColor=e}},{key:"alpha",get:function(){return this.fragment.alpha},set:function(e){this.fragment.alpha=e}},{key:"shadingAlpha",get:function(){return this.fragment.shadingAlpha},set:function(e){this.fragment.shadingAlpha=e}},{key:"shadingBlend",get:function(){return this.fragment.shadingBlend},set:function(e){this.fragment.shadingBlend=e}},{key:"position",get:function(){return this.fragment.position},set:function(e){this.fragment.position=e}},{key:"specular",get:function(){return this.fragment.specular},set:function(e){this.fragment.specular=e}},{key:"shininess",get:function(){return this.fragment.shininess},set:function(e){this.fragment.shininess=e}}]),r}(jc),nh=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i){var a;return(0,g.Z)(this,r),(a=t.call(this,n,e)).userData.type="ToonMaterial",a.userData.category="Toon",a.userData.layers=null!==i&&void 0!==i?i:a._getLayerStack(null===e||void 0===e?void 0:e.map),a}return(0,y.Z)(r,[{key:"layersList",get:function(){return this.userData.layers},set:function(e){this.userData.layers=e}},{key:"equals",value:function(e){return this.userData.type===e.userData.type&&this.userData.layers.uuid==e.userData.layers.uuid}},{key:"copy",value:function(e){if(void 0!==e.userData.layers&&e.userData.layers instanceof Fc){var t=e.userData.layers,n=e.fragment;(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e);var i=n.clone();this.fragment=i,this.vertex=i;var a=t.clone(this);this.userData.layers=a,i.shadingAlpha.value=n.shadingAlpha.value,i.shadingBlend.value=n.shadingBlend.value}else(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e);return this}},{key:"dispose",value:function(){(0,o.Z)((0,s.Z)(r.prototype),"dispose",this).call(this)}}],[{key:"fromJSON",value:function(e,t,n){var i=new r(void 0,n.getNode(t.vertex));return i.fromJSON(t,n),i}}]),r}(rh),ih=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;return(0,g.Z)(this,r),(e=t.call(this,"standard")).nodeType="Standard",e.color=new uc(5855577),e.roughness=new Fu(.3),e.metalness=new Fu(0),e.reflectivity=new Fu(.5),e.penumbraSize=new pc(5,.5),e.shadingAlpha=new Fu(1),e.shadingBlend=new cc(0),e}return(0,y.Z)(r,[{key:"build",value:function(e){var t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){var r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(w.UniformsUtils.merge([w.UniformsLib.fog,w.UniformsLib.lights])),w.UniformsLib.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var n=["#include <beginnormal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];r&&n.push(r.code,r.result?"displaced_position = "+r.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:this.penumbraSize});var i={gamma:!0};void 0===this.color&&(this.color=new uc(5855577)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);var a=this.color.flow(e,"c",{slot:"color",context:i}),o=this.roughness.flow(e,"f"),s=this.metalness.flow(e,"f"),l=this.shadingAlpha.flow(e,"f"),u=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(e,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=void 0!==h,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[".concat(5,"];"),"#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join("\n"));var f=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];f.push(a.code,"\tvec3 diffuseColor = "+a.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",o.code,"\tfloat roughnessFactor = "+o.result+";",s.code,"\tfloat metalnessFactor = "+s.result+";"),h&&f.push(h.code,"#ifdef ALPHATEST","\tif ( "+h.result+" <= ALPHATEST ) discard;","#endif"),f.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),f.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?f.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):f.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),f.push("#include <lights_fragment_begin>"),f.push("#include <lights_fragment_end>"),f.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),f.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(l.result," * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(l.result,", ").concat(u.result," );\n\t\t\t\t}\n\t\t\t\t")),c&&f.push(c.code,"outgoingLight = spe_blend(outgoingLight, ".concat(c.result,", 1.0, SPE_BLENDING_NORMAL);")),h?f.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(h.result," );")):f.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),f.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=f.join("\n")}return t}},{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),e.color&&(this.color=e.color.clone()),this.roughness=e.roughness.clone(),this.metalness=e.metalness.clone(),e.position&&(this.position=e.position.clone()),e.afterColor&&(this.afterColor=e.afterColor.clone()),e.alpha&&(this.alpha=e.alpha.clone()),e.reflectivity&&(this.reflectivity=e.reflectivity.clone()),e.shadingAlpha&&(this.shadingAlpha=e.shadingAlpha.clone()),e.shadingBlend&&(this.shadingBlend=e.shadingBlend.clone()),this}}]),r}(pu),ah=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ih,i=arguments.length>1?arguments[1]:void 0;return(0,g.Z)(this,r),(e=t.call(this,n,n,i)).type="StandardNodeMaterial",e.fragment=n,e}return(0,y.Z)(r,[{key:"color",get:function(){return this.fragment.color},set:function(e){this.fragment.color=e}},{key:"afterColor",get:function(){return this.fragment.afterColor},set:function(e){this.fragment.afterColor=e}},{key:"alpha",get:function(){return this.fragment.alpha},set:function(e){this.fragment.alpha=e}},{key:"shadingAlpha",get:function(){return this.fragment.shadingAlpha},set:function(e){this.fragment.shadingAlpha=e}},{key:"shadingBlend",get:function(){return this.fragment.shadingBlend},set:function(e){this.fragment.shadingBlend=e}},{key:"position",get:function(){return this.fragment.position},set:function(e){this.fragment.position=e}},{key:"roughness",get:function(){return this.fragment.roughness},set:function(e){this.fragment.roughness=e}},{key:"metalness",get:function(){return this.fragment.metalness},set:function(e){this.fragment.metalness=e}},{key:"reflectivity",get:function(){return this.fragment.reflectivity},set:function(e){this.fragment.reflectivity=e}}]),r}(jc),oh=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i){var a;return(0,g.Z)(this,r),(a=t.call(this,n,e)).userData.type="PhysicalMaterial",a.userData.category="Physical",a.userData.layers=null!==i&&void 0!==i?i:a._getLayerStack(null===e||void 0===e?void 0:e.map),a}return(0,y.Z)(r,[{key:"layersList",get:function(){return this.userData.layers},set:function(e){this.userData.layers=e}},{key:"equals",value:function(e){return this.userData.type===e.userData.type&&this.userData.layers.uuid==e.userData.layers.uuid}},{key:"copy",value:function(e){if(void 0!==e.userData.layers&&e.userData.layers instanceof Fc){var t=e.userData.layers,n=e.fragment;(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e);var i=n.clone();this.fragment=i,this.vertex=i;var a=t.clone(this);this.userData.layers=a,i.shadingAlpha.value=n.shadingAlpha.value,i.shadingBlend.value=n.shadingBlend.value}else(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e);return this}},{key:"dispose",value:function(){(0,o.Z)((0,s.Z)(r.prototype),"dispose",this).call(this)}}],[{key:"fromJSON",value:function(e,t,n){var i=new r(void 0,n.getNode(t.vertex));return i.fromJSON(t,n),i}}]),r}(ah);function sh(e,t){var r;if("string"!=typeof e)return new Su(e.r,e.g,e.b,"a"in e?e.a:1);var n=null===t||void 0===t?void 0:t.getColor(e);return n?r=n:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),r=new Su(0,0,0,0)),r}function lh(e,t){switch(e.data.type){case"light":return ch(e);case"fresnel":return function(e,t){var r=e.data,n=r.bias,i=r.scale,a=r.intensity,o=r.factor,s=r.color;return(0,x.Z)((0,x.Z)({},ch(e)),{},{color:sh(s,t),bias:n,scale:i,intensity:a,factor:o})}(e,t);case"gradient":return function(e){var t=e.data,r=t.gradientType,n=t.smooth,i=t.colors,o=t.steps,s=t.angle,l=t.offset,u=t.morph;return(0,x.Z)((0,x.Z)({},ch(e)),{},{gradientType:r,smooth:n,colors:i.map((function(e){return new w.Vector4(e[0],e[1],e[2],e[3])})),num:i.length,steps:o,offset:(0,a.Z)(w.Vector2,(0,c.Z)(l)),morph:(0,a.Z)(w.Vector2,(0,c.Z)(u)),angle:s})}(e);case"depth":return function(e){var t=e.data,r=t.gradientType,n=t.near,i=t.far,o=t.isVector,s=t.isWorldSpace,l=t.origin,u=t.direction,h=t.colors,d=t.steps,f=t.smooth,v=t.num;return(0,x.Z)((0,x.Z)({},ch(e)),{},{gradientType:r,near:n,far:i,isVector:o,isWorldSpace:s,origin:(0,a.Z)(w.Vector3,(0,c.Z)(l)),direction:u?(0,a.Z)(w.Vector3,(0,c.Z)(u)):new w.Vector3(1,0,0),num:v,colors:h.map((function(e){return new w.Vector4(e[0],e[1],e[2],e[3])})),steps:d,smooth:f})}(e);case"normal":return function(e){var t=e.data.cnormal;return(0,x.Z)((0,x.Z)({},ch(e)),{},{cnormal:new w.Vector3(t[0],t[1],t[2])})}(e);case"noise":return function(e,t){var r=e.data;return(0,x.Z)((0,x.Z)({},ch(e)),{},{scale:r.scale,move:r.move,fA:(0,a.Z)(w.Vector2,(0,c.Z)(r.fA)),fB:(0,a.Z)(w.Vector2,(0,c.Z)(r.fB)),size:(0,a.Z)(w.Vector3,(0,c.Z)(r.size)),distortion:(0,a.Z)(w.Vector2,(0,c.Z)(r.distortion)),colorA:sh(r.colorA,t),colorB:sh(r.colorB,t),colorC:sh(r.colorC,t),colorD:sh(r.colorD,t),noiseType:r.noiseType})}(e,t);case"texture":return function(e,t){var r,n=e.data,i=n.projection,a=n.axis,o=n.side,s=n.crop,l=n.size,u=e.data.texture,c=u.image,h=u.wrapping,d=u.repeat,f=u.offset,v=new w.Texture;if("string"==typeof c)r=null===t||void 0===t?void 0:t.getImage(c);else{var p=new Image;p.src=Lf(c.data),p.onload=function(){(null===t||void 0===t?void 0:t.onImageLoad)&&(null===t||void 0===t||t.onImageLoad())},r=p}return v.image=r,v.repeat.set(d[0],d[1]),v.offset.set(f[0],f[1]),v.wrapS=v.wrapT=h,(0,x.Z)((0,x.Z)({},ch(e)),{},{texture:v,mat:(new w.Matrix3).setUvTransform(f[0],f[1],d[0],d[1],0,0,0),crop:s,projection:i,axis:["x","y","z"].indexOf(a),side:[2,0,1].indexOf(o),size:l})}(e,t);case"rainbow":return function(e){var t=e.data;return(0,x.Z)((0,x.Z)({},ch(e)),{},{filmThickness:t.filmThickness,movement:t.movement,wavelengths:(0,a.Z)(w.Vector3,(0,c.Z)(t.wavelengths)),noiseStrength:t.noiseStrength,noiseScale:t.noiseScale,offset:(0,a.Z)(w.Vector3,(0,c.Z)(t.offset))})}(e);case"transmission":return function(e,t){var r=e.data;return(0,x.Z)((0,x.Z)({},ch(e)),{},{thickness:r.thickness,ior:r.ior,roughness:r.roughness,transmissionSamplerMap:t.transmissionSamplerMap,transmissionDepthMap:t.transmissionDepthMap})}(e,t);case"matcap":return function(e,t){var r,n=new w.Texture,i=e.data.texture.image;if("string"==typeof i)r=null===t||void 0===t?void 0:t.getImage(i);else{var a=new Image;a.src=Lf(i.data),a.onload=function(){(null===t||void 0===t?void 0:t.onImageLoad)&&(null===t||void 0===t||t.onImageLoad())},r=a}n.image=r;var o=16777215;return(0,x.Z)((0,x.Z)({},ch(e)),{},{color:o,texture:n})}(e,t);case"displace":return function(e){var t=e.data,r=(0,x.Z)((0,x.Z)({},uh(e)),{},{intensity:t.intensity});if("noise"===t.displacementType)return(0,x.Z)((0,x.Z)({},r),{},{offset:(0,a.Z)(w.Vector3,(0,c.Z)(t.offset)),scale:t.scale,movement:t.movement,noiseType:t.noiseType});var n=new w.Texture,i=(new w.Matrix3).setUvTransform(0,0,1,1,0,0,0);return(0,x.Z)((0,x.Z)({},r),{},{texture:n,mat:i,crop:t.crop})}(e);default:return function(e,t){return(0,x.Z)((0,x.Z)({},ch(e)),{},{color:sh(e.data.color,t)})}(e,t)}}function uh(e){return{type:e.data.type}}function ch(e){var t=e.data,r=t.alpha,n=t.mode;return(0,x.Z)((0,x.Z)({},uh(e)),{},{alpha:r,mode:n})}function hh(e,t,r){if("displace"===r.type&&("intensity"===e||"visible"===e)){var n=t.uniforms["f".concat(t.id,"_intensity")];return n?(n.value=r.intensity*(r.visible?1:0),n):void 0}if("displace"!==r.type&&("alpha"===e||"visible"===e)){var i=t.uniforms["f".concat(t.id,"_alpha")];return i?(i.value=r.alpha*(r.visible?1:0),i):void 0}}function dh(e,t){return"string"==typeof e?t.getMaterialOrDeletedPlaceholder(e):fh(e,t)}function fh(e,t){var r,n,i,a=null!==(r=e.layers)&&void 0!==r?r:Do.defaultTwoLayerData("phong").layers,o=function(e){var t,r=(0,b.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if("light"===n.data.type)return n.data}}catch(i){r.e(i)}finally{r.f()}return{type:"light",category:"basic",visible:!0,alpha:1,mode:0}}(a);switch(o.category){case"basic":i=new Jc;break;case"lambert":i=new eh;break;case"toon":i=new nh;break;case"physical":i=new oh;break;default:i=new Kc}i.name=null!==(n=e.name)&&void 0!==n?n:"Untitled Material";var s=i.userData.layers;!function(e){var t,r=(0,b.Z)(e.getLayers());try{for(r.s();!(t=r.n()).done;){var n=t.value;e.removeLayer(n.id)}}catch(i){r.e(i)}finally{r.f()}}(s);for(var l=a.length-1;l>=0;l--)vh(s,a[l],t);switch(o.category){case"basic":break;case"lambert":var u=i,c=sh(o.emissive,t);c instanceof w.Color?u.emissive.value=c:u.emissive.value.setHex(Rc.getHex(c));break;case"toon":var h=i,d=o;h.shininess.value=d.shininess;var f=sh(d.specular,t);f instanceof w.Color?h.specular.value=f:h.specular.value.setHex(Rc.getHex(f));break;case"physical":var v=i,p=o;v.metalness.value=p.metalness,v.roughness.value=p.roughness,v.reflectivity.value=p.reflectivity;break;default:var m=i,g=o;m.shininess.value=g.shininess;var y=sh(g.specular,t);y instanceof w.Color?m.specular.value=y:m.specular.value.setHex(Rc.getHex(y))}return i.penumbraSizeNode=t.penumbraSizeNode,s.blendColors(),s.blendAfterColors(),s.blendPositions(),i}function vh(e,t,r){var n=lh(t,r);"transmission"===n.type&&(n.transmissionSamplerMap=null===r||void 0===r?void 0:r.transmissionSamplerMap,n.transmissionDepthMap=null===r||void 0===r?void 0:r.transmissionDepthMap);var i=e.addLayer(n);for(var a in i.uuid=t.id,t.data)hh(a,i,t.data)}!function(e){e.getHex=function(e){return new w.Color(e.x,e.y,e.z).getHex()}}(Rc||(Rc={})),function(e){e.getThreeVector4=function(e){return new w.Vector4(e.r,e.g,e.b,e.a)}}(Gc||(Gc={})),function(e){e.setThreeColor=function(e,t){e.setRGB(t.r,t.g,t.b)},e.getHex=function(e){return new w.Color(e.r,e.g,e.b).getHex()}}(Hc||(Hc={}));var ph=function(e){return"isEntity"in e},mh=function(e){return"isAbstractMesh"in e},gh=function(e){return null!==e&&e.isBooleanMesh},yh=function(e){return"CombinedCamera"===e.objectType},xh=function(e){return"objectHelper"in e};function bh(e,t){(function(e,t){var r,n=!1;t.position&&(e.position.fromArray(t.position),n=!0),t.rotation&&(e.rotation.fromArray(t.rotation),n=!0),t.scale&&(n=!0,e.scale.fromArray(t.scale)),void 0!==t.hiddenMatrix&&"hiddenMatrix"in e&&(n=!0,e.hiddenMatrix.fromArray(null!==(r=t.hiddenMatrix)&&void 0!==r?r:di.identity)),n&&(e.updateMatrix(),gh(e.parent)&&mh(e)&&e.invalidateDownstreamBooleanData(!0).recomputeBoolean()),t.position&&t.rotation&&t.scale&&void 0!==t.hiddenMatrix&&e.updateWorldMatrix(!1,!0),"CombinedCamera"===e.objectType&&(void 0!==t.isUpVectorFlipped&&(e.isUpVectorFlipped=t.isUpVectorFlipped),e.updateUp())})(e,t),void 0!==t.name&&(e.name=t.name),void 0!==t.visible&&(e.isEntity?e.visibility=t.visible:e.visible=t.visible)}var wh=new w.Box3,Sh=new w.Vector3,kh=new w.Vector3,_h=new w.Matrix4,Ch=[new w.Vector3(-1,1,1),new w.Vector3(-1,-1,1),new w.Vector3(1,-1,1),new w.Vector3(1,1,1),new w.Vector3(-1,1,-1),new w.Vector3(-1,-1,-1),new w.Vector3(1,-1,-1),new w.Vector3(1,1,-1)],Oh=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],Zh=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]];var Lh=function(e,t,r,n){if(mh(e)){var i,a=e.geometry.userData.parameters,o=e.geometry.getAttribute("position");"SubdivGeometry"===e.geometry.userData.type?Sh.copy(e.originalGeometry.boundingSphere.center):void 0!==o&&(function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.count,i=1/0,a=1/0,o=1/0,s=-1/0,l=-1/0,u=-1/0,c=r;c<n;c++){var h=t.getX(c),d=t.getY(c),f=t.getZ(c);h<i&&(i=h),d<a&&(a=d),f<o&&(o=f),h>s&&(s=h),d>l&&(l=d),f>u&&(u=f)}e.min.set(i,a,o),e.max.set(s,l,u)}(wh,o,e.geometry.drawRange.start,e.geometry.drawRange.count<1/0?e.geometry.drawRange.count:o.count),wh.getCenter(Sh)),e.forceComputeSize?wh.getSize(kh).multiplyScalar(.5):kh.set(a.width,a.height,null!==(i=a.depth)&&void 0!==i?i:0).multiplyScalar(.5)}else if(xh(e)&&!0===n){var s=e.geometryHelper.getAttribute("position");wh.setFromArray(s.array),wh.getCenter(Sh),wh.getSize(kh).multiplyScalar(.5)}else Sh.setScalar(0),kh.setScalar(0);_h.copy(t).multiply(e.matrixWorld),0===kh.x&&0===kh.y&&0===kh.z?r.push(new w.Vector3(Sh.x,Sh.y,Sh.z).applyMatrix4(_h)):Ch.forEach((function(e){r.push(e.clone().multiply(kh).add(Sh).applyMatrix4(_h))}))},Ah=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;return(0,g.Z)(this,r),(e=t.apply(this,arguments)).matrix=new w.Matrix4,e.vertices=[],e.faces=[],e.edges=[],e.centerEdges=[],e}return(0,y.Z)(r,[{key:"copy",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map((function(e){return e.clone()})),this.faces=e.faces.map((function(e){return e.clone()})),this.edges=e.edges.map((function(e){return e.clone()})),this.centerEdges=e.centerEdges.map((function(e){return e.clone()})),this}},{key:"setFromObjectSize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);var r=(new w.Matrix4).copy(e.matrixWorld).invert();return this.expandByObjectSize(e,r,t)}},{key:"expandByObjectSize",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[];return!0===r?e.traverseEntity((function(r){r.visible&&Lh(r,t,n,!0===e.enableHelper)})):Lh(e,t,n,!0===e.enableHelper),this.setFromPoints(n)}},{key:"getCenter",value:function(e){return(e=(0,o.Z)((0,s.Z)(r.prototype),"getCenter",this).call(this,e)).applyMatrix4(this.matrix),e}},{key:"getPositionToCenter",value:function(e){return(e=(0,o.Z)((0,s.Z)(r.prototype),"getCenter",this).call(this,e)).applyMatrix4(_h.copy(this.matrix).setPosition(0,0,0)),e}},{key:"computeVertices",value:function(){this.getSize(kh).multiplyScalar(.5),this.getCenter(Sh),_h.copy(this.matrix).setPosition(Sh),this.vertices=Ch.map((function(e){return e.clone().multiply(kh).applyMatrix4(_h)}))}},{key:"computeEdges",value:function(){var e=this;this.vertices.length>0&&this.computeVertices(),this.edges=Oh.map((function(t){var r=(0,u.Z)(t,2),n=r[0],i=r[1];return new w.Line3(e.vertices[n],e.vertices[i])})),this.centerEdges=this.edges.map((function(e){return e.getCenter(new w.Vector3)}))}},{key:"computeFaces",value:function(){var e=this;this.vertices.length>0&&this.computeVertices(),this.faces=Zh.map((function(t){var r=(0,u.Z)(t,2),n=r[0],i=r[1];return e.vertices[n].clone().add(e.vertices[i]).multiplyScalar(.5)}))}}]),r}(w.Box3);function Mh(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}var Dh,Th=function(e){return function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){return(0,g.Z)(this,r),t.apply(this,arguments)}return(0,y.Z)(r,[{key:"hasEntityChild",value:function(){return this.children.some((function(e){return ph(e)}))}},{key:"isDescendantOf",value:function(e){e instanceof w.Object3D&&(e=e.uuid);for(var t=this;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}},{key:"attach",value:function(e,t){this.updateWorldMatrix(!0,!1);var r=(new w.Matrix4).copy(this.matrixWorld).invert();return null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),r.multiply(e.parent.matrixWorld)),ph(e)?e.hiddenMatrix.premultiply(r):e.applyMatrix4(r),e.updateWorldMatrix(!1,!1),this.add(e),void 0!==t&&(this.children.pop(),this.children.splice(t,0,e)),this}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++){var n=e.children[r];this.add(n.clone())}return this}},{key:"toJSON",value:function(e){var t=void 0===e,r={object:{uuid:"",objectType:""}};void 0===e&&(e={geometries:{},materials:{},textures:{},images:{},interactionStates:{},nodes:{}},r.metadata={version:1.5,type:"Object",generator:"Object3D.toJSON"});var n={uuid:this.uuid,objectType:this.type};if(""!==this.name&&(n.name=this.name),n.matrix=this.matrix.toArray(),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),n.layers=this.layers.mask,"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),this.children.length>0){n.children=[];var i,a=(0,b.Z)(this.children);try{for(a.s();!(i=a.n()).done;){var o=i.value;(ph(o)||o instanceof w.Light)&&n.children.push(o.toJSON(e).object)}}catch(f){a.e(f)}finally{a.f()}}if(t){var s=Mh(e.geometries),l=Mh(e.materials),u=Mh(e.textures),c=Mh(e.images),h=Mh(e.interactionStates),d=function(e){var t=[];for(var r in e)t.push(e[r]);return t}(e.nodes);s.length>0&&(r.geometries=s),l.length>0&&(r.materials=l),u.length>0&&(r.textures=u),c.length>0&&(r.images=c),h.length>0&&(r.interactionStates=h),d.length>0&&(r.nodes=d)}return r.object=n,r}},{key:"fromJSON",value:function(e){return this.uuid=e.uuid,void 0!==e.name&&(this.name=e.name),void 0!==e.matrix?(this.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(this.matrixAutoUpdate=e.matrixAutoUpdate),this.matrixAutoUpdate&&this.matrix.decompose(this.position,this.quaternion,this.scale)):(void 0!==e.position&&this.position.fromArray(e.position),void 0!==e.rotation&&this.rotation.fromArray(e.rotation),void 0!==e.quaternion&&this.quaternion.fromArray(e.quaternion),void 0!==e.scale&&this.scale.fromArray(e.scale)),this.castShadow=void 0!==e.castShadow,this.receiveShadow=void 0!==e.receiveShadow,void 0!==e.visible&&(this.visible=e.visible),void 0!==e.frustumCulled&&(this.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(this.renderOrder=e.renderOrder),void 0!==e.layers&&(this.layers.mask=e.layers),void 0!==e.userData&&(this.userData=e.userData),this}}]),r}(e)},zh=function(e){return"isEntity"in e},Eh=function(e){return"isAbstractMesh"in e},Ph=function(e){return function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;return(0,g.Z)(this,r),(e=t.apply(this,arguments)).objectType="",e.isEntity=!0,e.raycastLock=!1,e.scaleLock=!1,e.hiddenMatrix=new w.Matrix4,e._singleBBox=new Ah,e._recursiveBBox=new Ah,e.singleBBoxNeedsUpdate=!0,e.recursiveBBoxNeedsUpdate=!0,e.forceComputeSize=!1,e}return(0,y.Z)(r,[{key:"visibility",get:function(){return this.visible},set:function(e){this.visible=e;var t,r=(0,b.Z)(this.children);try{for(r.s();!(t=r.n()).done;){var n=t.value;zh(n)&&n.traverseEntity((function(t){xh(t)&&t.visible&&(t.objectHelper.visible=e)}))}}catch(i){r.e(i)}finally{r.f()}}},{key:"singleBBox",get:function(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}},{key:"recursiveBBox",get:function(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}},{key:"resetBBoxNeedsUpdate",value:function(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.traverseAncestors((function(e){zh(e)&&(e.singleBBoxNeedsUpdate=!0,e.recursiveBBoxNeedsUpdate=!0)})),this.traverseEntity((function(e){e.singleBBoxNeedsUpdate=!0,e.recursiveBBoxNeedsUpdate=!0}))}},{key:"traverseEntity",value:function(e){e(this);var t,r=(0,b.Z)(this.children);try{for(r.s();!(t=r.n()).done;){var n=t.value;zh(n)&&n.traverseEntity(e)}}catch(i){r.e(i)}finally{r.f()}}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);var t,r=(0,b.Z)(this.children);try{for(r.s();!(t=r.n()).done;){t.value.updateMatrixWorld(e)}}catch(n){r.e(n)}finally{r.f()}}},{key:"updateWorldMatrix",value:function(e,t){var r=this.parent;if(e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),t){var n,i=(0,b.Z)(this.children);try{for(i.s();!(n=i.n()).done;){n.value.updateWorldMatrix(!1,!0)}}catch(a){i.e(a)}finally{i.f()}}}},{key:"shallowClone",value:function(e){return(new this.constructor).shallowCopy(this,e)}},{key:"shallowCopy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if((0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e,!1),this.raycastLock=e.raycastLock,this.scaleLock=e.scaleLock,this.hiddenMatrix.copy(e.hiddenMatrix),!0===t){var n,i=(0,b.Z)(e.children);try{for(i.s();!(n=i.n()).done;){var a=n.value;zh(a)&&this.add(a.shallowClone())}}catch(l){i.e(l)}finally{i.f()}}return this}},{key:"clone",value:function(e){return(new this.constructor).copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if((0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e,!1),this.raycastLock=e.raycastLock,this.scaleLock=e.scaleLock,this.hiddenMatrix.copy(e.hiddenMatrix),!0===t){var n,i=(0,b.Z)(e.children);try{for(i.s();!(n=i.n()).done;){var a=n.value;zh(a)&&this.add(a.clone())}}catch(l){i.e(l)}finally{i.f()}}return this}},{key:"keepChildrenMatrixWorld",value:function(){var e=new w.Matrix4,t=this.matrixWorld.clone();this.updateWorldMatrix(!1,!1),e.copy(this.matrixWorld).invert(),e.multiply(t);var r,n=(0,b.Z)(this.children);try{for(n.s();!(r=n.n()).done;){var i=r.value;zh(i)&&i.hiddenMatrix.premultiply(e)}}catch(a){n.e(a)}finally{n.f()}}},{key:"toJSON",value:function(e){var t=(0,o.Z)((0,s.Z)(r.prototype),"toJSON",this).call(this,e),n=t.object;return!0===this.raycastLock&&(n.raycastLock=!0),!0===this.scaleLock&&(n.scaleLock=!0),n.hiddenMatrix=this.hiddenMatrix.toArray(),t}},{key:"fromJSON",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"fromJSON",this).call(this,e),void 0!==e.raycastLock&&(this.raycastLock=e.raycastLock),void 0!==e.scaleLock&&(this.scaleLock=e.scaleLock),this.hiddenMatrix.fromArray(e.hiddenMatrix),this}},{key:"fromObject3D",value:function(e){var t=e.children;return e.children=[],Object.assign(e,{raycastLock:!1,scaleLock:!1,hiddenMatrix:new w.Matrix4}),this.copy(e),e.children=t,this}},{key:"toObjectTransformState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.updateWorldMatrix(!0,!1);var t={position:this.position.toArray(),rotation:[this.rotation.x,this.rotation.y,this.rotation.z],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return ki(t,e)}},{key:"fromObjectTransformState",value:function(e){return e.position&&this.position.fromArray(e.position),e.rotation&&this.rotation.fromArray(e.rotation),e.scale&&this.scale.fromArray(e.scale),e.hiddenMatrix&&this.hiddenMatrix.fromArray(e.hiddenMatrix),this.updateMatrix(),this}},{key:"toState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(0,x.Z)({name:this.name,visible:this.visible,raycastLock:this.raycastLock},this.toObjectTransformState(e));return ki(t,e)}},{key:"fromState",value:function(e,t){return e.name&&(this.name=e.name),void 0!==e.raycastLock&&(this.raycastLock=e.raycastLock),"OrthographicCamera"!==e.type&&"PerspectiveCamera"!==e.type&&(this.matrixAutoUpdate=!1),void 0!==e.visible&&(this.visibility=e.visible),this.fromObjectTransformState(e),this}}]),r}(Th(e))},Nh=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,g.Z)(this,r),(n=t.call(this)).object=e;var a=e.recursiveBBox.getSize(new w.Vector3),o=.1;return n.parameters=bi.defaultData(a.toArray(),o),ni(n.parameters,i),n.update(),n.setHideBase(n.parameters.hideBase),n}return(0,y.Z)(r,[{key:"refreshMaterial",value:function(){if("material"in this.object){var e,t=(0,b.Z)(this.children);try{for(t.s();!(e=t.n()).done;){e.value.material=this.object.material}}catch(r){t.e(r)}finally{t.f()}}}},{key:"setHideBase",value:function(e){if("material"in this.object){if(Array.isArray(this.object.material)){if(this.children.length>0){var t,r=(0,b.Z)(this.object.material);try{for(r.s();!(t=r.n()).done;){t.value.visible=!0}}catch(p){r.e(p)}finally{r.f()}if(e){var n,i=this.object.material.map((function(e){return e.clone()})),a=(0,b.Z)(this.children);try{for(a.s();!(n=a.n()).done;){n.value.material=i}}catch(p){a.e(p)}finally{a.f()}}else{var o,s=(0,b.Z)(this.children);try{for(s.s();!(o=s.n()).done;){o.value.material=this.object.material}}catch(p){s.e(p)}finally{s.f()}}}var l,u=(0,b.Z)(this.object.material);try{for(u.s();!(l=u.n()).done;){l.value.visible=!e}}catch(p){u.e(p)}finally{u.f()}}else{if(this.children.length>0)if(this.object.material.visible=!0,e){var c,h=this.object.material.clone(),d=(0,b.Z)(this.children);try{for(d.s();!(c=d.n()).done;){c.value.material=h}}catch(p){d.e(p)}finally{d.f()}}else{var f,v=(0,b.Z)(this.children);try{for(v.s();!(f=v.n()).done;){f.value.material=this.object.material}}catch(p){v.e(p)}finally{v.f()}}this.object.material.visible=!e}this.parameters.hideBase=e}}},{key:"update",value:function(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters)}this.children.forEach((function(e){return e.updateMatrix()}))}},{key:"_updateCount",value:function(){var e="grid"===this.parameters.type?this.parameters.grid.count[0]*this.parameters.grid.count[1]*this.parameters.grid.count[2]:this.parameters.count;if(this.children.length!==e)if(this.children.length<e)for(var t=0,r=e-this.children.length;t<r;++t){var n=this.object.shallowClone(!1);n.visible=!0,this.add(n),this.parameters.hideBase&&this.setHideBase(!0)}else for(var i=0,a=this.children.length-e;i<a;++i)this.remove(this.children[0])}},{key:"_updateRadial",value:function(e){var t,r=e.radial,n=r.start*w.MathUtils.DEG2RAD,i=n-r.end*w.MathUtils.DEG2RAD,a=new w.Euler(r.rotation[0]*w.MathUtils.DEG2RAD,r.rotation[1]*w.MathUtils.DEG2RAD,r.rotation[2]*w.MathUtils.DEG2RAD);switch(r.axis){case"z":t=new w.Vector3(0,0,1);break;case"y":t=new w.Vector3(0,1,0);break;default:t=new w.Vector3(1,0,0)}var o,s=(0,b.Z)(this.children.entries());try{for(s.s();!(o=s.n()).done;){var l=(0,u.Z)(o.value,2),c=l[0],h=l[1];h.hiddenMatrix.identity(),h.scale.x=r.scale[0],h.scale.y=r.scale[1],h.scale.z=r.scale[2],h.position.setScalar(0);var d=i/e.count*c-n;switch(r.axis){case"x":h.rotation.set(0,d,0);break;case"y":h.rotation.set(0,0,d);break;case"z":h.rotation.set(d,0,0)}h.translateOnAxis(t,r.radius),h.position.x+=r.position[0],h.position.y+=r.position[1],h.position.z+=r.position[2],!0===r.alignment?(h.rotation.x+=a.x,h.rotation.y+=a.y,h.rotation.z+=a.z):h.rotation.copy(a)}}catch(f){s.e(f)}finally{s.f()}}},{key:"_updateLinear",value:function(e){if("linear"!==e.type)throw new Error;var t,r=e.linear,n=new w.Euler(r.rotation[0]*w.MathUtils.DEG2RAD,r.rotation[1]*w.MathUtils.DEG2RAD,r.rotation[2]*w.MathUtils.DEG2RAD),i=(0,b.Z)(this.children.entries());try{for(i.s();!(t=i.n()).done;){var a=(0,u.Z)(t.value,2),o=a[0],s=a[1];s.hiddenMatrix.identity(),s.scale.x=1+(r.scale[0]-1)*o,s.scale.y=1+(r.scale[1]-1)*o,s.scale.z=1+(r.scale[2]-1)*o,s.rotation.x=n.x*o,s.rotation.y=n.y*o,s.rotation.z=n.z*o,s.position.x=r.position[0]*o,s.position.y=r.position[1]*o,s.position.z=r.position[2]*o}}catch(l){i.e(l)}finally{i.f()}}},{key:"_updateGrid",value:function(e){var t=0,r=e.grid;if(!0===r.useCenter)for(var n={x:r.count[0]%2===0?2:1,y:r.count[1]%2===0?2:1,z:r.count[2]%2===0?2:1},i=new w.Vector3(r.size[0]*(r.count[0]-n.x)*.5,r.size[1]*(r.count[1]-n.y)*.5,r.size[2]*(r.count[2]-n.z)*.5),a=0;a<r.count[0];a++)for(var o=0;o<r.count[1];o++)for(var s=0;s<r.count[2];s++){var l=this.children[t++];l.hiddenMatrix.identity(),l.scale.setScalar(1),l.rotation.set(0,0,0),l.position.x=r.size[0]*a-i.x,l.position.y=r.size[1]*o-i.y,l.position.z=r.size[2]*s-i.z}else for(var u=0;u<r.count[0];u++)for(var c=0;c<r.count[1];c++)for(var h=0;h<r.count[2];h++){var d=this.children[t++];d.hiddenMatrix.identity(),d.scale.setScalar(1),d.rotation.set(0,0,0),d.position.x=r.size[0]*u,d.position.y=-r.size[1]*c,d.position.z=-r.size[2]*h}}},{key:"fromJSON",value:function(e){return this}},{key:"toJSON",value:function(){return{}}},{key:"fromClonerState",value:function(e){return void 0!==e.hideBase&&this.setHideBase(e.hideBase),ni(this.parameters,e),this.update(),this}}]),r}(w.Object3D),Bh=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n){var i;return(0,g.Z)(this,r),(i=t.call(this,e,n)).isAbstractMesh=!0,i.isBooleanMesh=!1,i.booleanMeshSetAddress=-1,i.booleanWasTransformed=!1,i.booleanMatrixInvOld=new w.Matrix4,i.booleanExclude=null,Array.isArray(n)&&(i.selectedMaterial=0,0===e.groups.length&&e.addGroup(0,e.getAttribute("position").count,0)),i}return(0,y.Z)(r,[{key:"cloner",get:function(){return this._cloner},set:function(e){this._cloner&&this.remove(this._cloner),e&&this.add(e),this._cloner=e}},{key:"getSelectedMaterial",value:function(e){return Array.isArray(this.material)?(void 0===this.selectedMaterial&&(this.selectedMaterial=null!==e&&void 0!==e?e:0),this.material[null!==e&&void 0!==e?e:this.selectedMaterial]):this.material}},{key:"setSelectedMaterial",value:function(e,t){var r,n;Array.isArray(this.material)?(void 0===this.selectedMaterial&&(this.selectedMaterial=null!==(r=t)&&void 0!==r?r:0),t=null!==(n=t)&&void 0!==n?n:this.selectedMaterial,this.material[t].dispose(),this.material[t]=e):(this.material.dispose(),this.material=e)}},{key:"updateGeometry",value:function(e){var t=this.geometry,r=dd[t.userData.type],n="NonParametric"===this.objectType?Object.assign({},t.userData,{geometry:t}):t.userData,i=r.build(r.normalizeInputs(e,n)),a=t.uuid;if(this.geometry.dispose(),this.geometry=i,this.geometry.uuid=a,this.geometry.computeBoundingSphere(),this.cloner){var o,s=(0,b.Z)(this.cloner.children);try{for(s.s();!(o=s.n()).done;){o.value.geometry=this.geometry}}catch(l){s.e(l)}finally{s.f()}}}},{key:"resizeGeometry",value:function(e,t,r){ou.resizeGeometry(this.geometry,{width:e,height:t,depth:r})}},{key:"shallowClone",value:function(e){return new this.constructor(this.geometry,this.material).shallowCopy(this,e)}},{key:"clone",value:function(e){var t="NonParametric"===this.objectType?Object.assign({},this.geometry.userData,{geometry:this.geometry.clone()}):this.geometry.userData,r=fd(t),n=Array.isArray(this.material)?this.material.map((function(e){return e.clone()})):this.material.clone();return new this.constructor(r,n).copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e,t),e.cloner&&(this.cloner=new Nh(e,e.cloner.parameters),this.add(this.cloner)),this}},{key:"setFromClonerState",value:function(e){null===e?this.cloner=void 0:(void 0===this.cloner&&(this.cloner=new Nh(this)),this.cloner.fromClonerState(e))}},{key:"fromState",value:function(e,t){var n,i,a;return(0,o.Z)((0,s.Z)(r.prototype),"fromState",this).call(this,e),"Mesh"===e.type&&(this.setFromClonerState(e.cloner),this.castShadow=null===(n=e.castShadow)||void 0===n||n,this.receiveShadow=null===(i=e.receiveShadow)||void 0===i||i,this.booleanExclude=null!==(a=e.booleanExclude)&&void 0!==a?a:null),this}},{key:"freeBooleanPointer",value:function(){-1!==this.booleanMeshSetAddress&&(td.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}},{key:"invalidateDownstreamBooleanData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),gh(this.parent)?this.parent.invalidateDownstreamBooleanData():this}},{key:"invalidateUpstreamBooleanData",value:function(){this.freeBooleanPointer();var e,t=(0,b.Z)(this.children);try{for(t.s();!(e=t.n()).done;){var r=e.value;mh(r)&&(r.freeBooleanPointer(),gh(r)&&r.invalidateUpstreamBooleanData())}}catch(n){t.e(n)}finally{t.f()}}}]),r}(Ph(w.Mesh)),Uh=new w.Vector3(0,0,1),Ih=new w.Vector3,Vh=new w.Vector3,Fh=new w.Matrix3,jh=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vl.create({}),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jc({side:w.DoubleSide});return(0,g.Z)(this,r),(n=t.call(this,i,a)).recursiveSelection=!1,n.objectType="VectorObject",n.eventDispatcher=new w.EventDispatcher,n._onShapeUpdate=function(){n.updateGeometry({}),n.geometry.computeBoundingSphere(),n.geometry.computeBoundingBox()},n.castShadow=!0,n.receiveShadow=!0,n.forceComputeSize=!0,n.shape=i.userData.shape,null===(e=n.shape.eventDispatcher)||void 0===e||e.addEventListener("update",n._onShapeUpdate),n}return(0,y.Z)(r,[{key:"toJSON",value:function(e){var t=(0,o.Z)((0,s.Z)(r.prototype),"toJSON",this).call(this,e);return t.object.objectType="VectorObject",t}},{key:"fromState",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"fromState",this).call(this,e),this.shape.update(),this}},{key:"setHelperVisibility",value:function(){}},{key:"updateGeometry",value:function(e){if((0,o.Z)((0,s.Z)(r.prototype),"updateGeometry",this).call(this,e),"userData"in this.geometry){var t=this.geometry.userData.parameters;this.eventDispatcher.dispatchEvent({type:"geometryUpdate",parameters:t})}}},{key:"setShape",value:function(e){var t,r;this.shape&&null!==(t=this.shape.eventDispatcher)&&void 0!==t&&t.removeEventListener("update",this._onShapeUpdate),this.shape=e,null===(r=this.shape.eventDispatcher)||void 0===r||r.addEventListener("update",this._onShapeUpdate)}},{key:"updateWorldMatrix",value:function(e,t){(0,o.Z)((0,s.Z)(r.prototype),"updateWorldMatrix",this).call(this,e,t),Fh.getNormalMatrix(this.matrixWorld),Ih.copy(Uh).applyMatrix3(Fh).normalize(),Vh.setFromMatrixPosition(this.matrixWorld),this.shape.plane.setFromNormalAndCoplanarPoint(Ih,Vh)}},{key:"clone",value:function(e){var t=this.shape.clone(),n=this.material.clone(),i=this.geometry.userData,a=new r(vl.create(Object.assign({},i,{shape:t})),n).copy(this,e);return a.shape=t,t.update(),a}},{key:"raycast",value:function(e,t){Bh.prototype.raycast.call(this,e,t)}}]),r}(Bh);function Rh(e,t){return function(e){var t,r={parameters:e,type:e.type};if("VectorGeometry"===e.type){var n=js.createFromState(e.shape,e.width,e.height);r.shape=n}else"NonParametricGeometry"===e.type&&(e.data.groups&&e.data.groups.forEach((function(e){var t;return e.materialIndex=Math.max(null!==(t=e.materialIndex)&&void 0!==t?t:0,0)})),r.geometry=(new w.BufferGeometryLoader).parse(e));try{t=fd(r)}catch(n){console.error(n)}if(!t){var i=js.createFromState(To.defaultData(),100,100);r.shape=i,t=fd(r)}return t}(e)}fu.then((function(e){Dh=e}));var Gh=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),Hh=new Uint32Array([0,1,2,3]),Wh=new Uint8Array([4]),qh=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"build",value:function(t,r,n,i,a){var o,s,l,u,c,h=null!==(o=null!==(s=null===t||void 0===t?void 0:t.phongAngle)&&void 0!==s?s:null===r||void 0===r?void 0:r.phongAngle)&&void 0!==o?o:35;if(!1===i&&(h=-1),void 0!==t.positionWASM){n&&0!==n&&(Dh.free_bvh(n),Dh.free_subdivision_surface(n));try{l=e.allocate(t,a)}catch(d){console.error(d,t),l=e.allocate({positionWASM:Gh,indexWASM:Hh,verticesPerFaceWASM:Wh},a)}Dh.set_destination_refinement_level(l,0),u=e.buildLevel(l,!0,h)}else l=n,void 0!==t.phongAngle&&(u=e.buildLevel(l,!0,h));return void 0!==t.subdivisions&&(Dh.set_destination_refinement_level(l,t.subdivisions),c=t.subdivisions>0?e.buildLevel(l,!1,h):null),{subdivPointer:l,originalGeometry:u,subdividedGeometry:c}}},{key:"primitiveToQuads",value:function(e,t){var r,n;e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),"DodecahedronGeometry"===e.type&&(e.detail=0);var i,a=void 0!==e.shape?t.geometry:Rh(e);return{positions:i=(r=Yh(a.getAttribute("position"),a.getIndex())).positions,indices:(n=ed(i,r.triIndices,a)).indices,verticesPerFace:n.verticesPerFace}}},{key:"allocate",value:function(e,t){var r,n,i,a,o,s=[],l=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,a=e.indexWASM,o=e.verticesPerFaceWASM):(i=Gh,a=Hh,o=Wh);var u,h=i.length,d=a.length,f=o.length,v=i.length+s.length+l.length,p=a.length+o.length,m=v*Float32Array.BYTES_PER_ELEMENT+p*Uint32Array.BYTES_PER_ELEMENT,g=v*Float32Array.BYTES_PER_ELEMENT,y=(Uint32Array.BYTES_PER_ELEMENT,Dh._malloc(m)),x=new Float32Array(Dh.HEAPF32.buffer,y,v),b=new Uint32Array(Dh.HEAPU32.buffer,y+g,p);x.set(i,0),x.set(s,i.length),x.set(l,i.length+s.length),b.set(a,0),b.set(o,a.length),null!==e&&void 0!==e&&null!==(r=e.scaleBaked)&&void 0!==r&&r.some((function(e){return 1!==e}))&&(u=(n=new w.Matrix4).makeScale.apply(n,(0,c.Z)(e.scaleBaked))),t&&(u?u.premultiply(t):u=t);var S=u?Dh.alloc_subdivision_surface2(y,h,y+g,d,y+g+a.length*Uint32Array.BYTES_PER_ELEMENT,f,u.elements):Dh.alloc_subdivision_surface(y,h,y+g,d,y+g+a.length*Uint32Array.BYTES_PER_ELEMENT,f);return Dh._free(y),S}},{key:"buildLevel",value:function(e,t,r,n,i){var a=i?Dh.get_mesh_data2(e,t?Dh.Level.CONTROL:Dh.Level.REFINED,r,i.elements):Dh.get_mesh_data(e,t?Dh.Level.CONTROL:Dh.Level.REFINED,r),o=Dh.HEAPU32.subarray(a>>2,8+(a>>2)),s=o.subarray(4,8),l=0,u=Dh.HEAPU32[o[l]>>2],c=Dh.HEAPF32.subarray(u>>2,(u>>2)+s[l]);l++;var h=Dh.HEAPU32[o[l]>>2],d=Dh.HEAPF32.subarray(h>>2,(h>>2)+s[l]);l++;var f=Dh.HEAPU32[o[l]>>2],v=Dh.HEAPU32.subarray(f>>2,(f>>2)+s[l]);l++;var p=Dh.HEAPU32[o[l]>>2],m=Dh.HEAPU32.subarray(p>>2,(p>>2)+s[l]);if(l++,void 0===n){var g=new w.BufferGeometry;if(g.setIndex(new w.Uint32BufferAttribute(m,1)),g.setAttribute("position",new w.Float32BufferAttribute(c,3)),g.setAttribute("normal",new w.Float32BufferAttribute(d,3)),t){g.setAttribute("faceMap",new w.Uint32BufferAttribute(v,1));var y=new Float32Array(d.length/3*4).fill(0);g.setAttribute("color",new w.BufferAttribute(y,4))}return Dh.free_mesh_data(a),g.userData.type="SubdivGeometry",g}n.getAttribute("position").copyArray(c),n.getAttribute("normal").copyArray(d),n.attributes.position.needsUpdate=!0,n.attributes.normal.needsUpdate=!0,Dh.free_mesh_data(a)}},{key:"buildControlCageWireframe",value:function(e,t,r){var n=Dh.get_wireframe_data_for_base_level(e),i=Dh.HEAPU32.subarray(n>>2,4+(n>>2)),a=i.subarray(2,4),o=0,s=Dh.HEAPU32[i[o]>>2],l=Dh.HEAPF32.subarray(s>>2,(s>>2)+a[o]);o++;var u=Dh.HEAPU32[i[o]>>2],c=Dh.HEAPU32.subarray(u>>2,(u>>2)+a[o]);if(void 0===t){var h=new w.BufferGeometry;h.setAttribute("position",new w.Float32BufferAttribute(l,3));for(var d=new Float32Array(l.length),f=0,v=l.length;f<v;)d[f++]=r.r,d[f++]=r.g,d[f++]=r.b;return h.setAttribute("color",new w.BufferAttribute(d,3)),h.setIndex(new w.Uint32BufferAttribute(c,1)),Dh.free_wireframe_data_for_base_level(n),h}t.getAttribute("position").copyArray(l),t.attributes.position.needsUpdate=!0,Dh.free_wireframe_data_for_base_level(n)}},{key:"updateCollabMesh",value:function(e,t,r){t||Dh.set_destination_refinement_level(e,1);var n=r?Dh.get_topological_data2(e,t?Dh.Level.CONTROL:Dh.Level.REFINED,r.elements):Dh.get_topological_data(e,t?Dh.Level.CONTROL:Dh.Level.REFINED),i=Dh.HEAPU32.subarray(n>>2,6+(n>>2)),a=i.subarray(3,6),o=0,s=Dh.HEAPU32[i[o]>>2],l=new Float32Array(Dh.HEAPF32.subarray(s>>2,(s>>2)+a[o]));o++;var u=Dh.HEAPU32[i[o]>>2],c=new Uint32Array(Dh.HEAPU32.subarray(u>>2,(u>>2)+a[o]));o++;var h=Dh.HEAPU32[i[o]>>2],d=new Uint8Array(Dh.HEAPU32.subarray(h>>2,(h>>2)+a[o]));return Dh.free_topological_data(n),{positions:l,indices:c,verticesPerFace:d}}}]),e}(),Jh=["getX","getY","getZ"];function Yh(e,t){for(var r={},n=t?t.count:e.count,i=0,a=[],o=[],s=0;s<n;s++){for(var l=t?t.getX(s):s,u="",c=0;c<3;c++)u+="".concat(~~(1e4*e[Jh[c]](l)),",");if(u in r)a.push(r[u]);else{for(var h=0;h<3;h++)o.push(e[Jh[h]](l));r[u]=i,a.push(i),i++}}for(var d=[],f=0;f<a.length;f+=3)a[f]===a[f+1]||a[f]===a[f+2]||a[f+1]===a[f+2]||d.push(a[f],a[f+1],a[f+2]);return{positions:o,triIndices:d}}var Xh=new w.Vector3,Kh=new w.Vector3,Qh=new w.Vector3,$h=new w.Vector3;function ed(e,t,r){var n=[],i=[];if(void 0!==r.userData.shape&&0===r.userData.parameters.depth){for(var a=r.userData.shape.extractShapePointsToFlatArray([]),o=0,s=0;s<a.length;s+=2)o+=(a[s]-a[(0===s?a.length:s)-2])*(a[s+1]+a[(0===s?a.length:s)-1]);e.length=0;var l=0;if(o<0)for(var u=0;u<a.length;u+=2)e.push(a[u],a[u+1],0),n.push(l++);else for(var c=a.length-2;c>=0;c-=2)e.push(a[c],a[c+1],0),n.push(l++);return i.push(l),{indices:n,verticesPerFace:i}}for(var h=0,d=null!==(f=r.capStartIndex)&&void 0!==f?f:t.length;h<d;){var f;if(t[h+1]===t[h+3]&&t[h+2]===t[h+5]||t[h+0]===t[h+3]&&t[h+2]===t[h+4]){Xh.set(e[3*t[h]],e[3*t[h]+1],e[3*t[h]+2]),Kh.set(e[3*t[h+1]],e[3*t[h+1]+1],e[3*t[h+1]+2]),Qh.set(e[3*t[h+4]],e[3*t[h+4]+1],e[3*t[h+4]+2]),$h.set(e[3*t[h+5]],e[3*t[h+5]+1],e[3*t[h+5]+2]),Kh.sub(Xh).normalize(),Qh.sub(Xh).normalize(),$h.sub(Xh).normalize();var v=Kh.cross(Qh).dot($h);Math.abs(v)>.005?(n.push(t[h],t[h+1],t[h+2]),i.push(3),h+=3):(n.push(t[h],t[h+1],t[h+4],t[h+5]),i.push(4),h+=6)}else n.push(t[h],t[h+1],t[h+2]),i.push(3),h+=3}if(void 0!==r.capStartIndex){for(var p=[],m=[],g=0,y=0,x=0;y<e.length;y+=3,x++)0===e[y+2]&&(p.push(x),g++),e[y+2]===r.userData.parameters.depth&&m.push(x);if(0===r.userData.parameters.extrudeBevelSize){var b=m[0];m[0]=m[1],m[1]=b}p.reverse(),n.push.apply(n,p.concat(m)),i.push(g,g)}return{indices:n,verticesPerFace:i}}var td={};N(td,{calcBoolean:function(){return ld},calcBooleanTopological:function(){return sd},freeMeshSet:function(){return hd},getMeshSet:function(){return ud},transformMeshSet:function(){return cd}});var rd,nd,id=new Promise((function(e){e}));function ad(e){var t=e.length,r=t*Uint32Array.BYTES_PER_ELEMENT,n=t*Float32Array.BYTES_PER_ELEMENT,i=Number.isInteger(e[0])?r:n,a=rd._malloc(i);return(Number.isInteger(e[0])?new Uint32Array(rd.HEAPU32.buffer,a,t):new Float32Array(rd.HEAPF32.buffer,a,t)).set(e,0),a}function od(e){switch(e){case 0:return rd.OP.UNION;case 1:return rd.OP.INTERSECTION;case 2:return rd.OP.A_MINUS_B;case 3:return rd.OP.B_MINUS_A;case 4:return rd.OP.SYMMETRIC_DIFFERENCE;case 5:return rd.OP.ALL;default:throw new Error("Unknown boolean operation "+e)}}function sd(e,t){void 0===nd&&(nd=rd.init_csg());var r=ad(e),n=rd.csg_calc_topological(nd,r,e.length,od(t));rd._free(r);var i=rd.HEAPU32.subarray(n>>2,6+(n>>2)),a=i.subarray(3,6),o=0,s=rd.HEAPU32[i[o]>>2],l=new Float32Array(rd.HEAPF32.subarray(s>>2,(s>>2)+a[o]));o++;var u=rd.HEAPU32[i[o]>>2],c=new Uint32Array(rd.HEAPU32.subarray(u>>2,(u>>2)+a[o]));o++;var h=rd.HEAPU32[i[o]>>2],d=new Uint8Array(rd.HEAPU32.subarray(h>>2,(h>>2)+a[o]));return rd.free_mesh_data(n),{positions:l,indices:c,verticesPerFace:d}}function ld(e,t,r,n){void 0===nd&&(nd=rd.init_csg());var i=ad(e),a=rd.csg_calc(nd,i,e.length,n,od(t));rd._free(i);var o=rd.HEAPU32.subarray(a>>2,5+(a>>2)),s=o.subarray(2,5),l=0,u=rd.HEAPU32[o[l]>>2],c=rd.HEAPF32.subarray(u>>2,(u>>2)+s[l]);l++;var h=rd.HEAPU32[o[l]>>2],d=rd.HEAPF32.subarray(h>>2,(h>>2)+s[l]),f=s[++l];r.setAttribute("position",new w.Float32BufferAttribute(c,3)),r.setAttribute("normal",new w.Float32BufferAttribute(d,3));var v=rd.HEAPF32.subarray(5+(a>>2),5+(a>>2)+6);return null===r.boundingSphere&&(r.boundingSphere=new w.Sphere),r.boundingSphere.center.set(v[0],v[1],v[2]),r.boundingSphere.radius=Math.pow(Math.pow(v[3],2)+Math.pow(v[4],2)+Math.pow(v[5],2),.5),r.userData.parameters={width:2*v[3],height:2*v[4],depth:2*v[5]},rd.free_mesh_data(a),f}function ud(e,t){if(void 0===rd)return-1;var r,n,i;if(t&&void 0!==e.userData.positions){var a=e.userData;i=a.verticesPerFace.length,r=a.positions,n=Array(a.verticesPerFace.reduce((function(e,t){return e+t}),0)+i);for(var o=0,s=0,l=0;o<a.verticesPerFace.length;o++){n[l++]=a.verticesPerFace[o];for(var u=0;u<a.verticesPerFace[o];u++)n[l++]=a.indices[s++]}}else{var c=function(e,t){var r,n,i=Yh(e.getAttribute("position"),e.getIndex()),a=i.positions,o=i.triIndices;if(t){var s=ed(a,o,e),l=s.indices,u=s.verticesPerFace;n=u.length,r=[];for(var c=0,h=0;c<n;c++){r.push(u[c]);for(var d=0;d<u[c];d++)r.push(l[h++])}}else{var f=o.length;r=Array(f+f/3),n=0;for(var v=0,p=0;p<r.length;)r[p++]=3,n++,r[p++]=o[v++],r[p++]=o[v++],r[p++]=o[v++]}return{positions:a,faceIndices:r,nFaces:n}}(e,t);r=c.positions,n=c.faceIndices,i=c.nFaces}var h=r.length,d=n.length,f=r.length,v=n.length,p=f*Float32Array.BYTES_PER_ELEMENT+v*Uint32Array.BYTES_PER_ELEMENT,m=f*Float32Array.BYTES_PER_ELEMENT,g=(Uint32Array.BYTES_PER_ELEMENT,rd._malloc(p)),y=new Float32Array(rd.HEAPF32.buffer,g,f),x=new Uint32Array(rd.HEAPU32.buffer,g+m,v);return y.set(r,0),x.set(n,0),rd.get_csg_mesh(g,h,g+m,d,i)}function cd(e,t){rd.transform_csg_mesh(e,t.elements)}function hd(e){rd.free_csg_mesh(e)}id.then((function(e){return rd=e}));var dd={ConeGeometry:Ko,CubeGeometry:Qo,CylinderGeometry:qo,DodecahedronGeometry:rs,EllipseGeometry:ml,HelixGeometry:kl,IcosahedronGeometry:Cl,LatheGeometry:Zl,NonParametricGeometry:Rl,PolygonGeometry:Gl,PyramidGeometry:Hl,RectangleGeometry:Xl,SphereGeometry:Kl,PlaneGeometry:Ql,BackdropGeometry:$l,StarGeometry:tu,TextFrameGeometry:ru,TorusGeometry:nu,TorusKnotGeometry:iu,TriangleGeometry:au,VectorGeometry:vl},fd=function(e){return dd[e.type].create(e)},vd=new w.Matrix4,pd=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w.BufferGeometry,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kc;return(0,g.Z)(this,r),(e=t.call(this,n,i)).booleanOp=2,e.phongAngle=35,e.meshSetAddresses=[],e.needsTransformForDownstream=!1,e.isBooleanMesh=!0,e.castShadow=!0,e.receiveShadow=!0,e.geometry.userData.parameters={width:0,height:0,depth:0},e.onAfterRender=e.recomputeBoolean.bind((0,h.Z)(e)),e}return(0,y.Z)(r,[{key:"reInit",value:function(){this.isBooleanMesh=!0,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry.userData.parameters={width:0,height:0,depth:0},this.onAfterRender=this.recomputeBoolean.bind(this)}},{key:"recomputeBoolean",value:function(e){if(-1===this.booleanMeshSetAddress){for(var t=0;t<this.children.length;t++){var r=this.children[t];gh(r)&&r.recomputeBoolean(!0===e)}this.meshSetAddresses=[];for(var n=0;n<this.children.length;n++){var i,a=this.children[n];if(Eh(a)&&!1===a.booleanExclude&&(null===(i=a.geometry.attributes.position)||void 0===i?void 0:i.count)>0&&a.geometry.drawRange.count>0){if(-1===a.booleanMeshSetAddress){if(a.booleanMeshSetAddress=td.getMeshSet(a.geometry,!0===e),-1===a.booleanMeshSetAddress)return;td.transformMeshSet(a.booleanMeshSetAddress,a.matrix),a.booleanMatrixInvOld.copy(a.matrix).invert(),a.booleanWasTransformed=!1}else gh(a)&&!0===a.needsTransformForDownstream?(td.transformMeshSet(a.booleanMeshSetAddress,a.matrix),a.needsTransformForDownstream=!1):!0===a.booleanWasTransformed&&(vd.multiplyMatrices(a.matrix,a.booleanMatrixInvOld),td.transformMeshSet(a.booleanMeshSetAddress,vd),a.booleanMatrixInvOld.copy(a.matrix).invert(),a.booleanWasTransformed=!1);this.meshSetAddresses.push(a.booleanMeshSetAddress)}}if(0!==this.meshSetAddresses.length){if(!0===e)return td.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);var o=this.geometry;o.dispose(),this.geometry=new w.BufferGeometry,this.geometry.userData=o.userData,this.geometry.boundingSphere=o.boundingSphere;try{this.booleanMeshSetAddress=td.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(t){this.booleanMeshSetAddress=0,console.error(t)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0}else this.geometry.setDrawRange(0,0)}}},{key:"toJSON",value:function(e){var t=(0,o.Z)((0,s.Z)(r.prototype),"toJSON",this).call(this,e);return t.object.objectType="Mesh3D",t}},{key:"updateGeometry",value:function(e){var t=e.parameters;void 0!==t.operation&&(this.booleanOp=t.operation),void 0!==t.phongAngle&&(this.phongAngle=t.phongAngle),this.invalidateDownstreamBooleanData().recomputeBoolean()}}]),r}(Bh),md=function(e){var t;return t=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;return(0,g.Z)(this,r),(e=t.apply(this,arguments)).isObjectHelper=!0,e}return(0,y.Z)(r)}(e),t.geometryHelper=new w.BoxBufferGeometry(30,30,30),t},gd=new w.Ray,yd=new w.Sphere,xd=new w.Matrix4,bd=function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=t,o=e.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),yd.copy(a.boundingSphere),yd.applyMatrix4(o),!1!==r.ray.intersectsSphere(yd)&&(xd.copy(o).invert(),gd.copy(r.ray).applyMatrix4(xd),null===a.boundingBox||!1!==gd.intersectsBox(a.boundingBox))){var s,l,u,c,h,d,f=a.index,v=a.attributes.position,p=a.drawRange;if(!1===i){var m=Math.max(0,p.start),g=Math.min(f.count,p.start+p.count);for(h=m,d=g;h<d;h+=3)if(l=f.getX(h),u=f.getX(h+1),c=f.getX(h+2),s=T(e,r,gd,v,l,u,c))return s.faceIndex=Math.floor(h/3),void n.push(s)}else for(var y=a.attributes.position,x=new w.Vector3,b=new w.Vector3,S=new w.Vector3,k=new w.Vector3,_=2,C=1/((e.scale.x+e.scale.y+e.scale.z)/3),O=C*C,Z=Math.max(0,p.start),L=Math.min(y.count,p.start+p.count),A=Z,M=L-1;A<M;A+=_)if(x.fromBufferAttribute(y,A),b.fromBufferAttribute(y,A+1),!(gd.distanceSqToSegment(x,b,k,S)>O)){k.applyMatrix4(e.matrixWorld);var D=r.ray.origin.distanceTo(k);D<r.near||D>r.far||n.push({distance:D,point:S.clone().applyMatrix4(e.matrixWorld),object:e})}}function T(e,t,r,n,i,a,o){var s=new w.Vector3,l=new w.Vector3,u=new w.Vector3,c=new w.Vector3,h=new w.Vector3;if(s.fromBufferAttribute(n,i),l.fromBufferAttribute(n,a),u.fromBufferAttribute(n,o),null===r.intersectTriangle(s,l,u,!1,c))return null;h.copy(c),h.applyMatrix4(e.matrixWorld);var d=t.ray.origin.distanceTo(h);return d<t.near||d>t.far?null:{faceIndex:1,distance:d,point:h.clone(),object:e}}},wd=new w.Vector3,Sd=new w.Camera,kd=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;(0,g.Z)(this,r);var i=new w.BufferGeometry,a=new w.LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],s=[],l={},u=new w.Color(15711266),c=new w.Color(15711266),h=new w.Color(2857471);function d(e,t,r){f(e,r),f(t,r)}function f(e,t){o.push(0,0,0),s.push(t.r,t.g,t.b),void 0===l[e]&&(l[e]=[]),l[e].push(o.length/3-1)}return d("n1","n2",u),d("n2","n4",u),d("n4","n3",u),d("n3","n1",u),d("f1","f2",u),d("f2","f4",u),d("f4","f3",u),d("f3","f1",u),d("n1","f1",u),d("n2","f2",u),d("n3","f3",u),d("n4","f4",u),d("p","n1",c),d("p","n2",c),d("p","n3",c),d("p","n4",c),d("u1","u2",h),d("u2","u3",h),d("u3","u1",h),i.setAttribute("position",new w.Float32BufferAttribute(o,3)),i.setAttribute("color",new w.Float32BufferAttribute(s,3)),(n=t.call(this,i,a)).type="CameraHelper",n.camera=e,n.camera.updateProjectionMatrix&&n.camera.updateProjectionMatrix(),n.matrix=e.matrixWorld,n.matrixAutoUpdate=!1,n.pointMap=l,n.update(),n}return(0,y.Z)(r,[{key:"update",value:function(){var e=this.geometry,t=this.pointMap;Sd.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];var r=.8;_d("n1",t,e,Sd,-1,-1,r),_d("n2",t,e,Sd,1,-1,r),_d("n3",t,e,Sd,-1,1,r),_d("n4",t,e,Sd,1,1,r);var n=r;_d("f1",t,e,Sd,-1,-1,n),_d("f2",t,e,Sd,1,-1,n),_d("f3",t,e,Sd,-1,1,n),_d("f4",t,e,Sd,1,1,n);_d("u1",t,e,Sd,.35,1.1,.8),_d("u2",t,e,Sd,-.35,1.1,.8),_d("u3",t,e,Sd,0,1.55,.8),e.getAttribute("position").needsUpdate=!0}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),r}(w.LineSegments);function _d(e,t,r,n,i,a,o){wd.set(i,a,o).unproject(n);var s=t[e];if(void 0!==s)for(var l=r.getAttribute("position"),u=0,c=s.length;u<c;u++)l.setXYZ(s[u],wd.x,wd.y,wd.z)}var Cd=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this,e)).object=e,n.object=e,n.name="CombinedCameraHelper: ".concat(e.uuid),n}return(0,y.Z)(r,[{key:"updateMatrixWorld",value:function(e){(0,o.Z)((0,s.Z)(r.prototype),"updateMatrixWorld",this).call(this,e),this.updateTarget()}},{key:"updateTarget",value:function(){var e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}},{key:"raycast",value:function(e,t){bd(this.object,this.geometry,e,t,!0)}}]),r}(md(kd)),Od=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10066329;return(0,g.Z)(this,r),(n=t.call(this,e,i,a)).object=e,n.added=!1,n.name="DirectionalLightHelper: ".concat(e.uuid),n}return(0,y.Z)(r,[{key:"raycast",value:function(e,t){bd(this.object,r.geometryHelper,e,t)}}]),r}(md(w.DirectionalLightHelper)),Zd=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;return(0,g.Z)(this,r),(n=t.call(this,i)).object=e,n.object.updateMatrixWorld(),n.name="EmptyObjectHelper: ".concat(e.uuid),n.matrix=e.matrixWorld,n.matrixAutoUpdate=!1,n}return(0,y.Z)(r,[{key:"raycast",value:function(e,t){bd(this.object,r.geometryHelper,e,t)}},{key:"update",value:function(){}}]),r}(md(w.AxesHelper)),Ld=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6710886;return(0,g.Z)(this,r),(n=t.call(this,e,i,a)).object=e,n.name="PointLightHelper: ".concat(e.uuid),n}return(0,y.Z)(r,[{key:"raycast",value:function(e,t){bd(this.object,r.geometryHelper,e,t)}}]),r}(md(w.PointLightHelper)),Ad=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6710886;return(0,g.Z)(this,r),(n=t.call(this,e,i)).object=e,n.name="SpotLightHelper: ".concat(e.uuid),n}return(0,y.Z)(r,[{key:"raycast",value:function(e,t){bd(this.object,r.geometryHelper,e,t)}},{key:"update",value:function(){if(void 0!==this.object){var e=r._vector,t=this.object.distance?this.object.distance:1e3,n=t*Math.tan(this.object.angle);this.cone.scale.set(n,n,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);var i=void 0!==this.color?this.color:this.light.color;if(this.cone.material instanceof Array)for(var a=0,o=this.cone.material.length;a<o;a++)this.cone.material[a].color.set(i);else this.cone.material.color.set(i)}}}]),r}(md(w.SpotLightHelper)),Md=Ad;Md._vector=new w.Vector3;var Dd=function(e,t){return function(e){(0,d.Z)(n,e);var r=(0,f.Z)(n);function n(){var e;return(0,g.Z)(this,n),(e=r.apply(this,arguments)).objectHelper=new t((0,h.Z)(e)),e.enableHelper=!1,e}return(0,y.Z)(n,[{key:"visibility",get:function(){return this.visible},set:function(e){this.visible=e,this.setHelperVisibility(e),this.setHelperChildrenVisibility(e)}},{key:"geometryHelper",get:function(){return t.geometryHelper}},{key:"setHelperVisibility",value:function(e){this.objectHelper.visible=e}},{key:"setHelperChildrenVisibility",value:function(e){var t,r=(0,b.Z)(this.children);try{for(r.s();!(t=r.n()).done;){var n=t.value;zh(n)&&n.traverseEntity((function(t){xh(t)&&t.visible&&(t.objectHelper.visible=e)}))}}catch(i){r.e(i)}finally{r.f()}}},{key:"raycast",value:function(e,t){this.objectHelper.raycast(e,t)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,o.Z)((0,s.Z)(n.prototype),"copy",this).call(this,e,t),void 0!==e.enableHelper&&(this.enableHelper=e.enableHelper),void 0!==e.objectHelper&&(this.objectHelper.visible=e.objectHelper.visible),this}},{key:"toJSON",value:function(e){var t=(0,o.Z)((0,s.Z)(n.prototype),"toJSON",this).call(this,e);return t.object.enableHelper=this.enableHelper,t}},{key:"fromJSON",value:function(e){return(0,o.Z)((0,s.Z)(n.prototype),"fromJSON",this).call(this,e),void 0!==e.enableHelper&&(this.enableHelper=!0),this}},{key:"fromLightState",value:function(e,t){if("LightDirectional"===this.objectType||"LightPoint"===this.objectType||"LightSpot"===this.objectType){var r=this;void 0!==e.color&&(r.color=sh(e.color,t)),void 0!==e.intensity&&(r.intensity=e.intensity),void 0!==e.depth&&(r.shadow.camera.far=e.depth,r.shadow.needsUpdate=!0),void 0!==e.shadows&&(this.castShadow=e.shadows),void 0!==e.helper&&(this.enableHelper=e.helper,r.gizmos.shadowmap.visible=e.helper)}return this}}]),n}(e)},Td=new w.Vector3,zd=new w.Vector3,Ed=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.innerWidth,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.innerHeight,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:45,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e5;return(0,g.Z)(this,r),(e=t.call(this)).objectType="CombinedCamera",e._cameraType="OrthographicCamera",e.targetOffset=si.DefaultTargetOffset,e.isUpVectorFlipped=!1,e.angleOffsetFromUp=0,e.width=n,e.height=i,e.orthoCamera=new w.OrthographicCamera(-.5*n,.5*n,.5*i,-.5*i,null!==o&&void 0!==o?o:-5e4,s),e.perspCamera=new w.PerspectiveCamera(a,n/i,null!==o&&void 0!==o?o:50,s),e.left=e.orthoCamera.left,e.right=e.orthoCamera.right,e.top=e.orthoCamera.top,e.bottom=e.orthoCamera.bottom,e.far=e.orthoCamera.far,e.view=e.orthoCamera.view,e.aspect=e.perspCamera.aspect,e.fov=e.perspCamera.fov,e.focus=e.perspCamera.focus,e.filmGauge=e.perspCamera.filmGauge,e.filmOffset=e.perspCamera.filmOffset,e.toOrthographic(!0),e}return(0,y.Z)(r,[{key:"isPerspectiveCamera",get:function(){return"PerspectiveCamera"===this.cameraType}},{key:"isOrthographicCamera",get:function(){return!this.isPerspectiveCamera}},{key:"cameraType",get:function(){return this._cameraType},set:function(e){"PerspectiveCamera"===e?this.toPerspective():"OrthographicCamera"===e&&this.toOrthographic()}},{key:"setNear",value:function(e,t){"PerspectiveCamera"===e?this.perspCamera.near=t:this.orthoCamera.near=t}},{key:"setZoom",value:function(e,t){t>=0&&("PerspectiveCamera"===e?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}},{key:"near",get:function(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.near:this.orthoCamera.near},set:function(e){"PerspectiveCamera"===this._cameraType?this.perspCamera.near=e:this.orthoCamera.near=e}},{key:"zoom",get:function(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.zoom:this.orthoCamera.zoom},set:function(e){e>=0&&("PerspectiveCamera"===this._cameraType?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}},{key:"lookAt",value:function(e){(0,o.Z)((0,s.Z)(r.prototype),"lookAt",this).call(this,e),this.getWorldPosition(Td),this.targetOffset=Td.distanceTo(e)}},{key:"getTarget",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new w.Vector3;return this.getWorldDirection(zd),this.getWorldPosition(Td),zd.multiplyScalar(this.targetOffset),e.copy(Td).add(zd),e}},{key:"getDistanceToTarget",value:function(){var e=this.getTarget();return this.getWorldPosition(Td),Td.distanceTo(e)}},{key:"updateUp",value:function(){var e=this.getWorldQuaternion(new w.Quaternion),t=new w.Vector3(0,0,1).applyQuaternion(e),r=(new w.Vector3).copy(w.Object3D.DefaultUp);this.isUpVectorFlipped&&r.negate(),r.applyQuaternion(e);var n=(new w.Vector3).copy(w.Object3D.DefaultUp).projectOnPlane(t),i=(new w.Vector3).crossVectors(n,r).dot(t)>=0?1:-1;this.angleOffsetFromUp=n.angleTo(r)*i}},{key:"getViewFrontToObject",value:function(e){var t=e.getWorldPosition(new w.Vector3),r=e.getWorldDirection(new w.Vector3).multiplyScalar(this.targetOffset);return{position:t.clone().add(r),target:t}}},{key:"getViewToObject",value:function(e){var t=e.getWorldPosition(new w.Vector3),r=this.getWorldDirection(new w.Vector3).multiplyScalar(this.targetOffset);return{position:t.clone().sub(r),target:t}}},{key:"setViewplaneSize",value:function(e,t){this.left=.5*-e,this.right=.5*e,this.top=.5*t,this.bottom=.5*-t,this.aspect=e/t,this.updateProjectionMatrix()}},{key:"toOrthographic",value:function(e){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",(!0===this.enableHelper||!0===e)&&this.objectHelper.update()}},{key:"toPerspective",value:function(e){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",(!0===this.enableHelper||!0===e)&&this.objectHelper.update()}},{key:"setFocalLength",value:function(e){this.perspCamera.setFocalLength(e),this.toPerspective()}},{key:"getFocalLength",value:function(){return this.perspCamera.getFocalLength()}},{key:"getEffectiveFOV",value:function(){return this.perspCamera.getEffectiveFOV()}},{key:"getFilmWidth",value:function(){return this.perspCamera.getFilmWidth()}},{key:"getFilmHeight",value:function(){return this.perspCamera.getFilmHeight()}},{key:"setViewOffset",value:function(e,t,r,n,i,a){"PerspectiveCamera"===this._cameraType?this.perspCamera.setViewOffset(e,t,r,n,i,a):this.orthoCamera.setViewOffset(e,t,r,n,i,a)}},{key:"clearViewOffset",value:function(){"PerspectiveCamera"===this._cameraType?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}},{key:"updateProjectionMatrix",value:function(e){"PerspectiveCamera"===this._cameraType?this.toPerspective(e):"OrthographicCamera"===this._cameraType&&this.toOrthographic(e)}},{key:"updateMatrixWorld",value:function(e){(0,o.Z)((0,s.Z)(r.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(e,t){(0,o.Z)((0,s.Z)(r.prototype),"updateWorldMatrix",this).call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"copy",value:function(e,t){return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e,t),this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=null===e.view?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}},{key:"fromCameraRender",value:function(e){var t={near:this.orthoCamera.near,far:this.orthoCamera.far},r={near:this.perspCamera.near,far:this.perspCamera.far};return this.copy(e),this.name="",this.enableHelper=!0,this.objectHelper.visible=!0,this.orthoCamera.near=t.near,this.orthoCamera.far=t.far,this.perspCamera.near=r.near,this.perspCamera.far=r.far,this.updateProjectionMatrix(),this}},{key:"toJSON",value:function(e){var t=(0,o.Z)((0,s.Z)(r.prototype),"toJSON",this).call(this,e),n=t.object;return n.objectType="CombinedCamera",n.cameraType=this.cameraType,n.targetOffset=this.targetOffset,n.isUpVectorFlipped=this.isUpVectorFlipped,n.angleOffsetFromUp=this.angleOffsetFromUp,n.left=this.left,n.right=this.right,n.top=this.top,n.bottom=this.bottom,null!==this.view&&(n.view=Object.assign({},this.view)),n.zoomOrtho=this.orthoCamera.zoom,n.nearOrtho=this.orthoCamera.near,n.far=this.far,n.aspect=this.aspect,n.fov=this.fov,n.focus=this.focus,n.filmGauge=this.filmGauge,n.filmOffset=this.filmOffset,n.zoomPersp=this.perspCamera.zoom,n.nearPersp=this.perspCamera.near,t}},{key:"fromJSON",value:function(e){var t;if((0,o.Z)((0,s.Z)(r.prototype),"fromJSON",this).call(this,e),this.cameraType=e.cameraType,void 0!==e.targetOffset&&(this.targetOffset=e.targetOffset),void 0!==e.orbitControlsTarget){var n=this.getWorldPosition(new w.Vector3),i=(new w.Vector3).fromArray(e.orbitControlsTarget);this.targetOffset=i.distanceTo(n)}else void 0!==e.targetOffset&&(this.targetOffset=e.targetOffset);return this.isUpVectorFlipped=!1,this.angleOffsetFromUp=null!==(t=e.angleOffsetFromUp)&&void 0!==t?t:0,void 0!==e.left&&(this.left=e.left),void 0!==e.right&&(this.right=e.right),void 0!==e.top&&(this.top=e.top),void 0!==e.bottom&&(this.bottom=e.bottom),void 0!==e.view&&(this.view=Object.assign({},e.view)),void 0!==e.zoomOrtho&&(this.orthoCamera.zoom=e.zoomOrtho),void 0!==e.nearOrtho&&(this.orthoCamera.near=e.nearOrtho),void 0!==e.far&&(this.far=e.far),void 0!==e.aspect&&(this.aspect=e.aspect),void 0!==e.fov&&(this.fov=e.fov),void 0!==e.focus&&(this.focus=e.focus),void 0!==e.filmGauge&&(this.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(this.filmOffset=e.filmOffset),void 0!==e.zoomPersp&&(this.perspCamera.zoom=e.zoomPersp),void 0!==e.nearPersp&&(this.perspCamera.near=e.nearPersp),this.updateProjectionMatrix(),this}},{key:"toCameraState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return ki(t,e)}},{key:"fromCameraState",value:function(e){var t=e.orthographic,r=e.perspective;return void 0!==e.type&&(this.cameraType=e.type),void 0!==e.far&&(this.far=e.far),void 0!==t&&(void 0!==t.near&&(this.orthoCamera.near=t.near),void 0!==t.zoom&&(this.orthoCamera.zoom=t.zoom)),void 0!==r&&(void 0!==r.near&&(this.perspCamera.near=r.near),void 0!==r.fov&&(this.perspCamera.fov=r.fov),void 0!==r.zoom&&(this.perspCamera.zoom=r.zoom)),void 0!==e.up&&this.up.fromArray(e.up),void 0!==e.targetOffset&&(this.targetOffset=e.targetOffset),void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix(),this}},{key:"toState",value:function(e){return(0,x.Z)((0,x.Z)((0,x.Z)({},(0,o.Z)((0,s.Z)(r.prototype),"toState",this).call(this,e)),this.toCameraState(e)),{},{type:this.cameraType})}},{key:"fromState",value:function(e){return(0,o.Z)((0,s.Z)(r.prototype),"fromState",this).call(this,e),this.fromCameraState(e),this}}],[{key:"createFromState",value:function(e,t){var n=(new r).fromState(t);return n.enableHelper=!0,n.objectHelper.update(),n.uuid=e,n}}]),r}(Dd(Ph(w.Camera),Cd)),Pd=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;return(0,g.Z)(this,r),(e=t.apply(this,arguments)).objectType="EmptyObject",e}return(0,y.Z)(r,[{key:"toJSON",value:function(e){var t=(0,o.Z)((0,s.Z)(r.prototype),"toJSON",this).call(this,e);return t.object.objectType="EmptyObject",t}}],[{key:"createFromState",value:function(e,t){var n=(new r).fromState(t);return n.uuid=e,n.enableHelper=!0,n.objectHelper.update(),n}}]),r}(Dd(Ph(w.Group),Zd)),Nd=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;(0,g.Z)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];(e=t.call.apply(t,[this].concat(i))).objectType="LightDirectional",e._gizmos={},e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.normalBias=1;var o=e.shadow.camera;o.top=1250,o.bottom=-1250,o.right=1250,o.left=-1250,o.near=-1e4,o.far=2500;var s=new w.CameraHelper(e.shadow.camera);return s.visible=!1,e._gizmos.shadowmap=s,e.update(),e}return(0,y.Z)(r,[{key:"gizmos",get:function(){return this._gizmos}},{key:"showGizmos",value:function(){for(var e in this._gizmos){var t=this._gizmos[e];t instanceof w.CameraHelper&&(t.visible=!0)}}},{key:"hideGizmos",value:function(){for(var e in this._gizmos){var t=this._gizmos[e];t instanceof w.CameraHelper&&(t.visible=!1)}}},{key:"update",value:function(){for(var e in this.shadow.camera.updateProjectionMatrix(),this._gizmos){var t=this._gizmos[e];t instanceof w.CameraHelper&&t.update()}}},{key:"updateMatrixWorld",value:function(e){(0,o.Z)((0,s.Z)(r.prototype),"updateMatrixWorld",this).call(this,e),!0===this.enableHelper&&!0===this.objectHelper.visible&&this.objectHelper.update()}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e,t),this.color.copy(e.color),this.intensity=e.intensity,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},{key:"toJSON",value:function(e){var t=(0,o.Z)((0,s.Z)(r.prototype),"toJSON",this).call(this,e),n=t.object;return n.objectType="LightDirectional",n.color=this.color.getHex(),n.intensity=this.intensity,n.shadow=this.shadow.toJSON(),t}},{key:"fromJSON",value:function(e){var t;(0,o.Z)((0,s.Z)(r.prototype),"fromJSON",this).call(this,e),this.color.set(e.color),this.intensity=e.intensity,this.shadow.normalBias=null!==(t=e.shadow.normalBias)&&void 0!==t?t:0,this.shadow.radius=e.shadow.radius,this.shadow.mapSize.fromArray(e.shadow.mapSize);var n=this.shadow.camera,i=e.shadow.camera;return n.near=i.near,n.far=i.far,n.zoom=i.zoom,n.left=i.left,n.right=i.right,n.top=i.top,n.bottom=i.bottom,void 0!==i.view&&(n.view=Object.assign({},i.view)),this}},{key:"fromDirectionalLightState",value:function(e,t){var n=void 0!==e.depth&&e.depth!==this.shadow.camera.far||void 0!==e.size&&e.size/2!==this.shadow.camera.right;return(0,o.Z)((0,s.Z)(r.prototype),"fromLightState",this).call(this,e,t),void 0!==e.size&&function(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}(this,e.size),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),n&&this.update(),this}},{key:"fromState",value:function(e,t){return(0,o.Z)((0,s.Z)(r.prototype),"fromState",this).call(this,e),this.fromDirectionalLightState(e,t),this}}],[{key:"createFromState",value:function(e,t,n){var i=(new r).fromState(t,n);return i.uuid=e,i}}]),r}(Dd(Ph(w.DirectionalLight),Od)),Bd=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;(0,g.Z)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];(e=t.call.apply(t,[this].concat(i))).objectType="LightPoint",e._gizmos={},e.castShadow=!0,e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024,e.shadow.normalBias=1;var o=e.shadow.camera;o.fov=90,o.aspect=1,o.near=100,o.far=2500;var s=new w.Vector3(-o.far+e.position.x,-o.far+e.position.y,-o.far+e.position.z),l=new w.Vector3(o.far+e.position.x,o.far+e.position.y,o.far+e.position.z),u=new w.Box3(s,l),c=new w.Box3Helper(u,new w.Color(16755200));return c.visible=!1,e._gizmos.shadowmap=c,e.update(),e}return(0,y.Z)(r,[{key:"gizmos",get:function(){return this._gizmos}},{key:"showGizmos",value:function(){for(var e in this._gizmos){var t=this._gizmos[e];t instanceof w.Box3Helper&&(t.visible=!0)}}},{key:"hideGizmos",value:function(){for(var e in this._gizmos){var t=this._gizmos[e];t instanceof w.Box3Helper&&(t.visible=!1)}}},{key:"update",value:function(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this._gizmos))for(var e in this._gizmos){var t=this._gizmos[e];if(t instanceof w.Box3Helper){var r=this.shadow.camera,n=new w.Vector3(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),i=new w.Vector3(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z);t.box.set(n,i),t.updateMatrixWorld(!0)}}}},{key:"updateMatrixWorld",value:function(e){(0,o.Z)((0,s.Z)(r.prototype),"updateMatrixWorld",this).call(this,e),!0===this.enableHelper&&!0===this.objectHelper.visible&&this.objectHelper.update()}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e,t),this.color.copy(e.color),this.intensity=e.intensity,this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},{key:"toJSON",value:function(e){var t=(0,o.Z)((0,s.Z)(r.prototype),"toJSON",this).call(this,e),n=t.object;return n.objectType="LightPoint",n.color=this.color.getHex(),n.intensity=this.intensity,n.distance=this.distance,n.decay=this.decay,n.shadow=this.shadow.toJSON(),t}},{key:"fromJSON",value:function(e){var t,n;(0,o.Z)((0,s.Z)(r.prototype),"fromJSON",this).call(this,e),this.color.set(e.color),this.intensity=e.intensity,this.distance=e.distance,this.decay=e.decay,this.shadow.normalBias=null!==(t=e.shadow.normalBias)&&void 0!==t?t:0,this.shadow.radius=e.shadow.radius,this.shadow.mapSize.fromArray(null!==(n=e.shadow.mapSize)&&void 0!==n?n:[512,512]),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null);var i=this.shadow.camera,a=e.shadow.camera;return i.near=a.near,i.far=a.far,i.zoom=a.zoom,i.fov=a.fov,i.focus=a.focus,i.aspect=a.aspect,i.filmGauge=a.filmGauge,i.filmOffset=a.filmOffset,void 0!==a.view&&(i.view=Object.assign({},a.view)),this}},{key:"fromPointLightState",value:function(e,t){return(0,o.Z)((0,s.Z)(r.prototype),"fromLightState",this).call(this,e,t),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),this}},{key:"fromState",value:function(e,t){return(0,o.Z)((0,s.Z)(r.prototype),"fromState",this).call(this,e),this.fromPointLightState(e,t),this}}],[{key:"createFromState",value:function(e,t,n){var i=(new r).fromState(t,n);return i.uuid=e,i}}]),r}(Dd(Ph(w.PointLight),Ld)),Ud=new w.Vector3,Id=new w.Vector3,Vd=new w.Quaternion,Fd=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;(0,g.Z)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];(e=t.call.apply(t,[this].concat(i))).objectType="LightSpot",e._gizmos={},e.castShadow=!0,e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024,e.shadow.normalBias=1;var o=e.shadow.camera;o.fov=2*w.MathUtils.RAD2DEG*e.angle,o.aspect=1,o.near=100,o.far=2500;var s=new w.CameraHelper(e.shadow.camera);return s.visible=!1,e._gizmos.shadowmap=s,e.update(),e}return(0,y.Z)(r,[{key:"gizmos",get:function(){return this._gizmos}},{key:"showGizmos",value:function(){for(var e in this._gizmos){var t=this._gizmos[e];t instanceof w.CameraHelper&&(t.visible=!0)}}},{key:"hideGizmos",value:function(){for(var e in this._gizmos){var t=this._gizmos[e];t instanceof w.CameraHelper&&(t.visible=!1)}}},{key:"update",value:function(){for(var e in this.shadow.camera.updateProjectionMatrix(),this._gizmos){var t=this._gizmos[e];t instanceof w.CameraHelper&&t.update()}}},{key:"updateMatrixWorld",value:function(e){(0,o.Z)((0,s.Z)(r.prototype),"updateMatrixWorld",this).call(this,e),Id.setFromMatrixPosition(this.matrixWorld),Vd.setFromRotationMatrix(this.matrixWorld),Ud.copy(this.up).applyQuaternion(Vd).negate().multiplyScalar(this.distance),this.target.position.copy(Id).add(Ud),this.target.updateMatrixWorld(),!0===this.enableHelper&&!0===this.objectHelper.visible&&this.objectHelper.update()}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,o.Z)((0,s.Z)(r.prototype),"copy",this).call(this,e,t),this.color.copy(e.color),this.intensity=e.intensity,this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},{key:"toJSON",value:function(e){var t=(0,o.Z)((0,s.Z)(r.prototype),"toJSON",this).call(this,e),n=t.object;return n.objectType="LightSpot",n.color=this.color.getHex(),n.intensity=this.intensity,n.distance=this.distance,n.angle=this.angle,n.decay=this.decay,n.penumbra=this.penumbra,n.shadow=this.shadow.toJSON(),t}},{key:"fromJSON",value:function(e){var t;(0,o.Z)((0,s.Z)(r.prototype),"fromJSON",this).call(this,e),this.color.set(e.color),this.intensity=e.intensity,this.distance=e.distance,this.angle=e.angle,this.decay=e.decay,this.penumbra=e.penumbra,this.shadow.normalBias=null!==(t=e.shadow.normalBias)&&void 0!==t?t:0,this.shadow.radius=e.shadow.radius,this.shadow.mapSize.fromArray(e.shadow.mapSize);var n=this.shadow.camera,i=e.shadow.camera;return n.near=i.near,n.far=i.far,n.zoom=i.zoom,n.fov=i.fov,n.focus=i.focus,n.aspect=i.aspect,n.filmGauge=i.filmGauge,n.filmOffset=i.filmOffset,void 0!==i.view&&(n.view=Object.assign({},i.view)),this}},{key:"fromSpotLightState",value:function(e,t){return(0,o.Z)((0,s.Z)(r.prototype),"fromLightState",this).call(this,e,t),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.angle&&(this.angle=e.angle),void 0!==e.penumbra&&(this.penumbra=e.penumbra),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),this}},{key:"fromState",value:function(e,t){return(0,o.Z)((0,s.Z)(r.prototype),"fromState",this).call(this,e),this.fromSpotLightState(e,t),this}}],[{key:"createFromState",value:function(e,t,n){var i=(new r).fromState(t,n);return i.uuid=e,i}}]),r}(Dd(Ph(w.SpotLight),Md)),jd=function(e){return"VIDEO"===e.tagName},Rd=function(){function e(){(0,g.Z)(this,e)}return(0,y.Z)(e,null,[{key:"resize",value:function(e,t,r){var n,i=e/t;if(r.image){var a=r.image;i>(n=jd(a)?a.videoWidth/a.videoHeight:a.width/a.height)&&("WEBCAM"==r.imageType?r.repeat.set(-1,1*n/i):r.repeat.set(1,1*n/i)),i<n&&("WEBCAM"==r.imageType?r.repeat.set(1*i/n*-1,1):r.repeat.set(1*i/n,1)),i==n&&("WEBCAM"==r.imageType?r.repeat.set(-1,1):r.repeat.set(1,1))}}},{key:"resizeTextureLayer",value:function(e,t,r){var n,i=e/t,a=void 0!==r.image?r.image.width/r.image.height:1;n=i>a?{x:1,y:a/i}:i<a?{x:i/a,y:1}:{x:1,y:1},r.repeat.set(n.x,n.y),r.updateMatrix()}},{key:"resizeTextureLayers",value:function(t,r,n){for(var i=n.userData.layers,a=i.getLayers(),o=0;o<a.length;o++){var s=a[o];dc(s)&&(e.resizeTextureLayer(t,r,s.uniforms["f".concat(s.id,"_texture")].value),i.updateLayerUniform())}}},{key:"resizeComplex",value:function(e,t,r,n){var i,a=e/t,o=r.image;i=jd(o)?o.videoWidth/o.videoHeight:o.width/o.height,n.geometry.type.includes("Shape")?(a>i&&("WEBCAM"==r.imageType?r.repeat.set(1/e*-1,1/t*i/a):r.repeat.set(1/e,1/t*i/a)),a<i&&("WEBCAM"==r.imageType?r.repeat.set(1/e*a/i*-1,1/t):r.repeat.set(1/e*a/i,1/t)),a==i&&("WEBCAM"==r.imageType?r.repeat.set(1/e*-1,1/t):r.repeat.set(1/e,1/t))):(a>i&&("WEBCAM"==r.imageType?r.repeat.set(-1,1*i/a):r.repeat.set(1,1*i/a)),a<i&&("WEBCAM"==r.imageType?r.repeat.set(1*a/i*-1,1):r.repeat.set(1*a/i,1)),a==i&&("WEBCAM"==r.imageType?r.repeat.set(-1,1):r.repeat.set(1,1)))}}]),e}(),Gd=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jc;return(0,g.Z)(this,r),(n=t.call(this,e,i)).objectType="Mesh2D",n.castShadow=!0,n.receiveShadow=!0,n}return(0,y.Z)(r,[{key:"updateGeometry",value:function(e){(0,o.Z)((0,s.Z)(r.prototype),"updateGeometry",this).call(this,e),this.material.userData.layers&&Rd.resizeTextureLayers(this.geometry.userData.parameters.width,this.geometry.userData.parameters.height,this.material)}},{key:"resizeGeometry",value:function(e,t){(0,o.Z)((0,s.Z)(r.prototype),"resizeGeometry",this).call(this,e,t,0),this.material.userData.layers&&Rd.resizeTextureLayers(this.geometry.userData.parameters.width,this.geometry.userData.parameters.height,this.material)}},{key:"toJSON",value:function(e){var t=(0,o.Z)((0,s.Z)(r.prototype),"toJSON",this).call(this,e);return t.object.objectType="Mesh2D",t}},{key:"clone",value:function(){var e=(0,o.Z)((0,s.Z)(r.prototype),"clone",this).call(this);return e.updateGeometry({}),e}}],[{key:"fromTexture",value:function(e){var t,n;if(e instanceof w.VideoTexture){var i=e.image;t=.5*i.videoWidth,n=.5*i.videoHeight}else{var a=e.image;t=.5*a.width,n=.5*a.height}var o=Xl.create({parameters:{width:t,height:n}}),s=new Jc;return s.layersList.changeLayer(0,{type:"texture",texture:e}),s.layersList.moveLayer(0,1),s.dispose(),new r(o,s)}}]),r}(Bh),Hd=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kc;return(0,g.Z)(this,r),(n=t.call(this,e,i)).objectType="Mesh3D",n.castShadow=!0,n.receiveShadow=!0,n}return(0,y.Z)(r,[{key:"toJSON",value:function(e){var t=(0,o.Z)((0,s.Z)(r.prototype),"toJSON",this).call(this,e);return t.object.objectType="Mesh3D",t}}]),r}(Bh),Wd=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kc;return(0,g.Z)(this,r),(n=t.call(this,e,i)).objectType="NonParametric",n}return(0,y.Z)(r,[{key:"toJSON",value:function(e){var t=(0,o.Z)((0,s.Z)(r.prototype),"toJSON",this).call(this,e);return t.object.objectType="NonParametric",t}}]),r}(Hd),qd=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n,i=e.char,a=e.originalChar,o=e.fontFamily,s=e.letterSpacing,l=e.fontSize,u=e.LOD,c=void 0===u?16:u,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w.MeshBasicMaterial({color:0,opacity:1,visible:!0,transparent:!0,side:w.DoubleSide});(0,g.Z)(this,r);var d=r.loadChar(i,o,c);return(n=t.call(this,d.geometry,h)).char=i,n.originalChar=null!==a&&void 0!==a?a:i,n.fontFamily=o,n.letterSpacing=s,n.fontSize=l,n.LOD=c,n.resolution=d.resolution,n.glyphsHa=d.glyphsHa,n.localPosition=new w.Vector2,n.charSize=0,n.geometry.userData={type:"CharacterGeometry",parameters:{char:n.char,fontFamily:n.fontFamily,letterSpacing:n.letterSpacing,fontSize:n.fontSize,lod:n.LOD,resolution:n.resolution,charSize:n.charSize,localPosition:n.localPosition}},n.updateFontSize(n.fontSize),n}return(0,y.Z)(r,[{key:"updatePosition",value:function(e,t){this.localPosition.copy(e);var r=new w.Vector3(this.localPosition.x,-this.localPosition.y,0);this.position.copy(r).add(t)}},{key:"updateFontSize",value:function(e){var t=e/this.resolution;this.fontSize=e,this.scale.set(this.fontSize,this.fontSize,1),this.charSize=this.glyphsHa*t*this.letterSpacing}},{key:"updateFontFamily",value:function(e){if(this.fontFamily!==e){this.fontFamily=e;var t=r.loadChar(this.char,e,this.LOD);this.geometry=t.geometry,this.resolution=t.resolution,this.glyphsHa=t.glyphsHa,this.geometry.userData={type:"CharacterGeometry",parameters:{char:this.char,fontFamily:this.fontFamily,letterSpacing:this.letterSpacing,fontSize:this.fontSize,lod:this.LOD,resolution:this.resolution,charSize:this.charSize,localPosition:this.localPosition}},this.updateFontSize(this.fontSize)}}},{key:"updateChar",value:function(e){if(this.char!==e){this.char=e;var t=r.loadChar(e,this.fontFamily,this.LOD);this.geometry=t.geometry,this.resolution=t.resolution,this.glyphsHa=t.glyphsHa,this.geometry.userData={type:"CharacterGeometry",parameters:{char:this.char,fontFamily:this.fontFamily,letterSpacing:this.letterSpacing,fontSize:this.fontSize,lod:this.LOD,resolution:this.resolution,charSize:this.charSize,localPosition:this.localPosition}},this.updateFontSize(this.fontSize)}}},{key:"updateLetterSpacing",value:function(e){this.letterSpacing!==e&&(this.letterSpacing=e,this.updateFontSize(this.fontSize))}},{key:"updateLOD",value:function(e){if(this.LOD!==e){this.LOD=e;var t=r.loadChar(this.char,this.fontFamily,this.LOD);this.geometry=t.geometry,this.resolution=t.resolution,this.glyphsHa=t.glyphsHa,this.geometry.userData={type:"CharacterGeometry",parameters:{char:this.char,fontFamily:this.fontFamily,letterSpacing:this.letterSpacing,fontSize:this.fontSize,lod:this.LOD,resolution:this.resolution,charSize:this.charSize,localPosition:this.localPosition}},this.updateFontSize(this.fontSize)}}},{key:"clone",value:function(){return new r({char:this.char,originalChar:this.originalChar,fontFamily:this.fontFamily,letterSpacing:this.letterSpacing,fontSize:this.fontSize,LOD:this.LOD}).copy(this)}}],[{key:"FONTS_PATH",get:function(){return r._fontPath},set:function(e){r._fontPath=e}},{key:"loadFont",value:function(e){return new Promise((function(t,n){r.fontCache[e]?t(r.fontCache[e]):(new S).load(r.FONTS_PATH+e+".json",(function(n){r.fontCache[e]=n,t(n)}),void 0,n)}))}},{key:"loadChar",value:function(e,t,n){if(r.charCache[e]){if(r.charCache[e][n]&&r.charCache[e][n].fontFamily===t)return r.charCache[e][n]}else r.charCache[e]={};var i=r.fontCache[t],a=i.generateShapes(e,1);return r.charCache[e][n]={geometry:new w.ShapeBufferGeometry(a,n),fontFamily:t,resolution:i.data.resolution,glyphsHa:i.data.glyphs[e].ha},r.charCache[e][n]}}]),r}(w.Mesh),Jd=qd;Jd.charCache={},Jd.fontCache={},Jd._fontPath="/_assets/_fonts/";var Yd=new w.Vector2,Xd=function(){function e(t,r,n){(0,g.Z)(this,e),this.message=[],this.endLine=!0,this.yLinePos=t,this.lineHeight=r,this.maxCharSize=n,this.nextChar3DPos=new w.Vector2(0,this.yLinePos+this.maxCharSize*this.lineHeight),this.align=1}return(0,y.Z)(e,[{key:"addChar3D",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.message.length;this.message.splice(r,0,e),e.fontSize>this.maxCharSize?(this.maxCharSize=e.fontSize,this.nextChar3DPos.y=this.yLinePos+this.maxCharSize*this.lineHeight,this.fullUpdate(t)):(e.updatePosition(this.nextChar3DPos,t),this.nextChar3DPos.x+=e.charSize)}},{key:"deleteChar3D",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.message.length-1,t=this.message[e];if(t)return this.message.splice(e,1),this.nextChar3DPos.x-=t.charSize,t}},{key:"isEndLine",value:function(e){this.endLine=e}},{key:"fullUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.nextChar3DPos.x=0;for(var r=t,n=this.message.length;r<n;r+=1)this.message[r].updatePosition(this.nextChar3DPos,e),this.nextChar3DPos.x+=this.message[r].charSize}},{key:"checkOverFlow",value:function(e){var t,r=this.message.length-1;if(r<=0)return!1;for(;r>=0;){if(" "!==this.message[r].char){t=this.message[r];break}r-=1}return!!(r>=0&&t&&t.localPosition.x+t.charSize>e)}},{key:"containSpaceOverFlow",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.message.length-1,t=e;t>=0;t-=1)if(" "===this.message[t].char)return!0;return!1}},{key:"containSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.message.length-1;if(this.endLine)return!0;for(var t=e;t>=0;t-=1)if(" "===this.message[t].char)return!0;return!1}},{key:"popWord",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.message.length-1,r=[],n=!0;for(e=t;e>=0;e-=1){if(" "===this.message[e].char){n=!1,0===r.length&&(e-=1,r.splice(0,0,this.message[e]));break}r.splice(0,0,this.message[e])}return n?r=[]:this.message.splice(e+1,r.length),r}},{key:"getWord",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=[],n=e;for(n=e;;n+=t){if(!this.message[n]||" "===this.message[n].char){0===r.length&&this.message[n]&&(r.push(this.message[n]),this.message.splice(n,1));break}t>0?(r.push(this.message[n]),this.message.splice(n,1),n-=t):(r.splice(0,0,this.message[n]),this.message.splice(n,1))}return r}},{key:"getWordAtIndex",value:function(e){for(var t=[],r=e;r<this.message.length&&" "!==this.message[r].char;r++)t.push(this.message[r]);for(var n=e-1;n>=0&&" "!==this.message[n].char;n--)t.splice(0,0,this.message[n]);return t}},{key:"wordSize",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=0,n=e;n>=0&&n<this.message.length;){if(" "===this.message[n].char){0===r&&(r=this.message[n].charSize);break}r+=this.message[n].charSize,n+=t}return(n<0||n>=this.message.length)&&!this.endLine?this.message[e]?this.message[e].charSize:999999999:0===r?999999999:r}},{key:"spaceLeft",value:function(e){return e-this.nextChar3DPos.x}},{key:"popChar",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.message.length-1;return this.nextChar3DPos.x-=this.message[e].charSize,this.message.splice(e,1)}},{key:"isEmpty",value:function(){return!this.message.length}},{key:"updateNextCharPosY",value:function(){this.nextChar3DPos.y=this.yLinePos+this.maxCharSize*this.lineHeight}},{key:"updateYLinePos",value:function(e){this.yLinePos=e,this.updateNextCharPosY()}},{key:"updatelineHeight",value:function(e){this.lineHeight=e,this.updateNextCharPosY()}},{key:"updateFontSize",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.message.length-1,n=t;n<=r;n+=1)this.message[n].updateFontSize(e);this.maxCharSize=e,this.nextChar3DPos.y=this.yLinePos+this.maxCharSize*this.lineHeight}},{key:"countSpaces",value:function(){for(var e=0,t=0;t<this.message.length;t++)" "===this.message[t].char&&(e+=1);return e}},{key:"alignText",value:function(e,t,r,n,i){switch(r){case 1:this.leftAlign(e,i);break;case 3:this.centerAlign(this.spaceLeft(t),e,i);break;case 2:this.rightAlign(this.spaceLeft(t),e,i);break;case 4:this.justifyAlign(this.spaceLeft(t),e,i)}}},{key:"offsetCharacters",value:function(e,t,r){Yd.set(t,r);for(var n=this.message.length,i=0;i<n;i++)this.message[i].updatePosition(this.message[i].localPosition.add(Yd),e)}},{key:"leftAlign",value:function(e,t){this.align=1,this.offsetCharacters(e,0,t)}},{key:"centerAlign",value:function(e,t,r){this.align=3,this.offsetCharacters(t,e/2,r)}},{key:"rightAlign",value:function(e,t,r){this.align=2,this.offsetCharacters(t,e,r)}},{key:"justifyAlign",value:function(e,t,r){if(this.align=4,this.endLine)this.offsetCharacters(t,0,r);else{var n=this.countSpaces();if(0!==n)for(var i=e/n,a=0,o=0;o<this.message.length;o++)" "===this.message[o].char&&(a+=i),Yd.set(a,r),this.message[o].updatePosition(this.message[o].localPosition.add(Yd),t);else this.offsetCharacters(t,0,r)}}},{key:"clone",value:function(){var t=new e(this.yLinePos,this.lineHeight,this.maxCharSize);t.nextChar3DPos=this.nextChar3DPos.clone(),t.align=this.align,t.endLine=this.endLine;for(var r=0;r<this.message.length;r++)t.message.push(this.message[r].clone());return t}}]),e}(),Kd=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jc({transparent:!0,opacity:1,visible:!1,side:w.DoubleSide});return(0,g.Z)(this,r),(n=t.call(this,e,i)).objectType="TextFrame",n.charContainer=new w.Object3D,n.add(n.charContainer),n.material.visible=!1,n._geometryUserData=e.userData,n.userData.textFrame={hexColor:null,opacity:1,visible:!0,text:"",fontSize:16,lineHeight:1.5,letterSpacing:1,fontFamily:"roboto_regular",textTransform:1,horizontalAlignment:1,verticalAlignment:1,LOD:16,maxLineSize:n._geometryUserData.parameters.width,textOrigin:new w.Vector3(-.5*n._geometryUserData.parameters.width,.5*n._geometryUserData.parameters.height,0),textLines:[]},n.createTextLine(),n}return(0,y.Z)(r,[{key:"updateText",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,a,o,s,l,u=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.clearText(),r=this.userData.textFrame,i=r.fontFamily,e.next=4,Jd.loadFont(i);case 4:r.text=t,a=r.textOrigin,o=new w.MeshBasicMaterial({visible:r.visible,transparent:!0,side:w.DoubleSide}),s=t.split("\n"),l=0,this.userData.textFrame.textLines=s.map((function(e,t){var n=new Xd(l,r.lineHeight,r.fontSize);return n.message=e.split("").map((function(e){var t={char:e,fontFamily:i,letterSpacing:r.letterSpacing,fontSize:r.fontSize,LOD:16},s=o.clone();s.color=r.hexColor,s.opacity=r.opacity;var l=new Jd(t,s);return n.addChar3D(l,a),u.charContainer.add(l),l})),l+=n.maxCharSize*n.lineHeight,n})),this.textFullUpdate(),this.checkOverFlow();case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"clearText",value:function(){for(var e=this.userData.textFrame.textLines;this.charContainer.children.length;){var t=this.charContainer.children[0];this.charContainer.remove(t)}for(;e.length;)e.pop()}},{key:"raycast",value:function(e,t){var n=[];if((0,o.Z)((0,s.Z)(r.prototype),"raycast",this).call(this,e,n),n.length>0)t.push(n[0]);else for(var i=[],a=0,l=this.charContainer.children.length;a<l;++a)if(this.charContainer.children[a]instanceof Jd&&(e.intersectObject(this.charContainer.children[a],!1,i),i.length>0))return i[0].object=this,void t.push(i[0])}},{key:"updateGeometry",value:function(e){var t,n,i,a,l=this.userData,u=this.geometry.userData,c=u.parameters.width,h=u.parameters.height,d=null!==(t=null===(n=e.parameters)||void 0===n?void 0:n.width)&&void 0!==t?t:c,f=null!==(i=null===(a=e.parameters)||void 0===a?void 0:a.height)&&void 0!==i?i:h,v=l.textFrame;(0,o.Z)((0,s.Z)(r.prototype),"updateGeometry",this).call(this,e),v.maxLineSize=d,v.textOrigin.set(-.5*d,.5*f,0),f!==h?(this.checkOverFlow(),this.checkCapacity()):d!==c&&(c<d?this.checkCapacity():c>d&&this.checkOverFlow())}},{key:"checkOverFlow",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.userData,r=t.textFrame.textOrigin,n=t.textFrame.textLines,i=e;i<n.length;i++){n[i].updateYLinePos(this.getNewLinePosition(i)),n[i].fullUpdate(r);for(var a=[];n[i].checkOverFlow(t.textFrame.maxLineSize);)n[i].containSpaceOverFlow()?a.unshift(n[i].getWord(n[i].message.length-1,-1)):a.unshift(n[i].popChar());if(a.length>0){void 0===n[i+1]?(n[i].isEndLine(!1),this.createTextLine()):n[i].endLine&&(this.createTextLine(i+1),n[i].isEndLine(!1),n[i+1].isEndLine(!0));for(var o=0,s=0;s<a.length;s+=1)for(var l=0;l<a[s].length;l+=1)n[i+1].addChar3D(a[s][l],r,o),o+=1;n[i+1].fullUpdate(r)}n[i].fullUpdate(r)}this.textFullUpdate(e)}},{key:"checkCapacity",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.userData,r=t.textFrame.textOrigin,n=t.textFrame.maxLineSize,i=t.textFrame.textLines,a=e;a<i.length;a+=1)if(i[a].updateYLinePos(this.getNewLinePosition(a)),i[a].fullUpdate(r),i[a-1])for(;!i[a-1].endLine;){var o=void 0,s=i[a-1].spaceLeft(n);if(!(i[a].wordSize(0,1)<=s)){i[a].isEmpty()?(i[a].endLine&&i[a-1].isEndLine(!0),i.splice(a,1),a-=1):(i[a].updateYLinePos(this.getNewLinePosition(a)),i[a].fullUpdate(r));break}o=i[a].containSpace()?i[a].getWord(0,1):i[a].popChar(0);for(var l=0;l<o.length;l+=1)o[l]&&i[a-1].addChar3D(o[l],r)}this.textFullUpdate(e)}},{key:"createTextLine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.userData.textFrame.textLines.length,t=this.userData.textFrame;t.textLines.splice(e,0,new Xd(this.getNewLinePosition(e),t.lineHeight,t.fontSize))}},{key:"textFullUpdate",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.userData.textFrame,r=t.textLines,n=this.getVerticalAlignmentOffSet(),i=e;i<r.length;i++)r[i].updateYLinePos(this.getNewLinePosition(i)),r[i].fullUpdate(t.textOrigin),r[i].alignText(t.textOrigin,t.maxLineSize,t.horizontalAlignment,t.verticalAlignment,n)}},{key:"getVerticalAlignmentOffSet",value:function(){switch(this.userData.textFrame.verticalAlignment){case 1:default:return 0;case 2:return this.getRemainingVerticalSpace()/2;case 3:return this.getRemainingVerticalSpace()}}},{key:"getRemainingVerticalSpace",value:function(){var e=this.userData.textFrame.textLines;return this.geometry.userData.parameters.height-this.getNewLinePosition(e.length)}},{key:"getNewLinePosition",value:function(e){for(var t=this.userData.textFrame.textLines,r=0,n=0;n<e;n+=1)r+=t[n].maxCharSize*t[n].lineHeight;return r}},{key:"updateColor",value:function(e){var t=this.userData;t.textFrame.hexColor=e;for(var r=t.textFrame.textLines,n=0;n<r.length;n++)for(var i=r[n].message,a=0;a<i.length;a++){var o,s=i[a].material;(null===(o=s.color)||void 0===o?void 0:o.isColor)&&(s.color=e)}}},{key:"updateOpacity",value:function(e){var t=this.userData;t.textFrame.opacity=e;for(var r=t.textFrame.textLines,n=0;n<r.length;n++)for(var i=r[n].message,a=0;a<i.length;a++){i[a].material.opacity=e}}},{key:"updateVisible",value:function(e){var t=this.userData;t.textFrame.visible=e;for(var r=t.textFrame.textLines,n=0;n<r.length;n++)for(var i=r[n].message,a=0;a<i.length;a++){i[a].material.visible=e}}},{key:"updateFontFamily",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,a,o,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jd.loadFont(t);case 2:for(r=this.userData.textFrame,i=r.textLines,r.fontFamily=t,a=0;a<i.length;a++)for(o=i[a].message,s=0;s<o.length;s++)o[s].updateFontFamily(t);this.textFullUpdate(),this.checkOverFlow(),this.checkCapacity();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateFontSize",value:function(e){var t=this.userData.textFrame,r=t.textLines,n=t.fontSize;t.fontSize=e;for(var i=0;i<r.length;i++)r[i].updateFontSize(e);this.textFullUpdate(),e>n?this.checkOverFlow():e<n&&this.checkCapacity()}},{key:"updateTextTransform",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,a,o,s,l,u,c,h,d,f;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.userData.textFrame,e.next=3,Jd.loadFont(r.fontFamily);case 3:i=r.textLines,e.t0=(r.textTransform=t,t),e.next=2===e.t0?7:3===e.t0?9:11;break;case 7:for(a=0;a<i.length;a++)for(o=i[a].message,s=0;s<o.length;s++)i[a].message[s].updateChar(o[s].char.toUpperCase());return e.abrupt("break",12);case 9:for(l=0;l<i.length;l++)for(u=i[l].message,c=0;c<u.length;c++)i[l].message[c].updateChar(u[c].char.toLowerCase());return e.abrupt("break",12);case 11:for(h=0;h<i.length;h++)for(d=i[h].message,f=0;f<d.length;f++)i[h].message[f].updateChar(d[f].originalChar);case 12:this.textFullUpdate(),this.checkOverFlow(),this.checkCapacity();case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateLetterSpacing",value:function(e){var t=this.userData,r=t.textFrame.textLines;t.textFrame.letterSpacing=e;for(var n=0;n<r.length;n++)for(var i=r[n].message,a=0;a<i.length;a++)i[a].updateLetterSpacing(e);this.textFullUpdate(),this.checkOverFlow(),this.checkCapacity()}},{key:"updateLOD",value:function(e){var t=this.userData;t.textFrame.LOD=e;for(var r=t.textFrame.textLines,n=0;n<r.length;n++);this.textFullUpdate(),this.checkOverFlow(),this.checkCapacity()}},{key:"updateLineHeight",value:function(e){var t=this.userData,r=t.textFrame.textLines;t.textFrame.lineHeight=e;for(var n=0;n<r.length;n++)r[n].updatelineHeight(e);this.textFullUpdate()}},{key:"updateVerticalAlignment",value:function(e){this.userData.textFrame.verticalAlignment=e,this.textFullUpdate()}},{key:"updateHorizontalAlignment",value:function(e){this.userData.textFrame.horizontalAlignment=e,this.textFullUpdate()}},{key:"toJSON",value:function(e){var t=(0,o.Z)((0,s.Z)(r.prototype),"toJSON",this).call(this,e),n=t.object;n.objectType="TextFrame";var i=this.userData.textFrame.textLines.map((function(e){var t=e.message.map((function(e){return{char:e.char,originalChar:e.originalChar,fontFamily:e.fontFamily,letterSpacing:e.letterSpacing,fontSize:e.fontSize,LOD:e.LOD}}));return{align:e.align,endLine:e.endLine,lineHeight:e.lineHeight,maxCharSize:e.maxCharSize,yLinePos:e.yLinePos,message:t}}));return n.userData.textFrame.textLinesData=i,t}},{key:"fromJSONasync",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var i,a,l=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,o.Z)((0,s.Z)(r.prototype),"fromJSON",this).call(this,t),void 0===t.userData){e.next=7;break}return i=t.userData.textFrame,e.next=4,Jd.loadFont(i.fontFamily);case 4:i.textOrigin=new w.Vector3(i.textOrigin.x,i.textOrigin.y,i.textOrigin.z),a=new w.MeshBasicMaterial({color:i.hexColor,opacity:i.opacity,visible:i.visible,transparent:!0,side:w.DoubleSide}),i.textLinesData&&(i.textLines=i.textLinesData.map((function(e,t){var r=new Xd(Number(e.yLinePos),Number(e.lineHeight),Number(e.maxCharSize)),n=e.message.map((function(e,n){if(void 0===e.char){var o=i.textLines[t].message[n];if("geometries"in o){var s=o.geometries[0].userData.parameters;Object.assign(e,{LOD:s.lod,char:s.char,fontFamily:s.fontFamily,fontSize:s.fontSize,letterSpacing:s.letterSpacing,originalChar:s.char})}}var u={char:e.char,fontFamily:e.fontFamily,letterSpacing:Number(e.letterSpacing),fontSize:Number(e.fontSize),LOD:e.LOD},c=new Jd(u,a.clone());return r.addChar3D(c,i.textOrigin),l.charContainer.add(c),c}));return r.message=n,r})),this.userData.textFrame=i),this.textFullUpdate();case 7:return e.abrupt("return",this);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fromTextFrameData",value:function(e,t){if(void 0!==e.color){var r=sh(e.color,t);this.updateColor(r),this.updateOpacity(r.a)}void 0!==e.alpha&&this.updateOpacity(e.alpha),void 0!==e.font&&this.updateFontFamily(e.font),void 0!==e.horizontalAlign&&this.updateHorizontalAlignment(e.horizontalAlign),void 0!==e.verticalAlign&&this.updateVerticalAlignment(e.verticalAlign),void 0!==e.textTransform&&this.updateTextTransform(e.textTransform),void 0!==e.fontSize&&this.updateFontSize(e.fontSize),void 0!==e.lineHeight&&this.updateLineHeight(e.lineHeight),void 0!==e.letterSpacing&&this.updateLetterSpacing(e.letterSpacing),void 0!==e.text&&""!==e.text&&this.updateText(e.text),(void 0!==e.width||void 0!==e.height)&&this.updateGeometry({parameters:{width:e.width,height:e.height}})}},{key:"fromState",value:function(e,t){return(0,o.Z)((0,s.Z)(r.prototype),"fromState",this).call(this,e),this.fromTextFrameData(e,t),this}},{key:"convertToVector",value:function(){var e=this.userData.textFrame,t=e.fontFamily,r=e.hexColor,n=new Pd;n.name="Text Shape";var i,a=Jd.fontCache[t],o=(0,b.Z)(this.charContainer.children);try{var s=function(){var e=i.value;e instanceof Jd&&a.generateShapes(e.char,1).forEach((function(t){var i=(new js).fromShape(t);i.applyScale(e.scale.x,e.scale.y);var a=vl.create({shape:i}),o=new Jc({side:w.DoubleSide});o.color=r;var s=new jh(a,o);s.name=e.char,s.position.copy(e.position),s.rotation.copy(e.rotation),n.attach(s)}))};for(o.s();!(i=o.n()).done;)s()}catch(l){o.e(l)}finally{o.f()}return n}}],[{key:"createFromState",value:function(e,t,n){var i=new r(ru.create({parameters:{width:t.width,height:t.height}})).fromState(t,n);return i.uuid=e,i}}]),r}(Bh),Qd=Kd;Qd.VerticalAlign=Ho,Qd.HorizontalAlign=Go,Qd.TextTransform=Wo;var $d,ef=function(e,t,r){return r=null!=e?M(E(e)):{},function(e,t,r,n){if(t&&"object"==typeof t||"function"==typeof t){var i,a=(0,b.Z)(z(t));try{var o=function(){var a=i.value;!P.call(e,a)&&a!==r&&D(e,a,{get:function(){return t[a]},enumerable:!(n=T(t,a))||n.enumerable})};for(a.s();!(i=a.n()).done;)o()}catch(s){a.e(s)}finally{a.f()}}return e}(!t&&e&&e.__esModule?r:D(r,"default",{value:e,enumerable:!0}),e)}(B());fu.then((function(e){$d=e}));var tf=new w.Matrix4,rf=new w.Matrix4,nf=new w.Matrix4,af=new w.Box3,of=new w.Vector3,sf=new w.Matrix4,lf=new w.Matrix4,uf=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Kc;return(0,g.Z)(this,r),(a=t.call(this,null!==i&&void 0!==i?i:n,o)).subdivPointer=e,a.originalGeometry=n,a.subdividedGeometry=i,a.objectType="SubdivObject",a.hiddenMatrixOld=new w.Matrix4,a.smoothShading=!0,a.phongAngle=35,a.matrixWorldRigid=new w.Matrix4,a.castShadow=!0,a.receiveShadow=!0,a.forceComputeSize=!1,a}return(0,y.Z)(r,[{key:"shallowClone",value:function(e){return new Wd(this.geometry,this.material).shallowCopy(this,e)}},{key:"toJSON",value:function(e){var t=(0,o.Z)((0,s.Z)(r.prototype),"toJSON",this).call(this,e);return t.object.objectType="SubdivObject",t}},{key:"buildFromStore",value:function(e,t){var r,n,i,a=qh.build(e,t,this.subdivPointer,this.smoothShading,this.shearScale),o=a.originalGeometry,s=a.subdividedGeometry,l=a.subdivPointer;if(void 0!==e.phongAngle&&(this.phongAngle=e.phongAngle),this.subdivPointer=l,void 0!==o&&(null!==(r=this.originalGeometry)&&void 0!==r&&r.dispose(),this.originalGeometry=o),void 0!==s&&(null!==(n=this.subdividedGeometry)&&void 0!==n&&n.dispose(),this.subdividedGeometry=null!==s&&void 0!==s?s:void 0),this.geometry=null!==(i=this.subdividedGeometry)&&void 0!==i?i:this.originalGeometry,this.cloner){var u,c=(0,b.Z)(this.cloner.children);try{for(c.s();!(u=c.n()).done;){u.value.geometry=this.geometry}}catch(h){c.e(h)}finally{c.f()}}e.width&&(this.geometry.userData.parameters={width:e.width,height:e.height,depth:e.depth})}},{key:"updateMesh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];qh.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e?this.shearScaleInv:void 0),this.subdividedGeometry&&qh.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e?this.shearScaleInv:void 0)}},{key:"updateTopology",value:function(){var e;this.originalGeometry.dispose(),this.originalGeometry=qh.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=qh.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.geometry=null!==(e=this.subdividedGeometry)&&void 0!==e?e:this.originalGeometry}},{key:"raycast",value:function(e,t){var r;this.geometry=this.originalGeometry,Bh.prototype.raycast.call(this,e,t),this.geometry=null!==(r=this.subdividedGeometry)&&void 0!==r?r:this.originalGeometry}},{key:"updateMatrixWorldSVD",value:function(){var e=this.matrixWorld.elements,t=[[e[0],e[4],e[8]],[e[1],e[5],e[9]],[e[2],e[6],e[10]]],r=(0,ef.SVD)(t),n=r.u,i=r.v,a=r.q,o=tf.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),s=rf.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),l=nf.copy(s).transpose();this.shearScale=sf.makeScale(a[0],a[1],a[2]).multiply(l).premultiply(s),this.shearScaleInv=lf.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(o,l),a.every((function(e){return Math.abs(a[0]-e)<.01}))&&(this.shearScale=void 0,this.shearScaleInv=void 0)}},{key:"activateSVDCompensation",value:function(){void 0!==this.shearScale&&(this.matrixAutoUpdate=!1,this.matrix.copy(this.matrixWorldRigid).copyPosition(this.matrixWorld),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}},{key:"deactivateSVDCompensation",value:function(){void 0!==this.shearScale&&(this.shearScale=void 0,this.shearScaleInv=void 0,this.matrixAutoUpdate=!0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}},{key:"calcBoundingBox",value:function(){var e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new w.Sphere);var t=e.attributes.position,r=e.boundingSphere.center;af.setFromBufferAttribute(t),af.getCenter(r),e.boundingSphere.radius=r.distanceTo(af.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),af.getSize(of);var n={width:of.x,height:of.y,depth:of.z};return this.geometry.userData.parameters=n,n}},{key:"updateBoundingBox",value:function(e){var t=this.originalGeometry;af.min.set(e[0],e[2],e[4]),af.max.set(e[1],e[3],e[5]),this.shearScaleInv&&(af.min.applyMatrix4(this.shearScaleInv),af.max.applyMatrix4(this.shearScaleInv)),null===t.boundingSphere&&(t.boundingSphere=new w.Sphere);var r=t.boundingSphere.center;af.getCenter(r),t.boundingSphere.radius=r.distanceTo(af.max),isNaN(t.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),af.getSize(of);var n={width:of.x,height:of.y,depth:of.z};return this.geometry.userData.parameters=n,n}},{key:"freeSubdivPointer",value:function(){this.subdivPointer&&($d.free_bvh(this.subdivPointer),$d.free_subdivision_surface(this.subdivPointer),this.subdivPointer=0)}},{key:"updateGeometry",value:function(e){this.geometry.userData.scale||(this.geometry.userData.scale=Array(3)),this.geometry.userData.scale[0]=0===this.geometry.userData.parameters.width?1:e.parameters.width/this.geometry.userData.parameters.width,this.geometry.userData.scale[1]=0===this.geometry.userData.parameters.height?1:e.parameters.height/this.geometry.userData.parameters.height,this.geometry.userData.scale[2]=0===this.geometry.userData.parameters.depth?1:e.parameters.depth/this.geometry.userData.parameters.depth,cf.apply(void 0,[this.originalGeometry.attributes].concat((0,c.Z)(this.geometry.userData.scale))),this.originalGeometry.attributes.position.needsUpdate=!0,this.originalGeometry.attributes.normal.needsUpdate=!0,this.subdividedGeometry&&(cf.apply(void 0,[this.subdividedGeometry.attributes].concat((0,c.Z)(this.subdividedGeometry.userData.scale))),this.subdividedGeometry.attributes.position.needsUpdate=!0,this.subdividedGeometry.attributes.normal.needsUpdate=!0),this.geometry.userData.parameters=(0,x.Z)({},e.parameters)}}],[{key:"createFromState",value:function(e,t,n){var i=qh.build(t.geometry,void 0,void 0,!t.flatShading),a=new r(i.subdivPointer,i.originalGeometry,i.subdividedGeometry||void 0,dh(t.material,n));return void 0!==t.geometry.phongAngle&&(a.phongAngle=t.geometry.phongAngle),a.calcBoundingBox(),a.freeSubdivPointer(),a.uuid=e,a.fromState(t),a}}]),r}(Bh);function cf(e,t,r,n){for(var i,a,o,s=e.position.array,l=e.normal.array,u=tf.makeScale(t,r,n).invert().elements,c=0,h=s.length;c<h;c+=3)s[c]*=t,s[c+1]*=r,s[c+2]*=n,i=l[c],a=l[c+1],o=l[c+2],l[c]=u[0]*i+u[4]*a+u[8]*o,l[c+1]=u[1]*i+u[5]*a+u[9]*o,l[c+2]=u[2]*i+u[6]*a+u[10]*o}function hf(e,t){void 0!==t.flatShading&&(e.flatShading=t.flatShading,e.needsUpdate=!0),void 0!==t.wireframe&&(e.wireframe=t.wireframe),void 0!==t.side&&(0===t.side?e.side=w.FrontSide:1===t.side?e.side=w.BackSide:e.side=w.DoubleSide)}function df(e,t,r){var n;if("SubdivGeometry"===t.geometry.type)n=uf.createFromState(e,t,r);else{var i="BooleanGeometry"===t.geometry.type?new w.BufferGeometry:Rh(t.geometry),a="materials"in t?function(e,t){return e.map((function(e){return dh(e,t)}))}(t.materials,r):dh(t.material,r);zo.is2DParametricMesh(i.userData.type)?n=new Gd(i,a):"VectorGeometry"===(null===i||void 0===i?void 0:i.userData.type)?n=new jh(i,a):"NonParametricGeometry"===t.geometry.type?n=new Wd(i,a):"BooleanGeometry"===t.geometry.type?((n=new pd(void 0,a)).booleanOp=t.geometry.operation,void 0!==t.geometry.phongAngle&&(n.phongAngle=t.geometry.phongAngle)):n=new Hd(i,a),n.uuid=e,n.fromState(t)}return function(e,t){if(Array.isArray(e.material)){var r,n=(0,b.Z)(e.material);try{for(n.s();!(r=n.n()).done;)hf(r.value,t)}catch(i){n.e(i)}finally{n.f()}}else hf(e.material,t);"SubdivObject"===e.objectType&&void 0!==t.flatShading&&(e.material.flatShading=!1,e.smoothShading=!t.flatShading,e.updateMesh())}(n,t),n}function ff(e,t,r){if(!r.userData.layers)return!1;var n=!1,i=r.userData.layers.getLayersOfType("transmission");return i.length>0?(t.layers.set(3),n=!0,void 0!==e&&i.forEach((function(t){return function(e,t){t.uniforms["f".concat(t.id,"_transmissionSamplerMap")].value=e.texture,t.uniforms["f".concat(t.id,"_transmissionDepthMap")].value=e.depthTexture}(e,t)}))):t.layers.set(0),n}function vf(e,t){"material"in e&&function(e,t){(function(e){return Array.isArray(e)?e:[e]})(e).forEach((function(e){t.isSharedMaterial(e)||e.dispose()}))}(e.material,t),"geometry"in e&&e.geometry.dispose()}var pf,mf=new w.Vector3,gf=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e,n){var i;return(0,g.Z)(this,r),(i=t.call(this)).objectType="Scene",i.alpha=1,i.backupFog=new w.Fog(16777215,.1,2e3),i.fogUseBGColor=!1,i.wireframeState=!1,i.needsTransmissionDirty=!0,i._needsTransmission=!1,i._color=new w.Color(1,0,0),i.bgColor=new w.Color(1,1,1),i.entityByUuid={},i.ambientLight=new w.HemisphereLight(13882323,8553090,.75),i.ambientLight.name="Default Ambient Light",i.personalCamera=i.createPersonalCamera(),i.activeCamera=i.personalCamera,i.sharedAssetManager=n,i.init(e,n),i}return(0,y.Z)(r,[{key:"needsTransmission",value:function(e){return this.needsTransmissionDirty&&(this._needsTransmission=function(e,t){var r=!1;return t.traverseEntity((function(t){if(t instanceof Bh)if(Array.isArray(t.material))for(var n=0;n<t.material.length;n++)ff(e,t,t.material[n])&&(r=!0);else ff(e,t,t.material)&&(r=!0)})),r}(e,this),void 0!==e&&(this.needsTransmissionDirty=!1)),this._needsTransmission}},{key:"find",value:function(e){if(""!==e&&void 0!==e){var t=this.entityByUuid[e];return void 0===t?this.getObjectByProperty("uuid",e):t}}},{key:"color",get:function(){return this._color},set:function(e){!0===this.fogUseBGColor&&this.backupFog.color.copy(e),this._color.copy(e)}},{key:"enableFog",get:function(){return null!==this.fog},set:function(e){this.fog=!0===e?this.backupFog:null}},{key:"init",value:function(e,t){if(this.createChildrenObjects(e.objects,this,t),this.personalCamera.removeFromParent(),this.add(this.personalCamera),this.ambientLight.removeFromParent(),this.add(this.ambientLight),this.setBackgroundColor(sh(e.backgroundColor,t)),this.updateFog(e.fog,t),this.updateAmbientLight(e.environment.ambientLight,t),this.activeCamera=this.personalCamera,null!==e.publish.playCamera){var r=this.find(e.publish.playCamera);r instanceof Ed&&this.switchActiveCamera(r)}this.traverse((function(e){gh(e)&&e.recomputeBoolean()}))}},{key:"clearScene",value:function(e){this.traverseEntity((function(t){vf(t,e)}));var t,r=(0,b.Z)(this.children);try{for(r.s();!(t=r.n()).done;){var n=t.value;zh(n)&&n.removeFromParent()}}catch(i){r.e(i)}finally{r.f()}}},{key:"resetAfterClear",value:function(e,t){this.init(e,t)}},{key:"createPersonalCamera",value:function(){var e=Ed.createFromState(r.PERSONAL_CAMERA_ID,(0,x.Z)((0,x.Z)({},Vo.defaultData),{},{name:"Personal Camera"}));return e.enableHelper=!1,e.objectHelper.visible=!1,delete e.isEntity,this.registerObjectCreatedInLegacy(e),e}},{key:"raycast",value:function(e){var t=[];return function r(n){var i,a=(0,b.Z)(n.children);try{for(a.s();!(i=a.n()).done;){var o=i.value;zh(o)&&!o.raycastLock&&o.visible&&((mh(o)||xh(o)&&o.enableHelper&&o.objectHelper.parent)&&e.intersectObject(o,!1,t),r(o))}}catch(s){a.e(s)}finally{a.f()}}(this),t}},{key:"traverseEntity",value:function(e){var t,r=(0,b.Z)(this.children);try{for(r.s();!(t=r.n()).done;){var n=t.value;zh(n)&&n.traverseEntity(e)}}catch(i){r.e(i)}finally{r.f()}}},{key:"updateFog",value:function(e,t){this.enableFog=e.enabled,this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=sh(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}},{key:"toJSON",value:function(e){return{}}},{key:"fromJSON",value:function(e){return this}},{key:"dispose",value:function(){this.clearScene(this.sharedAssetManager),this.sharedAssetManager.dispose()}},{key:"updateAmbientLight",value:function(e,t){(function(e,t,r){bh(e,t),void 0!==t.color&&(e.color=sh(t.color,r)),void 0!==t.intensity&&(e.intensity=t.intensity),void 0!==t.shadows&&!(e instanceof w.HemisphereLight)&&(e.castShadow=t.shadows),e.shadow&&!(e instanceof w.HemisphereLight)&&void 0!==t.depth&&(e.shadow.camera.far=t.depth,e.shadow.needsUpdate=!0),void 0!==t.helper&&xh(e)&&(e.enableHelper=t.helper,e.gizmos.shadowmap.visible=t.helper)})(this.ambientLight,e,t),void 0!==e.groundColor&&(this.ambientLight.groundColor=sh(e.groundColor,t)),void 0!==e.enabled&&(this.ambientLight.visible=e.enabled)}},{key:"switchActiveCamera",value:function(e){this.activeCamera!==this.personalCamera&&(this.activeCamera.enableHelper=!0),this.activeCamera=e,e.enableHelper=!1}},{key:"setBackgroundColor",value:function(e){this.bgColor=e,this.alpha=e.a}},{key:"createChildrenObjects",value:function(e,t,r){var n,i=(0,b.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;this.createChildObject(a.id,a.data,a.children,t,r)}}catch(o){i.e(o)}finally{i.f()}}},{key:"registerObjectCreatedInLegacy",value:function(e){this.entityByUuid[e.uuid]=e}},{key:"unregisterObject",value:function(e){delete this.entityByUuid[e.uuid];var t,r=(0,b.Z)(e.children);try{for(r.s();!(t=r.n()).done;){var n=t.value;this.unregisterObject(n)}}catch(i){r.e(i)}finally{r.f()}}},{key:"createChildObject",value:function(e,t,r,n,i){var a=function(e,t,r){return"Mesh"===t.type?df(e,t,r):"TextFrame"===t.type?Qd.createFromState(e,t,r):"Empty"===t.type?Pd.createFromState(e,t):"PointLight"===t.type?Bd.createFromState(e,t,r):"SpotLight"===t.type?Fd.createFromState(e,t,r):"DirectionalLight"===t.type?Nd.createFromState(e,t,r):ai.is(t.type)?Ed.createFromState(e,t):(console.error(t),new Pd)}(e,t,i);return a&&(this.entityByUuid[e]=a,n.add(a),gh(n)&&mh(a)&&(a.prevBooleanObjectParent=n),this.createChildrenObjects(r,a,i)),a}},{key:"getCenter",value:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var i=e[r],a=i.id,o=i.recursive,s=this.find(a),l=o?s.recursiveBBox:s.singleBBox;t.push.apply(t,(0,c.Z)(l.vertices))}var u=new w.Box3;return u.setFromPoints(t),u.getCenter(mf),mf}},{key:"copyMatrixWorld",value:function(e,t){if(null!==e){var r=this.find(e);r?t.copy(r.matrixWorld):t.identity()}else t.identity()}},{key:"copyParentMatrixWorld",value:function(e,t){var r;if(null!==e){var n=null===(r=this.find(e))||void 0===r?void 0:r.parent;n?t.copy(n.matrixWorld):t.identity()}else t.identity()}},{key:"traverseMaterial",value:function(e){this.traverseEntity((function(t){if(t instanceof Bh)if(Array.isArray(t.material))for(var r=0;r<t.material.length;r++)e(t.material[r]);else e(t.material)}))}},{key:"updateCanvasSize",value:function(e,t){var r,n;this.activeCamera.setViewplaneSize(e,t),e>=t?(r=t/e,n=1):(r=1,n=e/t),this.traverseMaterial((function(e){e.layersList.getLayersOfType("transmission").forEach((function(e){e.uniforms["f".concat(e.id,"_aspectRatio")].value.x=r,e.uniforms["f".concat(e.id,"_aspectRatio")].value.y=n}))}))}}]),r}(Th(w.Scene)),yf=gf;function xf(){return pf||(pf=new Z).setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload(),pf.decoderPending}function bf(e){return wf.apply(this,arguments)}function wf(){return wf=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!pf){e.next=13;break}return r={attributeIDs:pf.defaultAttributeIDs,attributeTypes:pf.defaultAttributeTypes,useUniqueIDs:!1},e.prev=2,e.next=5,pf.decodeGeometry(new Int8Array(t).buffer,r);case 5:i=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.error(e.t0);case 11:if(!i){e.next=13;break}return e.abrupt("return",{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map((function(e){var t=(0,u.Z)(e,2),r=t[0],n=t[1];return{name:r,itemSize:n.itemSize,array:n.array}}))});case 13:return e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[2,8]])}))),wf.apply(this,arguments)}function Sf(e){return kf.apply(this,arguments)}function kf(){return kf=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,a,o,s,l,c,h,d;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Ji(go.deserialize(new Uint8Array(t))),i=(0,u.Z)(r,2),a=i[0],o=i[1],s=[],a.scene.objects.traverse((function(e,t){"Mesh"===t.type&&"NonParametricGeometry"===t.geometry.type&&void 0!==t.geometry.data.draco&&s.push(t)})),e.t0=s.length,!e.t0){e.next=6;break}return e.next=6,xf();case 6:l=0,c=s;case 7:if(!(l<c.length)){e.next=16;break}return h=c[l],e.next=11,bf(Xi(h.geometry.data.draco));case 11:(d=e.sent)&&function(){d.index&&(h.geometry.data.index={array:d.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});var e={};d.attributes.forEach((function(t){var r=t.name,n=t.array,i=t.itemSize;e[r]={array:n,itemSize:i,type:"Float32Array",normalized:!1}})),h.geometry.data.attributes=e,h.geometry.data.draco=void 0}();case 13:l++,e.next=7;break;case 16:return e.abrupt("return",o.result().data);case 17:case"end":return e.stop()}}),e)}))),kf.apply(this,arguments)}yf.PERSONAL_CAMERA_ID="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera";var _f=new Map,Cf={url:"head",time:0,data:null,next:null,prev:null},Of={url:"tail",time:1/0,data:null,next:null,prev:null};Cf.next=Of,Of.prev=Cf;var Zf=0;function Lf(e){if("string"==typeof e)return e;var t=Date.now(),r=_f.get(e);return void 0===r?(r={url:URL.createObjectURL(new Blob([e])),data:e,time:t,next:null,prev:null},_f.set(e,r)):(r.time=t,r.prev.next=r.next,r.next.prev=r.prev),r.prev=Of.prev,r.next=Of,Of.prev.next=r,Of.prev=r,t-Zf>1e4&&(Zf=t+1e3,setTimeout((function(){for(var e=Date.now(),t=Cf.next;t.time<e-1e4;)URL.revokeObjectURL(t.url),_f.delete(t.data),(t=t.next).prev=Cf,Cf.next=t}),900)),r.url}var Af=new Jc,Mf=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){return(0,g.Z)(this,r),t.apply(this,arguments)}return(0,y.Z)(r)}(Su),Df=function(){function e(t){(0,g.Z)(this,e),this.materials={},this.images={},this.colors={},this.transmissionRenderTarget=new w.WebGLRenderTarget(2048,2048,{generateMipmaps:!0,minFilter:w.LinearMipmapLinearFilter,magFilter:w.LinearFilter,wrapS:w.ClampToEdgeWrapping,wrapT:w.ClampToEdgeWrapping}),this.transmissionRenderTarget.depthTexture=new w.DepthTexture(2048,2048),this.penumbraSizeNode=new pc(5,t.penumbraSize),this.reset(t)}return(0,y.Z)(e,[{key:"reset",value:function(e){for(var t=0,r=Object.entries(e.images);t<r.length;t++){var n=(0,u.Z)(r[t],2),i=n[0],a=n[1];this.addImage(i,a.data)}for(var o=0,s=Object.entries(e.colors);o<s.length;o++){var l=(0,u.Z)(s[o],2),c=l[0],h=l[1];this.addColor(c,h)}for(var d=0,f=Object.entries(e.materials);d<f.length;d++){var v=(0,u.Z)(f[d],2),p=v[0],m=v[1];this.addMaterial(p,fh(m,this))}}},{key:"transmissionSamplerMap",get:function(){return this.transmissionRenderTarget.texture}},{key:"transmissionDepthMap",get:function(){return this.transmissionRenderTarget.depthTexture}},{key:"addMaterial",value:function(e,t){t.uuid=e,this.materials[e]=t}},{key:"deleteMaterial",value:function(e){this.materials[e]&&(this.materials[e].dispose(),delete this.materials[e])}},{key:"isSharedMaterial",value:function(e){return e.uuid in this.materials||e===Af}},{key:"getMaterial",value:function(e){return this.materials[e]}},{key:"getMaterialOrDeletedPlaceholder",value:function(e){var t;return null!==(t=this.materials[e])&&void 0!==t?t:Af}},{key:"getMaterials",value:function(){return this.materials}},{key:"addImage",value:function(e,t){var r=this;if(this.images[e])return this.images[e].onload=function(){r.onImageLoad&&r.onImageLoad()},this.images[e].src=Lf(t),!0;var n=new Image;return n.src=Lf(t),n.onload=function(){r.onImageLoad&&r.onImageLoad()},this.images[e]=n,!1}},{key:"deleteImage",value:function(e){this.images[e]&&delete this.images[e]}},{key:"getDefaultImage",value:function(){return this.images.image_0}},{key:"getImage",value:function(e){return this.images[e]}},{key:"getImages",value:function(){return this.images}},{key:"addColor",value:function(e,t){return this.colors[e]?("a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):(this.colors[e]=new Mf(t.r,t.g,t.b,"a"in t?t.a:1),!1)}},{key:"updateColor",value:function(e,t){if(this.colors[e]){var r,n,i,a,o=this.colors[e];return this.colors[e].r=null!==(r=t.r)&&void 0!==r?r:o.r,this.colors[e].g=null!==(n=t.g)&&void 0!==n?n:o.g,this.colors[e].b=null!==(i=t.b)&&void 0!==i?i:o.b,this.colors[e].a=null!==(a=t.a)&&void 0!==a?a:o.a,!0}return!1}},{key:"deleteColor",value:function(e){this.colors[e]&&delete this.colors[e]}},{key:"getColor",value:function(e){return this.colors[e]}},{key:"dispose",value:function(){var e=this;Object.keys(this.materials).forEach((function(t){return e.deleteMaterial(t)})),this.transmissionRenderTarget.depthTexture.dispose(),this.transmissionRenderTarget.dispose(),this.onImageLoad=void 0}}]),e}();function Tf(e){var t=new Set;return e.traverse((function(e){if(mh(e))if(ee(e.material))e.material.forEach((function(e){var r=e;t.has(r)||t.add(r)}));else{var r=e.material;t.has(r)||t.add(r)}})),t.forEach((function(e){if(!(e instanceof Array)){var t=e.onBeforeCompile.bind(e);!function(e){return e.userData.layers.getLayersOfType("transmission").length>0}(e)?function(e){for(var t=e.userData.layers.head,r=0;void 0!==t;){if("light"!==t.type&&"fresnel"!==t.type){var n=t.uniforms["f"+t.id+"_alpha"];n&&(r+=(1-r)*n.value)}t=t.next}return r<1}(e)||(e.onBeforeCompile=function(r,n){t&&t(r,n),e.transparent=!1}):(Object.assign(e,{isMeshStandardMaterial:!0,isMeshPhysicalMaterial:!0,transmission:1,attenuationColor:new w.Color,specularColor:new w.Color}),e.onBeforeCompile=function(r,n){t&&t(r,n),r.uniforms=Object.assign(w.ShaderLib.physical.uniforms,r.uniforms),e.userData.layers.getLayersOfType("transmission").forEach((function(e){r.uniforms.transmissionSamplerMap.value&&(e.uniforms["f"+e.id+"_transmissionSamplerMap"].value=r.uniforms.transmissionSamplerMap.value,e.uniforms["f"+e.id+"_transmissionSamplerSize"].value=r.uniforms.transmissionSamplerSize.value)}))})}})),e}function zf(e){return e.traverse((function(e){if("Camera"===e.type){var t=e;t.type=t.cameraType}})),e}function Ef(e){var t=[],r=function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=n>0?r+n:r;return t.includes(i)?e(r,n+1):i};return e.traverse((function(e){if(t.includes(e.name)){var n=e.name,i=r(e.name);if(e.name=i,e.isMesh){var a=e;a.material instanceof Array?a.material.forEach((function(e){e.name=e.name.replace(n,i)})):a.material.isAsset||(a.material.name=a.material.name.replace(n,i))}}t.push(e.name)})),e}function Pf(e){var t=[];return e.traverse((function(e){e instanceof Nh&&t.push(e)})),t.forEach((function(e){var t=e.object,r=e.children,n=r.map((function(e){e.updateMatrix();var t=e.geometry.clone().applyMatrix4(e.matrix);return e.matrix.determinant()<0&&function(e){var t;if(e.index)for(var r=0;r<e.index.array.length;r+=3)t=e.index.array[r],e.index.array[r]=e.index.array[r+2],e.index.array[r+2]=t}(t),t})),i=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=null!==e[0].index,n=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),a={},o={},s=e[0].morphTargetsRelative,l=new w.BufferGeometry,u=0,c=0;c<e.length;++c){var h=e[c],d=0;if(r!==(null!==h.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(var f in h.attributes){if(!n.has(f))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+'. All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[f]&&(a[f]=[]),a[f].push(h.attributes[f]),d++}if(d!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". Make sure all geometries have the same number of attributes."),null;if(s!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(var v in h.morphAttributes){if(!i.has(v))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===o[v]&&(o[v]=[]),o[v].push(h.morphAttributes[v])}if(l.userData.mergedUserData=l.userData.mergedUserData||[],l.userData.mergedUserData.push(h.userData),t){var p=void 0;if(r)p=h.index.count;else{if(void 0===h.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". The geometry must have either an index or a position attribute"),null;p=h.attributes.position.count}l.addGroup(u,p,c),u+=p}}if(r){for(var m=0,g=[],y=0;y<e.length;++y){for(var x=e[y].index,b=0;b<x.count;++b)g.push(x.getX(b)+m);m+=e[y].attributes.position.count}l.setIndex(g)}for(var S in a){var k=A(a[S]);if(!k)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+S+" attribute."),null;l.setAttribute(S,k)}for(var _ in o){var C=o[_][0].length;if(0===C)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[_]=[];for(var O=0;O<C;++O){for(var Z=[],L=0;L<o[_].length;++L)Z.push(o[_][L][O]);var M=A(Z);if(!M)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+_+" morphAttribute."),null;l.morphAttributes[_].push(M)}}return l}(e.parameters.hideBase?n:[t.geometry].concat((0,c.Z)(n)));t.geometry=i,t.material=r[0].material,t.remove(e)})),e}function Nf(e){return e.traverse((function(e){e.matrixAutoUpdate=!0})),e}var Bf="The SplineLoader only accepts .splinecode files that are generated from Spline export panel.",Uf=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(){return(0,g.Z)(this,r),t.apply(this,arguments)}return(0,y.Z)(r,[{key:"load",value:function(e,t,r){var a=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.error,s=new w.FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),e.endsWith(".spline")?console.warn(Bf+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(Bf),s.load(e,function(){var e=(0,i.Z)((0,n.Z)().mark((function e(r){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"string"!=typeof r){e.next=3;break}throw new Error("The .spline file is not binary!");case 3:return e.next=5,a.parse(r);case 5:i=e.sent,t(i),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),o(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),r,o)}},{key:"parse",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i,a,o,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Sf(t);case 2:return r=e.sent,i=new Df(r.shared),Object.values(i.getMaterials()).forEach((function(e){return Object.assign(e,{isAsset:!0})})),(a=new yf(r.scene,i)).remove(a.personalCamera),r.scene.environment.ambientLight.enabled||a.remove(a.ambientLight),(o=r.scene.publish.playCamera)&&(s=a.find(o))&&yh(s)&&Object.assign(s,{makeDefault:!0}),e.abrupt("return",a=Nf(a=Ef(a=zf(a=Tf(a=Pf(a))))));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),r}(w.Loader),If=r(9324);function Vf(e){var t=(0,If.z)(Uf,e);return(0,If.y)(t)}}}]);
//# sourceMappingURL=674.c15108b3.chunk.js.map